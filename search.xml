<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>tmuxå¸¸è§å‘½ä»¤æ•´ç†</title>
      <link href="/2024/08/01/tmux%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/"/>
      <url>/2024/08/01/tmux%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="tmuxå¸¸è§å‘½ä»¤æ•´ç†"><a href="#tmuxå¸¸è§å‘½ä»¤æ•´ç†" class="headerlink" title="tmuxå¸¸è§å‘½ä»¤æ•´ç†"></a>tmuxå¸¸è§å‘½ä»¤æ•´ç†</h1><p>tmuxæ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç»ˆç«¯å¤ç”¨å™¨ï¼Œå…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ªç»ˆç«¯çª—å£ä¸­è¿è¡Œå¤šä¸ªç»ˆç«¯ä¼šè¯ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿™äº›ä¼šè¯ä¹‹é—´è‡ªç”±åˆ‡æ¢ã€‚ä»¥ä¸‹æ˜¯tmuxçš„ä¸€äº›å¸¸è§å‘½ä»¤åŠå…¶åŠŸèƒ½ï¼š</p><h3 id="ä¼šè¯æ“ä½œ"><a href="#ä¼šè¯æ“ä½œ" class="headerlink" title="ä¼šè¯æ“ä½œ"></a>ä¼šè¯æ“ä½œ</h3><ol><li><p><strong>æ–°å»ºä¼šè¯</strong></p><ul><li><code>tmux</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œå¦‚æœä¸æŒ‡å®šåç§°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤åç§°ã€‚</li><li><code>tmux new -s &lt;session_name&gt;</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œå¹¶æŒ‡å®šä¼šè¯åç§°ã€‚</li></ul></li><li><p><strong>é€€å‡ºä¼šè¯</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>d</code>ï¼šåˆ†ç¦»å½“å‰ä¼šè¯ï¼ˆé€€å‡ºä¼šè¯ç•Œé¢ï¼Œä½†ä¼šè¯ä»åœ¨åå°è¿è¡Œï¼‰ã€‚</li></ul></li><li><p><strong>æŸ¥çœ‹æ‰€æœ‰ä¼šè¯</strong></p><ul><li><code>tmux ls</code> æˆ– <code>tmux list-sessions</code>ï¼šåˆ—å‡ºæ‰€æœ‰å·²å­˜åœ¨çš„ä¼šè¯ã€‚</li></ul></li><li><p><strong>æ¢å¤ä¼šè¯</strong></p><ul><li><code>tmux attach -t &lt;session_name&gt;</code> æˆ– <code>tmux a -t &lt;session_name&gt;</code>ï¼šè¿æ¥åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„ä¼šè¯ã€‚</li></ul></li><li><p><strong>é‡å‘½åä¼šè¯</strong></p><ul><li><code>tmux rename-session -t &lt;old_name&gt; &lt;new_name&gt;</code>ï¼šé‡å‘½åä¸€ä¸ªå·²å­˜åœ¨çš„ä¼šè¯ã€‚</li></ul></li><li><p><strong>å…³é—­ä¼šè¯</strong></p><ul><li><code>tmux kill-session -t &lt;session_name&gt;</code>ï¼šç»ˆæ­¢ä¸€ä¸ªå·²å­˜åœ¨çš„ä¼šè¯ã€‚</li></ul></li></ol><h3 id="çª—å£æ“ä½œ"><a href="#çª—å£æ“ä½œ" class="headerlink" title="çª—å£æ“ä½œ"></a>çª—å£æ“ä½œ</h3><ol><li><p><strong>æ–°å»ºçª—å£</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>c</code>ï¼šåœ¨å½“å‰ä¼šè¯ä¸­åˆ›å»ºä¸€ä¸ªæ–°çª—å£ã€‚</li></ul></li><li><p><strong>åˆ‡æ¢çª—å£</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>&lt;çª—å£åºå·&gt;</code>ï¼šåˆ‡æ¢åˆ°æŒ‡å®šåºå·çš„çª—å£ã€‚</li><li><code>Ctrl + b</code> åæ¥ <code>p</code>ï¼šåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªçª—å£ã€‚</li><li><code>Ctrl + b</code> åæ¥ <code>n</code>ï¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçª—å£ã€‚</li><li><code>Ctrl + b</code> åæ¥ <code>w</code>ï¼šè¿›å…¥çª—å£é€‰æ‹©åˆ—è¡¨ï¼Œé€šè¿‡æ–¹å‘é”®å’Œå›è½¦é”®é€‰æ‹©çª—å£ã€‚</li></ul></li><li><p><strong>é‡å‘½åçª—å£</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>,</code>ï¼šé‡å‘½åå½“å‰çª—å£ã€‚</li></ul></li><li><p><strong>å…³é—­çª—å£</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>&amp;</code>ï¼šå…³é—­å½“å‰çª—å£ã€‚</li></ul></li></ol><h3 id="çª—æ ¼æ“ä½œ"><a href="#çª—æ ¼æ“ä½œ" class="headerlink" title="çª—æ ¼æ“ä½œ"></a>çª—æ ¼æ“ä½œ</h3><ol><li><p><strong>åˆ’åˆ†çª—æ ¼</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>%</code>ï¼šå°†å½“å‰çª—å£åˆ’åˆ†ä¸ºå·¦å³ä¸¤ä¸ªçª—æ ¼ã€‚</li><li><code>Ctrl + b</code> åæ¥ <code>&quot;</code>ï¼šå°†å½“å‰çª—å£åˆ’åˆ†ä¸ºä¸Šä¸‹ä¸¤ä¸ªçª—æ ¼ã€‚</li></ul></li><li><p><strong>åˆ‡æ¢æ´»åŠ¨çª—æ ¼</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>&lt;æ–¹å‘é”®&gt;</code>ï¼šåœ¨çª—æ ¼ä¹‹é—´åˆ‡æ¢ã€‚</li></ul></li><li><p><strong>è°ƒæ•´çª—æ ¼å¤§å°</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>&lt;æ–¹å‘é”®&gt;</code>ï¼ˆåŒæ—¶æŒ‰ä½ï¼‰ï¼šä»¥1ä¸ªå•å…ƒæ ¼ä¸ºå•ä½è°ƒæ•´å½“å‰çª—æ ¼çš„è¾¹ç¼˜ã€‚</li><li><code>Alt + æ–¹å‘é”®</code>ï¼šä»¥5ä¸ªå•å…ƒæ ¼ä¸ºå•ä½è°ƒæ•´å½“å‰çª—æ ¼çš„è¾¹ç¼˜ï¼ˆå–å†³äºé…ç½®ï¼‰ã€‚</li></ul></li><li><p><strong>å…³é—­çª—æ ¼</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>x</code>ï¼šå…³é—­å½“å‰çª—æ ¼ã€‚</li></ul></li><li><p><strong>çª—æ ¼å¸ƒå±€åˆ‡æ¢</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>ç©ºæ ¼é”®</code>ï¼šåœ¨é¢„ç½®çš„çª—æ ¼å¸ƒå±€ä¸­å¾ªç¯åˆ‡æ¢ã€‚</li></ul></li></ol><h3 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h3><ol><li><p><strong>æ–‡æœ¬å¤åˆ¶æ¨¡å¼</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>[</code>ï¼šè¿›å…¥æ–‡æœ¬å¤åˆ¶æ¨¡å¼ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨æ–¹å‘é”®å’Œç¿»é¡µé”®æ¥é€‰æ‹©æ–‡æœ¬ï¼ŒæŒ‰ <code>Enter</code> é”®å¤åˆ¶é€‰ä¸­çš„æ–‡æœ¬ï¼ŒæŒ‰ <code>q</code> é€€å‡ºå¤åˆ¶æ¨¡å¼ã€‚</li></ul></li><li><p><strong>ä¼šè¯å¿«æ·é”®æç¤º</strong></p><ul><li><code>Ctrl + b</code> åæ¥ <code>?</code>ï¼šåˆ—å‡ºæ‰€æœ‰å¿«æ·é”®ï¼ŒæŒ‰ <code>q</code> è¿”å›ã€‚</li></ul></li><li><p><strong>é…ç½®é€‰é¡¹</strong></p><ul><li>tmuxçš„é…ç½®é€šå¸¸ä¿å­˜åœ¨ç”¨æˆ·çš„å®¶ç›®å½•ä¸‹çš„<code>.tmux.conf</code>æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ç¼–è¾‘è¯¥æ–‡ä»¶æ¥è‡ªå®šä¹‰tmuxçš„è¡Œä¸ºå’Œå¤–è§‚ã€‚</li></ul></li></ol><p>è¯·æ³¨æ„ï¼Œtmuxçš„å¿«æ·é”®å‰ç¼€é»˜è®¤æ˜¯<code>Ctrl + b</code>ï¼Œä½†ç”¨æˆ·å¯ä»¥åœ¨<code>.tmux.conf</code>æ–‡ä»¶ä¸­é€šè¿‡<code>set -g prefix &lt;new-prefix&gt;</code>å‘½ä»¤æ¥æ›´æ”¹è¿™ä¸ªå‰ç¼€ã€‚æ­¤å¤–ï¼Œtmuxè¿˜æä¾›äº†ä¸°å¯Œçš„å‘½ä»¤å’Œé…ç½®é€‰é¡¹ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡<code>man tmux</code>æˆ–<code>tmux --help</code>å‘½ä»¤æ¥æŸ¥çœ‹æ›´å¤šä¿¡æ¯ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸è§å‘½ä»¤é€ŸæŸ¥</title>
      <link href="/2024/07/30/Linux%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/"/>
      <url>/2024/07/30/Linux%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="Linuxå‘½ä»¤é€ŸæŸ¥â€”ç¨‹åºç¾Š"><a href="#Linuxå‘½ä»¤é€ŸæŸ¥â€”ç¨‹åºç¾Š" class="headerlink" title="Linuxå‘½ä»¤é€ŸæŸ¥â€”ç¨‹åºç¾Š"></a>Linuxå‘½ä»¤é€ŸæŸ¥â€”ç¨‹åºç¾Š</h1><p><img src="/../img/Linux/1.jpg" alt="1"></p><p><img src="/../img/Linux/2.jpg" alt="2"></p><p><img src="/../img/Linux/3.jpg" alt="3"></p><p><img src="/../img/Linux/4.jpg" alt="4"></p><p><img src="/../img/Linux/5.jpg" alt="5"></p><p><img src="/../img/Linux/6.jpg" alt="6"></p><p><img src="/../img/Linux/7.jpg" alt="7"></p><p><img src="/../img/Linux/8.jpg" alt="8"></p><p><img src="/../img/Linux/9.jpg" alt="9"></p><p><img src="/../img/Linux/10.jpg" alt="10"></p><p><img src="/../img/Linux/11.jpg" alt="11"></p><p><img src="/../img/Linux/12.jpg" alt="12"></p><p><img src="/../img/Linux/13.jpg" alt="13"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RNNå­¦ä¹ ç¬”è®°ï¼ˆæ…å…¥ï¼‰</title>
      <link href="/2024/07/04/RNN%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/07/04/RNN%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="RNNå­¦ä¹ ç¬”è®°â€”å°±é™†ç† é¹è‡ªå·±çœ‹å¾—æ‡‚"><a href="#RNNå­¦ä¹ ç¬”è®°â€”å°±é™†ç† é¹è‡ªå·±çœ‹å¾—æ‡‚" class="headerlink" title="RNNå­¦ä¹ ç¬”è®°â€”å°±é™†ç† é¹è‡ªå·±çœ‹å¾—æ‡‚"></a>RNNå­¦ä¹ ç¬”è®°â€”å°±é™†ç† é¹è‡ªå·±çœ‹å¾—æ‡‚</h1><p><img src="/../img/note/1.jpg" alt="1"></p><p><img src="/../img/note/2.jpg" alt="2"></p><p><img src="/../img/note/3.jpg" alt="3"></p><p><img src="/../img/note/4.jpg" alt="4"></p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
            <tag> note </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch9RNNå¾ªç¯ç¥ç»ç½‘ç»œ</title>
      <link href="/2024/07/04/Pytorch9-RNN%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
      <url>/2024/07/04/Pytorch9-RNN%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="RNNå¾ªç¯ç¥ç»ç½‘ç»œ"><a href="#RNNå¾ªç¯ç¥ç»ç½‘ç»œ" class="headerlink" title="RNNå¾ªç¯ç¥ç»ç½‘ç»œ"></a>RNNå¾ªç¯ç¥ç»ç½‘ç»œ</h1><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°"></a>å¾ªç¯ç¥ç»ç½‘ç»œçš„ä»é›¶å¼€å§‹å®ç°</h2><p>å…ˆè¯»å–æ•°æ®é›†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">batch_size, num_steps = <span class="number">32</span>, <span class="number">35</span></span><br><span class="line">train_iter, vocab = d2l.load_data_time_machine(batch_size, num_steps)</span><br></pre></td></tr></table></figure><h3 id="ç‹¬çƒ­ç¼–ç "><a href="#ç‹¬çƒ­ç¼–ç " class="headerlink" title="ç‹¬çƒ­ç¼–ç "></a>ç‹¬çƒ­ç¼–ç </h3><p>å›æƒ³ä¸€ä¸‹ï¼Œåœ¨<code>train_iter</code>ä¸­ï¼Œæ¯ä¸ªè¯å…ƒéƒ½è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°å­—ç´¢å¼•ï¼Œ å°†è¿™äº›ç´¢å¼•ç›´æ¥è¾“å…¥ç¥ç»ç½‘ç»œå¯èƒ½ä¼šä½¿å­¦ä¹ å˜å¾—å›°éš¾ã€‚ æˆ‘ä»¬é€šå¸¸å°†æ¯ä¸ªè¯å…ƒè¡¨ç¤ºä¸ºæ›´å…·è¡¨ç°åŠ›çš„ç‰¹å¾å‘é‡ã€‚ æœ€ç®€å•çš„è¡¨ç¤ºç§°ä¸º<em>ç‹¬çƒ­ç¼–ç </em>ï¼ˆone-hot encodingï¼‰</p><p>ç®€è¨€ä¹‹ï¼Œå°†æ¯ä¸ªç´¢å¼•æ˜ å°„ä¸ºç›¸äº’ä¸åŒçš„å•ä½å‘é‡ï¼š å‡è®¾è¯è¡¨ä¸­ä¸åŒè¯å…ƒçš„æ•°ç›®ä¸ºğ‘ï¼ˆå³<code>len(vocab)</code>ï¼‰ï¼Œ è¯å…ƒç´¢å¼•çš„èŒƒå›´ä¸º0åˆ°ğ‘âˆ’1ã€‚ å¦‚æœè¯å…ƒçš„ç´¢å¼•æ˜¯æ•´æ•°ğ‘–ï¼Œ é‚£ä¹ˆæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºğ‘çš„å…¨0å‘é‡ï¼Œ å¹¶å°†ç¬¬ğ‘–å¤„çš„å…ƒç´ è®¾ç½®ä¸º1ã€‚ æ­¤å‘é‡æ˜¯åŸå§‹è¯å…ƒçš„ä¸€ä¸ªç‹¬çƒ­å‘é‡ã€‚ ç´¢å¼•ä¸º0å’Œ2çš„ç‹¬çƒ­å‘é‡å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">F.one_hot(torch.tensor([<span class="number">0</span>, <span class="number">2</span>]), <span class="built_in">len</span>(vocab))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tensor([[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">         <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">         <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]])</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¯æ¬¡é‡‡æ ·çš„å°æ‰¹é‡æ•°æ®å½¢çŠ¶æ˜¯äºŒç»´å¼ é‡ï¼š ï¼ˆæ‰¹é‡å¤§å°ï¼Œæ—¶é—´æ­¥æ•°ï¼‰ã€‚ <code>one_hot</code>å‡½æ•°å°†è¿™æ ·ä¸€ä¸ªå°æ‰¹é‡æ•°æ®è½¬æ¢æˆä¸‰ç»´å¼ é‡ï¼Œ å¼ é‡çš„æœ€åä¸€ä¸ªç»´åº¦ç­‰äºè¯è¡¨å¤§å°ï¼ˆ<code>len(vocab)</code>ï¼‰ã€‚ æˆ‘ä»¬ç»å¸¸è½¬æ¢è¾“å…¥çš„ç»´åº¦ï¼Œä»¥ä¾¿è·å¾—å½¢çŠ¶ä¸º ï¼ˆæ—¶é—´æ­¥æ•°ï¼Œæ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°ï¼‰çš„è¾“å‡ºã€‚ è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°é€šè¿‡æœ€å¤–å±‚çš„ç»´åº¦ï¼Œ ä¸€æ­¥ä¸€æ­¥åœ°æ›´æ–°å°æ‰¹é‡æ•°æ®çš„éšçŠ¶æ€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = torch.arange(<span class="number">10</span>).reshape((<span class="number">2</span>, <span class="number">5</span>))</span><br><span class="line">F.one_hot(X.T, <span class="number">28</span>).shape</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.Size([<span class="number">5</span>, <span class="number">2</span>, <span class="number">28</span>])</span><br></pre></td></tr></table></figure><h3 id="å§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#å§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="å§‹åŒ–æ¨¡å‹å‚æ•°"></a>å§‹åŒ–æ¨¡å‹å‚æ•°</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆå§‹åŒ–å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„æ¨¡å‹å‚æ•°ã€‚ éšè—å•å…ƒæ•°<code>num_hiddens</code>æ˜¯ä¸€ä¸ªå¯è°ƒçš„è¶…å‚æ•°ã€‚ å½“è®­ç»ƒè¯­è¨€æ¨¡å‹æ—¶ï¼Œè¾“å…¥å’Œè¾“å‡ºæ¥è‡ªç›¸åŒçš„è¯è¡¨ã€‚ å› æ­¤ï¼Œå®ƒä»¬å…·æœ‰ç›¸åŒçš„ç»´åº¦ï¼Œå³è¯è¡¨çš„å¤§å°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">vocab_size, num_hiddens, device</span>):</span><br><span class="line">    num_inputs = num_outputs = vocab_size</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">normal</span>(<span class="params">shape</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.randn(size=shape, device=device) * <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># éšè—å±‚å‚æ•°</span></span><br><span class="line">    W_xh = normal((num_inputs, num_hiddens))</span><br><span class="line">    W_hh = normal((num_hiddens, num_hiddens))</span><br><span class="line">    b_h = torch.zeros(num_hiddens, device=device)</span><br><span class="line">    <span class="comment"># è¾“å‡ºå±‚å‚æ•°</span></span><br><span class="line">    W_hq = normal((num_hiddens, num_outputs))</span><br><span class="line">    b_q = torch.zeros(num_outputs, device=device)</span><br><span class="line">    <span class="comment"># é™„åŠ æ¢¯åº¦</span></span><br><span class="line">    params = [W_xh, W_hh, b_h, W_hq, b_q]</span><br><span class="line">    <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">        param.requires_grad_(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> params</span><br></pre></td></tr></table></figure><h3 id="å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹"></a>å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹</h3><p>ä¸ºäº†å®šä¹‰å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œ æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸€ä¸ª<code>init_rnn_state</code>å‡½æ•°åœ¨åˆå§‹åŒ–æ—¶è¿”å›éšçŠ¶æ€ã€‚ è¿™ä¸ªå‡½æ•°çš„è¿”å›æ˜¯ä¸€ä¸ªå¼ é‡ï¼Œå¼ é‡å…¨ç”¨0å¡«å……ï¼Œ å½¢çŠ¶ä¸ºï¼ˆæ‰¹é‡å¤§å°ï¼Œéšè—å•å…ƒæ•°ï¼‰ã€‚ åœ¨åé¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šé‡åˆ°éšçŠ¶æ€åŒ…å«å¤šä¸ªå˜é‡çš„æƒ…å†µï¼Œ è€Œä½¿ç”¨å…ƒç»„å¯ä»¥æ›´å®¹æ˜“åœ°å¤„ç†äº›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_rnn_state</span>(<span class="params">batch_size, num_hiddens, device</span>):</span><br><span class="line">    <span class="keyword">return</span> (torch.zeros((batch_size, num_hiddens), device=device), )</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„<code>rnn</code>å‡½æ•°å®šä¹‰äº†å¦‚ä½•åœ¨ä¸€ä¸ªæ—¶é—´æ­¥å†…è®¡ç®—éšçŠ¶æ€å’Œè¾“å‡ºã€‚ å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹é€šè¿‡<code>inputs</code>æœ€å¤–å±‚çš„ç»´åº¦å®ç°å¾ªç¯ï¼Œ ä»¥ä¾¿é€æ—¶é—´æ­¥æ›´æ–°å°æ‰¹é‡æ•°æ®çš„éšçŠ¶æ€<code>H</code>ã€‚ æ­¤å¤–ï¼Œè¿™é‡Œä½¿ç”¨tanhå‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rnn</span>(<span class="params">inputs, state, params</span>):</span><br><span class="line">    <span class="comment"># inputsçš„å½¢çŠ¶ï¼š(æ—¶é—´æ­¥æ•°é‡ï¼Œæ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°)</span></span><br><span class="line">    W_xh, W_hh, b_h, W_hq, b_q = params</span><br><span class="line">    H, = state</span><br><span class="line">    outputs = []</span><br><span class="line">    <span class="comment"># Xçš„å½¢çŠ¶ï¼š(æ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°)</span></span><br><span class="line">    <span class="keyword">for</span> X <span class="keyword">in</span> inputs:</span><br><span class="line">        H = torch.tanh(torch.mm(X, W_xh) + torch.mm(H, W_hh) + b_h)</span><br><span class="line">        Y = torch.mm(H, W_hq) + b_q</span><br><span class="line">        outputs.append(Y)</span><br><span class="line">    <span class="keyword">return</span> torch.cat(outputs, dim=<span class="number">0</span>), (H,)</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†æ‰€æœ‰éœ€è¦çš„å‡½æ•°ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»æ¥åŒ…è£…è¿™äº›å‡½æ•°ï¼Œ å¹¶å­˜å‚¨ä»é›¶å¼€å§‹å®ç°çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RNNModelScratch</span>: <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä»é›¶å¼€å§‹å®ç°çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, vocab_size, num_hiddens, device,</span></span><br><span class="line"><span class="params">                 get_params, init_state, forward_fn</span>):</span><br><span class="line">        self.vocab_size, self.num_hiddens = vocab_size, num_hiddens</span><br><span class="line">        self.params = get_params(vocab_size, num_hiddens, device)</span><br><span class="line">        self.init_state, self.forward_fn = init_state, forward_fn</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, X, state</span>):</span><br><span class="line">        X = F.one_hot(X.T, self.vocab_size).<span class="built_in">type</span>(torch.float32)</span><br><span class="line">        <span class="keyword">return</span> self.forward_fn(X, state, self.params)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">begin_state</span>(<span class="params">self, batch_size, device</span>):</span><br><span class="line">        <span class="keyword">return</span> self.init_state(batch_size, self.num_hiddens, device)</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ£€æŸ¥è¾“å‡ºæ˜¯å¦å…·æœ‰æ­£ç¡®çš„å½¢çŠ¶ã€‚ ä¾‹å¦‚ï¼ŒéšçŠ¶æ€çš„ç»´æ•°æ˜¯å¦ä¿æŒä¸å˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">num_hiddens = <span class="number">512</span></span><br><span class="line">net = RNNModelScratch(<span class="built_in">len</span>(vocab), num_hiddens, d2l.try_gpu(), get_params,</span><br><span class="line">                      init_rnn_state, rnn)</span><br><span class="line">state = net.begin_state(X.shape[<span class="number">0</span>], d2l.try_gpu())</span><br><span class="line">Y, new_state = net(X.to(d2l.try_gpu()), state)</span><br><span class="line">Y.shape, <span class="built_in">len</span>(new_state), new_state[<span class="number">0</span>].shape</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(torch.Size([<span class="number">10</span>, <span class="number">28</span>]), <span class="number">1</span>, torch.Size([<span class="number">2</span>, <span class="number">512</span>]))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¾“å‡ºå½¢çŠ¶æ˜¯ï¼ˆæ—¶é—´æ­¥æ•°Ã—æ‰¹é‡å¤§å°ï¼Œè¯è¡¨å¤§å°ï¼‰ï¼Œ è€ŒéšçŠ¶æ€å½¢çŠ¶ä¿æŒä¸å˜ï¼Œå³ï¼ˆæ‰¹é‡å¤§å°ï¼Œéšè—å•å…ƒæ•°ï¼‰ã€‚</p><h3 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h3><p>è®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰é¢„æµ‹å‡½æ•°æ¥ç”Ÿæˆ<code>prefix</code>ä¹‹åçš„æ–°å­—ç¬¦ï¼Œ å…¶ä¸­çš„<code>prefix</code>æ˜¯ä¸€ä¸ªç”¨æˆ·æä¾›çš„åŒ…å«å¤šä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚ åœ¨å¾ªç¯éå†<code>prefix</code>ä¸­çš„å¼€å§‹å­—ç¬¦æ—¶ï¼Œ æˆ‘ä»¬ä¸æ–­åœ°å°†éšçŠ¶æ€ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œä½†æ˜¯ä¸ç”Ÿæˆä»»ä½•è¾“å‡ºã€‚ è¿™è¢«ç§°ä¸º<em>é¢„çƒ­</em>ï¼ˆwarm-upï¼‰æœŸï¼Œ å› ä¸ºåœ¨æ­¤æœŸé—´æ¨¡å‹ä¼šè‡ªæˆ‘æ›´æ–°ï¼ˆä¾‹å¦‚ï¼Œæ›´æ–°éšçŠ¶æ€ï¼‰ï¼Œ ä½†ä¸ä¼šè¿›è¡Œé¢„æµ‹ã€‚ é¢„çƒ­æœŸç»“æŸåï¼ŒéšçŠ¶æ€çš„å€¼é€šå¸¸æ¯”åˆšå¼€å§‹çš„åˆå§‹å€¼æ›´é€‚åˆé¢„æµ‹ï¼Œ ä»è€Œé¢„æµ‹å­—ç¬¦å¹¶è¾“å‡ºå®ƒä»¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">predict_ch8</span>(<span class="params">prefix, num_preds, net, vocab, device</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;åœ¨prefixåé¢ç”Ÿæˆæ–°å­—ç¬¦&quot;&quot;&quot;</span></span><br><span class="line">    state = net.begin_state(batch_size=<span class="number">1</span>, device=device)</span><br><span class="line">    outputs = [vocab[prefix[<span class="number">0</span>]]]</span><br><span class="line">    get_input = <span class="keyword">lambda</span>: torch.tensor([outputs[-<span class="number">1</span>]], device=device).reshape((<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> prefix[<span class="number">1</span>:]:  <span class="comment"># é¢„çƒ­æœŸ</span></span><br><span class="line">        _, state = net(get_input(), state)</span><br><span class="line">        outputs.append(vocab[y])</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_preds):  <span class="comment"># é¢„æµ‹num_predsæ­¥</span></span><br><span class="line">        y, state = net(get_input(), state)</span><br><span class="line">        outputs.append(<span class="built_in">int</span>(y.argmax(dim=<span class="number">1</span>).reshape(<span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([vocab.idx_to_token[i] <span class="keyword">for</span> i <span class="keyword">in</span> outputs])</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æµ‹è¯•<code>predict_ch8</code>å‡½æ•°ã€‚ æˆ‘ä»¬å°†å‰ç¼€æŒ‡å®šä¸º<code>time traveller</code>ï¼Œ å¹¶åŸºäºè¿™ä¸ªå‰ç¼€ç”Ÿæˆ10ä¸ªåç»­å­—ç¬¦ã€‚ é‰´äºæˆ‘ä»¬è¿˜æ²¡æœ‰è®­ç»ƒç½‘ç»œï¼Œå®ƒä¼šç”Ÿæˆè’è°¬çš„é¢„æµ‹ç»“æœã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predict_ch8(<span class="string">&#x27;time traveller &#x27;</span>, <span class="number">10</span>, net, vocab, d2l.try_gpu())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;time traveller aaaaaaaaaa&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ¢¯åº¦è£å‰ª"><a href="#æ¢¯åº¦è£å‰ª" class="headerlink" title="æ¢¯åº¦è£å‰ª"></a>æ¢¯åº¦è£å‰ª</h3><p>å¯¹äºé•¿åº¦ä¸ºğ‘‡çš„åºåˆ—ï¼Œæˆ‘ä»¬åœ¨è¿­ä»£ä¸­è®¡ç®—è¿™ğ‘‡ä¸ªæ—¶é—´æ­¥ä¸Šçš„æ¢¯åº¦ï¼Œ å°†ä¼šåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­äº§ç”Ÿé•¿åº¦ä¸ºğ‘‚(ğ‘‡)çš„çŸ©é˜µä¹˜æ³•é“¾ã€‚ å¦‚ä¹‹å‰æ‰€è¿°ï¼Œ å½“ğ‘‡è¾ƒå¤§æ—¶ï¼Œå®ƒå¯èƒ½å¯¼è‡´æ•°å€¼ä¸ç¨³å®šï¼Œ ä¾‹å¦‚å¯èƒ½å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸æˆ–æ¢¯åº¦æ¶ˆå¤±ã€‚ å› æ­¤ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹å¾€å¾€éœ€è¦é¢å¤–çš„æ–¹å¼æ¥æ”¯æŒç¨³å®šè®­ç»ƒã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“è§£å†³ä¼˜åŒ–é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯¹æ¨¡å‹å‚æ•°é‡‡ç”¨æ›´æ–°æ­¥éª¤ã€‚ å‡å®šåœ¨å‘é‡å½¢å¼çš„ğ‘¥ä¸­ï¼Œ æˆ–è€…åœ¨å°æ‰¹é‡æ•°æ®çš„è´Ÿæ¢¯åº¦ğ‘”æ–¹å‘ä¸Šã€‚ ä¾‹å¦‚ï¼Œä½¿ç”¨ğœ‚&gt;0ä½œä¸ºå­¦ä¹ ç‡æ—¶ï¼Œåœ¨ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œ æˆ‘ä»¬å°†ğ‘¥æ›´æ–°ä¸ºğ‘¥âˆ’ğœ‚ğ‘”ã€‚ å¦‚æœæˆ‘ä»¬è¿›ä¸€æ­¥å‡è®¾ç›®æ ‡å‡½æ•°ğ‘“è¡¨ç°è‰¯å¥½ï¼Œ å³å‡½æ•°ğ‘“åœ¨å¸¸æ•°ğ¿ä¸‹æ˜¯<em>åˆ©æ™®å¸ŒèŒ¨è¿ç»­çš„</em>ï¼ˆLipschitz continuousï¼‰ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä»»æ„ğ‘¥å’Œğ‘¦æˆ‘ä»¬æœ‰ï¼š</p><p>â€‹                                                                                                |ğ‘“(ğ‘¥)âˆ’ğ‘“(ğ‘¦)|â‰¤ğ¿â€–ğ‘¥âˆ’ğ‘¦â€–.</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å‡è®¾ï¼š å¦‚æœæˆ‘ä»¬é€šè¿‡ğœ‚ğ‘”æ›´æ–°å‚æ•°å‘é‡ï¼Œåˆ™</p><p>â€‹                                                                                               |ğ‘“(ğ‘¥)âˆ’ğ‘“(ğ‘¥âˆ’ğœ‚ğ‘”)|â‰¤ğ¿ğœ‚â€–ğ‘”â€–,</p><p>è¿™æ„å‘³ç€æˆ‘ä»¬ä¸ä¼šè§‚å¯Ÿåˆ°è¶…è¿‡ğ¿ğœ‚â€–ğ‘”â€–çš„å˜åŒ–ã€‚ è¿™æ—¢æ˜¯åäº‹ä¹Ÿæ˜¯å¥½äº‹ã€‚ åçš„æ–¹é¢ï¼Œå®ƒé™åˆ¶äº†å–å¾—è¿›å±•çš„é€Ÿåº¦ï¼› å¥½çš„æ–¹é¢ï¼Œå®ƒé™åˆ¶äº†äº‹æƒ…å˜ç³Ÿçš„ç¨‹åº¦ï¼Œå°¤å…¶å½“æˆ‘ä»¬æœç€é”™è¯¯çš„æ–¹å‘å‰è¿›æ—¶ã€‚</p><p>æœ‰æ—¶æ¢¯åº¦å¯èƒ½å¾ˆå¤§ï¼Œä»è€Œä¼˜åŒ–ç®—æ³•å¯èƒ½æ— æ³•æ”¶æ•›ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡é™ä½ğœ‚çš„å­¦ä¹ ç‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¾ˆå°‘å¾—åˆ°å¤§çš„æ¢¯åº¦å‘¢ï¼Ÿ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§åšæ³•ä¼¼ä¹æ¯«æ— é“ç†ã€‚ ä¸€ä¸ªæµè¡Œçš„æ›¿ä»£æ–¹æ¡ˆæ˜¯é€šè¿‡å°†æ¢¯åº¦ğ‘”æŠ•å½±å›ç»™å®šåŠå¾„ ï¼ˆä¾‹å¦‚ğœƒï¼‰çš„çƒæ¥è£å‰ªæ¢¯åº¦ğ‘”ã€‚ å¦‚ä¸‹å¼ï¼š</p><p>â€‹                                                                                                   ğ‘”â†min(1,ğœƒâ€–ğ‘”â€–)ğ‘”.</p><p>é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬çŸ¥é“æ¢¯åº¦èŒƒæ•°æ°¸è¿œä¸ä¼šè¶…è¿‡ğœƒï¼Œ å¹¶ä¸”æ›´æ–°åçš„æ¢¯åº¦å®Œå…¨ä¸ğ‘”çš„åŸå§‹æ–¹å‘å¯¹é½ã€‚ å®ƒè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ‹¥æœ‰çš„å‰¯ä½œç”¨ï¼Œ å³é™åˆ¶ä»»ä½•ç»™å®šçš„å°æ‰¹é‡æ•°æ®ï¼ˆä»¥åŠå…¶ä¸­ä»»ä½•ç»™å®šçš„æ ·æœ¬ï¼‰å¯¹å‚æ•°å‘é‡çš„å½±å“ï¼Œ è¿™èµ‹äºˆäº†æ¨¡å‹ä¸€å®šç¨‹åº¦çš„ç¨³å®šæ€§ã€‚ æ¢¯åº¦è£å‰ªæä¾›äº†ä¸€ä¸ªå¿«é€Ÿä¿®å¤æ¢¯åº¦çˆ†ç‚¸çš„æ–¹æ³•ï¼Œ è™½ç„¶å®ƒå¹¶ä¸èƒ½å®Œå…¨è§£å†³é—®é¢˜ï¼Œä½†å®ƒæ˜¯ä¼—å¤šæœ‰æ•ˆçš„æŠ€æœ¯ä¹‹ä¸€ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è£å‰ªæ¨¡å‹çš„æ¢¯åº¦ï¼Œ æ¨¡å‹æ˜¯ä»é›¶å¼€å§‹å®ç°çš„æ¨¡å‹æˆ–ç”±é«˜çº§APIæ„å»ºçš„æ¨¡å‹ã€‚ æˆ‘ä»¬åœ¨æ­¤è®¡ç®—äº†æ‰€æœ‰æ¨¡å‹å‚æ•°çš„æ¢¯åº¦çš„èŒƒæ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">grad_clipping</span>(<span class="params">net, theta</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è£å‰ªæ¢¯åº¦&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(net, nn.Module):</span><br><span class="line">        params = [p <span class="keyword">for</span> p <span class="keyword">in</span> net.parameters() <span class="keyword">if</span> p.requires_grad]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        params = net.params</span><br><span class="line">    norm = torch.sqrt(<span class="built_in">sum</span>(torch.<span class="built_in">sum</span>((p.grad ** <span class="number">2</span>)) <span class="keyword">for</span> p <span class="keyword">in</span> params))</span><br><span class="line">    <span class="keyword">if</span> norm &gt; theta:</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">            param.grad[:] *= theta / norm</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><p>åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸå†…è®­ç»ƒæ¨¡å‹ã€‚ å®ƒä¸æˆ‘ä»¬è®­ç»ƒä¹‹å‰çš„æ¨¡å‹çš„æ–¹å¼æœ‰ä¸‰ä¸ªä¸åŒä¹‹å¤„ã€‚</p><ol><li>åºåˆ—æ•°æ®çš„ä¸åŒé‡‡æ ·æ–¹æ³•ï¼ˆéšæœºé‡‡æ ·å’Œé¡ºåºåˆ†åŒºï¼‰å°†å¯¼è‡´éšçŠ¶æ€åˆå§‹åŒ–çš„å·®å¼‚ã€‚</li><li>æˆ‘ä»¬åœ¨æ›´æ–°æ¨¡å‹å‚æ•°ä¹‹å‰è£å‰ªæ¢¯åº¦ã€‚ è¿™æ ·çš„æ“ä½œçš„ç›®çš„æ˜¯ï¼Œå³ä½¿è®­ç»ƒè¿‡ç¨‹ä¸­æŸä¸ªç‚¹ä¸Šå‘ç”Ÿäº†æ¢¯åº¦çˆ†ç‚¸ï¼Œä¹Ÿèƒ½ä¿è¯æ¨¡å‹ä¸ä¼šå‘æ•£ã€‚</li><li>æˆ‘ä»¬ç”¨å›°æƒ‘åº¦æ¥è¯„ä»·æ¨¡å‹ã€‚ è¿™æ ·çš„åº¦é‡ç¡®ä¿äº†ä¸åŒé•¿åº¦çš„åºåˆ—å…·æœ‰å¯æ¯”æ€§ã€‚</li></ol><p>å…·ä½“æ¥è¯´ï¼Œå½“ä½¿ç”¨é¡ºåºåˆ†åŒºæ—¶ï¼Œ æˆ‘ä»¬åªåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸçš„å¼€å§‹ä½ç½®åˆå§‹åŒ–éšçŠ¶æ€ã€‚ ç”±äºä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¸­çš„ç¬¬ğ‘–ä¸ªå­åºåˆ—æ ·æœ¬ ä¸å½“å‰ç¬¬ğ‘–ä¸ªå­åºåˆ—æ ·æœ¬ç›¸é‚»ï¼Œ å› æ­¤å½“å‰å°æ‰¹é‡æ•°æ®æœ€åä¸€ä¸ªæ ·æœ¬çš„éšçŠ¶æ€ï¼Œ å°†ç”¨äºåˆå§‹åŒ–ä¸‹ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ç¬¬ä¸€ä¸ªæ ·æœ¬çš„éšçŠ¶æ€ã€‚ è¿™æ ·ï¼Œå­˜å‚¨åœ¨éšçŠ¶æ€ä¸­çš„åºåˆ—çš„å†å²ä¿¡æ¯ å¯ä»¥åœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸå†…æµç»ç›¸é‚»çš„å­åºåˆ—ã€‚ ç„¶è€Œï¼Œåœ¨ä»»ä½•ä¸€ç‚¹éšçŠ¶æ€çš„è®¡ç®—ï¼Œ éƒ½ä¾èµ–äºåŒä¸€è¿­ä»£å‘¨æœŸä¸­å‰é¢æ‰€æœ‰çš„å°æ‰¹é‡æ•°æ®ï¼Œ è¿™ä½¿å¾—æ¢¯åº¦è®¡ç®—å˜å¾—å¤æ‚ã€‚ ä¸ºäº†é™ä½è®¡ç®—é‡ï¼Œåœ¨å¤„ç†ä»»ä½•ä¸€ä¸ªå°æ‰¹é‡æ•°æ®ä¹‹å‰ï¼Œ æˆ‘ä»¬å…ˆåˆ†ç¦»æ¢¯åº¦ï¼Œä½¿å¾—éšçŠ¶æ€çš„æ¢¯åº¦è®¡ç®—æ€»æ˜¯é™åˆ¶åœ¨ä¸€ä¸ªå°æ‰¹é‡æ•°æ®çš„æ—¶é—´æ­¥å†…ã€‚</p><p>å½“ä½¿ç”¨éšæœºæŠ½æ ·æ—¶ï¼Œå› ä¸ºæ¯ä¸ªæ ·æœ¬éƒ½æ˜¯åœ¨ä¸€ä¸ªéšæœºä½ç½®æŠ½æ ·çš„ï¼Œ å› æ­¤éœ€è¦ä¸ºæ¯ä¸ªè¿­ä»£å‘¨æœŸé‡æ–°åˆå§‹åŒ–éšçŠ¶æ€ã€‚ <code>updater</code>æ˜¯æ›´æ–°æ¨¡å‹å‚æ•°çš„å¸¸ç”¨å‡½æ•°ã€‚ å®ƒæ—¢å¯ä»¥æ˜¯ä»å¤´å¼€å§‹å®ç°çš„<code>d2l.sgd</code>å‡½æ•°ï¼Œ ä¹Ÿå¯ä»¥æ˜¯æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­å†…ç½®çš„ä¼˜åŒ–å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_epoch_ch8</span>(<span class="params">net, train_iter, loss, updater, device, use_random_iter</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®­ç»ƒç½‘ç»œä¸€ä¸ªè¿­ä»£å‘¨æœŸï¼ˆå®šä¹‰è§ç¬¬8ç« ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    state, timer = <span class="literal">None</span>, d2l.Timer()</span><br><span class="line">    metric = d2l.Accumulator(<span class="number">2</span>)  <span class="comment"># è®­ç»ƒæŸå¤±ä¹‹å’Œ,è¯å…ƒæ•°é‡</span></span><br><span class="line">    <span class="keyword">for</span> X, Y <span class="keyword">in</span> train_iter:</span><br><span class="line">        <span class="keyword">if</span> state <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> use_random_iter:</span><br><span class="line">            <span class="comment"># åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æˆ–ä½¿ç”¨éšæœºæŠ½æ ·æ—¶åˆå§‹åŒ–state</span></span><br><span class="line">            state = net.begin_state(batch_size=X.shape[<span class="number">0</span>], device=device)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(net, nn.Module) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(state, <span class="built_in">tuple</span>):</span><br><span class="line">                <span class="comment"># stateå¯¹äºnn.GRUæ˜¯ä¸ªå¼ é‡</span></span><br><span class="line">                state.detach_()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># stateå¯¹äºnn.LSTMæˆ–å¯¹äºæˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°çš„æ¨¡å‹æ˜¯ä¸ªå¼ é‡</span></span><br><span class="line">                <span class="keyword">for</span> s <span class="keyword">in</span> state:</span><br><span class="line">                    s.detach_()</span><br><span class="line">        y = Y.T.reshape(-<span class="number">1</span>)</span><br><span class="line">        X, y = X.to(device), y.to(device)</span><br><span class="line">        y_hat, state = net(X, state)</span><br><span class="line">        l = loss(y_hat, y.long()).mean()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(updater, torch.optim.Optimizer):</span><br><span class="line">            updater.zero_grad()</span><br><span class="line">            l.backward()</span><br><span class="line">            grad_clipping(net, <span class="number">1</span>)</span><br><span class="line">            updater.step()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            l.backward()</span><br><span class="line">            grad_clipping(net, <span class="number">1</span>)</span><br><span class="line">            <span class="comment"># å› ä¸ºå·²ç»è°ƒç”¨äº†meanå‡½æ•°</span></span><br><span class="line">            updater(batch_size=<span class="number">1</span>)</span><br><span class="line">        metric.add(l * y.numel(), y.numel())</span><br><span class="line">    <span class="keyword">return</span> math.exp(metric[<span class="number">0</span>] / metric[<span class="number">1</span>]), metric[<span class="number">1</span>] / timer.stop()</span><br></pre></td></tr></table></figure><p>å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„è®­ç»ƒå‡½æ•°æ—¢æ”¯æŒä»é›¶å¼€å§‹å®ç°ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨é«˜çº§APIæ¥å®ç°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_ch8</span>(<span class="params">net, train_iter, vocab, lr, num_epochs, device,</span></span><br><span class="line"><span class="params">              use_random_iter=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®­ç»ƒæ¨¡å‹ï¼ˆå®šä¹‰è§ç¬¬8ç« ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    loss = nn.CrossEntropyLoss()</span><br><span class="line">    animator = d2l.Animator(xlabel=<span class="string">&#x27;epoch&#x27;</span>, ylabel=<span class="string">&#x27;perplexity&#x27;</span>,</span><br><span class="line">                            legend=[<span class="string">&#x27;train&#x27;</span>], xlim=[<span class="number">10</span>, num_epochs])</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(net, nn.Module):</span><br><span class="line">        updater = torch.optim.SGD(net.parameters(), lr)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        updater = <span class="keyword">lambda</span> batch_size: d2l.sgd(net.params, lr, batch_size)</span><br><span class="line">    predict = <span class="keyword">lambda</span> prefix: predict_ch8(prefix, <span class="number">50</span>, net, vocab, device)</span><br><span class="line">    <span class="comment"># è®­ç»ƒå’Œé¢„æµ‹</span></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">        ppl, speed = train_epoch_ch8(</span><br><span class="line">            net, train_iter, loss, updater, device, use_random_iter)</span><br><span class="line">        <span class="keyword">if</span> (epoch + <span class="number">1</span>) % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(predict(<span class="string">&#x27;time traveller&#x27;</span>))</span><br><span class="line">            animator.add(epoch + <span class="number">1</span>, [ppl])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;å›°æƒ‘åº¦ <span class="subst">&#123;ppl:<span class="number">.1</span>f&#125;</span>, <span class="subst">&#123;speed:<span class="number">.1</span>f&#125;</span> è¯å…ƒ/ç§’ <span class="subst">&#123;<span class="built_in">str</span>(device)&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(predict(<span class="string">&#x27;time traveller&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(predict(<span class="string">&#x27;traveller&#x27;</span>))</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬è®­ç»ƒå¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚ å› ä¸ºæˆ‘ä»¬åœ¨æ•°æ®é›†ä¸­åªä½¿ç”¨äº†10000ä¸ªè¯å…ƒï¼Œ æ‰€ä»¥æ¨¡å‹éœ€è¦æ›´å¤šçš„è¿­ä»£å‘¨æœŸæ¥æ›´å¥½åœ°æ”¶æ•›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_epochs, lr = <span class="number">500</span>, <span class="number">1</span></span><br><span class="line">train_ch8(net, train_iter, vocab, lr, num_epochs, d2l.try_gpu())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å›°æƒ‘åº¦ <span class="number">1.0</span>, <span class="number">67212.6</span> è¯å…ƒ/ç§’ cuda:<span class="number">0</span></span><br><span class="line">time traveller <span class="keyword">for</span> so it will be convenient to speak of himwas e</span><br><span class="line">travelleryou can show black <span class="keyword">is</span> white by argument said filby</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch8/3.png" alt="3"></p><p>ä»é›¶å¼€å§‹å®ç°ä¸Šè¿°å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œ è™½ç„¶æœ‰æŒ‡å¯¼æ„ä¹‰ï¼Œä½†æ˜¯å¹¶ä¸æ–¹ä¾¿ã€‚ åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•æ”¹è¿›å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚ ä¾‹å¦‚ï¼Œå¦‚ä½•ä½¿å…¶å®ç°åœ°æ›´å®¹æ˜“ï¼Œä¸”è¿è¡Œé€Ÿåº¦æ›´å¿«ã€‚</p><h2 id="å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°"><a href="#å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°" class="headerlink" title="å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°"></a>å¾ªç¯ç¥ç»ç½‘ç»œçš„ç®€æ´å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">batch_size, num_steps = <span class="number">32</span>, <span class="number">35</span></span><br><span class="line">train_iter, vocab = d2l.load_data_time_machine(batch_size, num_steps)</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><p>é«˜çº§APIæä¾›äº†å¾ªç¯ç¥ç»ç½‘ç»œçš„å®ç°ã€‚ æˆ‘ä»¬æ„é€ ä¸€ä¸ªå…·æœ‰256ä¸ªéšè—å•å…ƒçš„å•éšè—å±‚çš„å¾ªç¯ç¥ç»ç½‘ç»œå±‚<code>rnn_layer</code>ã€‚ äº‹å®ä¸Šï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è®¨è®ºå¤šå±‚å¾ªç¯ç¥ç»ç½‘ç»œçš„æ„ä¹‰ã€‚ ç°åœ¨ä»…éœ€è¦å°†å¤šå±‚ç†è§£ä¸ºä¸€å±‚å¾ªç¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºè¢«ç”¨ä½œä¸‹ä¸€å±‚å¾ªç¯ç¥ç»ç½‘ç»œçš„è¾“å…¥å°±è¶³å¤Ÿäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_hiddens = <span class="number">256</span></span><br><span class="line">rnn_layer = nn.RNN(<span class="built_in">len</span>(vocab), num_hiddens)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨å¼ é‡æ¥åˆå§‹åŒ–éšçŠ¶æ€ï¼Œå®ƒçš„å½¢çŠ¶æ˜¯ï¼ˆéšè—å±‚æ•°ï¼Œæ‰¹é‡å¤§å°ï¼Œéšè—å•å…ƒæ•°ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">state = torch.zeros((<span class="number">1</span>, batch_size, num_hiddens))</span><br><span class="line">state.shape</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.Size([<span class="number">1</span>, <span class="number">32</span>, <span class="number">256</span>])</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸€ä¸ªéšçŠ¶æ€å’Œä¸€ä¸ªè¾“å…¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨æ›´æ–°åçš„éšçŠ¶æ€è®¡ç®—è¾“å‡ºã€‚ éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œ<code>rnn_layer</code>çš„â€œè¾“å‡ºâ€ï¼ˆ<code>Y</code>ï¼‰ä¸æ¶‰åŠè¾“å‡ºå±‚çš„è®¡ç®—ï¼š å®ƒæ˜¯æŒ‡æ¯ä¸ªæ—¶é—´æ­¥çš„éšçŠ¶æ€ï¼Œè¿™äº›éšçŠ¶æ€å¯ä»¥ç”¨ä½œåç»­è¾“å‡ºå±‚çš„è¾“å…¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X = torch.rand(size=(num_steps, batch_size, <span class="built_in">len</span>(vocab)))</span><br><span class="line">Y, state_new = rnn_layer(X, state)</span><br><span class="line">Y.shape, state_new.shape</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(torch.Size([<span class="number">35</span>, <span class="number">32</span>, <span class="number">256</span>]), torch.Size([<span class="number">1</span>, <span class="number">32</span>, <span class="number">256</span>]))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸ºä¸€ä¸ªå®Œæ•´çš„å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹å®šä¹‰äº†ä¸€ä¸ª<code>RNNModel</code>ç±»ã€‚ æ³¨æ„ï¼Œ<code>rnn_layer</code>åªåŒ…å«éšè—çš„å¾ªç¯å±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¾“å‡ºå±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RNNModel</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¾ªç¯ç¥ç»ç½‘ç»œæ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, rnn_layer, vocab_size, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(RNNModel, self).__init__(**kwargs)</span><br><span class="line">        self.rnn = rnn_layer</span><br><span class="line">        self.vocab_size = vocab_size</span><br><span class="line">        self.num_hiddens = self.rnn.hidden_size</span><br><span class="line">        <span class="comment"># å¦‚æœRNNæ˜¯åŒå‘çš„ï¼ˆä¹‹åå°†ä»‹ç»ï¼‰ï¼Œnum_directionsåº”è¯¥æ˜¯2ï¼Œå¦åˆ™åº”è¯¥æ˜¯1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.rnn.bidirectional:</span><br><span class="line">            self.num_directions = <span class="number">1</span></span><br><span class="line">            self.linear = nn.Linear(self.num_hiddens, self.vocab_size)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.num_directions = <span class="number">2</span></span><br><span class="line">            self.linear = nn.Linear(self.num_hiddens * <span class="number">2</span>, self.vocab_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, inputs, state</span>):</span><br><span class="line">        X = F.one_hot(inputs.T.long(), self.vocab_size)</span><br><span class="line">        X = X.to(torch.float32)</span><br><span class="line">        Y, state = self.rnn(X, state)</span><br><span class="line">        <span class="comment"># å…¨è¿æ¥å±‚é¦–å…ˆå°†Yçš„å½¢çŠ¶æ”¹ä¸º(æ—¶é—´æ­¥æ•°*æ‰¹é‡å¤§å°,éšè—å•å…ƒæ•°)</span></span><br><span class="line">        <span class="comment"># å®ƒçš„è¾“å‡ºå½¢çŠ¶æ˜¯(æ—¶é—´æ­¥æ•°*æ‰¹é‡å¤§å°,è¯è¡¨å¤§å°)ã€‚</span></span><br><span class="line">        output = self.linear(Y.reshape((-<span class="number">1</span>, Y.shape[-<span class="number">1</span>])))</span><br><span class="line">        <span class="keyword">return</span> output, state</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">begin_state</span>(<span class="params">self, device, batch_size=<span class="number">1</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(self.rnn, nn.LSTM):</span><br><span class="line">            <span class="comment"># nn.GRUä»¥å¼ é‡ä½œä¸ºéšçŠ¶æ€</span></span><br><span class="line">            <span class="keyword">return</span>  torch.zeros((self.num_directions * self.rnn.num_layers,</span><br><span class="line">                                 batch_size, self.num_hiddens),</span><br><span class="line">                                device=device)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># nn.LSTMä»¥å…ƒç»„ä½œä¸ºéšçŠ¶æ€</span></span><br><span class="line">            <span class="keyword">return</span> (torch.zeros((</span><br><span class="line">                self.num_directions * self.rnn.num_layers,</span><br><span class="line">                batch_size, self.num_hiddens), device=device),</span><br><span class="line">                    torch.zeros((</span><br><span class="line">                        self.num_directions * self.rnn.num_layers,</span><br><span class="line">                        batch_size, self.num_hiddens), device=device))</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒä¸é¢„æµ‹"><a href="#è®­ç»ƒä¸é¢„æµ‹" class="headerlink" title="è®­ç»ƒä¸é¢„æµ‹"></a>è®­ç»ƒä¸é¢„æµ‹</h3><p>åœ¨è®­ç»ƒæ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åŸºäºä¸€ä¸ªå…·æœ‰éšæœºæƒé‡çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">device = d2l.try_gpu()</span><br><span class="line">net = RNNModel(rnn_layer, vocab_size=<span class="built_in">len</span>(vocab))</span><br><span class="line">net = net.to(device)</span><br><span class="line">d2l.predict_ch8(<span class="string">&#x27;time traveller&#x27;</span>, <span class="number">10</span>, net, vocab, device)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;time travellerbbabbkabyg&#x27;</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ¨¡å‹æ ¹æœ¬ä¸èƒ½è¾“å‡ºå¥½çš„ç»“æœã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰ä¸­å®šä¹‰çš„è¶…å‚æ•°è°ƒç”¨<code>train_ch8</code>ï¼Œå¹¶ä¸”ä½¿ç”¨pytorchè®­ç»ƒæ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_epochs, lr = <span class="number">500</span>, <span class="number">1</span></span><br><span class="line">d2l.train_ch8(net, train_iter, vocab, lr, num_epochs, device)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">perplexity <span class="number">1.3</span>, <span class="number">404413.8</span> tokens/sec on cuda:<span class="number">0</span></span><br><span class="line">time travellerit would be remarkably convenient <span class="keyword">for</span> the historia</span><br><span class="line">travellery of il the hise fupt might <span class="keyword">and</span> st was it loflers</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch8/4.png" alt="4"></p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch8 CNNå·ç§¯ç¥ç»ç½‘ç»œ</title>
      <link href="/2024/07/01/CNN%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
      <url>/2024/07/01/CNN%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="CNNå·ç§¯ç¥ç»ç½‘ç»œ"><a href="#CNNå·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="CNNå·ç§¯ç¥ç»ç½‘ç»œ"></a>CNNå·ç§¯ç¥ç»ç½‘ç»œ</h1><h2 id="å…¨è¿æ¥ç½‘ç»œ-VS-å·ç§¯ç½‘ç»œ"><a href="#å…¨è¿æ¥ç½‘ç»œ-VS-å·ç§¯ç½‘ç»œ" class="headerlink" title="å…¨è¿æ¥ç½‘ç»œ VS å·ç§¯ç½‘ç»œ"></a>å…¨è¿æ¥ç½‘ç»œ VS å·ç§¯ç½‘ç»œ</h2><p>å…¨è¿æ¥ç¥ç»ç½‘ç»œä¹‹æ‰€ä»¥ä¸å¤ªé€‚åˆå›¾åƒè¯†åˆ«ä»»åŠ¡ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š</p><ul><li><strong>å‚æ•°æ•°é‡å¤ªå¤š</strong> è€ƒè™‘ä¸€ä¸ªè¾“å…¥1000<em>1000åƒç´ çš„å›¾ç‰‡(ä¸€ç™¾ä¸‡åƒç´ ï¼Œç°åœ¨å·²ç»ä¸èƒ½ç®—å¤§å›¾äº†)ï¼Œè¾“å…¥å±‚æœ‰1000</em>1000&#x3D;100ä¸‡èŠ‚ç‚¹ã€‚å‡è®¾ç¬¬ä¸€ä¸ªéšè—å±‚æœ‰100ä¸ªèŠ‚ç‚¹(è¿™ä¸ªæ•°é‡å¹¶ä¸å¤š)ï¼Œé‚£ä¹ˆä»…è¿™ä¸€å±‚å°±æœ‰(1000*1000+1)*100&#x3D;1äº¿å‚æ•°ï¼Œè¿™å®åœ¨æ˜¯å¤ªå¤šäº†ï¼æˆ‘ä»¬çœ‹åˆ°å›¾åƒåªæ‰©å¤§ä¸€ç‚¹ï¼Œå‚æ•°æ•°é‡å°±ä¼šå¤šå¾ˆå¤šï¼Œå› æ­¤å®ƒçš„æ‰©å±•æ€§å¾ˆå·®ã€‚</li><li><strong>æ²¡æœ‰åˆ©ç”¨åƒç´ ä¹‹é—´çš„ä½ç½®ä¿¡æ¯</strong> å¯¹äºå›¾åƒè¯†åˆ«ä»»åŠ¡æ¥è¯´ï¼Œæ¯ä¸ªåƒç´ å’Œå…¶å‘¨å›´åƒç´ çš„è”ç³»æ˜¯æ¯”è¾ƒç´§å¯†çš„ï¼Œå’Œç¦»å¾—å¾ˆè¿œçš„åƒç´ çš„è”ç³»å¯èƒ½å°±å¾ˆå°äº†ã€‚å¦‚æœä¸€ä¸ªç¥ç»å…ƒå’Œä¸Šä¸€å±‚æ‰€æœ‰ç¥ç»å…ƒç›¸è¿ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºå¯¹äºä¸€ä¸ªåƒç´ æ¥è¯´ï¼ŒæŠŠå›¾åƒçš„æ‰€æœ‰åƒç´ éƒ½ç­‰åŒçœ‹å¾…ï¼Œè¿™ä¸ç¬¦åˆå‰é¢çš„å‡è®¾ã€‚å½“æˆ‘ä»¬å®Œæˆæ¯ä¸ªè¿æ¥æƒé‡çš„å­¦ä¹ ä¹‹åï¼Œæœ€ç»ˆå¯èƒ½ä¼šå‘ç°ï¼Œæœ‰å¤§é‡çš„æƒé‡ï¼Œå®ƒä»¬çš„å€¼éƒ½æ˜¯å¾ˆå°çš„(ä¹Ÿå°±æ˜¯è¿™äº›è¿æ¥å…¶å®æ— å…³ç´§è¦)ã€‚åŠªåŠ›å­¦ä¹ å¤§é‡å¹¶ä¸é‡è¦çš„æƒé‡ï¼Œè¿™æ ·çš„å­¦ä¹ å¿…å°†æ˜¯éå¸¸ä½æ•ˆçš„ã€‚</li><li><strong>ç½‘ç»œå±‚æ•°é™åˆ¶</strong> æˆ‘ä»¬çŸ¥é“ç½‘ç»œå±‚æ•°è¶Šå¤šå…¶è¡¨è¾¾èƒ½åŠ›è¶Šå¼ºï¼Œä½†æ˜¯é€šè¿‡æ¢¯åº¦ä¸‹é™æ–¹æ³•è®­ç»ƒæ·±åº¦å…¨è¿æ¥ç¥ç»ç½‘ç»œå¾ˆå›°éš¾ï¼Œå› ä¸ºå…¨è¿æ¥ç¥ç»ç½‘ç»œçš„æ¢¯åº¦å¾ˆéš¾ä¼ é€’è¶…è¿‡3å±‚ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å¾—åˆ°ä¸€ä¸ªå¾ˆæ·±çš„å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œä¹Ÿå°±é™åˆ¶äº†å®ƒçš„èƒ½åŠ›ã€‚</li></ul><p>é‚£ä¹ˆï¼Œå·ç§¯ç¥ç»ç½‘ç»œåˆæ˜¯æ€æ ·è§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿä¸»è¦æœ‰ä¸‰ä¸ªæ€è·¯ï¼š</p><ul><li><strong>å±€éƒ¨è¿æ¥</strong> è¿™ä¸ªæ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„ï¼Œæ¯ä¸ªç¥ç»å…ƒä¸å†å’Œä¸Šä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒç›¸è¿ï¼Œè€Œåªå’Œä¸€å°éƒ¨åˆ†ç¥ç»å…ƒç›¸è¿ã€‚è¿™æ ·å°±å‡å°‘äº†å¾ˆå¤šå‚æ•°ã€‚</li><li><strong>æƒå€¼å…±äº«</strong> ä¸€ç»„è¿æ¥å¯ä»¥å…±äº«åŒä¸€ä¸ªæƒé‡ï¼Œè€Œä¸æ˜¯æ¯ä¸ªè¿æ¥æœ‰ä¸€ä¸ªä¸åŒçš„æƒé‡ï¼Œè¿™æ ·åˆå‡å°‘äº†å¾ˆå¤šå‚æ•°ã€‚</li><li><strong>ä¸‹é‡‡æ ·</strong> å¯ä»¥ä½¿ç”¨Poolingæ¥å‡å°‘æ¯å±‚çš„æ ·æœ¬æ•°ï¼Œè¿›ä¸€æ­¥å‡å°‘å‚æ•°æ•°é‡ï¼ŒåŒæ—¶è¿˜å¯ä»¥æå‡æ¨¡å‹çš„é²æ£’æ€§ã€‚</li></ul><p>å¯¹äºå›¾åƒè¯†åˆ«ä»»åŠ¡æ¥è¯´ï¼Œå·ç§¯ç¥ç»ç½‘ç»œé€šè¿‡å°½å¯èƒ½ä¿ç•™é‡è¦çš„å‚æ•°ï¼Œå»æ‰å¤§é‡ä¸é‡è¦çš„å‚æ•°ï¼Œæ¥è¾¾åˆ°æ›´å¥½çš„å­¦ä¹ æ•ˆæœã€‚</p><h2 id="å·ç§¯ç»“æ„"><a href="#å·ç§¯ç»“æ„" class="headerlink" title="å·ç§¯ç»“æ„"></a>å·ç§¯ç»“æ„</h2><h3 id="å·ç§¯å±‚"><a href="#å·ç§¯å±‚" class="headerlink" title="å·ç§¯å±‚"></a>å·ç§¯å±‚</h3><p>å·ç§¯å±‚å¯ä»¥äº§ç”Ÿä¸€ç»„å¹³è¡Œçš„ç‰¹å¾å›¾ï¼ˆfeature mapï¼‰ï¼Œå®ƒé€šè¿‡åœ¨è¾“å…¥å›¾åƒä¸Šæ»‘åŠ¨ä¸åŒçš„å·ç§¯æ ¸å¹¶æ‰§è¡Œä¸€å®šçš„è¿ç®—è€Œç»„æˆã€‚æ­¤å¤–ï¼Œåœ¨æ¯ä¸€ä¸ªæ»‘åŠ¨çš„ä½ç½®ä¸Šï¼Œå·ç§¯æ ¸ä¸è¾“å…¥å›¾åƒä¹‹é—´ä¼šæ‰§è¡Œä¸€ä¸ªå…ƒç´ å¯¹åº”ä¹˜ç§¯å¹¶æ±‚å’Œçš„è¿ç®—ä»¥å°†æ„Ÿå—è§†é‡å†…çš„ä¿¡æ¯æŠ•å½±åˆ°ç‰¹å¾å›¾ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚è¿™ä¸€æ»‘åŠ¨çš„è¿‡ç¨‹å¯ç§°ä¸ºæ­¥å¹… Z_sï¼Œæ­¥å¹… Z_s æ˜¯æ§åˆ¶è¾“å‡ºç‰¹å¾å›¾å°ºå¯¸çš„ä¸€ä¸ªå› ç´ ã€‚å·ç§¯æ ¸çš„å°ºå¯¸è¦æ¯”è¾“å…¥å›¾åƒå°å¾—å¤šï¼Œä¸”é‡å æˆ–å¹³è¡Œåœ°ä½œç”¨äºè¾“å…¥å›¾åƒä¸­ï¼Œä¸€å¼ ç‰¹å¾å›¾ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå·ç§¯æ ¸è®¡ç®—å¾—å‡ºçš„ï¼Œä¹Ÿå³ä¸€å¼ ç‰¹å¾å›¾å…±äº«äº†ç›¸åŒçš„æƒé‡å’Œåç½®é¡¹ã€‚</p><h3 id="æ± åŒ–å±‚"><a href="#æ± åŒ–å±‚" class="headerlink" title="æ± åŒ–å±‚"></a>æ± åŒ–å±‚</h3><p>æ± åŒ–ï¼ˆPoolingï¼‰æ˜¯å·ç§¯ç¥ç»ç½‘ç»œä¸­å¦ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ç§éçº¿æ€§å½¢å¼çš„é™é‡‡æ ·ã€‚æœ‰å¤šç§ä¸åŒå½¢å¼çš„éçº¿æ€§æ± åŒ–å‡½æ•°ï¼Œè€Œå…¶ä¸­â€œæœ€å¤§æ± åŒ–ï¼ˆMax poolingï¼‰â€æ˜¯æœ€ä¸ºå¸¸è§çš„ã€‚å®ƒæ˜¯å°†è¾“å…¥çš„å›¾åƒåˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªçŸ©å½¢åŒºåŸŸï¼Œå¯¹æ¯ä¸ªå­åŒºåŸŸè¾“å‡ºæœ€å¤§å€¼ã€‚</p><p>ä¸€ä¸ªç‰¹å¾çš„ç²¾ç¡®ä½ç½®è¿œä¸åŠå®ƒç›¸å¯¹äºå…¶ä»–ç‰¹å¾çš„ç²—ç•¥ä½ç½®é‡è¦ã€‚æ± åŒ–å±‚ä¼šä¸æ–­åœ°å‡å°æ•°æ®çš„ç©ºé—´å¤§å°ï¼Œå› æ­¤å‚æ•°çš„æ•°é‡å’Œè®¡ç®—é‡ä¹Ÿä¼šä¸‹é™ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿæ§åˆ¶äº†<a href="https://zh.wikipedia.org/wiki/%E8%BF%87%E6%8B%9F%E5%90%88">è¿‡æ‹Ÿåˆ</a>ã€‚é€šå¸¸æ¥è¯´ï¼ŒCNNçš„ç½‘ç»œç»“æ„ä¸­çš„å·ç§¯å±‚ä¹‹é—´éƒ½ä¼šå‘¨æœŸæ€§åœ°æ’å…¥æ± åŒ–å±‚ã€‚æ± åŒ–æ“ä½œæä¾›äº†å¦ä¸€ç§å½¢å¼çš„å¹³ç§»ä¸å˜æ€§ã€‚å› ä¸ºå·ç§¯æ ¸æ˜¯ä¸€ç§ç‰¹å¾å‘ç°å™¨ï¼Œæˆ‘ä»¬é€šè¿‡å·ç§¯å±‚å¯ä»¥å¾ˆå®¹æ˜“åœ°å‘ç°å›¾åƒä¸­çš„å„ç§è¾¹ç¼˜ã€‚ä½†æ˜¯å·ç§¯å±‚å‘ç°çš„ç‰¹å¾å¾€å¾€è¿‡äºç²¾ç¡®ï¼Œæˆ‘ä»¬å³ä½¿é«˜é€Ÿè¿æ‹æ‹æ‘„ä¸€ä¸ªç‰©ä½“ï¼Œç…§ç‰‡ä¸­çš„ç‰©ä½“çš„è¾¹ç¼˜åƒç´ ä½ç½®ä¹Ÿä¸å¤§å¯èƒ½å®Œå…¨ä¸€è‡´ï¼Œé€šè¿‡æ± åŒ–å±‚æˆ‘ä»¬å¯ä»¥é™ä½å·ç§¯å±‚å¯¹è¾¹ç¼˜çš„æ•æ„Ÿæ€§ã€‚</p><h3 id="å…¨è¿æ¥å±‚"><a href="#å…¨è¿æ¥å±‚" class="headerlink" title="å…¨è¿æ¥å±‚"></a>å…¨è¿æ¥å±‚</h3><p>æœ€åï¼Œåœ¨ç»è¿‡å‡ ä¸ªå·ç§¯å’Œæœ€å¤§æ± åŒ–å±‚ä¹‹åï¼Œç¥ç»ç½‘ç»œä¸­çš„é«˜çº§æ¨ç†é€šè¿‡å®Œå…¨è¿æ¥å±‚æ¥å®Œæˆã€‚å°±å’Œå¸¸è§„çš„éå·ç§¯äººå·¥ç¥ç»ç½‘ç»œä¸­ä¸€æ ·ï¼Œå®Œå…¨è¿æ¥å±‚ä¸­çš„ç¥ç»å…ƒä¸å‰ä¸€å±‚ä¸­çš„æ‰€æœ‰æ¿€æ´»éƒ½æœ‰è”ç³»ã€‚å› æ­¤ï¼Œå®ƒä»¬çš„æ¿€æ´»å¯ä»¥ä½œä¸º<a href="https://zh.wikipedia.org/wiki/%E4%BB%BF%E5%B0%84%E5%8F%98%E6%8D%A2">ä»¿å°„å˜æ¢</a>æ¥è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯å…ˆä¹˜ä»¥ä¸€ä¸ªçŸ©é˜µç„¶ååŠ ä¸Šä¸€ä¸ªåå·®(bias)åç§»é‡(å‘é‡åŠ ä¸Šä¸€ä¸ªå›ºå®šçš„æˆ–è€…å­¦ä¹ æ¥çš„åå·®é‡)ã€‚</p><h2 id="å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰"><a href="#å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰"></a>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆLeNetï¼‰</h2><h3 id="æ¨¡å‹å®ç°"><a href="#æ¨¡å‹å®ç°" class="headerlink" title="æ¨¡å‹å®ç°"></a>æ¨¡å‹å®ç°</h3><p>LeNetæ˜¯æœ€æ—©å‘å¸ƒçš„å·ç§¯ç¥ç»ç½‘ç»œä¹‹ä¸€ï¼Œå› å…¶åœ¨è®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­çš„é«˜æ•ˆæ€§èƒ½è€Œå—åˆ°å¹¿æ³›å…³æ³¨ã€‚</p><p>ç”¨Pytorchæ¡†æ¶å®ç°æ­¤ç±»æ¨¡å‹éå¸¸ç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª<code>Sequential</code>å—å¹¶å°†éœ€è¦çš„å±‚è¿æ¥åœ¨ä¸€èµ·ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">net = nn.Sequential(</span><br><span class="line">    nn.Conv2d(<span class="number">1</span>, <span class="number">6</span>, kernel_size=<span class="number">5</span>, padding=<span class="number">2</span>), nn.Sigmoid(),</span><br><span class="line">    nn.AvgPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nn.Conv2d(<span class="number">6</span>, <span class="number">16</span>, kernel_size=<span class="number">5</span>), nn.Sigmoid(),</span><br><span class="line">    nn.AvgPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nn.Flatten(),</span><br><span class="line">    nn.Linear(<span class="number">16</span> * <span class="number">5</span> * <span class="number">5</span>, <span class="number">120</span>), nn.Sigmoid(),</span><br><span class="line">    nn.Linear(<span class="number">120</span>, <span class="number">84</span>), nn.Sigmoid(),</span><br><span class="line">    nn.Linear(<span class="number">84</span>, <span class="number">10</span>))</span><br></pre></td></tr></table></figure><p>å°†ä¸€ä¸ªå¤§å°ä¸º28Ã—28çš„å•é€šé“ï¼ˆé»‘ç™½ï¼‰å›¾åƒé€šè¿‡LeNetã€‚é€šè¿‡åœ¨æ¯ä¸€å±‚æ‰“å°è¾“å‡ºçš„å½¢çŠ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ¨¡å‹</p><p><img src="/../img/Pytorch1/pytorch8/1.png" alt="1"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X = torch.rand(size=(<span class="number">1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>), dtype=torch.float32)</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> net:</span><br><span class="line">    X = layer(X)</span><br><span class="line">    <span class="built_in">print</span>(layer.__class__.__name__,<span class="string">&#x27;output shape: \t&#x27;</span>,X.shape)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Conv2d output shape:         torch.Size([<span class="number">1</span>, <span class="number">6</span>, <span class="number">28</span>, <span class="number">28</span>])</span><br><span class="line">Sigmoid output shape:        torch.Size([<span class="number">1</span>, <span class="number">6</span>, <span class="number">28</span>, <span class="number">28</span>])</span><br><span class="line">AvgPool2d output shape:      torch.Size([<span class="number">1</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">14</span>])</span><br><span class="line">Conv2d output shape:         torch.Size([<span class="number">1</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">10</span>])</span><br><span class="line">Sigmoid output shape:        torch.Size([<span class="number">1</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">10</span>])</span><br><span class="line">AvgPool2d output shape:      torch.Size([<span class="number">1</span>, <span class="number">16</span>, <span class="number">5</span>, <span class="number">5</span>])</span><br><span class="line">Flatten output shape:        torch.Size([<span class="number">1</span>, <span class="number">400</span>])</span><br><span class="line">Linear output shape:         torch.Size([<span class="number">1</span>, <span class="number">120</span>])</span><br><span class="line">Sigmoid output shape:        torch.Size([<span class="number">1</span>, <span class="number">120</span>])</span><br><span class="line">Linear output shape:         torch.Size([<span class="number">1</span>, <span class="number">84</span>])</span><br><span class="line">Sigmoid output shape:        torch.Size([<span class="number">1</span>, <span class="number">84</span>])</span><br><span class="line">Linear output shape:         torch.Size([<span class="number">1</span>, <span class="number">10</span>])</span><br></pre></td></tr></table></figure><h3 id="æ¨¡å‹è®­ç»ƒ"><a href="#æ¨¡å‹è®­ç»ƒ" class="headerlink" title="æ¨¡å‹è®­ç»ƒ"></a>æ¨¡å‹è®­ç»ƒ</h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†LeNetï¼Œè®©æˆ‘ä»¬çœ‹çœ‹LeNetåœ¨Fashion-MNISTæ•°æ®é›†ä¸Šçš„è¡¨ç°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size=batch_size)</span><br></pre></td></tr></table></figure><p>ç”±äºå®Œæ•´çš„æ•°æ®é›†ä½äºå†…å­˜ä¸­ï¼Œå› æ­¤åœ¨æ¨¡å‹ä½¿ç”¨GPUè®¡ç®—æ•°æ®é›†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å¤åˆ¶åˆ°æ˜¾å­˜ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate_accuracy_gpu</span>(<span class="params">net, data_iter, device=<span class="literal">None</span></span>): <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨GPUè®¡ç®—æ¨¡å‹åœ¨æ•°æ®é›†ä¸Šçš„ç²¾åº¦&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(net, nn.Module):</span><br><span class="line">        net.<span class="built_in">eval</span>()  <span class="comment"># è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> device:</span><br><span class="line">            device = <span class="built_in">next</span>(<span class="built_in">iter</span>(net.parameters())).device</span><br><span class="line">    <span class="comment"># æ­£ç¡®é¢„æµ‹çš„æ•°é‡ï¼Œæ€»é¢„æµ‹çš„æ•°é‡</span></span><br><span class="line">    metric = d2l.Accumulator(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(X, <span class="built_in">list</span>):</span><br><span class="line">                <span class="comment"># BERTå¾®è°ƒæ‰€éœ€çš„ï¼ˆä¹‹åå°†ä»‹ç»ï¼‰</span></span><br><span class="line">                X = [x.to(device) <span class="keyword">for</span> x <span class="keyword">in</span> X]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                X = X.to(device)</span><br><span class="line">            y = y.to(device)</span><br><span class="line">            metric.add(d2l.accuracy(net(X), y), y.numel())</span><br><span class="line">    <span class="keyword">return</span> metric[<span class="number">0</span>] / metric[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>ä¸å…¨è¿æ¥å±‚ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°å’Œå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train_ch6</span>(<span class="params">net, train_iter, test_iter, num_epochs, lr, device</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç”¨GPUè®­ç»ƒæ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init_weights</span>(<span class="params">m</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(m) == nn.Linear <span class="keyword">or</span> <span class="built_in">type</span>(m) == nn.Conv2d:</span><br><span class="line">            nn.init.xavier_uniform_(m.weight)</span><br><span class="line">    net.apply(init_weights)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;training on&#x27;</span>, device)</span><br><span class="line">    net.to(device)</span><br><span class="line">    optimizer = torch.optim.SGD(net.parameters(), lr=lr)</span><br><span class="line">    loss = nn.CrossEntropyLoss()</span><br><span class="line">    animator = d2l.Animator(xlabel=<span class="string">&#x27;epoch&#x27;</span>, xlim=[<span class="number">1</span>, num_epochs],</span><br><span class="line">                            legend=[<span class="string">&#x27;train loss&#x27;</span>, <span class="string">&#x27;train acc&#x27;</span>, <span class="string">&#x27;test acc&#x27;</span>])</span><br><span class="line">    timer, num_batches = d2l.Timer(), <span class="built_in">len</span>(train_iter)</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">        <span class="comment"># è®­ç»ƒæŸå¤±ä¹‹å’Œï¼Œè®­ç»ƒå‡†ç¡®ç‡ä¹‹å’Œï¼Œæ ·æœ¬æ•°</span></span><br><span class="line">        metric = d2l.Accumulator(<span class="number">3</span>)</span><br><span class="line">        net.train()</span><br><span class="line">        <span class="keyword">for</span> i, (X, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(train_iter):</span><br><span class="line">            timer.start()</span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            X, y = X.to(device), y.to(device)</span><br><span class="line">            y_hat = net(X)</span><br><span class="line">            l = loss(y_hat, y)</span><br><span class="line">            l.backward()</span><br><span class="line">            optimizer.step()</span><br><span class="line">            <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">                metric.add(l * X.shape[<span class="number">0</span>], d2l.accuracy(y_hat, y), X.shape[<span class="number">0</span>])</span><br><span class="line">            timer.stop()</span><br><span class="line">            train_l = metric[<span class="number">0</span>] / metric[<span class="number">2</span>]</span><br><span class="line">            train_acc = metric[<span class="number">1</span>] / metric[<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">if</span> (i + <span class="number">1</span>) % (num_batches // <span class="number">5</span>) == <span class="number">0</span> <span class="keyword">or</span> i == num_batches - <span class="number">1</span>:</span><br><span class="line">                animator.add(epoch + (i + <span class="number">1</span>) / num_batches,</span><br><span class="line">                             (train_l, train_acc, <span class="literal">None</span>))</span><br><span class="line">        test_acc = evaluate_accuracy_gpu(net, test_iter)</span><br><span class="line">        animator.add(epoch + <span class="number">1</span>, (<span class="literal">None</span>, <span class="literal">None</span>, test_acc))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;loss <span class="subst">&#123;train_l:<span class="number">.3</span>f&#125;</span>, train acc <span class="subst">&#123;train_acc:<span class="number">.3</span>f&#125;</span>, &#x27;</span></span><br><span class="line">          <span class="string">f&#x27;test acc <span class="subst">&#123;test_acc:<span class="number">.3</span>f&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;metric[<span class="number">2</span>] * num_epochs / timer.<span class="built_in">sum</span>():<span class="number">.1</span>f&#125;</span> examples/sec &#x27;</span></span><br><span class="line">          <span class="string">f&#x27;on <span class="subst">&#123;<span class="built_in">str</span>(device)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è®­ç»ƒå’Œè¯„ä¼°LeNet-5æ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lr, num_epochs = <span class="number">0.9</span>, <span class="number">10</span></span><br><span class="line">train_ch6(net, train_iter, test_iter, num_epochs, lr, d2l.try_gpu())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loss <span class="number">0.469</span>, train acc <span class="number">0.823</span>, test acc <span class="number">0.779</span></span><br><span class="line"><span class="number">55296.6</span> examples/sec on cuda:<span class="number">0</span></span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch8/2.png" alt="2"></p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå®¹å™¨ç”¨æ³•</title>
      <link href="/2024/06/30/Java%E5%AE%B9%E5%99%A8%E7%94%A8%E6%B3%95/"/>
      <url>/2024/06/30/Java%E5%AE%B9%E5%99%A8%E7%94%A8%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaå®¹å™¨ç”¨æ³•æ±‡æ€»"><a href="#Javaå®¹å™¨ç”¨æ³•æ±‡æ€»" class="headerlink" title="Javaå®¹å™¨ç”¨æ³•æ±‡æ€»"></a>Javaå®¹å™¨ç”¨æ³•æ±‡æ€»</h1><h2 id="å®¹å™¨åˆ†ç±»"><a href="#å®¹å™¨åˆ†ç±»" class="headerlink" title="å®¹å™¨åˆ†ç±»"></a>å®¹å™¨åˆ†ç±»</h2><p><img src="/../img/java/%E5%AE%B9%E5%99%A8%E6%B1%87%E6%80%BB/1.png" alt="1"></p><ul><li>List(å¯¹ä»˜é¡ºåºçš„å¥½å¸®æ‰‹): å­˜å‚¨çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€å¯é‡å¤çš„ã€‚</li><li>Set (æ³¨é‡ç‹¬ä¸€æ— äºŒçš„æ€§è´¨)ï¼šå­˜å‚¨çš„å…ƒç´ æ˜¯æ— åºçš„ã€ä¸å¯é‡å¤çš„ã€‚</li><li>Queue (å®ç°æ’é˜ŸåŠŸèƒ½çš„å«å·æœº):æŒ‰ç‰¹å®šçš„æ’é˜Ÿè§„åˆ™æ¥ç¡®å®šå…ˆåé¡ºåºï¼Œå­˜å‚¨çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€å¯é‡å¤çš„ã€‚</li><li>Map (ç”¨ key æ¥æœç´¢çš„ä¸“å®¶) :ä½¿ç”¨é”®å€¼å¯¹ï¼ˆkey-valueï¼‰å­˜å‚¨ï¼Œç±»ä¼¼äºæ•°å­¦ä¸Šçš„å‡½æ•° y&#x3D;f(x)ï¼Œâ€œxâ€ ä»£è¡¨ keyï¼Œâ€œyâ€ ä»£è¡¨ valueï¼Œkey æ˜¯æ— åºçš„ã€ä¸å¯é‡å¤çš„ï¼Œvalue æ˜¯æ— åºçš„ã€å¯é‡å¤çš„ï¼Œæ¯ä¸ªé”®æœ€å¤šæ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚</li></ul><h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><p>Collectionæ˜¯æ‰€æœ‰å•åˆ—é›†åˆçš„çˆ¶æ¥å£ï¼Œå› æ­¤åœ¨Collectionä¸­å®šä¹‰äº†å•åˆ—é›†åˆ(Listå’ŒSet)é€šç”¨çš„ä¸€äº›æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ç”¨äºæ“ä½œæ‰€æœ‰çš„å•åˆ—é›†åˆã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectionAPITest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//Collectionæ˜¯æ¥å£ï¼Œä½¿ç”¨éœ€è¦å®ç°ç±»</span></span><br><span class="line">        <span class="type">Collection</span> <span class="variable">col</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="comment">//add()æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œæ·»åŠ åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¼šè‡ªåŠ¨è£…ç®±ï¼Œint---&gt;Integer</span></span><br><span class="line">        col.add(<span class="number">1</span>);</span><br><span class="line">        col.add(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨addæ–¹æ³•æ·»åŠ 1å’Œ2ï¼š&quot;</span>+col);</span><br><span class="line">        <span class="comment">//addALl()æ·»åŠ ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">        List&lt;Integer&gt; integers = Arrays.asList(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;);</span><br><span class="line">        col.addAll(integers);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨addAllæ–¹æ³•æ·»åŠ &#123;3, 4, 5, 6, 7, 8&#125;:&quot;</span>+col);</span><br><span class="line">        System.out.println(Integer.toBinaryString(<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toHexString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>));</span><br><span class="line">        <span class="comment">//remove()æ–¹æ³•ç§»é™¤æŒ‡å®šå…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨remove()æ–¹æ³•ç§»é™¤å…ƒç´ 1ï¼š&quot;</span>+col.remove(<span class="number">1</span>)+<span class="string">&quot;(trueæˆåŠŸ/falseå¤±è´¥)ç§»é™¤åé›†åˆ&quot;</span>+col);</span><br><span class="line">        System.out.println(<span class="string">&quot;å†æ¬¡ä½¿ç”¨remove()æ–¹æ³•ç§»é™¤å…ƒç´ 1ï¼š&quot;</span>+col.remove(<span class="number">1</span>)+<span class="string">&quot;(trueæˆåŠŸ/falseå¤±è´¥)ç§»é™¤åé›†åˆ&quot;</span>+col);</span><br><span class="line">        System.out.println(Integer.toBinaryString(<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toHexString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>));</span><br><span class="line">        <span class="comment">//clear()æ–¹æ³•æ¸…é™¤é›†åˆ</span></span><br><span class="line">        col.clear();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨clearæ–¹æ³•æ¸…é™¤é›†åˆ&quot;</span>+col);</span><br><span class="line">        <span class="comment">//isEmpty()æ–¹æ³•æŸ¥çœ‹é›†åˆæ˜¯å¦ä¸ºç©º</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨isEmptyæ–¹æ³•æŸ¥çœ‹é›†åˆæ˜¯å¦ä¸ºç©º&quot;</span>+col.isEmpty());</span><br><span class="line">        System.out.println(Integer.toBinaryString(<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toHexString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>));</span><br><span class="line">        <span class="comment">//equals()æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ªé›†åˆæ˜¯å¦ç›¸ç­‰</span></span><br><span class="line">        ArrayList&lt;Object&gt; objects = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        System.out.println(<span class="string">&quot;é›†åˆä¸€ï¼š&quot;</span>+col+<span class="string">&quot;é›†åˆäºŒï¼š&quot;</span>+objects+<span class="string">&quot;ä½¿ç”¨equals()æ¯”è¾ƒä¸¤ä¸ªé›†åˆå…ƒç´ æ˜¯å¦ç›¸ç­‰&quot;</span>+col.equals(objects));</span><br><span class="line">        objects.add(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;é›†åˆä¸€ï¼š&quot;</span>+col+<span class="string">&quot;é›†åˆäºŒï¼š&quot;</span>+objects+<span class="string">&quot;ä½¿ç”¨equals()æ¯”è¾ƒä¸¤ä¸ªé›†åˆå…ƒç´ æ˜¯å¦ç›¸ç­‰&quot;</span>+col.equals(objects));</span><br><span class="line">        System.out.println(Integer.toBinaryString(<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toHexString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>));</span><br><span class="line">        <span class="comment">//contains()æ–¹æ³•åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;é›†åˆï¼š&quot;</span>+objects+<span class="string">&quot;ä½¿ç”¨contains()æ–¹æ³•åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«1è¿™ä¸ªå…ƒç´ &quot;</span>+objects.contains(<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;é›†åˆï¼š&quot;</span>+objects+<span class="string">&quot;ä½¿ç”¨contains()æ–¹æ³•åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«2è¿™ä¸ªå…ƒç´ &quot;</span>+objects.contains(<span class="number">2</span>));</span><br><span class="line">        System.out.println(Integer.toBinaryString(<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toHexString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>));</span><br><span class="line">        <span class="comment">//size()æ–¹æ³•è·å–é›†åˆé•¿åº¦</span></span><br><span class="line">        System.out.println(<span class="string">&quot;é›†åˆï¼š&quot;</span>+col+<span class="string">&quot;ä½¿ç”¨size()æ–¹æ³•è·å–é›†åˆé•¿åº¦&quot;</span>+col.size());</span><br><span class="line">        System.out.println(<span class="string">&quot;é›†åˆï¼š&quot;</span>+objects+<span class="string">&quot;ä½¿ç”¨size()æ–¹æ³•è·å–é›†åˆé•¿åº¦&quot;</span>+objects.size());</span><br><span class="line">        System.out.println(Integer.toBinaryString(<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toHexString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>)+<span class="string">&quot; &quot;</span>+Integer.toBinaryString(-<span class="number">2</span>&gt;&gt;&gt;<span class="number">2</span>));</span><br><span class="line">        <span class="comment">//ä½¿ç”¨iterator()è¿­ä»£å™¨éå†é›†åˆ</span></span><br><span class="line">        col.addAll( Arrays.asList(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>&#125;));</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½¿ç”¨iterator()éå†é›†åˆ&quot;</span>+col);</span><br><span class="line"></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> col.iterator();<span class="comment">//è·å–Iteratorå¯¹è±¡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(iterator.hasNext())&#123;<span class="comment">//Iterator.hasNext()æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸ªä¸‹ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">next</span> <span class="operator">=</span> iterator.next();<span class="comment">//è¿”å›å½“å‰å…ƒç´ ï¼Œå¹¶æŒ‡é’ˆåç§»ï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥æ²¡æœ‰ï¼Œä¸‹ä¸€æ¬¡hasNextæ–¹æ³•ä¼šåšå¤„ç†</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ç¬¬&quot;</span>+i+<span class="string">&quot;ä¸ªå…ƒç´ ï¼š&quot;</span>+next);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¸¸è§ç”¨æ³•"><a href="#å¸¸è§ç”¨æ³•" class="headerlink" title="å¸¸è§ç”¨æ³•"></a>å¸¸è§ç”¨æ³•</h2><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¢åˆ æ”¹æŸ¥æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Object element)</span> <span class="comment">//å¢æ·»å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,Object element)</span> <span class="comment">//åœ¨æŒ‡å®šä½ç½®å¢æ·»å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object o)</span> <span class="comment">//åˆ é™¤æŒ‡å®šå¯¹è±¡</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> <span class="comment">//åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">set</span><span class="params">(<span class="type">int</span> index,Object element)</span> <span class="comment">//ä¿®æ”¹æŒ‡å®šä½ç½®å…ƒç´ çš„å€¼</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> <span class="comment">//è·å–æŒ‡å®šä½ç½®å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(Object o)</span> <span class="comment">//è·å–æŒ‡å®šå…ƒç´ çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> <span class="comment">//åˆ¤æ–­æŒ‡å®šå…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å…¶ä»–å¸¸ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> <span class="comment">//è·å–å®¹å™¨ä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> <span class="comment">//è·å–è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> <span class="comment">//æ¸…ç©ºå…ƒç´ </span></span><br></pre></td></tr></table></figure><p>ArrayListé€‚åˆå¿«é€ŸæŸ¥æ‰¾å…ƒç´ ï¼ŒLinkedListé€‚åˆé¢‘ç¹åœ°å¯¹åˆ—è¡¨è¿›è¡Œå¢åŠ æˆ–åˆ é™¤å…ƒç´ æ“ä½œï¼Œå› æ­¤LinkedListç±»å¯ç”¨äºå®ç°å †æ ˆå’Œé˜Ÿåˆ—ï¼Œå¯¹æ­¤LinkedListç±»ä¸­å®šä¹‰äº†ç‰¹å®šçš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¨¡æ‹Ÿæ ˆå’Œé˜Ÿåˆ—æ“ä½œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(Object o)</span> <span class="comment">//åœ¨é“¾è¡¨å¤´å¢æ·»å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(Object o)</span> <span class="comment">//åœ¨é“¾è¡¨å°¾å¢æ·»å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">removeFirst</span><span class="params">()</span> <span class="comment">//åˆ é™¤é“¾è¡¨å¤´å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">removeLast</span><span class="params">()</span> <span class="comment">//åˆ é™¤é“¾è¡¨å°¾å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> <span class="comment">//åˆ¤æ–­é“¾è¡¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(E e)</span> <span class="comment">//ç­‰ä»·äºaddFirst()</span></span><br><span class="line"><span class="keyword">public</span> E <span class="title function_">pop</span><span class="params">()</span> <span class="comment">//ç­‰ä»·äºremoveFirst()</span></span><br><span class="line"><span class="keyword">public</span> E <span class="title function_">getFirst</span><span class="params">()</span> <span class="comment">//è·å–é“¾è¡¨é¦–å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> E <span class="title function_">getLast</span><span class="params">()</span> <span class="comment">//è·å–é“¾è¡¨å°¾å…ƒç´ </span></span><br></pre></td></tr></table></figure><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¢åˆ æŸ¥æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Object element)</span> <span class="comment">//å¢æ·»å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(object element)</span> <span class="comment">//åˆ é™¤å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> <span class="comment">//åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å…¶ä»–å¸¸ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> <span class="comment">//è·å–å®¹å™¨ä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> <span class="comment">//åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> <span class="comment">//è·å–è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> <span class="comment">//æ¸…ç©ºå…ƒç´ </span></span><br></pre></td></tr></table></figure><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¢åˆ æŸ¥</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">put</span><span class="params">(Object key,Object value)</span> <span class="comment">//å¢æ·»å…ƒç´ </span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">remove</span><span class="params">(Object key)</span> <span class="comment">//åˆ é™¤å…ƒç´ ,å¹¶è¿”å›é”®å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(Object key)</span> <span class="comment">//è·å–é”®å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsKey</span><span class="params">(Object key)</span> <span class="comment">//åˆ¤æ–­æŒ‡å®šé”®æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">containsValue</span><span class="params">(Object value)</span> <span class="comment">//åˆ¤æ–­æŒ‡å®šå€¼æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//è·å–é”®ã€å€¼ã€å…ƒç´ é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> Collection <span class="title function_">values</span><span class="params">()</span> <span class="comment">//è·å–å€¼é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> Set <span class="title function_">KeySet</span><span class="params">()</span> <span class="comment">//è·å–é”®é›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> Set <span class="title function_">entrySet</span><span class="params">()</span> <span class="comment">//è·å–å…ƒç´ é›†åˆ</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//å…¶ä»–æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> <span class="comment">//è·å–å®¹å™¨ä¸­å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> <span class="comment">//åˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> <span class="comment">//æ¸…ç©ºå…ƒç´ </span></span><br></pre></td></tr></table></figure><p>Map æ¥å£æ²¡æœ‰æä¾› iterator() æ–¹æ³•ï¼Œå…¶å­æ¥å£ Entry æä¾›äº† iterator() æ–¹æ³•ï¼Œå¹¶ä¸”æä¾›äº†è·å–é”®ã€å€¼çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Map.Entryæ¥å£ä¸»è¦æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> <span class="comment">//è·å–è¿­ä»£å™¨</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getKey</span><span class="params">()</span> <span class="comment">//è·å–é”®</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getValue</span><span class="params">()</span> <span class="comment">//è·å–å€¼</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//è°ƒç”¨æ¡ˆä¾‹</span></span><br><span class="line">Iterator(Entry) iter=map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span>(iter.hasNext())&#123;</span><br><span class="line">    Entry entry=iter.next();</span><br><span class="line">    <span class="type">int</span> key=(Integer)entry.getKey();</span><br><span class="line">    <span class="type">int</span> val=(Integer)entry.getValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(Object[] a, Object key)</span> <span class="comment">//äºŒåˆ†æŸ¥æ‰¾ï¼ˆaå·²æ’åºï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object[] a, Object[] a2)</span> <span class="comment">//åˆ¤æ–­ä¸¤æ•°ç»„æ˜¯å¦å®Œå…¨ä¸€è‡´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">fill</span><span class="params">(Object[] a, Object val)</span> <span class="comment">//åœ¨aä¸­æ‰€æœ‰ä½ç½®å¡«å……val</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">fill</span><span class="params">(Object[] a, <span class="type">int</span> fromIndex, <span class="type">int</span> toIndex, Object val)</span> <span class="comment">//åœ¨[fromIndex,toIndex)ä¸­å¡«å……å…ƒç´ val</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">toString</span><span class="params">(Object[] a)</span> <span class="comment">//å°†æ•°ç»„aè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¦‚&quot;[1, 2, 3]&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Object[] a)</span> <span class="comment">//æ”¹è¿›çš„å¿«é€Ÿæ’åºï¼ˆå‡åºï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Object[] a, <span class="type">int</span> fromIndex, <span class="type">int</span> toIndex)</span> <span class="comment">//å¯¹[fromIndex,toIndex)ä¸­çš„å…ƒç´ æ’åºï¼ˆå‡åºï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(T[] a, Comparator&lt;? <span class="built_in">super</span> T&gt; c)</span> <span class="comment">//è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ’åº</span></span><br></pre></td></tr></table></figure><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º HashMap å¯¹è±¡ Sites</span></span><br><span class="line">HashMap&lt;Integer, String&gt; Sites = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, String&gt;();</span><br><span class="line"><span class="comment">// æ·»åŠ é”®å€¼å¯¹</span></span><br><span class="line">Sites.put(<span class="number">1</span>, <span class="string">&quot;Google&quot;</span>);</span><br><span class="line"><span class="comment">//ä½¿ç”¨ get(key) æ–¹æ³•æ¥è·å– key å¯¹åº”çš„ value</span></span><br><span class="line"><span class="comment">//remove(key) æ–¹æ³•æ¥åˆ é™¤ key å¯¹åº”çš„é”®å€¼å¯¹(key-value)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">clear()<span class="comment">//åˆ é™¤ hashMap ä¸­çš„æ‰€æœ‰é”®/å€¼å¯¹</span></span><br><span class="line">clone()<span class="comment">//å¤åˆ¶ä¸€ä»½ hashMap</span></span><br><span class="line">isEmpty()<span class="comment">//åˆ¤æ–­ hashMap æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">size()<span class="comment">//è®¡ç®— hashMap ä¸­é”®/å€¼å¯¹çš„æ•°é‡</span></span><br><span class="line">put()<span class="comment">//å°†é”®/å€¼å¯¹æ·»åŠ åˆ° hashMap ä¸­</span></span><br><span class="line">putAll()<span class="comment">//å°†æ‰€æœ‰é”®/å€¼å¯¹æ·»åŠ åˆ° hashMap ä¸­</span></span><br><span class="line">putIfAbsent()<span class="comment">//å¦‚æœ hashMap ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„é”®ï¼Œåˆ™å°†æŒ‡å®šçš„é”®/å€¼å¯¹æ’å…¥åˆ° hashMap ä¸­ã€‚</span></span><br><span class="line">remove()<span class="comment">//åˆ é™¤ hashMap ä¸­æŒ‡å®šé”® key çš„æ˜ å°„å…³ç³»</span></span><br><span class="line">containsKey()<span class="comment">//æ£€æŸ¥ hashMap ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„ key å¯¹åº”çš„æ˜ å°„å…³ç³»ã€‚</span></span><br><span class="line">containsValue()<span class="comment">//æ£€æŸ¥ hashMap ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„ value å¯¹åº”çš„æ˜ å°„å…³ç³»ã€‚</span></span><br><span class="line">replace()<span class="comment">//æ›¿æ¢ hashMap ä¸­æ˜¯æŒ‡å®šçš„ key å¯¹åº”çš„ valueã€‚</span></span><br><span class="line">replaceAll()<span class="comment">//å°† hashMap ä¸­çš„æ‰€æœ‰æ˜ å°„å…³ç³»æ›¿æ¢æˆç»™å®šçš„å‡½æ•°æ‰€æ‰§è¡Œçš„ç»“æœã€‚</span></span><br><span class="line">get()<span class="comment">//è·å–æŒ‡å®š key å¯¹åº”å¯¹ value</span></span><br><span class="line">getOrDefault()<span class="comment">//è·å–æŒ‡å®š key å¯¹åº”å¯¹ valueï¼Œå¦‚æœæ‰¾ä¸åˆ° key ï¼Œåˆ™è¿”å›è®¾ç½®çš„é»˜è®¤å€¼</span></span><br><span class="line">forEach()<span class="comment">//å¯¹ hashMap ä¸­çš„æ¯ä¸ªæ˜ å°„æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚</span></span><br><span class="line">entrySet()<span class="comment">//è¿”å› hashMap ä¸­æ‰€æœ‰æ˜ å°„é¡¹çš„é›†åˆé›†åˆè§†å›¾ã€‚</span></span><br><span class="line">keySet()<span class="comment">//è¿”å› hashMap ä¸­æ‰€æœ‰ key ç»„æˆçš„é›†åˆè§†å›¾ã€‚</span></span><br><span class="line">values()<span class="comment">//è¿”å› hashMap ä¸­å­˜åœ¨çš„æ‰€æœ‰ value å€¼ã€‚</span></span><br><span class="line">merge()     <span class="comment">//æ·»åŠ é”®å€¼å¯¹åˆ° hashMap ä¸­</span></span><br><span class="line">compute()<span class="comment">//å¯¹ hashMap ä¸­æŒ‡å®š key çš„å€¼è¿›è¡Œé‡æ–°è®¡ç®—</span></span><br><span class="line">computeIfAbsent()<span class="comment">//å¯¹ hashMap ä¸­æŒ‡å®š key çš„å€¼è¿›è¡Œé‡æ–°è®¡ç®—ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ä¸ª keyï¼Œåˆ™æ·»åŠ åˆ° hasMap ä¸­</span></span><br><span class="line">computeIfPresent()<span class="comment">//å¯¹ hashMap ä¸­æŒ‡å®š key çš„å€¼è¿›è¡Œé‡æ–°è®¡ç®—ï¼Œå‰ææ˜¯è¯¥ key å­˜åœ¨äº hashMap ä¸­ã€‚</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch7æ·±åº¦å­¦ä¹ è®¡ç®—</title>
      <link href="/2024/06/26/Pytorch7%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97/"/>
      <url>/2024/06/26/Pytorch7%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E8%AE%A1%E7%AE%97/</url>
      
        <content type="html"><![CDATA[<h1 id="æ·±åº¦å­¦ä¹ è®¡ç®—"><a href="#æ·±åº¦å­¦ä¹ è®¡ç®—" class="headerlink" title="æ·±åº¦å­¦ä¹ è®¡ç®—"></a>æ·±åº¦å­¦ä¹ è®¡ç®—</h1><h2 id="å—å’Œå±‚"><a href="#å—å’Œå±‚" class="headerlink" title="å—å’Œå±‚"></a>å—å’Œå±‚</h2><p>å¯¹äºå¤šå±‚æ„ŸçŸ¥æœºè€Œè¨€ï¼Œæ•´ä¸ªæ¨¡å‹åŠå…¶ç»„æˆå±‚éƒ½æ˜¯è¿™ç§æ¶æ„ã€‚ æ•´ä¸ªæ¨¡å‹æ¥å—åŸå§‹è¾“å…¥ï¼ˆç‰¹å¾ï¼‰ï¼Œç”Ÿæˆè¾“å‡ºï¼ˆé¢„æµ‹ï¼‰ï¼Œ å¹¶åŒ…å«ä¸€äº›å‚æ•°ï¼ˆæ‰€æœ‰ç»„æˆå±‚çš„å‚æ•°é›†åˆï¼‰ã€‚ åŒæ ·ï¼Œæ¯ä¸ªå•ç‹¬çš„å±‚æ¥æ”¶è¾“å…¥ï¼ˆç”±å‰ä¸€å±‚æä¾›ï¼‰ï¼Œ ç”Ÿæˆè¾“å‡ºï¼ˆåˆ°ä¸‹ä¸€å±‚çš„è¾“å…¥ï¼‰ï¼Œå¹¶ä¸”å…·æœ‰ä¸€ç»„å¯è°ƒå‚æ•°ï¼Œ è¿™äº›å‚æ•°æ ¹æ®ä»ä¸‹ä¸€å±‚åå‘ä¼ æ’­çš„ä¿¡å·è¿›è¡Œæ›´æ–°ã€‚</p><p>äº‹å®è¯æ˜ï¼Œç ”ç©¶è®¨è®ºâ€œæ¯”å•ä¸ªå±‚å¤§â€ä½†â€œæ¯”æ•´ä¸ªæ¨¡å‹å°â€çš„ç»„ä»¶æ›´æœ‰ä»·å€¼ã€‚ ä¾‹å¦‚ï¼Œåœ¨è®¡ç®—æœºè§†è§‰ä¸­å¹¿æ³›æµè¡Œçš„ResNet-152æ¶æ„å°±æœ‰æ•°ç™¾å±‚ï¼Œ è¿™äº›å±‚æ˜¯ç”±<em>å±‚ç»„</em>ï¼ˆgroups of layersï¼‰çš„é‡å¤æ¨¡å¼ç»„æˆã€‚ è¿™ä¸ªResNetæ¶æ„èµ¢å¾—äº†2015å¹´ImageNetå’ŒCOCOè®¡ç®—æœºè§†è§‰æ¯”èµ› çš„è¯†åˆ«å’Œæ£€æµ‹ä»»åŠ¡ (<a href="https://zh-v2.d2l.ai/chapter_references/zreferences.html#id60">He <em>et al.</em>, 2016</a>)ã€‚ ç›®å‰ResNetæ¶æ„ä»ç„¶æ˜¯è®¸å¤šè§†è§‰ä»»åŠ¡çš„é¦–é€‰æ¶æ„ã€‚ åœ¨å…¶ä»–çš„é¢†åŸŸï¼Œå¦‚è‡ªç„¶è¯­è¨€å¤„ç†å’Œè¯­éŸ³ï¼Œ å±‚ç»„ä»¥å„ç§é‡å¤æ¨¡å¼æ’åˆ—çš„ç±»ä¼¼æ¶æ„ç°åœ¨ä¹Ÿæ˜¯æ™®éå­˜åœ¨ã€‚</p><p>ä¸ºäº†å®ç°è¿™äº›å¤æ‚çš„ç½‘ç»œï¼Œæˆ‘ä»¬å¼•å…¥äº†ç¥ç»ç½‘ç»œ<em>å—</em>çš„æ¦‚å¿µã€‚ <em>å—</em>ï¼ˆblockï¼‰å¯ä»¥æè¿°å•ä¸ªå±‚ã€ç”±å¤šä¸ªå±‚ç»„æˆçš„ç»„ä»¶æˆ–æ•´ä¸ªæ¨¡å‹æœ¬èº«ã€‚ ä½¿ç”¨å—è¿›è¡ŒæŠ½è±¡çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å°†ä¸€äº›å—ç»„åˆæˆæ›´å¤§çš„ç»„ä»¶ï¼Œ è¿™ä¸€è¿‡ç¨‹é€šå¸¸æ˜¯é€’å½’çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ é€šè¿‡å®šä¹‰ä»£ç æ¥æŒ‰éœ€ç”Ÿæˆä»»æ„å¤æ‚åº¦çš„å—ï¼Œ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€æ´çš„ä»£ç å®ç°å¤æ‚çš„ç¥ç»ç½‘ç»œã€‚</p><p><img src="/../img/Pytorch1/pytorch7/1.png" alt="1"></p><p>ä»ç¼–ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œå—ç”±<em>ç±»</em>ï¼ˆclassï¼‰è¡¨ç¤ºã€‚ å®ƒçš„ä»»ä½•å­ç±»éƒ½å¿…é¡»å®šä¹‰ä¸€ä¸ªå°†å…¶è¾“å…¥è½¬æ¢ä¸ºè¾“å‡ºçš„å‰å‘ä¼ æ’­å‡½æ•°ï¼Œ å¹¶ä¸”å¿…é¡»å­˜å‚¨ä»»ä½•å¿…éœ€çš„å‚æ•°ã€‚ æ³¨æ„ï¼Œæœ‰äº›å—ä¸éœ€è¦ä»»ä½•å‚æ•°ã€‚ æœ€åï¼Œä¸ºäº†è®¡ç®—æ¢¯åº¦ï¼Œå—å¿…é¡»å…·æœ‰åå‘ä¼ æ’­å‡½æ•°ã€‚ åœ¨å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„å—æ—¶ï¼Œç”±äºè‡ªåŠ¨å¾®åˆ†æä¾›äº†ä¸€äº›åç«¯å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘å‰å‘ä¼ æ’­å‡½æ•°å’Œå¿…éœ€çš„å‚æ•°ã€‚</p><p>åœ¨æ„é€ è‡ªå®šä¹‰å—ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹å¤šå±‚æ„ŸçŸ¥æœºçš„ä»£ç ã€‚ ä¸‹é¢çš„ä»£ç ç”Ÿæˆä¸€ä¸ªç½‘ç»œï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå…·æœ‰256ä¸ªå•å…ƒå’ŒReLUæ¿€æ´»å‡½æ•°çš„å…¨è¿æ¥éšè—å±‚ï¼Œ ç„¶åæ˜¯ä¸€ä¸ªå…·æœ‰10ä¸ªéšè—å•å…ƒä¸”ä¸å¸¦æ¿€æ´»å‡½æ•°çš„å…¨è¿æ¥è¾“å‡ºå±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">net = nn.Sequential(nn.Linear(<span class="number">20</span>, <span class="number">256</span>), nn.ReLU(), nn.Linear(<span class="number">256</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">X = torch.rand(<span class="number">2</span>, <span class="number">20</span>)</span><br><span class="line">net(X)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">0.0343</span>,  <span class="number">0.0264</span>,  <span class="number">0.2505</span>, -<span class="number">0.0243</span>,  <span class="number">0.0945</span>,  <span class="number">0.0012</span>, -<span class="number">0.0141</span>,  <span class="number">0.0666</span>,</span><br><span class="line">         -<span class="number">0.0547</span>, -<span class="number">0.0667</span>],</span><br><span class="line">        [ <span class="number">0.0772</span>, -<span class="number">0.0274</span>,  <span class="number">0.2638</span>, -<span class="number">0.0191</span>,  <span class="number">0.0394</span>, -<span class="number">0.0324</span>,  <span class="number">0.0102</span>,  <span class="number">0.0707</span>,</span><br><span class="line">         -<span class="number">0.1481</span>, -<span class="number">0.1031</span>]], grad_fn=&lt;AddmmBackward0&gt;)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®ä¾‹åŒ–<code>nn.Sequential</code>æ¥æ„å»ºæˆ‘ä»¬çš„æ¨¡å‹ï¼Œ å±‚çš„æ‰§è¡Œé¡ºåºæ˜¯ä½œä¸ºå‚æ•°ä¼ é€’çš„ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œ<code>nn.Sequential</code>å®šä¹‰äº†ä¸€ç§ç‰¹æ®Šçš„<code>Module</code>ï¼Œ å³åœ¨PyTorchä¸­è¡¨ç¤ºä¸€ä¸ªå—çš„ç±»ï¼Œ å®ƒç»´æŠ¤äº†ä¸€ä¸ªç”±<code>Module</code>ç»„æˆçš„æœ‰åºåˆ—è¡¨ã€‚ æ³¨æ„ï¼Œä¸¤ä¸ªå…¨è¿æ¥å±‚éƒ½æ˜¯<code>Linear</code>ç±»çš„å®ä¾‹ï¼Œ <code>Linear</code>ç±»æœ¬èº«å°±æ˜¯<code>Module</code>çš„å­ç±»ã€‚ å¦å¤–ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨é€šè¿‡<code>net(X)</code>è°ƒç”¨æˆ‘ä»¬çš„æ¨¡å‹æ¥è·å¾—æ¨¡å‹çš„è¾“å‡ºã€‚ è¿™å®é™…ä¸Šæ˜¯<code>net.__call__(X)</code>çš„ç®€å†™ã€‚ è¿™ä¸ªå‰å‘ä¼ æ’­å‡½æ•°éå¸¸ç®€å•ï¼š å®ƒå°†åˆ—è¡¨ä¸­çš„æ¯ä¸ªå—è¿æ¥åœ¨ä¸€èµ·ï¼Œå°†æ¯ä¸ªå—çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªå—çš„è¾“å…¥ã€‚</p><h2 id="è‡ªå®šä¹‰å—"><a href="#è‡ªå®šä¹‰å—" class="headerlink" title="è‡ªå®šä¹‰å—"></a>è‡ªå®šä¹‰å—</h2><p>è¦æƒ³ç›´è§‚åœ°äº†è§£å—æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯è‡ªå·±å®ç°ä¸€ä¸ªã€‚ åœ¨å®ç°æˆ‘ä»¬è‡ªå®šä¹‰å—ä¹‹å‰ï¼Œæˆ‘ä»¬ç®€è¦æ€»ç»“ä¸€ä¸‹æ¯ä¸ªå—å¿…é¡»æä¾›çš„åŸºæœ¬åŠŸèƒ½ã€‚</p><ol><li>å°†è¾“å…¥æ•°æ®ä½œä¸ºå…¶å‰å‘ä¼ æ’­å‡½æ•°çš„å‚æ•°ã€‚</li><li>é€šè¿‡å‰å‘ä¼ æ’­å‡½æ•°æ¥ç”Ÿæˆè¾“å‡ºã€‚è¯·æ³¨æ„ï¼Œè¾“å‡ºçš„å½¢çŠ¶å¯èƒ½ä¸è¾“å…¥çš„å½¢çŠ¶ä¸åŒã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸Šé¢æ¨¡å‹ä¸­çš„ç¬¬ä¸€ä¸ªå…¨è¿æ¥çš„å±‚æ¥æ”¶ä¸€ä¸ª20ç»´çš„è¾“å…¥ï¼Œä½†æ˜¯è¿”å›ä¸€ä¸ªç»´åº¦ä¸º256çš„è¾“å‡ºã€‚</li><li>è®¡ç®—å…¶è¾“å‡ºå…³äºè¾“å…¥çš„æ¢¯åº¦ï¼Œå¯é€šè¿‡å…¶åå‘ä¼ æ’­å‡½æ•°è¿›è¡Œè®¿é—®ã€‚é€šå¸¸è¿™æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„ã€‚</li><li>å­˜å‚¨å’Œè®¿é—®å‰å‘ä¼ æ’­è®¡ç®—æ‰€éœ€çš„å‚æ•°ã€‚</li><li>æ ¹æ®éœ€è¦åˆå§‹åŒ–æ¨¡å‹å‚æ•°ã€‚</li></ol><p>ä»é›¶ç¼–å†™ä¸€ä¸ªå—ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºï¼Œå…¶å…·æœ‰256ä¸ªéšè—å•å…ƒçš„éšè—å±‚å’Œä¸€ä¸ª10ç»´è¾“å‡ºå±‚ã€‚ æ³¨æ„ï¼Œä¸‹é¢çš„<code>MLP</code>ç±»ç»§æ‰¿äº†è¡¨ç¤ºå—çš„ç±»ã€‚ æˆ‘ä»¬çš„å®ç°åªéœ€è¦æä¾›æˆ‘ä»¬è‡ªå·±çš„æ„é€ å‡½æ•°ï¼ˆPythonä¸­çš„<code>__init__</code>å‡½æ•°ï¼‰å’Œå‰å‘ä¼ æ’­å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MLP</span>(nn.Module):</span><br><span class="line">    <span class="comment"># ç”¨æ¨¡å‹å‚æ•°å£°æ˜å±‚ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬å£°æ˜ä¸¤ä¸ªå…¨è¿æ¥çš„å±‚</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># è°ƒç”¨MLPçš„çˆ¶ç±»Moduleçš„æ„é€ å‡½æ•°æ¥æ‰§è¡Œå¿…è¦çš„åˆå§‹åŒ–ã€‚</span></span><br><span class="line">        <span class="comment"># è¿™æ ·ï¼Œåœ¨ç±»å®ä¾‹åŒ–æ—¶ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–å‡½æ•°å‚æ•°ï¼Œä¾‹å¦‚æ¨¡å‹å‚æ•°paramsï¼ˆç¨åå°†ä»‹ç»ï¼‰</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.hidden = nn.Linear(<span class="number">20</span>, <span class="number">256</span>)  <span class="comment"># éšè—å±‚</span></span><br><span class="line">        self.out = nn.Linear(<span class="number">256</span>, <span class="number">10</span>)  <span class="comment"># è¾“å‡ºå±‚</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å®šä¹‰æ¨¡å‹çš„å‰å‘ä¼ æ’­ï¼Œå³å¦‚ä½•æ ¹æ®è¾“å…¥Xè¿”å›æ‰€éœ€çš„æ¨¡å‹è¾“å‡º</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        <span class="comment"># æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ReLUçš„å‡½æ•°ç‰ˆæœ¬ï¼Œå…¶åœ¨nn.functionalæ¨¡å—ä¸­å®šä¹‰ã€‚</span></span><br><span class="line">        <span class="keyword">return</span> self.out(F.relu(self.hidden(X)))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å‰å‘ä¼ æ’­å‡½æ•°ï¼Œå®ƒä»¥<code>X</code>ä½œä¸ºè¾“å…¥ï¼Œ è®¡ç®—å¸¦æœ‰æ¿€æ´»å‡½æ•°çš„éšè—è¡¨ç¤ºï¼Œå¹¶è¾“å‡ºå…¶æœªè§„èŒƒåŒ–çš„è¾“å‡ºå€¼ã€‚ åœ¨è¿™ä¸ª<code>MLP</code>å®ç°ä¸­ï¼Œä¸¤ä¸ªå±‚éƒ½æ˜¯å®ä¾‹å˜é‡ã€‚ è¦äº†è§£è¿™ä¸ºä»€ä¹ˆæ˜¯åˆç†çš„ï¼Œå¯ä»¥æƒ³è±¡å®ä¾‹åŒ–ä¸¤ä¸ªå¤šå±‚æ„ŸçŸ¥æœºï¼ˆ<code>net1</code>å’Œ<code>net2</code>ï¼‰ï¼Œ å¹¶æ ¹æ®ä¸åŒçš„æ•°æ®å¯¹å®ƒä»¬è¿›è¡Œè®­ç»ƒã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒä»¬å­¦åˆ°ä¸¤ç§ä¸åŒçš„æ¨¡å‹ã€‚</p><p>æ¥ç€æˆ‘ä»¬å®ä¾‹åŒ–å¤šå±‚æ„ŸçŸ¥æœºçš„å±‚ï¼Œç„¶ååœ¨æ¯æ¬¡è°ƒç”¨å‰å‘ä¼ æ’­å‡½æ•°æ—¶è°ƒç”¨è¿™äº›å±‚ã€‚ æ³¨æ„ä¸€äº›å…³é”®ç»†èŠ‚ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬å®šåˆ¶çš„<code>__init__</code>å‡½æ•°é€šè¿‡<code>super().__init__()</code> è°ƒç”¨çˆ¶ç±»çš„<code>__init__</code>å‡½æ•°ï¼Œ çœå»äº†é‡å¤ç¼–å†™æ¨¡ç‰ˆä»£ç çš„ç—›è‹¦ã€‚ ç„¶åï¼Œæˆ‘ä»¬å®ä¾‹åŒ–ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼Œ åˆ†åˆ«ä¸º<code>self.hidden</code>å’Œ<code>self.out</code>ã€‚ æ³¨æ„ï¼Œé™¤éæˆ‘ä»¬å®ç°ä¸€ä¸ªæ–°çš„è¿ç®—ç¬¦ï¼Œ å¦åˆ™æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒåå‘ä¼ æ’­å‡½æ•°æˆ–å‚æ•°åˆå§‹åŒ–ï¼Œ ç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆè¿™äº›ã€‚</p><p>æˆ‘ä»¬æ¥è¯•ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net = MLP()</span><br><span class="line">net(X)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">0.0669</span>,  <span class="number">0.2202</span>, -<span class="number">0.0912</span>, -<span class="number">0.0064</span>,  <span class="number">0.1474</span>, -<span class="number">0.0577</span>, -<span class="number">0.3006</span>,  <span class="number">0.1256</span>,</span><br><span class="line">         -<span class="number">0.0280</span>,  <span class="number">0.4040</span>],</span><br><span class="line">        [ <span class="number">0.0545</span>,  <span class="number">0.2591</span>, -<span class="number">0.0297</span>,  <span class="number">0.1141</span>,  <span class="number">0.1887</span>,  <span class="number">0.0094</span>, -<span class="number">0.2686</span>,  <span class="number">0.0732</span>,</span><br><span class="line">         -<span class="number">0.0135</span>,  <span class="number">0.3865</span>]], grad_fn=&lt;AddmmBackward0&gt;)</span><br></pre></td></tr></table></figure><p>å—çš„ä¸€ä¸ªä¸»è¦ä¼˜ç‚¹æ˜¯å®ƒçš„å¤šåŠŸèƒ½æ€§ã€‚ æˆ‘ä»¬å¯ä»¥å­ç±»åŒ–å—ä»¥åˆ›å»ºå±‚ï¼ˆå¦‚å…¨è¿æ¥å±‚çš„ç±»ï¼‰ã€ æ•´ä¸ªæ¨¡å‹ï¼ˆå¦‚ä¸Šé¢çš„<code>MLP</code>ç±»ï¼‰æˆ–å…·æœ‰ä¸­ç­‰å¤æ‚åº¦çš„å„ç§ç»„ä»¶ã€‚ æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­å……åˆ†åˆ©ç”¨äº†è¿™ç§å¤šåŠŸèƒ½æ€§ï¼Œ æ¯”å¦‚åœ¨å¤„ç†å·ç§¯ç¥ç»ç½‘ç»œæ—¶ã€‚</p><h2 id="é¡ºåºå—"><a href="#é¡ºåºå—" class="headerlink" title="é¡ºåºå—"></a>é¡ºåºå—</h2><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ›´ä»”ç»†åœ°çœ‹çœ‹<code>Sequential</code>ç±»æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œ å›æƒ³ä¸€ä¸‹<code>Sequential</code>çš„è®¾è®¡æ˜¯ä¸ºäº†æŠŠå…¶ä»–æ¨¡å—ä¸²èµ·æ¥ã€‚ ä¸ºäº†æ„å»ºæˆ‘ä»¬è‡ªå·±çš„ç®€åŒ–çš„<code>MySequential</code>ï¼Œ æˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸¤ä¸ªå…³é”®å‡½æ•°ï¼š</p><ol><li>ä¸€ç§å°†å—é€ä¸ªè¿½åŠ åˆ°åˆ—è¡¨ä¸­çš„å‡½æ•°ï¼›</li><li>ä¸€ç§å‰å‘ä¼ æ’­å‡½æ•°ï¼Œç”¨äºå°†è¾“å…¥æŒ‰è¿½åŠ å—çš„é¡ºåºä¼ é€’ç»™å—ç»„æˆçš„â€œé“¾æ¡â€ã€‚</li></ol><p>ä¸‹é¢çš„<code>MySequential</code>ç±»æä¾›äº†ä¸é»˜è®¤<code>Sequential</code>ç±»ç›¸åŒçš„åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MySequential</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="keyword">for</span> idx, module <span class="keyword">in</span> <span class="built_in">enumerate</span>(args):</span><br><span class="line">            <span class="comment"># è¿™é‡Œï¼Œmoduleæ˜¯Moduleå­ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æˆ‘ä»¬æŠŠå®ƒä¿å­˜åœ¨&#x27;Module&#x27;ç±»çš„æˆå‘˜</span></span><br><span class="line">            <span class="comment"># å˜é‡_modulesä¸­ã€‚_moduleçš„ç±»å‹æ˜¯OrderedDict</span></span><br><span class="line">            self._modules[<span class="built_in">str</span>(idx)] = module</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        <span class="comment"># OrderedDictä¿è¯äº†æŒ‰ç…§æˆå‘˜æ·»åŠ çš„é¡ºåºéå†å®ƒä»¬</span></span><br><span class="line">        <span class="keyword">for</span> block <span class="keyword">in</span> self._modules.values():</span><br><span class="line">            X = block(X)</span><br><span class="line">        <span class="keyword">return</span> X</span><br></pre></td></tr></table></figure><p><code>__init__</code>å‡½æ•°å°†æ¯ä¸ªæ¨¡å—é€ä¸ªæ·»åŠ åˆ°æœ‰åºå­—å…¸<code>_modules</code>ä¸­ã€‚ è¯»è€…å¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆæ¯ä¸ª<code>Module</code>éƒ½æœ‰ä¸€ä¸ª<code>_modules</code>å±æ€§ï¼Ÿ ä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨å®ƒè€Œä¸æ˜¯è‡ªå·±å®šä¹‰ä¸€ä¸ªPythonåˆ—è¡¨ï¼Ÿ ç®€è€Œè¨€ä¹‹ï¼Œ<code>_modules</code>çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼š åœ¨æ¨¡å—çš„å‚æ•°åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œ ç³»ç»ŸçŸ¥é“åœ¨<code>_modules</code>å­—å…¸ä¸­æŸ¥æ‰¾éœ€è¦åˆå§‹åŒ–å‚æ•°çš„å­å—ã€‚</p><p>å½“<code>MySequential</code>çš„å‰å‘ä¼ æ’­å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œ æ¯ä¸ªæ·»åŠ çš„å—éƒ½æŒ‰ç…§å®ƒä»¬è¢«æ·»åŠ çš„é¡ºåºæ‰§è¡Œã€‚ ç°åœ¨å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„<code>MySequential</code>ç±»é‡æ–°å®ç°å¤šå±‚æ„ŸçŸ¥æœºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net = MySequential(nn.Linear(<span class="number">20</span>, <span class="number">256</span>), nn.ReLU(), nn.Linear(<span class="number">256</span>, <span class="number">10</span>))</span><br><span class="line">net(X)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">2.2759e-01</span>, -<span class="number">4.7003e-02</span>,  <span class="number">4.2846e-01</span>, -<span class="number">1.2546e-01</span>,  <span class="number">1.5296e-01</span>,</span><br><span class="line">          <span class="number">1.8972e-01</span>,  <span class="number">9.7048e-02</span>,  <span class="number">4.5479e-04</span>, -<span class="number">3.7986e-02</span>,  <span class="number">6.4842e-02</span>],</span><br><span class="line">        [ <span class="number">2.7825e-01</span>, -<span class="number">9.7517e-02</span>,  <span class="number">4.8541e-01</span>, -<span class="number">2.4519e-01</span>, -<span class="number">8.4580e-02</span>,</span><br><span class="line">          <span class="number">2.8538e-01</span>,  <span class="number">3.6861e-02</span>,  <span class="number">2.9411e-02</span>, -<span class="number">1.0612e-01</span>,  <span class="number">1.2620e-01</span>]],</span><br><span class="line">       grad_fn=&lt;AddmmBackward0&gt;)</span><br></pre></td></tr></table></figure><h2 id="åœ¨å‰å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç "><a href="#åœ¨å‰å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç " class="headerlink" title="åœ¨å‰å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç "></a>åœ¨å‰å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡Œä»£ç </h2><p><code>Sequential</code>ç±»ä½¿æ¨¡å‹æ„é€ å˜å¾—ç®€å•ï¼Œ å…è®¸æˆ‘ä»¬ç»„åˆæ–°çš„æ¶æ„ï¼Œè€Œä¸å¿…å®šä¹‰è‡ªå·±çš„ç±»ã€‚ ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¶æ„éƒ½æ˜¯ç®€å•çš„é¡ºåºæ¶æ„ã€‚ å½“éœ€è¦æ›´å¼ºçš„çµæ´»æ€§æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰è‡ªå·±çš„å—ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨å‰å‘ä¼ æ’­å‡½æ•°ä¸­æ‰§è¡ŒPythonçš„æ§åˆ¶æµã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æ‰§è¡Œä»»æ„çš„æ•°å­¦è¿ç®—ï¼Œ è€Œä¸æ˜¯ç®€å•åœ°ä¾èµ–é¢„å®šä¹‰çš„ç¥ç»ç½‘ç»œå±‚ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ æˆ‘ä»¬ç½‘ç»œä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å¯¹ç½‘ç»œçš„æ¿€æ´»å€¼åŠç½‘ç»œçš„å‚æ•°èµ·ä½œç”¨ã€‚ ç„¶è€Œï¼Œæœ‰æ—¶æˆ‘ä»¬å¯èƒ½å¸Œæœ›åˆå¹¶æ—¢ä¸æ˜¯ä¸Šä¸€å±‚çš„ç»“æœä¹Ÿä¸æ˜¯å¯æ›´æ–°å‚æ•°çš„é¡¹ï¼Œ æˆ‘ä»¬ç§°ä¹‹ä¸º<em>å¸¸æ•°å‚æ•°</em>ï¼ˆconstant parameterï¼‰ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè®¡ç®—å‡½æ•° ğ‘“(ğ‘¥,ğ‘¤)&#x3D;ğ‘â‹…ğ‘¤âŠ¤ğ‘¥çš„å±‚ï¼Œ å…¶ä¸­ğ‘¥æ˜¯è¾“å…¥ï¼Œ ğ‘¤æ˜¯å‚æ•°ï¼Œ ğ‘æ˜¯æŸä¸ªåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­æ²¡æœ‰æ›´æ–°çš„æŒ‡å®šå¸¸é‡ã€‚ å› æ­¤æˆ‘ä»¬å®ç°äº†ä¸€ä¸ª<code>FixedHiddenMLP</code>ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FixedHiddenMLP</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment"># ä¸è®¡ç®—æ¢¯åº¦çš„éšæœºæƒé‡å‚æ•°ã€‚å› æ­¤å…¶åœ¨è®­ç»ƒæœŸé—´ä¿æŒä¸å˜</span></span><br><span class="line">        self.rand_weight = torch.rand((<span class="number">20</span>, <span class="number">20</span>), requires_grad=<span class="literal">False</span>)</span><br><span class="line">        self.linear = nn.Linear(<span class="number">20</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        X = self.linear(X)</span><br><span class="line">        <span class="comment"># ä½¿ç”¨åˆ›å»ºçš„å¸¸é‡å‚æ•°ä»¥åŠreluå’Œmmå‡½æ•°</span></span><br><span class="line">        X = F.relu(torch.mm(X, self.rand_weight) + <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># å¤ç”¨å…¨è¿æ¥å±‚ã€‚è¿™ç›¸å½“äºä¸¤ä¸ªå…¨è¿æ¥å±‚å…±äº«å‚æ•°</span></span><br><span class="line">        X = self.linear(X)</span><br><span class="line">        <span class="comment"># æ§åˆ¶æµ</span></span><br><span class="line">        <span class="keyword">while</span> X.<span class="built_in">abs</span>().<span class="built_in">sum</span>() &gt; <span class="number">1</span>:</span><br><span class="line">            X /= <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> X.<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ª<code>FixedHiddenMLP</code>æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªéšè—å±‚ï¼Œ å…¶æƒé‡ï¼ˆ<code>self.rand_weight</code>ï¼‰åœ¨å®ä¾‹åŒ–æ—¶è¢«éšæœºåˆå§‹åŒ–ï¼Œä¹‹åä¸ºå¸¸é‡ã€‚ è¿™ä¸ªæƒé‡ä¸æ˜¯ä¸€ä¸ªæ¨¡å‹å‚æ•°ï¼Œå› æ­¤å®ƒæ°¸è¿œä¸ä¼šè¢«åå‘ä¼ æ’­æ›´æ–°ã€‚ ç„¶åï¼Œç¥ç»ç½‘ç»œå°†è¿™ä¸ªå›ºå®šå±‚çš„è¾“å‡ºé€šè¿‡ä¸€ä¸ªå…¨è¿æ¥å±‚ã€‚</p><p>æ³¨æ„ï¼Œåœ¨è¿”å›è¾“å‡ºä¹‹å‰ï¼Œæ¨¡å‹åšäº†ä¸€äº›ä¸å¯»å¸¸çš„äº‹æƒ…ï¼š å®ƒè¿è¡Œäº†ä¸€ä¸ªwhileå¾ªç¯ï¼Œåœ¨ğ¿1èŒƒæ•°å¤§äº1çš„æ¡ä»¶ä¸‹ï¼Œ å°†è¾“å‡ºå‘é‡é™¤ä»¥2ï¼Œç›´åˆ°å®ƒæ»¡è¶³æ¡ä»¶ä¸ºæ­¢ã€‚ æœ€åï¼Œæ¨¡å‹è¿”å›äº†<code>X</code>ä¸­æ‰€æœ‰é¡¹çš„å’Œã€‚ æ³¨æ„ï¼Œæ­¤æ“ä½œå¯èƒ½ä¸ä¼šå¸¸ç”¨äºåœ¨ä»»ä½•å®é™…ä»»åŠ¡ä¸­ï¼Œ æˆ‘ä»¬åªå±•ç¤ºå¦‚ä½•å°†ä»»æ„ä»£ç é›†æˆåˆ°ç¥ç»ç½‘ç»œè®¡ç®—çš„æµç¨‹ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net = FixedHiddenMLP()</span><br><span class="line">net(X)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor(<span class="number">0.1862</span>, grad_fn=&lt;SumBackward0&gt;)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ··åˆæ­é…å„ç§ç»„åˆå—çš„æ–¹æ³•ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»¥ä¸€äº›æƒ³åˆ°çš„æ–¹æ³•åµŒå¥—å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NestMLP</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.net = nn.Sequential(nn.Linear(<span class="number">20</span>, <span class="number">64</span>), nn.ReLU(),</span><br><span class="line">                                 nn.Linear(<span class="number">64</span>, <span class="number">32</span>), nn.ReLU())</span><br><span class="line">        self.linear = nn.Linear(<span class="number">32</span>, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, X</span>):</span><br><span class="line">        <span class="keyword">return</span> self.linear(self.net(X))</span><br><span class="line"></span><br><span class="line">chimera = nn.Sequential(NestMLP(), nn.Linear(<span class="number">16</span>, <span class="number">20</span>), FixedHiddenMLP())</span><br><span class="line">chimera(X)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor(<span class="number">0.2183</span>, grad_fn=&lt;SumBackward0&gt;)</span><br></pre></td></tr></table></figure><h2 id="å‚æ•°ç®¡ç†"><a href="#å‚æ•°ç®¡ç†" class="headerlink" title="å‚æ•°ç®¡ç†"></a>å‚æ•°ç®¡ç†</h2><ul><li>è®¿é—®ç®¡ç†â€”&gt;è°ƒè¯•ï¼Œè¯Šæ–­å’Œå¯è§†åŒ–</li><li>å‚æ•°åˆå§‹åŒ–</li><li>åœ¨ä¸åŒæ¨¡å‹ç»„ä»¶ä¹‹é—´å…±äº«å‚æ•°</li></ul><p>å…ˆä»¥ä¸€ä¸ªå•å±‚éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºä¸ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line">inport nn <span class="keyword">from</span> torch</span><br><span class="line"></span><br><span class="line">net = nn Sequential(nn.Linear(<span class="number">4</span>,<span class="number">8</span>),nn.ReLU(),nn.Linear(<span class="number">8</span>,<span class="number">1</span>));</span><br><span class="line">X =torch.rand(size=(<span class="number">2</span>,<span class="number">4</span>));      //è¾“å…¥ä¸ºä¸€ä¸ªå½¢çŠ¶ä¸º(<span class="number">2</span>, <span class="number">4</span>)çš„å¼ é‡ï¼Œè¡¨ç¤ºä¸€ä¸ªæ‰¹æ¬¡ä¸­æœ‰ä¸¤ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬æœ‰<span class="number">4</span>ä¸ªç‰¹å¾ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tensor([[-<span class="number">0.0970</span>],</span><br><span class="line">        [-<span class="number">0.0827</span>]], grad_fn=&lt;AddmmBackward0&gt;)          </span><br></pre></td></tr></table></figure><p><code>grad_fn=&lt;AddmmBackward0&gt;</code>è¿™éƒ¨åˆ†ä¿¡æ¯è¡¨ç¤ºè¿™ä¸ªå¼ é‡æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„æ¢¯åº¦å‡½æ•°ï¼ˆåœ¨è¿™ä¸ªæƒ…å†µä¸‹æ˜¯<code>AddmmBackward0</code>ï¼‰ï¼Œè¿™é€šå¸¸æ„å‘³ç€è¿™ä¸ªå¼ é‡æ˜¯é€šè¿‡ä¸€ä¸ªéœ€è¦æ¢¯åº¦çš„æ“ä½œï¼ˆå¦‚åå‘ä¼ æ’­ï¼‰å¾—åˆ°çš„ã€‚åœ¨PyTorchä¸­ï¼Œå½“ä½ è¿›è¡Œè‡ªåŠ¨å¾®åˆ†ï¼ˆautogradï¼‰æ—¶ï¼Œæ¯ä¸ªè®¡ç®—å›¾ï¼ˆcomputation graphï¼‰ä¸­çš„å¼ é‡éƒ½ä¼šä¸ä¸€ä¸ªæ¢¯åº¦å‡½æ•°ç›¸å…³è”ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯ä»¥è®¡ç®—æ¢¯åº¦ã€‚</p><p>ç”±äºè°ƒç”¨äº†<code>nn.Linear</code>å±‚ï¼Œè¿™äº›å±‚åœ¨å®šä¹‰æ—¶é»˜è®¤å¯ç”¨äº†<code>requires_grad=True</code>ï¼ˆé™¤éæ˜ç¡®è®¾ç½®ä¸º<code>False</code>ï¼‰ï¼Œå› æ­¤å¯¹è¿™äº›å±‚è¿›è¡Œå‰å‘ä¼ æ’­æ—¶ï¼Œè¾“å‡ºçš„å¼ é‡ä¹Ÿä¼šæœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„æ¢¯åº¦å‡½æ•°ã€‚</p><h3 id="å‚æ•°è®¿é—®"><a href="#å‚æ•°è®¿é—®" class="headerlink" title="å‚æ•°è®¿é—®"></a>å‚æ•°è®¿é—®</h3><p>å½“é€šè¿‡<code>Sequential</code>ç±»å®šä¹‰æ¨¡å‹æ—¶ï¼Œ æˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•æ¥è®¿é—®æ¨¡å‹çš„ä»»æ„å±‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(net.state_dict())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OrderedDict([(<span class="string">&#x27;weight&#x27;</span>, tensor([[-<span class="number">0.0427</span>, -<span class="number">0.2939</span>, -<span class="number">0.1894</span>,  <span class="number">0.0220</span>, -<span class="number">0.1709</span>, -<span class="number">0.1522</span>, -<span class="number">0.0334</span>, -<span class="number">0.2263</span>]])), (<span class="string">&#x27;bias&#x27;</span>, tensor([<span class="number">0.0887</span>]))])</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå…¨è¿æ¥å±‚åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯è¯¥å±‚çš„æƒé‡å’Œåç½®ã€‚ ä¸¤è€…éƒ½å­˜å‚¨ä¸ºå•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆfloat32ï¼‰ã€‚ æ³¨æ„ï¼Œå‚æ•°åç§°å…è®¸å”¯ä¸€æ ‡è¯†æ¯ä¸ªå‚æ•°ï¼Œå³ä½¿åœ¨åŒ…å«æ•°ç™¾ä¸ªå±‚çš„ç½‘ç»œä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><h4 id="ç›®æ ‡å‚æ•°"><a href="#ç›®æ ‡å‚æ•°" class="headerlink" title="ç›®æ ‡å‚æ•°"></a>ç›®æ ‡å‚æ•°</h4><p>æ¯ä¸ªå‚æ•°éƒ½è¡¨ç¤ºä¸ºå‚æ•°ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚ è¦å¯¹å‚æ•°æ‰§è¡Œä»»ä½•æ“ä½œï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è®¿é—®åº•å±‚çš„æ•°å€¼ã€‚ æœ‰å‡ ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚æœ‰äº›æ¯”è¾ƒç®€å•ï¼Œè€Œå¦ä¸€äº›åˆ™æ¯”è¾ƒé€šç”¨ã€‚ ä¸‹é¢çš„ä»£ç ä»ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ï¼ˆå³ç¬¬ä¸‰ä¸ªç¥ç»ç½‘ç»œå±‚ï¼‰æå–åç½®ï¼Œ æå–åè¿”å›çš„æ˜¯ä¸€ä¸ªå‚æ•°ç±»å®ä¾‹ï¼Œå¹¶è¿›ä¸€æ­¥è®¿é—®è¯¥å‚æ•°çš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(net[<span class="number">2</span>].bias))  <span class="comment"># æ‰“å°åç½®çš„ç±»å‹  </span></span><br><span class="line"><span class="built_in">print</span>(net[<span class="number">2</span>].bias)        <span class="comment"># æ‰“å°åç½®å¯¹è±¡ï¼ŒåŒ…æ‹¬grad_fnï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰  </span></span><br><span class="line"><span class="built_in">print</span>(net[<span class="number">2</span>].bias.data)   <span class="comment"># æ‰“å°åç½®çš„æ•°æ®ï¼ˆä¸åŒ…æ‹¬grad_fnï¼‰</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">class</span> <span class="string">&#x27;torch.nn.parameter.Parameter&#x27;</span>&gt;</span><br><span class="line">Parameter containing:</span><br><span class="line">tensor([<span class="number">0.0887</span>], requires_grad=<span class="literal">True</span>)</span><br><span class="line">tensor([<span class="number">0.0887</span>])</span><br></pre></td></tr></table></figure><p>å‚æ•°æ˜¯å¤åˆçš„å¯¹è±¡ï¼ŒåŒ…å«å€¼ã€æ¢¯åº¦å’Œé¢å¤–ä¿¡æ¯ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦æ˜¾å¼å‚æ•°å€¼çš„åŸå› ã€‚ é™¤äº†å€¼ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¿é—®æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦ã€‚ åœ¨ä¸Šé¢è¿™ä¸ªç½‘ç»œä¸­ï¼Œç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰è°ƒç”¨åå‘ä¼ æ’­ï¼Œæ‰€ä»¥å‚æ•°çš„æ¢¯åº¦å¤„äºåˆå§‹çŠ¶æ€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net[<span class="number">2</span>].weight.grad == <span class="literal">None</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><h4 id="ä¸€æ¬¡æ€§è®¿é—®æ‰€æœ‰å‚æ•°"><a href="#ä¸€æ¬¡æ€§è®¿é—®æ‰€æœ‰å‚æ•°" class="headerlink" title="ä¸€æ¬¡æ€§è®¿é—®æ‰€æœ‰å‚æ•°"></a>ä¸€æ¬¡æ€§è®¿é—®æ‰€æœ‰å‚æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(*[(name, param.shape) <span class="keyword">for</span> name, param <span class="keyword">in</span> net[<span class="number">0</span>].named_parameters()])</span><br><span class="line"><span class="built_in">print</span>(*[(name, param.shape) <span class="keyword">for</span> name, param <span class="keyword">in</span> net.named_parameters()])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&#x27;weight&#x27;</span>, torch.Size([<span class="number">8</span>, <span class="number">4</span>])) (<span class="string">&#x27;bias&#x27;</span>, torch.Size([<span class="number">8</span>]))</span><br><span class="line">(<span class="string">&#x27;0.weight&#x27;</span>, torch.Size([<span class="number">8</span>, <span class="number">4</span>])) (<span class="string">&#x27;0.bias&#x27;</span>, torch.Size([<span class="number">8</span>])) (<span class="string">&#x27;2.weight&#x27;</span>, torch.Size([<span class="number">1</span>, <span class="number">8</span>])) (<span class="string">&#x27;2.bias&#x27;</span>, torch.Size([<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§è®¿é—®ç½‘ç»œå‚æ•°çš„æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net.state_dict()[<span class="string">&#x27;2.bias&#x27;</span>].data</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">0.0887</span>])</span><br></pre></td></tr></table></figure><h4 id="ä»åµŒå¥—å—æ”¶é›†å‚æ•°"><a href="#ä»åµŒå¥—å—æ”¶é›†å‚æ•°" class="headerlink" title="ä»åµŒå¥—å—æ”¶é›†å‚æ•°"></a>ä»åµŒå¥—å—æ”¶é›†å‚æ•°</h4><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªç”Ÿæˆå—çš„å‡½æ•°ï¼ˆå¯ä»¥è¯´æ˜¯â€œå—å·¥å‚â€ï¼‰ï¼Œç„¶åå°†è¿™äº›å—ç»„åˆåˆ°æ›´å¤§çš„å—ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">block1</span>():</span><br><span class="line">    <span class="keyword">return</span> nn.Sequential(nn.Linear(<span class="number">4</span>, <span class="number">8</span>), nn.ReLU(),</span><br><span class="line">                         nn.Linear(<span class="number">8</span>, <span class="number">4</span>), nn.ReLU())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block2</span>():</span><br><span class="line">    net = nn.Sequential()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="comment"># åœ¨è¿™é‡ŒåµŒå¥—</span></span><br><span class="line">        net.add_module(<span class="string">f&#x27;block <span class="subst">&#123;i&#125;</span>&#x27;</span>, block1())</span><br><span class="line">    <span class="keyword">return</span> net</span><br><span class="line"></span><br><span class="line">rgnet = nn.Sequential(block2(), nn.Linear(<span class="number">4</span>, <span class="number">1</span>))</span><br><span class="line">rgnet(X)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tensor([[<span class="number">0.2596</span>],</span><br><span class="line">        [<span class="number">0.2596</span>]], grad_fn=&lt;AddmmBackward0&gt;)</span><br></pre></td></tr></table></figure><p>è®¾è®¡äº†ç½‘ç»œåï¼ŒæŸ¥çœ‹ä¸€ä¸‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(rgnet)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Sequential(</span><br><span class="line">  (<span class="number">0</span>): Sequential(</span><br><span class="line">    (block <span class="number">0</span>): Sequential(</span><br><span class="line">      (<span class="number">0</span>): Linear(in_features=<span class="number">4</span>, out_features=<span class="number">8</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">1</span>): ReLU()</span><br><span class="line">      (<span class="number">2</span>): Linear(in_features=<span class="number">8</span>, out_features=<span class="number">4</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">3</span>): ReLU()</span><br><span class="line">    )</span><br><span class="line">    (block <span class="number">1</span>): Sequential(</span><br><span class="line">      (<span class="number">0</span>): Linear(in_features=<span class="number">4</span>, out_features=<span class="number">8</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">1</span>): ReLU()</span><br><span class="line">      (<span class="number">2</span>): Linear(in_features=<span class="number">8</span>, out_features=<span class="number">4</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">3</span>): ReLU()</span><br><span class="line">    )</span><br><span class="line">    (block <span class="number">2</span>): Sequential(</span><br><span class="line">      (<span class="number">0</span>): Linear(in_features=<span class="number">4</span>, out_features=<span class="number">8</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">1</span>): ReLU()</span><br><span class="line">      (<span class="number">2</span>): Linear(in_features=<span class="number">8</span>, out_features=<span class="number">4</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">3</span>): ReLU()</span><br><span class="line">    )</span><br><span class="line">    (block <span class="number">3</span>): Sequential(</span><br><span class="line">      (<span class="number">0</span>): Linear(in_features=<span class="number">4</span>, out_features=<span class="number">8</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">1</span>): ReLU()</span><br><span class="line">      (<span class="number">2</span>): Linear(in_features=<span class="number">8</span>, out_features=<span class="number">4</span>, bias=<span class="literal">True</span>)</span><br><span class="line">      (<span class="number">3</span>): ReLU()</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">  (<span class="number">1</span>): Linear(in_features=<span class="number">4</span>, out_features=<span class="number">1</span>, bias=<span class="literal">True</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å› ä¸ºå±‚æ˜¯åˆ†å±‚åµŒå¥—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒé€šè¿‡åµŒå¥—åˆ—è¡¨ç´¢å¼•ä¸€æ ·è®¿é—®å®ƒä»¬ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬è®¿é—®ç¬¬ä¸€ä¸ªä¸»è¦çš„å—ä¸­ã€ç¬¬äºŒä¸ªå­å—çš„ç¬¬ä¸€å±‚çš„åç½®é¡¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rgnet[<span class="number">0</span>][<span class="number">1</span>][<span class="number">0</span>].bias.data</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([ <span class="number">0.1999</span>, -<span class="number">0.4073</span>, -<span class="number">0.1200</span>, -<span class="number">0.2033</span>, -<span class="number">0.1573</span>,  <span class="number">0.3546</span>, -<span class="number">0.2141</span>, -<span class="number">0.2483</span>])</span><br></pre></td></tr></table></figure><h3 id="å‚æ•°åˆå§‹åŒ–"><a href="#å‚æ•°åˆå§‹åŒ–" class="headerlink" title="å‚æ•°åˆå§‹åŒ–"></a>å‚æ•°åˆå§‹åŒ–</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyTorchä¼šæ ¹æ®ä¸€ä¸ªèŒƒå›´å‡åŒ€åœ°åˆå§‹åŒ–æƒé‡å’Œåç½®çŸ©é˜µï¼Œ è¿™ä¸ªèŒƒå›´æ˜¯æ ¹æ®è¾“å…¥å’Œè¾“å‡ºç»´åº¦è®¡ç®—å‡ºçš„ã€‚ PyTorchçš„<code>nn.init</code>æ¨¡å—æä¾›äº†å¤šç§é¢„ç½®åˆå§‹åŒ–æ–¹æ³•ã€‚</p><h4 id="å†…ç½®åˆå§‹åŒ–"><a href="#å†…ç½®åˆå§‹åŒ–" class="headerlink" title="å†…ç½®åˆå§‹åŒ–"></a>å†…ç½®åˆå§‹åŒ–</h4><p>è°ƒç”¨å†…ç½®çš„åˆå§‹åŒ–å™¨ã€‚ ä¸‹é¢çš„ä»£ç å°†æ‰€æœ‰æƒé‡å‚æ•°åˆå§‹åŒ–ä¸ºæ ‡å‡†å·®ä¸º0.01çš„é«˜æ–¯éšæœºå˜é‡ï¼Œ ä¸”å°†åç½®å‚æ•°è®¾ç½®ä¸º0ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_normal</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(m) == nn.Linear:</span><br><span class="line">        nn.init.normal_(m.weight, mean=<span class="number">0</span>, std=<span class="number">0.01</span>)</span><br><span class="line">        nn.init.zeros_(m.bias)</span><br><span class="line">net.apply(init_normal)</span><br><span class="line">net[<span class="number">0</span>].weight.data[<span class="number">0</span>], net[<span class="number">0</span>].bias.data[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor([-<span class="number">0.0214</span>, -<span class="number">0.0015</span>, -<span class="number">0.0100</span>, -<span class="number">0.0058</span>]), tensor(<span class="number">0.</span>))</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥å°†æ‰€æœ‰å‚æ•°åˆå§‹åŒ–ä¸ºç»™å®šçš„å¸¸æ•°ï¼Œæ¯”å¦‚åˆå§‹åŒ–ä¸º1ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_constant</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(m) == nn.Linear:</span><br><span class="line">        nn.init.constant_(m.weight, <span class="number">1</span>)</span><br><span class="line">        nn.init.zeros_(m.bias)</span><br><span class="line">net.apply(init_constant)</span><br><span class="line">net[<span class="number">0</span>].weight.data[<span class="number">0</span>], net[<span class="number">0</span>].bias.data[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor([<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>]), tensor(<span class="number">0.</span>))</span><br></pre></td></tr></table></figure><h2 id="è¯»å†™æ–‡ä»¶"><a href="#è¯»å†™æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡ä»¶"></a>è¯»å†™æ–‡ä»¶</h2><p>åŠ è½½å’Œå­˜å‚¨æƒé‡å‘é‡å’Œæ•´ä¸ªæ¨¡å‹</p><h3 id="åŠ è½½å’Œä¿å­˜å¼ é‡"><a href="#åŠ è½½å’Œä¿å­˜å¼ é‡" class="headerlink" title="åŠ è½½å’Œä¿å­˜å¼ é‡"></a>åŠ è½½å’Œä¿å­˜å¼ é‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line">x = torch.arange(<span class="number">4</span>)</span><br><span class="line">torch.save(x, <span class="string">&#x27;x-file&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯ä»¥å°†å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„æ•°æ®è¯»å›å†…å­˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x2 = torch.load(<span class="string">&#x27;x-file&#x27;</span>)</span><br><span class="line">x2</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure><p>å¯ä»¥å­˜å‚¨ä¸€ä¸ªå¼ é‡åˆ—è¡¨ï¼Œç„¶åæŠŠå®ƒä»¬è¯»å›å†…å­˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">y = torch.zeros(<span class="number">4</span>)</span><br><span class="line">torch.save([x, y],<span class="string">&#x27;x-files&#x27;</span>)</span><br><span class="line">x2, y2 = torch.load(<span class="string">&#x27;x-files&#x27;</span>)</span><br><span class="line">(x2, y2)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), tensor([<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]))</span><br></pre></td></tr></table></figure><p>ç”šè‡³å¯ä»¥å†™å…¥æˆ–è¯»å–ä»å­—ç¬¦ä¸²æ˜ å°„åˆ°å¼ é‡çš„å­—å…¸ã€‚ å½“æˆ‘ä»¬è¦è¯»å–æˆ–å†™å…¥æ¨¡å‹ä¸­çš„æ‰€æœ‰æƒé‡æ—¶ï¼Œè¿™å¾ˆæ–¹ä¾¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mydict = &#123;<span class="string">&#x27;x&#x27;</span>: x, <span class="string">&#x27;y&#x27;</span>: y&#125;</span><br><span class="line">torch.save(mydict, <span class="string">&#x27;mydict&#x27;</span>)</span><br><span class="line">mydict2 = torch.load(<span class="string">&#x27;mydict&#x27;</span>)</span><br><span class="line">mydict2</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;x&#x27;</span>: tensor([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]), <span class="string">&#x27;y&#x27;</span>: tensor([<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>])&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°"><a href="#åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°" class="headerlink" title="åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°"></a>åŠ è½½å’Œä¿å­˜æ¨¡å‹å‚æ•°</h3><p>å°†æ¨¡å‹çš„å‚æ•°å­˜å‚¨åœ¨ä¸€ä¸ªå«åšâ€œmlp.paramsâ€çš„æ–‡ä»¶ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.save(net.state_dict(), <span class="string">&#x27;mlp.params&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ¢å¤æ¨¡å‹ï¼Œæˆ‘ä»¬å®ä¾‹åŒ–äº†åŸå§‹å¤šå±‚æ„ŸçŸ¥æœºæ¨¡å‹çš„ä¸€ä¸ªå¤‡ä»½ã€‚ è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦éšæœºåˆå§‹åŒ–æ¨¡å‹å‚æ•°ï¼Œè€Œæ˜¯ç›´æ¥è¯»å–æ–‡ä»¶ä¸­å­˜å‚¨çš„å‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">clone = MLP()</span><br><span class="line">clone.load_state_dict(torch.load(<span class="string">&#x27;mlp.params&#x27;</span>))</span><br><span class="line">clone.<span class="built_in">eval</span>()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MLP(</span><br><span class="line">  (hidden): Linear(in_features=<span class="number">20</span>, out_features=<span class="number">256</span>, bias=<span class="literal">True</span>)</span><br><span class="line">  (output): Linear(in_features=<span class="number">256</span>, out_features=<span class="number">10</span>, bias=<span class="literal">True</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="GPU"><a href="#GPU" class="headerlink" title="GPU"></a>GPU</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!nvidia-smi</span><br></pre></td></tr></table></figure><p>åœ¨PyTorchä¸­ï¼Œæ¯ä¸ªæ•°ç»„éƒ½æœ‰ä¸€ä¸ªè®¾å¤‡ï¼ˆdeviceï¼‰ï¼Œ æˆ‘ä»¬é€šå¸¸å°†å…¶ç§°ä¸ºç¯å¢ƒï¼ˆcontextï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å˜é‡å’Œç›¸å…³çš„è®¡ç®—éƒ½åˆ†é…ç»™CPUã€‚ æœ‰æ—¶ç¯å¢ƒå¯èƒ½æ˜¯GPUã€‚ å½“æˆ‘ä»¬è·¨å¤šä¸ªæœåŠ¡å™¨éƒ¨ç½²ä½œä¸šæ—¶ï¼Œäº‹æƒ…ä¼šå˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚ é€šè¿‡æ™ºèƒ½åœ°å°†æ•°ç»„åˆ†é…ç»™ç¯å¢ƒï¼Œ æˆ‘ä»¬å¯ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘åœ¨è®¾å¤‡ä¹‹é—´ä¼ è¾“æ•°æ®çš„æ—¶é—´ã€‚ ä¾‹å¦‚ï¼Œå½“åœ¨å¸¦æœ‰GPUçš„æœåŠ¡å™¨ä¸Šè®­ç»ƒç¥ç»ç½‘ç»œæ—¶ï¼Œ æˆ‘ä»¬é€šå¸¸å¸Œæœ›æ¨¡å‹çš„å‚æ•°åœ¨GPUä¸Šã€‚</p><h3 id="è®¡ç®—è®¾å¤‡"><a href="#è®¡ç®—è®¾å¤‡" class="headerlink" title="è®¡ç®—è®¾å¤‡"></a>è®¡ç®—è®¾å¤‡</h3><p>åœ¨PyTorchä¸­ï¼ŒCPUå’ŒGPUå¯ä»¥ç”¨<code>torch.device(&#39;cpu&#39;)</code> å’Œ<code>torch.device(&#39;cuda&#39;)</code>è¡¨ç¤ºã€‚ åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œ<code>cpu</code>è®¾å¤‡æ„å‘³ç€æ‰€æœ‰ç‰©ç†CPUå’Œå†…å­˜ï¼Œ è¿™æ„å‘³ç€PyTorchçš„è®¡ç®—å°†å°è¯•ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒã€‚ ç„¶è€Œï¼Œ<code>gpu</code>è®¾å¤‡åªä»£è¡¨ä¸€ä¸ªå¡å’Œç›¸åº”çš„æ˜¾å­˜ã€‚ å¦‚æœæœ‰å¤šä¸ªGPUï¼Œæˆ‘ä»¬ä½¿ç”¨<code>torch.device(f&#39;cuda:&#123;i&#125;&#39;)</code> æ¥è¡¨ç¤ºç¬¬ğ‘–å—GPUï¼ˆğ‘–ä»0å¼€å§‹ï¼‰ã€‚ å¦å¤–ï¼Œ<code>cuda:0</code>å’Œ<code>cuda</code>æ˜¯ç­‰ä»·çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">torch.device(<span class="string">&#x27;cpu&#x27;</span>), torch.device(<span class="string">&#x27;cuda&#x27;</span>), torch.device(<span class="string">&#x27;cuda:1&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(device(<span class="built_in">type</span>=<span class="string">&#x27;cpu&#x27;</span>), device(<span class="built_in">type</span>=<span class="string">&#x27;cuda&#x27;</span>), device(<span class="built_in">type</span>=<span class="string">&#x27;cuda&#x27;</span>, index=<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢å¯ç”¨gpuçš„æ•°é‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.cuda.device_count()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="å¼ é‡ä¸GPU"><a href="#å¼ é‡ä¸GPU" class="headerlink" title="å¼ é‡ä¸GPU"></a>å¼ é‡ä¸GPU</h3><p>æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢å¼ é‡æ‰€åœ¨çš„è®¾å¤‡ã€‚ é»˜è®¤åœ¨CPUä¸Šåˆ›å»ºçš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = torch.tensor([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">x.device</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">device(<span class="built_in">type</span>=<span class="string">&#x27;cpu&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ— è®ºä½•æ—¶æˆ‘ä»¬è¦å¯¹å¤šä¸ªé¡¹è¿›è¡Œæ“ä½œï¼Œ å®ƒä»¬éƒ½å¿…é¡»åœ¨åŒä¸€ä¸ªè®¾å¤‡ä¸Šã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ä¸¤ä¸ªå¼ é‡æ±‚å’Œï¼Œ æˆ‘ä»¬éœ€è¦ç¡®ä¿ä¸¤ä¸ªå¼ é‡éƒ½ä½äºåŒä¸€ä¸ªè®¾å¤‡ä¸Šï¼Œ å¦åˆ™æ¡†æ¶å°†ä¸çŸ¥é“åœ¨å“ªé‡Œå­˜å‚¨ç»“æœï¼Œç”šè‡³ä¸çŸ¥é“åœ¨å“ªé‡Œæ‰§è¡Œè®¡ç®—ã€‚</p><h4 id="å­˜å‚¨åœ¨GPUä¸Š"><a href="#å­˜å‚¨åœ¨GPUä¸Š" class="headerlink" title="å­˜å‚¨åœ¨GPUä¸Š"></a>å­˜å‚¨åœ¨GPUä¸Š</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = torch.ones(<span class="number">2</span>, <span class="number">3</span>, device=try_gpu())</span><br><span class="line">X</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tensor([[<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>],</span><br><span class="line">        [<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>]], device=<span class="string">&#x27;cuda:0&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="ç¥ç»ç½‘ç»œä¸GPU"><a href="#ç¥ç»ç½‘ç»œä¸GPU" class="headerlink" title="ç¥ç»ç½‘ç»œä¸GPU"></a>ç¥ç»ç½‘ç»œä¸GPU</h3><p>ä¸‹é¢çš„ä»£ç å°†æ¨¡å‹å‚æ•°æ”¾åœ¨GPUä¸Šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential(nn.Linear(<span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line">net = net.to(device=try_gpu())</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä¸ºGPUä¸Šçš„å¼ é‡æ—¶ï¼Œæ¨¡å‹å°†åœ¨åŒä¸€GPUä¸Šè®¡ç®—ç»“æœã€‚</p><p>è®©æˆ‘ä»¬ç¡®è®¤æ¨¡å‹å‚æ•°å­˜å‚¨åœ¨åŒä¸€ä¸ªGPUä¸Šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net[<span class="number">0</span>].weight.data.device</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">device(<span class="built_in">type</span>=<span class="string">&#x27;cuda&#x27;</span>, index=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“ï¼š-PyTorchæ„å»ºç¥ç»ç½‘ç»œçš„ä¸»è¦å·¥å…·"><a href="#æ€»ç»“ï¼š-PyTorchæ„å»ºç¥ç»ç½‘ç»œçš„ä¸»è¦å·¥å…·" class="headerlink" title="æ€»ç»“ï¼š PyTorchæ„å»ºç¥ç»ç½‘ç»œçš„ä¸»è¦å·¥å…·"></a>æ€»ç»“ï¼š PyTorchæ„å»ºç¥ç»ç½‘ç»œçš„ä¸»è¦å·¥å…·</h2><p>ä½¿ç”¨PyTorchæ„å»ºç¥ç»ç½‘ç»œä½¿ç”¨çš„ä¸»è¦å·¥å…·ï¼ˆæˆ–ç±»ï¼‰åŠç›¸äº’å…³ç³»</p><p><img src="/../img/Pytorch1/pytorch7/2.png" alt="2"></p><p>ä»å›¾ä¸­å¯çŸ¥ï¼Œå¯ä»¥åŸºäºModuleç±»æˆ–å‡½æ•°ï¼ˆnn.functionalï¼‰æ„å»ºç½‘ç»œå±‚ã€‚nnä¸­çš„å¤§å¤šæ•°å±‚ï¼ˆlayerï¼‰åœ¨functionalä¸­éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„å‡½æ•°ã€‚nn.functionalä¸­çš„å‡½æ•°ä¸nn.Moduleä¸­çš„layerçš„ä¸»è¦åŒºåˆ«æ˜¯åè€…ç»§æ‰¿è‡ªModuleç±»ï¼Œå¯è‡ªåŠ¨æå–å¯å­¦ä¹ çš„å‚æ•°ï¼Œè€Œnn.functionalæ›´åƒæ˜¯çº¯å‡½æ•°ã€‚ä¸¤è€…åŠŸèƒ½ç›¸åŒï¼Œæ€§èƒ½ä¹Ÿæ²¡æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œé‚£ä¹ˆå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿå·ç§¯å±‚ã€å…¨è¿æ¥å±‚ã€dropoutå±‚ç­‰å«æœ‰å¯å­¦ä¹ å‚æ•°ï¼Œä¸€èˆ¬ä½¿ç”¨nn.Moduleï¼Œè€Œæ¿€æ´»å‡½æ•°ã€æ± åŒ–å±‚ä¸å«å¯å­¦ä¹ å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨nn.functionalä¸­å¯¹åº”çš„å‡½æ•°ã€‚</p><h3 id="nn-Module"><a href="#nn-Module" class="headerlink" title="nn.Module"></a>nn.Module</h3><p>nnæ˜¯ä¸€ä¸ªæœ‰æ•ˆå·¥å…·ã€‚å®ƒæ˜¯ä¸“é—¨ä¸ºæ·±åº¦å­¦ä¹ è®¾è®¡çš„ä¸€ä¸ªæ¨¡å—ï¼Œè€Œnn.Moduleæ˜¯nnçš„ä¸€ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ã€‚nn.Moduleå¯ä»¥æ˜¯ç¥ç»ç½‘ç»œçš„æŸä¸ªå±‚ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ…å«å¤šå±‚çš„ç¥ç»ç½‘ç»œã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæœ€å¸¸è§çš„åšæ³•æ˜¯ç»§æ‰¿nn.Moduleï¼Œç”Ÿæˆè‡ªå·±çš„ç½‘ç»œ&#x2F;å±‚ã€‚nnä¸­å·²å®ç°äº†ç»å¤§å¤šæ•°å±‚ï¼ŒåŒ…æ‹¬å…¨è¿æ¥å±‚ã€æŸå¤±å±‚ã€æ¿€æ´»å±‚ã€å·ç§¯å±‚ã€å¾ªç¯å±‚ç­‰ã€‚è¿™äº›å±‚éƒ½æ˜¯nn.Moduleçš„å­ç±»ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹åˆ°è‡ªå·±çš„å‚æ•°ï¼Œå¹¶å°†å…¶ä½œä¸ºå­¦ä¹ å‚æ•°ï¼Œä¸”é’ˆå¯¹GPUè¿è¡Œè¿›è¡Œäº†CuDNNä¼˜åŒ–ã€‚</p><h3 id="nn-functional"><a href="#nn-functional" class="headerlink" title="nn.functional"></a>nn.functional</h3><p>nnä¸­çš„å±‚ï¼Œä¸€ç±»æ˜¯ç»§æ‰¿äº†nn.Moduleï¼Œå…¶å‘½åä¸€èˆ¬ä¸ºnn.Xxxï¼ˆç¬¬ä¸€ä¸ªæ˜¯å¤§å†™ï¼‰ï¼Œå¦‚nn.Linearã€nn.Conv2dã€nn.CrossEntropyLossç­‰ã€‚å¦ä¸€ç±»æ˜¯nn.functionalä¸­çš„å‡½æ•°ï¼Œå…¶åç§°ä¸€èˆ¬ä¸ºnn.funtional.xxxï¼Œå¦‚nn.funtional.linearã€nn.funtional.conv2dã€nn.funtional.cross_entropyç­‰ã€‚ä»åŠŸèƒ½æ¥è¯´ä¸¤è€…ç›¸å½“ï¼ŒåŸºäºnn.Mudleèƒ½å®ç°çš„å±‚ï¼Œä¹Ÿå¯ä»¥åŸºäºnn.funtionalå®ç°</p><p>ä¸è¿‡åœ¨å…·ä½“ä½¿ç”¨æ—¶ï¼Œä¸¤è€…è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¸»è¦åŒºåˆ«å¦‚ä¸‹ã€‚</p><ol><li>nn.Xxxç»§æ‰¿äºnn.Moduleï¼Œnn.Xxx éœ€è¦å…ˆå®ä¾‹åŒ–å¹¶ä¼ å…¥å‚æ•°ï¼Œç„¶åä»¥å‡½æ•°è°ƒç”¨çš„æ–¹å¼è°ƒç”¨å®ä¾‹åŒ–çš„å¯¹è±¡å¹¶ä¼ å…¥è¾“å…¥æ•°æ®ã€‚å®ƒèƒ½å¤Ÿå¾ˆå¥½çš„ä¸nn.Sequentialç»“åˆä½¿ç”¨ï¼Œè€Œnn.functional.xxxæ— æ³•ä¸nn.Sequentialç»“åˆä½¿ç”¨ã€‚</li><li>nn.Xxxä¸éœ€è¦è‡ªå·±å®šä¹‰å’Œç®¡ç†weightã€biaså‚æ•°ï¼›è€Œnn.functional.xxxéœ€è¦ä½ è‡ªå·±å®šä¹‰weightã€biasï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½éœ€è¦æ‰‹åŠ¨ä¼ å…¥weightã€biasç­‰å‚æ•°, ä¸åˆ©äºä»£ç å¤ç”¨ã€‚</li><li>dropoutæ“ä½œåœ¨è®­ç»ƒå’Œæµ‹è¯•é˜¶æ®µæ˜¯æœ‰åŒºåˆ«çš„ï¼Œä½¿ç”¨nn.Xxxæ–¹å¼å®šä¹‰dropoutï¼Œåœ¨è°ƒç”¨model.eval()ä¹‹åï¼Œè‡ªåŠ¨å®ç°çŠ¶æ€çš„è½¬æ¢ï¼Œè€Œä½¿ç”¨nn.functional.xxxå´æ— æ­¤åŠŸèƒ½ã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼Œä¸¤ç§åŠŸèƒ½éƒ½æ˜¯ç›¸åŒçš„ï¼Œä½†PyTorchå®˜æ–¹æ¨èï¼šå…·æœ‰å­¦ä¹ å‚æ•°çš„ï¼ˆä¾‹å¦‚ï¼Œconv2dã€ linearã€batch_normã€dropoutç­‰ï¼‰æƒ…å†µé‡‡ç”¨nn.Xxxæ–¹å¼ï¼Œæ²¡æœ‰å­¦ä¹ å‚æ•°çš„ï¼ˆä¾‹å¦‚ï¼Œmaxpool, loss func, activation funcï¼‰ç­‰æƒ…å†µé€‰æ‹©ä½¿ç”¨nn.functional.xxxæˆ–è€…nn.Xxxæ–¹å¼ã€‚3.5èŠ‚ä¸­ä½¿ç”¨æ¿€æ´»å±‚ï¼Œæˆ‘ä»¬é‡‡ç”¨æ— å­¦ä¹ å‚æ•°çš„F.reluæ–¹å¼æ¥å®ç°ï¼Œå³nn.functional.xxxæ–¹å¼ã€‚</p><h3 id="æ„å»ºæ¨¡å‹"><a href="#æ„å»ºæ¨¡å‹" class="headerlink" title="æ„å»ºæ¨¡å‹"></a>æ„å»ºæ¨¡å‹</h3><p>PyTorchæ„å»ºæ¨¡å‹å¤§è‡´æœ‰ä»¥ä¸‹3ç§æ–¹å¼ã€‚</p><ol><li>ç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹ã€‚</li><li>ä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹ã€‚</li><li>ç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹ï¼Œåˆä½¿ç”¨ç›¸å…³æ¨¡å‹å®¹å™¨(å¦‚nn.Sequential,nn.ModuleList,nn.ModuleDictç­‰ï¼‰è¿›è¡Œå°è£…ã€‚</li></ol><p>åœ¨è¿™3ç§æ–¹æ³•ä¸­ï¼Œç¬¬1ç§æ–¹å¼æœ€ä¸ºå¸¸è§ï¼›ç¬¬2ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œéå¸¸é€‚åˆä¸åˆå­¦è€…ï¼›ç¬¬3ç§æ–¹å¼è¾ƒçµæ´»ä½†å¤æ‚ä¸€äº›ã€‚</p><h4 id="ç»§æ‰¿nn-ModuleåŸºç±»æ„å»ºæ¨¡å‹"><a href="#ç»§æ‰¿nn-ModuleåŸºç±»æ„å»ºæ¨¡å‹" class="headerlink" title="ç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹"></a>ç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹</h4><p>å…ˆå®šä¹‰ä¸€ä¸ªç±»ï¼Œä½¿ä¹‹ç»§æ‰¿nn.ModuleåŸºç±»ã€‚æŠŠæ¨¡å‹ä¸­éœ€è¦ç”¨åˆ°çš„å±‚æ”¾åœ¨æ„é€ å‡½æ•°__init__()ä¸­ï¼Œåœ¨forwardæ–¹æ³•ä¸­å®ç°æ¨¡å‹çš„æ­£å‘ä¼ æ’­ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ã€‚</p><ol><li>å¯¼å…¥æ¨¡å—</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br></pre></td></tr></table></figure><ol start="2"><li>æ„å»ºæ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Model_Seq</span>(nn.Module):</span><br><span class="line">   <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">   é€šè¿‡ç»§æ‰¿åŸºç±»nn.Moduleæ¥æ„å»ºæ¨¡å‹</span></span><br><span class="line"><span class="string">   &quot;&quot;&quot;</span></span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_dim, n_hidden_1, n_hidden_2, out_dim</span>):</span><br><span class="line">       <span class="built_in">super</span>(Model_Seq, self).__init__()</span><br><span class="line">       self.flatten = nn.Flatten()</span><br><span class="line">       self.linear1= nn.Linear(in_dim, n_hidden_1)</span><br><span class="line">       self.bn1=nn.BatchNorm1d(n_hidden_1)</span><br><span class="line">       self.linear2= nn.Linear(n_hidden_1, n_hidden_2)</span><br><span class="line">       self.bn2 = nn.BatchNorm1d(n_hidden_2)</span><br><span class="line">       self.out = nn.Linear(n_hidden_2, out_dim)</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">   <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">       x=self.flatten(x)</span><br><span class="line">       x=self.linear1(x)</span><br><span class="line">       x=self.bn1(x)</span><br><span class="line">       x = F.relu(x)</span><br><span class="line">       x=self.linear2(x)</span><br><span class="line">       x=self.bn2(x)</span><br><span class="line">       x = F.relu(x)</span><br><span class="line">       x=self.out(x)</span><br><span class="line">       x = F.softmax(x,dim=<span class="number">1</span>)</span><br><span class="line">       <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>3.æŸ¥çœ‹æ¨¡å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##å¯¹ä¸€äº›è¶…å‚æ•°èµ‹å€¼</span></span><br><span class="line">in_dim, n_hidden_1, n_hidden_2, out_dim=<span class="number">28</span> * <span class="number">28</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">10</span></span><br><span class="line">model_seq= Model_Seq(in_dim, n_hidden_1, n_hidden_2, out_dim)</span><br><span class="line"><span class="built_in">print</span>(model_seq)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Model_Seq(</span><br><span class="line">  (flatten): Flatten(start_dim=<span class="number">1</span>, end_dim=-<span class="number">1</span>)</span><br><span class="line">  (linear1): Linear(in_features=<span class="number">784</span>, out_features=<span class="number">300</span>, bias=<span class="literal">True</span>)</span><br><span class="line">  (bn1): BatchNorm1d(<span class="number">300</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">  (linear2): Linear(in_features=<span class="number">300</span>, out_features=<span class="number">100</span>, bias=<span class="literal">True</span>)</span><br><span class="line">  (bn2): BatchNorm1d(<span class="number">100</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">  (out): Linear(in_features=<span class="number">100</span>, out_features=<span class="number">10</span>, bias=<span class="literal">True</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨nn-SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹"><a href="#ä½¿ç”¨nn-SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹" class="headerlink" title="ä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹"></a>ä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹</h4><p>ä½¿ç”¨nn.Sequentialæ„å»ºæ¨¡å‹ï¼Œå› å…¶å†…éƒ¨å®ç°äº†forwardå‡½æ•°ï¼Œå› æ­¤å¯ä»¥ä¸ç”¨å†™forwardå‡½æ•°ã€‚nn.Sequentialé‡Œé¢çš„æ¨¡å—æŒ‰ç…§å…ˆåé¡ºåºè¿›è¡Œæ’åˆ—çš„ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿å‰ä¸€ä¸ªæ¨¡å—çš„è¾“å‡ºå¤§å°å’Œä¸‹ä¸€ä¸ªæ¨¡å—çš„è¾“å…¥å¤§å°æ˜¯ä¸€è‡´çš„ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ä¸€èˆ¬æ„å»ºè¾ƒç®€å•çš„æ¨¡å‹ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨nn.Sequentialæ­å»ºæ¨¡å‹çš„å‡ ç§ç­‰ä»·æ–¹æ³•ã€‚</p><h5 id="åˆ©ç”¨å¯å˜å‚æ•°"><a href="#åˆ©ç”¨å¯å˜å‚æ•°" class="headerlink" title="åˆ©ç”¨å¯å˜å‚æ•°"></a>åˆ©ç”¨å¯å˜å‚æ•°</h5><p>Pythonä¸­çš„å‡½æ•°å‚æ•°ä¸ªæ•°æ˜¯å¯å˜ï¼ˆæˆ–ç§°ä¸ºä¸å®šé•¿å‚æ•°ï¼‰ï¼ŒPyTorchä¸­çš„æœ‰äº›å‡½æ•°ä¹Ÿç±»ä¼¼ï¼Œå¦‚nn.Sequential(*args)å°±æ˜¯ä¸€ä¾‹ã€‚</p><ol><li>å¯¼å…¥æ¨¡å—</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br></pre></td></tr></table></figure><ol start="2"><li>æ„å»ºæ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Seq_arg = nn.Sequential(</span><br><span class="line">    nn.Flatten(),</span><br><span class="line">    nn.Linear(in_dim,n_hidden_1),</span><br><span class="line">    nn.BatchNorm1d(n_hidden_1),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.Linear(n_hidden_1, n_hidden_2),</span><br><span class="line">    nn.BatchNorm1d(n_hidden_2),</span><br><span class="line">    nn.ReLU(),         </span><br><span class="line">    nn.Linear(n_hidden_2, out_dim),</span><br><span class="line">    nn.Softmax(dim=<span class="number">1</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><ol start="3"><li>æŸ¥çœ‹æ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">in_dim, n_hidden_1, n_hidden_2, out_dim=<span class="number">28</span> * <span class="number">28</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(Seq_arg)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Sequential(</span><br><span class="line">(<span class="number">0</span>): Flatten(start_dim=<span class="number">1</span>, end_dim=-<span class="number">1</span>)</span><br><span class="line">(<span class="number">1</span>): Linear(in_features=<span class="number">784</span>, out_features=<span class="number">300</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(<span class="number">2</span>): BatchNorm1d(<span class="number">300</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">(<span class="number">3</span>): ReLU()</span><br><span class="line">(<span class="number">4</span>): Linear(in_features=<span class="number">300</span>, out_features=<span class="number">100</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(<span class="number">5</span>): BatchNorm1d(<span class="number">100</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">(<span class="number">6</span>): ReLU()</span><br><span class="line">(<span class="number">7</span>): Linear(in_features=<span class="number">100</span>, out_features=<span class="number">10</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(<span class="number">8</span>): Softmax(dim=<span class="number">1</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨add-moduleæ–¹æ³•"><a href="#ä½¿ç”¨add-moduleæ–¹æ³•" class="headerlink" title="ä½¿ç”¨add_moduleæ–¹æ³•"></a>ä½¿ç”¨add_moduleæ–¹æ³•</h5><ol start="2"><li>æ„å»ºæ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Seq_module = nn.Sequential()</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;flatten&quot;</span>,nn.Flatten())</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;linear1&quot;</span>,nn.Linear(in_dim,n_hidden_1))</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;bn1&quot;</span>,nn.BatchNorm1d(n_hidden_1))</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;relu1&quot;</span>,nn.ReLU())</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;linear2&quot;</span>,nn.Linear(n_hidden_1, n_hidden_2))</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;bn2&quot;</span>,nn.BatchNorm1d(n_hidden_2))</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;relu2&quot;</span>,nn.ReLU())         </span><br><span class="line">Seq_module.add_module(<span class="string">&quot;out&quot;</span>,nn.Linear(n_hidden_2, out_dim))</span><br><span class="line">Seq_module.add_module(<span class="string">&quot;softmax&quot;</span>,nn.Softmax(dim=<span class="number">1</span>))</span><br></pre></td></tr></table></figure><ol start="3"><li>æŸ¥çœ‹æ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">in_dim, n_hidden_1, n_hidden_2, out_dim=<span class="number">28</span> * <span class="number">28</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(Seq_module)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Sequential(</span><br><span class="line">(flatten): Flatten(start_dim=<span class="number">1</span>, end_dim=-<span class="number">1</span>)</span><br><span class="line">(linear1): Linear(in_features=<span class="number">784</span>, out_features=<span class="number">300</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(bn1): BatchNorm1d(<span class="number">300</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">(relu1): ReLU()</span><br><span class="line">(linear2): Linear(in_features=<span class="number">300</span>, out_features=<span class="number">100</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(bn2): BatchNorm1d(<span class="number">100</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">(relu2): ReLU()</span><br><span class="line">(out): Linear(in_features=<span class="number">100</span>, out_features=<span class="number">10</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(softmax): Softmax(dim=<span class="number">1</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="ä½¿ç”¨OrderedDict"><a href="#ä½¿ç”¨OrderedDict" class="headerlink" title="ä½¿ç”¨OrderedDict"></a>ä½¿ç”¨OrderedDict</h5><ol><li>å¯¼å…¥æ¨¡å—</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br></pre></td></tr></table></figure><ol start="2"><li>æ„å»ºæ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Seq_dict = nn.Sequential(OrderedDict([</span><br><span class="line">(<span class="string">&quot;flatten&quot;</span>,nn.Flatten()),</span><br><span class="line">(<span class="string">&quot;linear1&quot;</span>,nn.Linear(in_dim,n_hidden_1)),</span><br><span class="line">(<span class="string">&quot;bn1&quot;</span>,nn.BatchNorm1d(n_hidden_1)),</span><br><span class="line">(<span class="string">&quot;relu1&quot;</span>,nn.ReLU()),</span><br><span class="line">(<span class="string">&quot;linear2&quot;</span>,nn.Linear(n_hidden_1, n_hidden_2)),</span><br><span class="line">(<span class="string">&quot;bn2&quot;</span>,nn.BatchNorm1d(n_hidden_2)),</span><br><span class="line">(<span class="string">&quot;relu2&quot;</span>,nn.ReLU()),       </span><br><span class="line">(<span class="string">&quot;out&quot;</span>,nn.Linear(n_hidden_2, out_dim)),</span><br><span class="line">(<span class="string">&quot;softmax&quot;</span>,nn.Softmax(dim=<span class="number">1</span>))]))</span><br></pre></td></tr></table></figure><ol start="3"><li>æŸ¥çœ‹æ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">in_dim, n_hidden_1, n_hidden_2, out_dim=<span class="number">28</span> * <span class="number">28</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">10</span></span><br><span class="line"><span class="built_in">print</span>(Seq_dict)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Sequential(</span><br><span class="line">(flatten): Flatten(start_dim=<span class="number">1</span>, end_dim=-<span class="number">1</span>)</span><br><span class="line">(linear1): Linear(in_features=<span class="number">784</span>, out_features=<span class="number">300</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(bn1): BatchNorm1d(<span class="number">300</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">(relu1): ReLU()</span><br><span class="line">(linear2): Linear(in_features=<span class="number">300</span>, out_features=<span class="number">100</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(bn2): BatchNorm1d(<span class="number">100</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">(relu2): ReLU()</span><br><span class="line">(out): Linear(in_features=<span class="number">100</span>, out_features=<span class="number">10</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(softmax): Softmax(dim=<span class="number">1</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="ç»§æ‰¿nn-ModuleåŸºç±»å¹¶åº”ç”¨æ¨¡å‹å®¹å™¨æ¥æ„å»ºæ¨¡å‹"><a href="#ç»§æ‰¿nn-ModuleåŸºç±»å¹¶åº”ç”¨æ¨¡å‹å®¹å™¨æ¥æ„å»ºæ¨¡å‹" class="headerlink" title="ç»§æ‰¿nn.ModuleåŸºç±»å¹¶åº”ç”¨æ¨¡å‹å®¹å™¨æ¥æ„å»ºæ¨¡å‹"></a>ç»§æ‰¿nn.ModuleåŸºç±»å¹¶åº”ç”¨æ¨¡å‹å®¹å™¨æ¥æ„å»ºæ¨¡å‹</h4><p>å½“æ¨¡å‹çš„ç»“æ„æ¯”è¾ƒå¤æ‚æ—¶ï¼Œå¯ä»¥åº”ç”¨æ¨¡å‹å®¹å™¨ï¼ˆå¦‚nn.Sequential,nn.ModuleList,nn.ModuleDictï¼‰å¯¹æ¨¡å‹çš„éƒ¨åˆ†ç»“æ„è¿›è¡Œå°è£…ï¼Œä»¥å¢å¼ºæ¨¡å‹çš„å¯è¯»æ€§ï¼Œæˆ–å‡å°‘ä»£ç é‡ã€‚</p><p>ä½¿ç”¨nn.Sequentialæ¨¡å‹å®¹å™¨</p><ol><li>å¯¼å…¥æ¨¡å—</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br></pre></td></tr></table></figure><ol start="2"><li>æ„å»ºæ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Model_lay</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½¿ç”¨sequentialæ„å»ºç½‘ç»œï¼ŒSequential()å‡½æ•°çš„åŠŸèƒ½æ˜¯å°†ç½‘ç»œçš„å±‚ç»„åˆåˆ°ä¸€èµ·</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_dim, n_hidden_1, n_hidden_2, out_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>(Model_lay, self).__init__()</span><br><span class="line">        self.flatten = nn.Flatten()</span><br><span class="line">        self.layer1 = nn.Sequential(nn.Linear(in_dim, n_hidden_1),nn.BatchNorm1d(n_hidden_1))</span><br><span class="line">        self.layer2 = nn.Sequential(nn.Linear(n_hidden_1, n_hidden_2),nn.BatchNorm1d(n_hidden_2))</span><br><span class="line">        self.out = nn.Sequential(nn.Linear(n_hidden_2, out_dim))</span><br><span class="line">        </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x=self.flatten(x)</span><br><span class="line">        x = F.relu(self.layer1(x))</span><br><span class="line">        x = F.relu(self.layer2(x))</span><br><span class="line">        x = F.softmax(self.out(x),dim=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><ol start="3"><li>æŸ¥çœ‹æ¨¡å‹</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">in_dim, n_hidden_1, n_hidden_2, out_dim=<span class="number">28</span> * <span class="number">28</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">10</span></span><br><span class="line">model_lay= Model_lay(in_dim, n_hidden_1, n_hidden_2, out_dim)</span><br><span class="line"><span class="built_in">print</span>(model_lay)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Model_lay(</span><br><span class="line">(flatten): Flatten(start_dim=<span class="number">1</span>, end_dim=-<span class="number">1</span>)</span><br><span class="line">(layer1): Sequential(</span><br><span class="line">(<span class="number">0</span>): Linear(in_features=<span class="number">784</span>, out_features=<span class="number">300</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(<span class="number">1</span>): BatchNorm1d(<span class="number">300</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">)</span><br><span class="line">(layer2): Sequential(</span><br><span class="line">(<span class="number">0</span>): Linear(in_features=<span class="number">300</span>, out_features=<span class="number">100</span>, bias=<span class="literal">True</span>)</span><br><span class="line">(<span class="number">1</span>): BatchNorm1d(<span class="number">100</span>, eps=<span class="number">1e-05</span>, momentum=<span class="number">0.1</span>, affine=<span class="literal">True</span>, track_running_stats=<span class="literal">True</span>)</span><br><span class="line">)</span><br><span class="line">(out): Sequential(</span><br><span class="line">(<span class="number">0</span>): Linear(in_features=<span class="number">100</span>, out_features=<span class="number">10</span>, bias=<span class="literal">True</span>)</span><br><span class="line">)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰ç½‘ç»œæ¨¡å—"><a href="#è‡ªå®šä¹‰ç½‘ç»œæ¨¡å—" class="headerlink" title="è‡ªå®šä¹‰ç½‘ç»œæ¨¡å—"></a>è‡ªå®šä¹‰ç½‘ç»œæ¨¡å—</h4><p>åˆ©ç”¨ä»¥ä¸Šæ–¹æ³•ï¼Œè‡ªå®šä¹‰ä¸€äº›å…¸å‹çš„ç½‘ç»œæ¨¡å—ï¼Œå¦‚æ®‹å·®ç½‘ç»œï¼ˆResNet18ï¼‰ä¸­çš„æ®‹å·®å—</p><p><img src="/../img/Pytorch1/pytorch7/3.png" alt="3"></p><p>â€‹                                                                                         æ®‹å·®å—ç½‘ç»œç»“æ„</p><p>æ®‹å·®å—æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ­£å¸¸çš„æ¨¡å—æ–¹å¼ï¼Œå¦‚å›¾å·¦å›¾ï¼Œå°†è¾“å…¥ä¸è¾“å‡ºç›¸åŠ ï¼Œç„¶ååº”ç”¨æ¿€æ´»å‡½æ•°ReLUã€‚ å¦ä¸€ç§æ˜¯ä¸ºä½¿è¾“å…¥ä¸è¾“å‡ºå½¢çŠ¶ä¸€è‡´ï¼Œéœ€æ·»åŠ é€šè¿‡1Ã—1å·ç§¯è°ƒæ•´é€šé“å’Œåˆ†è¾¨ç‡ï¼Œå¦‚å›¾ä¸­çš„å³å›¾æ‰€ç¤ºã€‚è¿™äº›æ¨¡å—ä¸­ç”¨åˆ°å·ç§¯å±‚ã€æ‰¹é‡è§„èŒƒåŒ–å±‚ï¼Œå…·ä½“å°†åœ¨ç¬¬6ç« è¯¦ç»†ä»‹ç»ï¼Œè¿™é‡Œæˆ‘ä»¬åªéœ€è¦äº†è§£è¿™äº›æ˜¯ç½‘ç»œå±‚å³å¯ã€‚</p><h5 id="å®šä¹‰å·¦å›¾çš„æ®‹å·®æ¨¡å—"><a href="#å®šä¹‰å·¦å›¾çš„æ®‹å·®æ¨¡å—" class="headerlink" title="å®šä¹‰å·¦å›¾çš„æ®‹å·®æ¨¡å—"></a>å®šä¹‰å·¦å›¾çš„æ®‹å·®æ¨¡å—</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RestNetBasicBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_channels, out_channels, stride</span>):</span><br><span class="line">        <span class="built_in">super</span>(RestNetBasicBlock, self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(in_channels, out_channels, kernel_size=<span class="number">3</span>, stride=stride, padding=<span class="number">1</span>)</span><br><span class="line">        self.bn1 = nn.BatchNorm2d(out_channels)</span><br><span class="line">        self.conv2 = nn.Conv2d(out_channels, out_channels, kernel_size=<span class="number">3</span>, stride=stride, padding=<span class="number">1</span>)</span><br><span class="line">        self.bn2 = nn.BatchNorm2d(out_channels)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        output = self.conv1(x)</span><br><span class="line">        output = F.relu(self.bn1(output))</span><br><span class="line">        output = self.conv2(output)</span><br><span class="line">        output = self.bn2(output)</span><br><span class="line">        <span class="keyword">return</span> F.relu(x + output)</span><br></pre></td></tr></table></figure><h5 id="å®šä¹‰å³å›¾æ®‹å·®æ¨¡å—"><a href="#å®šä¹‰å³å›¾æ®‹å·®æ¨¡å—" class="headerlink" title="å®šä¹‰å³å›¾æ®‹å·®æ¨¡å—"></a>å®šä¹‰å³å›¾æ®‹å·®æ¨¡å—</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RestNetDownBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_channels, out_channels, stride</span>):</span><br><span class="line">        <span class="built_in">super</span>(RestNetDownBlock, self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(in_channels, out_channels, kernel_size=<span class="number">3</span>, stride=stride[<span class="number">0</span>], padding=<span class="number">1</span>)</span><br><span class="line">        self.bn1 = nn.BatchNorm2d(out_channels)</span><br><span class="line">        self.conv2 = nn.Conv2d(out_channels, out_channels, kernel_size=<span class="number">3</span>, stride=stride[<span class="number">1</span>], padding=<span class="number">1</span>)</span><br><span class="line">        self.bn2 = nn.BatchNorm2d(out_channels)</span><br><span class="line">        self.extra = nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_channels, out_channels, kernel_size=<span class="number">1</span>, stride=stride[<span class="number">0</span>], padding=<span class="number">0</span>),</span><br><span class="line">            nn.BatchNorm2d(out_channels)</span><br><span class="line">        )</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        extra_x = self.extra(x)</span><br><span class="line">        output = self.conv1(x)</span><br><span class="line">        out = F.relu(self.bn1(output))</span><br><span class="line"> </span><br><span class="line">        out = self.conv2(out)</span><br><span class="line">        out = self.bn2(out)</span><br><span class="line">        <span class="keyword">return</span> F.relu(extra_x + out)</span><br></pre></td></tr></table></figure><h5 id="ç»„åˆè¿™ä¸¤ä¸ªæ¨¡å—å¾—åˆ°ç°ä»£ç»å…¸RetNet18ç½‘ç»œç»“æ„ã€‚"><a href="#ç»„åˆè¿™ä¸¤ä¸ªæ¨¡å—å¾—åˆ°ç°ä»£ç»å…¸RetNet18ç½‘ç»œç»“æ„ã€‚" class="headerlink" title="ç»„åˆè¿™ä¸¤ä¸ªæ¨¡å—å¾—åˆ°ç°ä»£ç»å…¸RetNet18ç½‘ç»œç»“æ„ã€‚"></a>ç»„åˆè¿™ä¸¤ä¸ªæ¨¡å—å¾—åˆ°ç°ä»£ç»å…¸RetNet18ç½‘ç»œç»“æ„ã€‚</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RestNet18</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(RestNet18, self).__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">3</span>)</span><br><span class="line">        self.bn1 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">        self.maxpool = nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">        self.layer1 = nn.Sequential(RestNetBasicBlock(<span class="number">64</span>, <span class="number">64</span>, <span class="number">1</span>),</span><br><span class="line">                                    RestNetBasicBlock(<span class="number">64</span>, <span class="number">64</span>, <span class="number">1</span>))</span><br><span class="line"> </span><br><span class="line">        self.layer2 = nn.Sequential(RestNetDownBlock(<span class="number">64</span>, <span class="number">128</span>, [<span class="number">2</span>, <span class="number">1</span>]),</span><br><span class="line">                                    RestNetBasicBlock(<span class="number">128</span>, <span class="number">128</span>, <span class="number">1</span>))</span><br><span class="line"> </span><br><span class="line">        self.layer3 = nn.Sequential(RestNetDownBlock(<span class="number">128</span>, <span class="number">256</span>, [<span class="number">2</span>, <span class="number">1</span>]),</span><br><span class="line">                                    RestNetBasicBlock(<span class="number">256</span>, <span class="number">256</span>, <span class="number">1</span>))</span><br><span class="line"> </span><br><span class="line">        self.layer4 = nn.Sequential(RestNetDownBlock(<span class="number">256</span>, <span class="number">512</span>, [<span class="number">2</span>, <span class="number">1</span>]),</span><br><span class="line">                                    RestNetBasicBlock(<span class="number">512</span>, <span class="number">512</span>, <span class="number">1</span>))</span><br><span class="line"> </span><br><span class="line">        self.avgpool = nn.AdaptiveAvgPool2d(output_size=(<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"> </span><br><span class="line">        self.fc = nn.Linear(<span class="number">512</span>, <span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = self.conv1(x)</span><br><span class="line">        out = self.layer1(out)</span><br><span class="line">        out = self.layer2(out)</span><br><span class="line">        out = self.layer3(out)</span><br><span class="line">        out = self.layer4(out)</span><br><span class="line">        out = self.avgpool(out)</span><br><span class="line">        out = out.reshape(x.shape[<span class="number">0</span>], -<span class="number">1</span>)</span><br><span class="line">        out = self.fc(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h3><p>æ„å»ºæ¨¡å‹ï¼ˆå‡è®¾ä¸ºmodelï¼‰åï¼Œæ¥ä¸‹æ¥å°±æ˜¯è®­ç»ƒæ¨¡å‹ã€‚PyTorchè®­ç»ƒæ¨¡å‹ä¸»è¦åŒ…æ‹¬åŠ è½½æ•°æ®é›†ã€æŸå¤±è®¡ç®—ã€å®šä¹‰ä¼˜åŒ–ç®—æ³•ã€åå‘ä¼ æ’­ã€å‚æ•°æ›´æ–°ç­‰ä¸»è¦æ­¥éª¤ã€‚<br>1.åŠ è½½é¢„å¤„ç†æ•°æ®é›†<br>åŠ è½½å’Œé¢„å¤„ç†æ•°æ®é›†ï¼Œå¯ä»¥ä½¿ç”¨PyTorchçš„æ•°æ®å¤„ç†å·¥å…·ï¼Œå¦‚torch.utilså’Œtorchvisionç­‰ï¼Œè¿™äº›å·¥å…·å°†åœ¨ç¬¬4ç« è¯¦ç»†ä»‹ç»ã€‚<br>2.å®šä¹‰æŸå¤±å‡½æ•°<br>å®šä¹‰æŸå¤±å‡½æ•°å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ–¹æ³•æˆ–ä½¿ç”¨PyTorchå†…ç½®çš„æŸå¤±å‡½æ•°ï¼Œå¦‚å›å½’ä½¿ç”¨çš„losss_fun&#x3D;nn.MSELoss()ï¼Œåˆ†ç±»ä½¿ç”¨çš„nn.BCELossç­‰æŸå¤±å‡½æ•°ï¼Œæ›´å¤šå†…å®¹å¯å‚è€ƒæœ¬ä¹¦5.2.4èŠ‚ã€‚<br>3.å®šä¹‰ä¼˜åŒ–æ–¹æ³•<br>Pytochå¸¸ç”¨çš„ä¼˜åŒ–æ–¹æ³•éƒ½å°è£…åœ¨torch.optimé‡Œé¢ï¼Œå…¶è®¾è®¡å¾ˆçµæ´»ï¼Œå¯ä»¥æ‰©å±•ä¸ºè‡ªå®šä¹‰çš„ä¼˜åŒ–æ–¹æ³•ã€‚æ‰€æœ‰çš„ä¼˜åŒ–æ–¹æ³•éƒ½æ˜¯ç»§æ‰¿äº†åŸºç±»optim.Optimizerï¼Œå¹¶å®ç°äº†è‡ªå·±çš„ä¼˜åŒ–æ­¥éª¤ã€‚<br>æœ€å¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•å°±æ˜¯æ¢¯åº¦ä¸‹é™æ³•åŠå…¶å„ç§å˜ç§ï¼Œå…·ä½“å°†åœ¨5.4èŠ‚è¯¦ç»†ä»‹ç»ï¼Œè¿™äº›ä¼˜åŒ–ç®—æ³•å¤§å¤šä½¿ç”¨æ¢¯åº¦æ›´æ–°å‚æ•°ã€‚<br>å¦‚ä½¿ç”¨SGDä¼˜åŒ–å™¨æ—¶ï¼Œå¯è®¾ç½®ä¸ºoptimizer &#x3D; torch.optim.SGD(params,lr &#x3D; 0.001)ã€‚<br>4.å¾ªç¯è®­ç»ƒæ¨¡å‹<br>1ï¼‰è®¾ç½®ä¸ºè®­ç»ƒæ¨¡å¼ï¼š<br>model.train()<br>è°ƒç”¨model.train()ä¼šæŠŠæ‰€æœ‰çš„moduleè®¾ç½®ä¸ºè®­ç»ƒæ¨¡å¼ã€‚<br>2ï¼‰æ¢¯åº¦æ¸…é›¶ï¼š<br>optimizer. zero_grad()<br>åœ¨é»˜è®¤æƒ…å†µä¸‹æ¢¯åº¦æ˜¯ç´¯åŠ çš„ï¼Œéœ€è¦æ‰‹å·¥æŠŠæ¢¯åº¦åˆå§‹åŒ–æˆ–æ¸…é›¶ï¼Œè°ƒç”¨optimizer.zero_grad() å³å¯ã€‚<br>3ï¼‰æ±‚æŸå¤±å€¼ï¼š<br>y_prev&#x3D;model(x)<br>loss&#x3D;loss_fun(y_prev,y_true)<br>4ï¼‰è‡ªåŠ¨æ±‚å¯¼ï¼Œå®ç°æ¢¯åº¦çš„åå‘ä¼ æ’­ï¼š<br>loss.backward()<br>5ï¼‰æ›´æ–°å‚æ•°ï¼š<br>optimizer.step()<br>5.å¾ªç¯æµ‹è¯•æˆ–éªŒè¯æ¨¡å‹<br>1ï¼‰è®¾ç½®ä¸ºæµ‹è¯•æˆ–éªŒè¯æ¨¡å¼ï¼š<br>model.eval()<br>è°ƒç”¨model.eval()ä¼šæŠŠæ‰€æœ‰çš„trainingå±æ€§è®¾ç½®ä¸ºFalseã€‚<br>2ï¼‰åœ¨ä¸è·Ÿè¸ªæ¢¯åº¦æ¨¡å¼ä¸‹è®¡ç®—æŸå¤±å€¼ã€é¢„æµ‹å€¼ç­‰ï¼š<br>with.torch.no_grad():<br>6.å¯è§†åŒ–ç»“æœ<br>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å®ä¾‹æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨nnæ¥æ„å»ºç½‘ç»œæ¨¡å‹ã€è®­ç»ƒæ¨¡å‹ã€‚<br>ã€è¯´æ˜ã€‘model.train()ä¸model.eval()çš„ä½¿ç”¨<br>å¦‚æœæ¨¡å‹ä¸­æœ‰BN (Batch Normalizationï¼‰å±‚å’ŒDropoutï¼Œéœ€è¦åœ¨è®­ç»ƒæ—¶æ·»åŠ model.train()ï¼Œ<br>åœ¨æµ‹è¯•æ—¶æ·»åŠ model.eval()ã€‚å…¶ä¸­model.train()æ˜¯ä¿è¯BNå±‚ç”¨æ¯ä¸€æ‰¹æ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼Œè€Œmodel.eval()æ˜¯ä¿è¯BNç”¨å…¨éƒ¨è®­ç»ƒæ•°æ®çš„å‡å€¼å’Œæ–¹å·®ï¼›è€Œå¯¹äºDropoutï¼Œmodel.train()æ˜¯éšæœºå–ä¸€éƒ¨åˆ†ç½‘ç»œè¿æ¥æ¥è®­ç»ƒæ›´æ–°å‚æ•°ï¼Œè€Œmodel.eval()æ˜¯åˆ©ç”¨åˆ°äº†æ‰€æœ‰ç½‘ç»œè¿æ¥ã€‚</p><h3 id="å®ç°ç¥ç»ç½‘ç»œå®ä¾‹"><a href="#å®ç°ç¥ç»ç½‘ç»œå®ä¾‹" class="headerlink" title="å®ç°ç¥ç»ç½‘ç»œå®ä¾‹"></a>å®ç°ç¥ç»ç½‘ç»œå®ä¾‹</h3><p>é€šè¿‡ä¸€ä¸ªæ„å»ºç¥ç»ç½‘ç»œçš„å®ä¾‹æŠŠè¿™äº›å†…å®¹æœ‰æœºç»“åˆèµ·æ¥ã€‚</p><h4 id="èƒŒæ™¯è¯´æ˜"><a href="#èƒŒæ™¯è¯´æ˜" class="headerlink" title="èƒŒæ™¯è¯´æ˜"></a>èƒŒæ™¯è¯´æ˜</h4><p>åˆ©ç”¨ç¥ç»ç½‘ç»œå®Œæˆå¯¹æ‰‹å†™æ•°å­—è¿›è¡Œè¯†åˆ«çš„å®ä¾‹ï¼Œæ¥è¯´æ˜å¦‚ä½•å€ŸåŠ©nnå·¥å…·ç®±æ¥å®ç°ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œå¹¶å¯¹ç¥ç»ç½‘ç»œæœ‰ä¸ªç›´è§‚äº†è§£ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œåç»­æˆ‘ä»¬å°†å¯¹nnçš„å„æ¨¡å—è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚å®ä¾‹ç¯å¢ƒä½¿ç”¨PyTorch1.5+ï¼ŒGPUæˆ–CPU,æºæ•°æ®é›†ä¸ºMNISTã€‚<br>ä¸»è¦æ­¥éª¤å¦‚ä¸‹ã€‚</p><p>åˆ©ç”¨PyTorchå†…ç½®å‡½æ•°mnistä¸‹è½½æ•°æ®ã€‚</p><ol><li><p>åˆ©ç”¨torchvisionå¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œè°ƒç”¨torch.utilså»ºç«‹ä¸€ä¸ªæ•°æ®è¿­ä»£å™¨ã€‚</p></li><li><p>å¯è§†åŒ–æºæ•°æ®ã€‚</p></li><li><p>åˆ©ç”¨nnå·¥å…·ç®±æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p></li><li><p>å®ä¾‹åŒ–æ¨¡å‹ï¼Œå¹¶å®šä¹‰æŸå¤±å‡½æ•°åŠä¼˜åŒ–å™¨ã€‚</p></li><li><p>è®­ç»ƒæ¨¡å‹ã€‚</p></li><li><p>å¯è§†åŒ–ç»“æœã€‚</p></li></ol><p>ç¥ç»ç½‘ç»œçš„ç»“æ„å¦‚å›¾</p><p>ä½¿ç”¨ä¸¤ä¸ªéšå«å±‚ï¼Œæ¯å±‚ä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°ï¼Œè¾“å‡ºå±‚ä½¿ç”¨softmaxæ¿€æ´»å‡½æ•°ï¼Œæœ€åä½¿ç”¨torch.max(out,1)æ‰¾å‡ºå¼ é‡outæœ€å¤§å€¼å¯¹åº”ç´¢å¼•ä½œä¸ºé¢„æµ‹å€¼ã€‚</p><h4 id="å‡†å¤‡æ•°æ®"><a href="#å‡†å¤‡æ•°æ®" class="headerlink" title="å‡†å¤‡æ•°æ®"></a>å‡†å¤‡æ•°æ®</h4><p>å¯¼äººå¿…è¦çš„æ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># å¯¼å…¥ pytorch å†…ç½®çš„ mnist æ•°æ®</span></span><br><span class="line"><span class="keyword">from</span> torchvision.datasets <span class="keyword">import</span> mnist </span><br><span class="line"><span class="comment">#å¯¼å…¥é¢„å¤„ç†æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="comment">#å¯¼å…¥nnåŠä¼˜åŒ–å™¨</span></span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€äº›è¶…å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">train_batch_size = <span class="number">64</span></span><br><span class="line">test_batch_size = <span class="number">128</span></span><br><span class="line">learning_rate = <span class="number">0.01</span></span><br><span class="line">num_epoches = <span class="number">20</span></span><br><span class="line">lr = <span class="number">0.01</span></span><br><span class="line">momentum = <span class="number">0.5</span></span><br></pre></td></tr></table></figure><p>ä¸‹è½½æ•°æ®å¹¶è¿›è¡Œé¢„å¤„ç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å®šä¹‰é¢„å¤„ç†å‡½æ•°</span></span><br><span class="line">transform = transforms.Compose([transforms.ToTensor(),transforms.Normalize([<span class="number">0.5</span>], [<span class="number">0.5</span>])])</span><br><span class="line"><span class="comment">#ä¸‹è½½æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†</span></span><br><span class="line">train_dataset = mnist.MNIST(<span class="string">&#x27;../data/&#x27;</span>, train=<span class="literal">True</span>, transform=transform, download=<span class="literal">False</span>)</span><br><span class="line">test_dataset = mnist.MNIST(<span class="string">&#x27;../data/&#x27;</span>, train=<span class="literal">False</span>, transform=transform)</span><br><span class="line"><span class="comment">#å¾—åˆ°ä¸€ä¸ªç”Ÿæˆå™¨</span></span><br><span class="line">train_loader = DataLoader(train_dataset, batch_size=train_batch_size, shuffle=<span class="literal">True</span>)</span><br><span class="line">test_loader = DataLoader(test_dataset, batch_size=test_batch_size, shuffle=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>ã€è¯´æ˜ã€‘<br>\1) transforms.Composeå¯ä»¥æŠŠä¸€äº›è½¬æ¢å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ã€‚<br>\2) Normalize([0.5], [0.5])å¯¹å¼ é‡è¿›è¡Œå½’ä¸€åŒ–ï¼Œè¿™é‡Œä¸¤ä¸ª0.5åˆ†åˆ«è¡¨ç¤ºå¯¹å¼ é‡è¿›è¡Œå½’ä¸€åŒ–çš„å…¨å±€å¹³å‡å€¼å’Œæ–¹å·®ã€‚å› å›¾åƒæ˜¯ç°è‰²çš„åªæœ‰ä¸€ä¸ªé€šé“ï¼Œå¦‚æœæœ‰å¤šä¸ªé€šé“ï¼Œéœ€è¦æœ‰å¤šä¸ªæ•°å­—ï¼Œå¦‚ä¸‰ä¸ªé€šé“ï¼Œåº”è¯¥æ˜¯Normalize([m1,m2,m3], [n1,n2,n3])ã€‚<br>\3) downloadå‚æ•°æ§åˆ¶æ˜¯å¦éœ€è¦ä¸‹è½½ï¼Œå¦‚æœ.&#x2F;dataç›®å½•ä¸‹å·²æœ‰MNISTï¼Œå¯é€‰æ‹©Falseã€‚<br>\4) ç”¨DataLoaderå¾—åˆ°ç”Ÿæˆå™¨ï¼Œè¿™å¯èŠ‚çœå†…å­˜ã€‚<br>\5) torchvisionåŠdataçš„ä½¿ç”¨ç¬¬4ç« å°†è¯¦ç»†ä»‹ç»ã€‚</p><h4 id="å¯è§†åŒ–æºæ•°æ®"><a href="#å¯è§†åŒ–æºæ•°æ®" class="headerlink" title="å¯è§†åŒ–æºæ•°æ®"></a>å¯è§†åŒ–æºæ•°æ®</h4><p>å¯¹æ•°æ®é›†  ä¸­éƒ¨åˆ†æ•°æ®è¿›è¡Œå¯è§†åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line">examples = <span class="built_in">enumerate</span>(test_loader)</span><br><span class="line">batch_idx, (example_data, example_targets) = <span class="built_in">next</span>(examples)</span><br><span class="line"> </span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">  plt.subplot(<span class="number">2</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">  plt.tight_layout()</span><br><span class="line">  plt.imshow(example_data[i][<span class="number">0</span>], cmap=<span class="string">&#x27;gray&#x27;</span>, interpolation=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">  plt.title(<span class="string">&quot;Ground Truth: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(example_targets[i]))</span><br><span class="line">  plt.xticks([])</span><br><span class="line">  plt.yticks([])</span><br></pre></td></tr></table></figure><h4 id="æ„å»ºæ¨¡å‹-1"><a href="#æ„å»ºæ¨¡å‹-1" class="headerlink" title="æ„å»ºæ¨¡å‹"></a>æ„å»ºæ¨¡å‹</h4><p>æ„å»ºç½‘ç»œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Net</span>(nn.Module):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä½¿ç”¨sequentialæ„å»ºç½‘ç»œï¼ŒSequential()å‡½æ•°çš„åŠŸèƒ½æ˜¯å°†ç½‘ç»œçš„å±‚ç»„åˆåˆ°ä¸€èµ·</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_dim, n_hidden_1, n_hidden_2, out_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>(Net, self).__init__()</span><br><span class="line">        self.flatten = nn.Flatten()</span><br><span class="line">        self.layer1 = nn.Sequential(nn.Linear(in_dim, n_hidden_1),nn.BatchNorm1d(n_hidden_1))</span><br><span class="line">        self.layer2 = nn.Sequential(nn.Linear(n_hidden_1, n_hidden_2),nn.BatchNorm1d(n_hidden_2))</span><br><span class="line">        self.out = nn.Sequential(nn.Linear(n_hidden_2, out_dim))</span><br><span class="line">        </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x=self.flatten(x)</span><br><span class="line">        x = F.relu(self.layer1(x))</span><br><span class="line">        x = F.relu(self.layer2(x))</span><br><span class="line">        x = F.softmax(self.out(x),dim=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>å®ä¾‹åŒ–ç½‘ç»œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ£€æµ‹æ˜¯å¦æœ‰å¯ç”¨çš„GPUï¼Œæœ‰åˆ™ä½¿ç”¨ï¼Œå¦åˆ™ä½¿ç”¨CPU</span></span><br><span class="line">device = torch.device(<span class="string">&quot;cuda:0&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line"><span class="comment">#å®ä¾‹åŒ–ç½‘ç»œ</span></span><br><span class="line">model = Net(<span class="number">28</span> * <span class="number">28</span>, <span class="number">300</span>, <span class="number">100</span>, <span class="number">10</span>)</span><br><span class="line">model.to(device)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span></span><br><span class="line">criterion = nn.CrossEntropyLoss()</span><br><span class="line">optimizer = optim.SGD(model.parameters(), lr=lr, momentum=momentum)</span><br></pre></td></tr></table></figure><h4 id="è®­ç»ƒæ¨¡å‹-1"><a href="#è®­ç»ƒæ¨¡å‹-1" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h4><p>è¿™é‡Œä½¿ç”¨forå¾ªç¯è¿›è¡Œè¿­ä»£ã€‚å…¶ä¸­åŒ…æ‹¬å¯¹è®­ç»ƒæ•°æ®çš„è®­ç»ƒæ¨¡å‹ï¼Œç„¶åç”¨æµ‹è¯•æ•°æ®éªŒè¯æ¨¡å‹</p><p>1ï¼‰è®­ç»ƒæ¨¡å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹è®­ç»ƒ</span></span><br><span class="line">losses = []</span><br><span class="line">acces = []</span><br><span class="line">eval_losses = []</span><br><span class="line">eval_acces = []</span><br><span class="line">writer = SummaryWriter(log_dir=<span class="string">&#x27;logs&#x27;</span>,comment=<span class="string">&#x27;train-loss&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epoches):</span><br><span class="line">    train_loss = <span class="number">0</span></span><br><span class="line">    train_acc = <span class="number">0</span></span><br><span class="line">    model.train()</span><br><span class="line">    <span class="comment">#åŠ¨æ€ä¿®æ”¹å‚æ•°å­¦ä¹ ç‡</span></span><br><span class="line">    <span class="keyword">if</span> epoch%<span class="number">5</span>==<span class="number">0</span>:</span><br><span class="line">        optimizer.param_groups[<span class="number">0</span>][<span class="string">&#x27;lr&#x27;</span>]*=<span class="number">0.9</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;å­¦ä¹ ç‡:&#123;:.6f&#125;&quot;</span>.<span class="built_in">format</span>(optimizer.param_groups[<span class="number">0</span>][<span class="string">&#x27;lr&#x27;</span>]))</span><br><span class="line">    <span class="keyword">for</span> img, label <span class="keyword">in</span> train_loader:</span><br><span class="line">        img=img.to(device)</span><br><span class="line">        label = label.to(device)</span><br><span class="line">        <span class="comment"># æ­£å‘ä¼ æ’­</span></span><br><span class="line">        out = model(img)</span><br><span class="line">        loss = criterion(out, label)</span><br><span class="line">        <span class="comment"># åå‘ä¼ æ’­</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">        <span class="comment"># è®°å½•è¯¯å·®</span></span><br><span class="line">        train_loss += loss.item()</span><br><span class="line">        <span class="comment"># ä¿å­˜lossçš„æ•°æ®ä¸epochæ•°å€¼</span></span><br><span class="line">        writer.add_scalar(<span class="string">&#x27;Train&#x27;</span>, train_loss/<span class="built_in">len</span>(train_loader), epoch)</span><br><span class="line">        <span class="comment"># è®¡ç®—åˆ†ç±»çš„å‡†ç¡®ç‡</span></span><br><span class="line">        _, pred = out.<span class="built_in">max</span>(<span class="number">1</span>)</span><br><span class="line">        num_correct = (pred == label).<span class="built_in">sum</span>().item()</span><br><span class="line">        acc = num_correct / img.shape[<span class="number">0</span>]</span><br><span class="line">        train_acc += acc</span><br><span class="line">        </span><br><span class="line">    losses.append(train_loss / <span class="built_in">len</span>(train_loader))</span><br><span class="line">    acces.append(train_acc / <span class="built_in">len</span>(train_loader))</span><br><span class="line">    <span class="comment"># åœ¨æµ‹è¯•é›†ä¸Šæ£€éªŒæ•ˆæœ</span></span><br><span class="line">    eval_loss = <span class="number">0</span></span><br><span class="line">    eval_acc = <span class="number">0</span></span><br><span class="line">    <span class="comment">#net.eval() # å°†æ¨¡å‹æ”¹ä¸ºé¢„æµ‹æ¨¡å¼</span></span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    <span class="keyword">for</span> img, label <span class="keyword">in</span> test_loader:</span><br><span class="line">        img=img.to(device)</span><br><span class="line">        label = label.to(device)</span><br><span class="line">        img = img.view(img.size(<span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">        out = model(img)</span><br><span class="line">        loss = criterion(out, label)</span><br><span class="line">        <span class="comment"># è®°å½•è¯¯å·®</span></span><br><span class="line">        eval_loss += loss.item()</span><br><span class="line">        <span class="comment"># è®°å½•å‡†ç¡®ç‡</span></span><br><span class="line">        _, pred = out.<span class="built_in">max</span>(<span class="number">1</span>)</span><br><span class="line">        num_correct = (pred == label).<span class="built_in">sum</span>().item()</span><br><span class="line">        acc = num_correct / img.shape[<span class="number">0</span>]</span><br><span class="line">        eval_acc += acc</span><br><span class="line">        </span><br><span class="line">    eval_losses.append(eval_loss / <span class="built_in">len</span>(test_loader))</span><br><span class="line">    eval_acces.append(eval_acc / <span class="built_in">len</span>(test_loader))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;epoch: &#123;&#125;, Train Loss: &#123;:.4f&#125;, Train Acc: &#123;:.4f&#125;, Test Loss: &#123;:.4f&#125;, Test Acc: &#123;:.4f&#125;&#x27;</span></span><br><span class="line">          .<span class="built_in">format</span>(epoch, train_loss / <span class="built_in">len</span>(train_loader), train_acc / <span class="built_in">len</span>(train_loader), </span><br><span class="line">                     eval_loss / <span class="built_in">len</span>(test_loader), eval_acc / <span class="built_in">len</span>(test_loader)))</span><br></pre></td></tr></table></figure><p>æœ€å5æ¬¡è¿­ä»£çš„ç»“æœå¦‚ä¸‹ï¼š<br>å­¦ä¹ ç‡:0.006561<br>epoch: 15, Train Loss: 1.4681, Train Acc: 0.9950, Test Loss: 1.4801, Test Acc: 0.9830<br>epoch: 16, Train Loss: 1.4681, Train Acc: 0.9950, Test Loss: 1.4801, Test Acc: 0.9833<br>epoch: 17, Train Loss: 1.4673, Train Acc: 0.9956, Test Loss: 1.4804, Test Acc: 0.9826<br>epoch: 18, Train Loss: 1.4668, Train Acc: 0.9960, Test Loss: 1.4798, Test Acc: 0.9835<br>epoch: 19, Train Loss: 1.4666, Train Acc: 0.9962, Test Loss: 1.4795, Test Acc: 0.9835<br>è¿™ä¸ªç¥ç»ç½‘ç»œçš„ç»“æ„æ¯”è¾ƒç®€å•ï¼Œåªç”¨äº†ä¸¤å±‚ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨dropoutå±‚ï¼Œè¿­ä»£20æ¬¡ï¼Œæµ‹è¯•å‡†ç¡®ç‡è¾¾åˆ°98%å·¦å³ï¼Œæ•ˆæœè¿˜å¯ä»¥ã€‚ä¸è¿‡ï¼Œè¿˜æ˜¯æœ‰æå‡ç©ºé—´ï¼Œå¦‚æœé‡‡ç”¨cnnï¼Œdropoutç­‰å±‚ï¼Œåº”è¯¥è¿˜å¯ä»¥æå‡æ¨¡å‹æ€§èƒ½ã€‚</p><p>2ï¼‰å¯è§†åŒ–è®­ç»ƒåŠæµ‹è¯•æŸå¤±å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.title(<span class="string">&#x27;train loss&#x27;</span>)</span><br><span class="line">plt.plot(np.arange(<span class="built_in">len</span>(losses)), losses)</span><br><span class="line">plt.legend([<span class="string">&#x27;Train Loss&#x27;</span>], loc=<span class="string">&#x27;upper right&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch7/4.png" alt="4"></p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaåŸºç¡€å­¦ä¹ </title>
      <link href="/2024/06/26/Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/"/>
      <url>/2024/06/26/Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªåšå®¢æ˜¯æˆ‘æ•´ç†çš„ Java åŸºç¡€çŸ¥è¯†çš„å­¦ä¹ ç¬”è®°(å¹¶ä¸æ˜¯æˆ‘åŸåˆ›çš„ï¼Œæˆ‘ä¹Ÿæ²¡å®åŠ›åŸåˆ›ï¼Œä»…ä¾›è‡ªå·±å’Œå¤§å®¶å­¦ä¹ )ï¼Œå†…å®¹åŒ…æ‹¬ï¼šJava æ•°æ®ç±»å‹ã€Java å…³é”®å­—ã€Javaçš„ä¸‰å¤§ç‰¹æ€§ã€Java ä¸­çš„ Stringã€StringBuffer å’Œ StringBuilderã€Java åå°„ã€Java å¼‚å¸¸ã€Java IO æµã€Java æ³¨è§£ã€Java æ³›å‹ã€Java æšä¸¾ã€Java 8 æ–°ç‰¹æ€§ã€Java å¸¸è§çš„é›†åˆæ¡†æ¶æºç è§£æã€‚</p><h1 id="1-Java-æ•°æ®ç±»å‹è¯¦è§£"><a href="#1-Java-æ•°æ®ç±»å‹è¯¦è§£" class="headerlink" title="1. Java æ•°æ®ç±»å‹è¯¦è§£"></a>1. Java æ•°æ®ç±»å‹è¯¦è§£</h1><p>Java æ•°æ®ç±»å‹æœ‰å¾ˆå¤šï¼Œæœ¬æ–‡ä¸»è¦ä»åŸºæœ¬ç±»å‹ã€åŒ…è£…ç±»å‹ã€å¼•ç”¨ç±»å‹å’Œç¼“å­˜æ± å››ä¸ªæ–¹é¢æ¥æ€»ç»“ã€‚</p><h2 id="1-1-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#1-1-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="1.1 åŸºæœ¬æ•°æ®ç±»å‹"></a>1.1 åŸºæœ¬æ•°æ®ç±»å‹</h2><p>åŸºæœ¬æ•°æ®ç±»å‹æœ‰ byteã€shortã€intã€longã€floatã€doubleã€booleanã€charï¼Œå…³äºå®ƒä»¬çš„åˆ†ç±»ï¼Œæˆ‘ç”»äº†ä¸ªå›¾ã€‚</p><p><img src="/../img/java/1.jpg" alt="1"></p><p>æ¥ä¸‹æ¥æˆ‘ä¸»è¦ä»å­—èŠ‚æ•°ã€æ•°æ®èŒƒå›´ã€é»˜è®¤å€¼ã€ä»¥åŠç”¨é€”ç­‰æ–¹é¢ç»™å¤§å®¶æ€»ç»“æˆä¸€ä¸ªè¡¨æ ¼ï¼Œä¸€ç›®äº†ç„¶ã€‚</p><table><thead><tr><th>æ•°æ®ç±» å‹</th><th>å­—èŠ‚æ•°</th><th>ä½ æ•°</th><th>æœ€å°å€¼</th><th>æœ€å¤§å€¼</th><th>é»˜è®¤ å€¼</th><th>ç”¨é€”</th></tr></thead><tr><td>byte</td><td>1</td><td>8</td><td>-128</td><td>127</td><td>0</td><td>byte ç±»å‹ç”¨åœ¨å¤§å‹æ•°ç»„ä¸­èŠ‚çº¦ç©º é—´ï¼Œä¸»è¦ä»£æ›¿æ•´æ•°ã€‚å› ä¸º byte å˜ é‡å ç”¨çš„ç©ºé—´åªæœ‰ int ç±»å‹çš„å››åˆ† ä¹‹ä¸€</td></tr><tr><td>short</td><td>2</td><td>16</td><td>-32768</td><td>32767</td><td>0</td><td>Short æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥åƒ byte é‚£ æ ·èŠ‚çœç©ºé—´ã€‚ä¸€ä¸ªshortå˜é‡æ˜¯int å‹å˜é‡æ‰€å ç©ºé—´çš„äºŒåˆ†ä¹‹ä¸€</td></tr><tr><td>int</td><td>4</td><td>32</td><td>-2^31</td><td>2^31 - 1</td><td>0</td><td>ä¸€èˆ¬åœ°æ•´å‹å˜é‡é»˜è®¤ä¸º int ç±»å‹</td></tr><tr><td>long</td><td>8</td><td>64</td><td>-2^63</td><td>2^63-1</td><td>OL</td><td>è¿™ç§ç±»å‹ä¸»è¦ä½¿ç”¨åœ¨éœ€è¦æ¯”è¾ƒå¤§ æ•´æ•°çš„ç³»ç»Ÿä¸Š</td></tr><tr><td>float</td><td>4</td><td>32</td><td>1.4e-45</td><td>3.4e38</td><td>0.0F</td><td>float åœ¨å‚¨å­˜å¤§å‹æµ®ç‚¹æ•°ç»„çš„æ—¶å€™ å¯èŠ‚çœå†…å­˜ç©ºé—´ã€‚æµ®ç‚¹æ•°ä¸èƒ½ç”¨ æ¥è¡¨ç¤ºç²¾ç¡®çš„å€¼ï¼Œå¦‚è´§å¸</td></tr></table><table><thead><tr><th>æ•°æ®ç±» å‹</th><th>å­—èŠ‚æ•°</th><th>ä½æ•°</th><th>æœ€å°å€¼</th><th>æœ€å¤§å€¼</th><th>é»˜è®¤ å€¼</th><th>ç”¨é€”</th></tr></thead><tr><td>double</td><td>8</td><td>64</td><td>4.9e- 324</td><td>1.8e308</td><td>0.0D</td><td>æµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹ä¸ºdoubleç±» å‹ã€‚doubleç±»å‹åŒæ ·ä¸èƒ½è¡¨ç¤ºç²¾ ç¡®çš„å€¼ï¼Œå¦‚è´§å¸</td></tr><tr><td>boolean</td><td>\( \times \)</td><td>\( \times \)</td><td>\( \times \)</td><td>\( \times \)</td><td>false</td><td>trueå’Œfalse</td></tr><tr><td>char</td><td>2</td><td>16</td><td>\\u0000</td><td>\\uffff</td><td></td><td>char æ•°æ®ç±»å‹å¯ä»¥å‚¨å­˜ä»»ä½•å­—ç¬¦</td></tr></table><h2 id="1-2-åŒ…è£…æ•°æ®ç±»å‹"><a href="#1-2-åŒ…è£…æ•°æ®ç±»å‹" class="headerlink" title="1.2 åŒ…è£…æ•°æ®ç±»å‹"></a>1.2 åŒ…è£…æ•°æ®ç±»å‹</h2><p>ä¸Šé¢æåˆ°çš„åŸºæœ¬ç±»å‹éƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼Œä¸ºäº†æ–¹ä¾¿è¯»è€…æŸ¥çœ‹ï¼Œæˆ‘ä¹Ÿæ•´äº†ä¸€ä¸ªè¡¨æ ¼ã€‚</p><table><thead><tr><th>åŸºæœ¬ç±»å‹</th><th>åŒ…è£…ç±»å‹</th><th>æœ€å°å€¼</th><th>æœ€å¤§å€¼</th></tr></thead><tr><td>byte</td><td>Byte</td><td>Byte.MIN_VALUE</td><td>Byte.MAX_VALUE</td></tr><tr><td>short</td><td>Short</td><td>Short.MIN_VALUE</td><td>Short.MAX_VALUE</td></tr><tr><td>int</td><td>Integer</td><td>Integer.MIN_VALUE</td><td>Integer.MAX_VALUE</td></tr><tr><td>long</td><td>Long</td><td>Long.MIN_VALUE</td><td>Long.MAX_VALUE</td></tr><tr><td>float</td><td>Float</td><td>Float.MIN_VALUE</td><td>Float.MAX_VALUE</td></tr><tr><td>double</td><td>Double</td><td>Double.MIN_VALUE</td><td>Double.MAX_VALUE</td></tr><tr><td>boolean</td><td>Boolean</td><td>Boolean.MIN_VALUE</td><td>Boolean.MAX_VALUE</td></tr><tr><td>char</td><td>Char</td><td>CHAR.MIN_VALUE</td><td>Char.MAX_VALUE</td></tr></table><h2 id="1-3-å¼•ç”¨ç±»å‹"><a href="#1-3-å¼•ç”¨ç±»å‹" class="headerlink" title="1.3 å¼•ç”¨ç±»å‹"></a>1.3 å¼•ç”¨ç±»å‹</h2><p>åœ¨Javaä¸­ï¼Œå¼•ç”¨ç±»å‹çš„å˜é‡éå¸¸ç±»ä¼¼äº C&#x2F;C++ çš„æŒ‡é’ˆã€‚å¼•ç”¨ç±»å‹æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼ŒæŒ‡å‘å¯¹è±¡çš„å˜é‡æ˜¯å¼•ç”¨å˜é‡ã€‚è¿™äº›å˜é‡åœ¨å£°æ˜æ—¶è¢«æŒ‡å®šä¸ºä¸€ä¸ªç‰¹å®šçš„ç±»å‹ï¼Œæ¯”å¦‚ Studentã€Dog ç­‰ã€‚å˜é‡ä¸€æ—¦å£°æ˜åï¼Œç±»å‹å°±ä¸èƒ½è¢«æ”¹å˜äº†ã€‚</p><p>å¯¹è±¡ã€æ•°ç»„éƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ã€‚æ‰€æœ‰å¼•ç”¨ç±»å‹çš„é»˜è®¤å€¼éƒ½æ˜¯nullã€‚ä¸€ä¸ªå¼•ç”¨å˜é‡å¯ä»¥ç”¨æ¥å¼•ç”¨ä»»ä½•ä¸ä¹‹å…¼å®¹çš„ç±»å‹ã€‚ä¾‹å¦‚:</p><p>Dog dog &#x3D; new Dog(â€œæ—ºè´¢â€)ã€‚</p><h2 id="1-4-æ•°æ®ç±»å‹è½¬æ¢"><a href="#1-4-æ•°æ®ç±»å‹è½¬æ¢" class="headerlink" title="1.4 æ•°æ®ç±»å‹è½¬æ¢"></a>1.4 æ•°æ®ç±»å‹è½¬æ¢</h2><p>åŒ…è£…ç±»å‹å’ŒåŸºæœ¬ç±»å‹ä¹‹é—´å¦‚ä½•è½¬åŒ–å‘¢?</p><table><tr><td>Integer \( x = 2 \) ;</td><td>// è£…ç®± è°ƒç”¨äº† Integer.valueOf(2)</td></tr><tr><td>int \( y = x \) ;</td><td>// æ‹†ç®± è°ƒç”¨äº† x.intvalue()</td></tr></table><ol><li><p>æŠŠå¤§å®¹é‡çš„ç±»å‹è½¬æ¢ä¸ºå°å®¹é‡çš„ç±»å‹æ—¶å¿…é¡»ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p></li><li><p>æŠŠå°å®¹é‡çš„ç±»å‹è½¬æ¢ä¸ºå¤§å®¹é‡çš„ç±»å‹å¯ä»¥è‡ªåŠ¨è½¬æ¢ã€‚</p></li></ol><p>æ¯”å¦‚:</p><p>int ( i &#x3D; {128} ) ;</p><p>byte ( b &#x3D; ) (byte) ( i ) ;</p><p>long ( c &#x3D; i ) ;</p><h2 id="1-5-ç¼“å­˜æ± "><a href="#1-5-ç¼“å­˜æ± " class="headerlink" title="1.5 ç¼“å­˜æ± "></a>1.5 ç¼“å­˜æ± </h2><p>å¤§å®¶æ€è€ƒä¸€ä¸ªé—®é¢˜: new Integer(123) ä¸ Integer.valueof(123) æœ‰ä»€ä¹ˆåŒºåˆ«?</p><p>æœ‰äº›äººå¯èƒ½çŸ¥é“ï¼Œæœ‰äº›äººå¯èƒ½ä¸çŸ¥é“ã€‚å…¶å®ä»–ä»¬çš„åŒºåˆ«å¾ˆå¤§ã€‚</p><ol><li><p>new Integer(123) æ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªå¯¹è±¡;</p></li><li><p>Integer.valueOf(123) ä¼šä½¿ç”¨ç¼“å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå¤šæ¬¡è°ƒç”¨ä¼šå–å¾—åŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ æˆ‘å†™ä¸ªdemoå¤§å®¶å°±çŸ¥é“äº†</p></li></ol><p>Integer ( x &#x3D; ) new Integer(123);</p><p>Integer ( y &#x3D; ) new Integer(123);</p><p>System.out.println(x &#x3D;&#x3D; y); &#x2F;&#x2F; false</p><p>Integer ( z &#x3D; ) Integer.valueOf ( \left( {123}\right) ) ;</p><p>Integer ( k &#x3D; ) Integer.valueOf(123);</p><p>System.out.println(z &#x3D;&#x3D; k); &#x2F;&#x2F; true</p><p>ç¼–è¯‘å™¨ä¼šåœ¨è‡ªåŠ¨è£…ç®±è¿‡ç¨‹è°ƒç”¨ valueof () æ–¹æ³•ï¼Œå› æ­¤å¤šä¸ªå€¼ç›¸åŒä¸”å€¼åœ¨ç¼“å­˜æ± èŒƒå›´å†…çš„ Integer å®ä¾‹ä½¿ç”¨è‡ªåŠ¨è£…ç®±æ¥åˆ›å»ºï¼Œé‚£ä¹ˆå°±ä¼šå¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚å¦‚:</p><hr><p>Integer ( m &#x3D; {123} ) ;</p><p>Integer ( n &#x3D; {123} ) ;</p><p>System.out.println(m &#x3D;&#x3D; n); &#x2F;&#x2F; true</p><hr><p>valueof() æ–¹æ³•çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å…ˆåˆ¤æ–­å€¼æ˜¯å¦åœ¨ç¼“å­˜æ± ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±ç›´æ¥è¿”å›ç¼“å­˜æ± çš„å†…å®¹ã€‚æˆ‘ä»¬çœ‹ä¸‹æºç å°±çŸ¥é“ã€‚</p><p>public static Integer valueOf(int i) {</p><p>if (i &gt;&#x3D; IntegerCache.low &amp;&amp; i &lt;&#x3D; IntegerCache.high)</p><p>return IntegerCache.cache[i + (-IntegerCache.low)];</p><p>return new Integer(i);</p><p>}</p><p>æ ¹æ®æ•°æ®ç±»å‹çš„ä¸ä¸€æ ·ï¼Œè¿™ä¸ªç¼“å­˜æ± çš„ä¸Šä¸‹é™ä¹Ÿä¸åŒï¼Œæ¯”å¦‚è¿™ä¸ª Integerï¼Œå°±æ˜¯ -128~127ã€‚ä¸è¿‡è¿™ä¸ªä¸Šç•Œæ˜¯å¯è°ƒçš„ï¼Œåœ¨å¯åŠ¨ jvm çš„æ—¶å€™ï¼Œé€šè¿‡ -XX:AutoBoxCacheMax&#x3D; æ¥æŒ‡å®šè¿™ä¸ªç¼“å†²æ± çš„å¤§å°ï¼Œè¯¥é€‰é¡¹åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™ä¼šè®¾å®šä¸€ä¸ªåä¸º java.lang.IntegerCache.high ç³»ç»Ÿå±æ€§ï¼Œç„¶å IntegerCache åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè¯»å–è¯¥ç³»ç»Ÿå±æ€§æ¥å†³å®šä¸Šç•Œã€‚</p><p>å‚è€ƒè‡ªï¼šStackOverflow : Differences between new Integer(123), Integer.valueOf(123) and just 123</p><p>OKï¼Œè¿™ç¯‡æ–‡ç« å°±åˆ†äº«åˆ°è¿™ï¼ŒJava çš„æ•°æ®ç±»å‹è™½ç„¶ç®€å•ï¼Œä½†æ˜¯é‡Œé¢è¿˜æ˜¯æœ‰å¾ˆå¤šå°ç»†èŠ‚å€¼å¾—æˆ‘ä»¬ç©å‘³çš„ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚</p><h1 id="2-Java-å…³é”®å­—è¯¦è§£"><a href="#2-Java-å…³é”®å­—è¯¦è§£" class="headerlink" title="2. Java å…³é”®å­—è¯¦è§£"></a>2. Java å…³é”®å­—è¯¦è§£</h1><p>Java æœ‰ä¸€ç³»åˆ—çš„å…³é”®å­—ï¼Œåœ¨ä»£ç ä¸­å„è‡ªæœ‰è‡ªå·±çš„é‡è¦ç”¨é€”ä¸æ„ä¹‰ï¼Œä»Šå¤©å°±å¸¦ç€å¤§å®¶ä¸€èµ·æ¥äº†è§£ä¸€ä¸‹ Java çš„å…³é”®å­—!</p><p>Java çš„å…³é”®å­—ç‰¹åˆ«å¤šï¼Œæœ¬æ–‡å…ˆä¸»è¦ä»‹ç»ä¸€ä¸‹å„ä¸ªå…³é”®å­—çš„ç”¨é€”ï¼Œç„¶åé‡ç‚¹ä»‹ç»ä¸€ä¸‹ finalã€static å’Œ this è¿™ä¸‰ä¸ªå¸¸ç”¨çš„å…³é”®å­—ï¼Œå…¶ä»–çš„å…³é”®å­—å¤§å®¶ç”¨åˆ°çš„æ—¶å€™å¯ä»¥å»ç½‘ä¸ŠæŸ¥ä¸€ä¸‹ã€‚</p><h2 id="2-1-Java-å…³é”®å­—æ±‡æ€»"><a href="#2-1-Java-å…³é”®å­—æ±‡æ€»" class="headerlink" title="2.1 Java å…³é”®å­—æ±‡æ€»"></a>2.1 Java å…³é”®å­—æ±‡æ€»</h2><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tr><td>abstract</td><td>è¡¨æ˜ç±»æˆ–è€…æˆå‘˜æ–¹æ³•å…·æœ‰æŠ½è±¡å±æ€§</td></tr><tr><td>assert</td><td>æ–­è¨€ï¼Œç”¨æ¥è¿›è¡Œç¨‹åºè°ƒè¯•</td></tr><tr><td>boolean</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå¸ƒå°”ç±»å‹</td></tr><tr><td>break</td><td>æå‰è·³å‡ºä¸€ä¸ªå—</td></tr><tr><td>byte</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå­—èŠ‚ç±»å‹</td></tr><tr><td>case</td><td>ç”¨åœ¨switchè¯­å¥ä¹‹ä¸­ï¼Œè¡¨ç¤ºå…¶ä¸­çš„ä¸€ä¸ªåˆ†æ”¯</td></tr><tr><td>catch</td><td>ç”¨åœ¨å¼‚å¸¸å¤„ç†ä¸­ï¼Œç”¨æ¥æ•æ‰å¼‚å¸¸</td></tr><tr><td>char</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå­—ç¬¦ç±»å‹</td></tr><tr><td>class</td><td>å£°æ˜ä¸€ä¸ªç±»</td></tr><tr><td>const</td><td>ä¿ç•™å…³é”®å­—ï¼Œæ²¡æœ‰å…·ä½“å«ä¹‰</td></tr><tr><td>continue</td><td>å›åˆ°ä¸€ä¸ªå—çš„å¼€å§‹å¤„</td></tr><tr><td>default</td><td>é»˜è®¤ï¼Œä¾‹å¦‚ï¼Œç”¨åœ¨switchè¯­å¥ä¸­ï¼Œè¡¨æ˜ä¸€ä¸ªé»˜è®¤çš„åˆ†æ”¯</td></tr><tr><td>do</td><td>ç”¨åœ¨do-whileå¾ªç¯ç»“æ„ä¸­</td></tr><tr><td>double</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼ŒåŒç²¾åº¦æµ®ç‚¹æ•°ç±»å‹</td></tr><tr><td>else</td><td>ç”¨åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œè¡¨æ˜å½“æ¡ä»¶ä¸æˆç«‹æ—¶çš„åˆ†æ”¯</td></tr><tr><td>enum</td><td>æšä¸¾</td></tr><tr><td>extends</td><td>è¡¨æ˜ä¸€ä¸ªç±»å‹æ˜¯å¦ä¸€ä¸ªç±»å‹çš„å­ç±»å‹ï¼Œè¿™é‡Œå¸¸è§çš„ç±»å‹æœ‰ç±»å’Œæ¥å£</td></tr><tr><td>final</td><td>ç”¨æ¥è¯´æ˜æœ€ç»ˆå±æ€§ï¼Œè¡¨æ˜ä¸€ä¸ªç±»ä¸èƒ½æ´¾ç”Ÿå‡ºå­ç±»ï¼Œæˆ–è€…æˆå‘˜æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œæˆ– è€…æˆå‘˜åŸŸçš„å€¼ä¸èƒ½è¢«æ”¹å˜ï¼Œç”¨æ¥å®šä¹‰å¸¸é‡</td></tr><tr><td>finally</td><td>ç”¨äºå¤„ç†å¼‚å¸¸æƒ…å†µï¼Œç”¨æ¥å£°æ˜ä¸€ä¸ªåŸºæœ¬è‚¯å®šä¼šè¢«æ‰§è¡Œåˆ°çš„è¯­å¥å—</td></tr><tr><td>float</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå•ç²¾åº¦æµ®ç‚¹æ•°ç±»å‹</td></tr><tr><td>for</td><td>ä¸€ç§å¾ªç¯ç»“æ„çš„å¼•å¯¼è¯</td></tr><tr><td>goto</td><td>ä¿ç•™å…³é”®å­—ï¼Œæ²¡æœ‰å…·ä½“å«ä¹‰</td></tr><tr><td>if</td><td>æ¡ä»¶è¯­å¥çš„å¼•å¯¼è¯</td></tr></table><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tr><td>implements</td><td>è¡¨æ˜ä¸€ä¸ªç±»å®ç°äº†ç»™å®šçš„æ¥å£</td></tr><tr><td>import</td><td>è¡¨æ˜è¦è®¿é—®æŒ‡å®šçš„ç±»æˆ–åŒ…</td></tr><tr><td>instanceof</td><td>ç”¨æ¥æµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æŒ‡å®šç±»å‹çš„å®ä¾‹å¯¹è±¡</td></tr><tr><td>int</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œæ•´æ•°ç±»å‹</td></tr><tr><td>interface</td><td>æ¥å£</td></tr><tr><td>long</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œé•¿æ•´æ•°ç±»å‹</td></tr><tr><td>native</td><td>ç”¨æ¥å£°æ˜ä¸€ä¸ªæ–¹æ³•æ˜¯ç”±ä¸è®¡ç®—æœºç›¸å…³çš„è¯­è¨€ï¼ˆå¦‚C/C++/FORTRANè¯­è¨€ï¼‰å®ç°çš„</td></tr><tr><td>new</td><td>ç”¨æ¥åˆ›å»ºæ–°å®ä¾‹å¯¹è±¡</td></tr><tr><td>package</td><td>åŒ…</td></tr><tr><td>private</td><td>ä¸€ç§è®¿é—®æ§åˆ¶æ–¹å¼ï¼šç§ç”¨æ¨¡å¼</td></tr><tr><td>protected</td><td>ä¸€ç§è®¿é—®æ§åˆ¶æ–¹å¼ï¼šä¿æŠ¤æ¨¡å¼</td></tr><tr><td>public</td><td>ä¸€ç§è®¿é—®æ§åˆ¶æ–¹å¼ï¼šå…±ç”¨æ¨¡å¼</td></tr><tr><td>return</td><td>ä»æˆå‘˜æ–¹æ³•ä¸­è¿”å›æ•°æ®</td></tr><tr><td>short</td><td>åŸºæœ¬æ•°æ®ç±»å‹ä¹‹ä¸€,çŸ­æ•´æ•°ç±»å‹</td></tr><tr><td>static</td><td>è¡¨æ˜å…·æœ‰é™æ€å±æ€§</td></tr><tr><td>strictfp</td><td>ç”¨æ¥å£°æ˜FP_strictï¼ˆå•ç²¾åº¦æˆ–åŒç²¾åº¦æµ®ç‚¹æ•°ï¼‰è¡¨è¾¾å¼éµå¾ªIEEE 754ç®—æœ¯è§„èŒƒ [1</td></tr><tr><td>super</td><td>è¡¨æ˜å½“å‰å¯¹è±¡çš„çˆ¶ç±»å‹çš„å¼•ç”¨æˆ–è€…çˆ¶ç±»å‹çš„æ„é€ æ–¹æ³•</td></tr><tr><td>switch</td><td>åˆ†æ”¯è¯­å¥ç»“æ„çš„å¼•å¯¼è¯</td></tr><tr><td>synchronized</td><td>è¡¨æ˜ä¸€æ®µä»£ç éœ€è¦åŒæ­¥æ‰§è¡Œ</td></tr><tr><td>this</td><td>æŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡çš„å¼•ç”¨</td></tr><tr><td>throw</td><td>æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</td></tr><tr><td>throws</td><td>å£°æ˜åœ¨å½“å‰å®šä¹‰çš„æˆå‘˜æ–¹æ³•ä¸­æ‰€æœ‰éœ€è¦æŠ›å‡ºçš„å¼‚å¸¸</td></tr><tr><td>transient</td><td>å£°æ˜ä¸ç”¨åºåˆ—åŒ–çš„æˆå‘˜åŸŸ</td></tr><tr><td>try</td><td>å°è¯•ä¸€ä¸ªå¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ç¨‹åºå—</td></tr><tr><td>void</td><td>å£°æ˜å½“å‰æˆå‘˜æ–¹æ³•æ²¡æœ‰è¿”å›å€¼</td></tr><tr><td>volatile</td><td>è¡¨æ˜ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå˜é‡å¿…é¡»åŒæ­¥åœ°å‘ç”Ÿå˜åŒ–</td></tr><tr><td>while</td><td>ç”¨åœ¨å¾ªç¯ç»“æ„ä¸­</td></tr></table><p>æ˜¯ä¸æ˜¯ä¸åˆ—ä¸çŸ¥é“ï¼Œä¸€åˆ—å“ä¸€è·³ï¼ŒåŸæ¥ Java é‡Œè¿˜æœ‰è¿™ä¹ˆå¤šå…³é”®å­—ï¼Œå¤§éƒ¨åˆ†æˆ‘ä»¬å¹³æ—¶éƒ½åœ¨ç”¨ï¼Œåªæ˜¯æ²¡æœ‰ç‰¹æ„å»æ³¨æ„è¿™ä¸ªè€Œå·²ã€‚æ‰€ä»¥å¤§éƒ¨åˆ†å¤§å®¶éƒ½å¾ˆç†Ÿäº†ï¼Œæœ‰äº›ä¸å¸¸ç”¨çš„æˆ‘ä¹Ÿä¸æ€»ç»“äº†ï¼Œæˆ‘æ¥ä¸‹æ¥ä¸»è¦æ€»ç»“å‡ ä¸ªæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„å…³é”®å­—ã€‚</p><h2 id="2-2-final-å…³é”®å­—"><a href="#2-2-final-å…³é”®å­—" class="headerlink" title="2.2 final å…³é”®å­—"></a>2.2 final å…³é”®å­—</h2><p>Java ä¸­çš„ final å…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ (åŒ…æ‹¬å®ä¾‹å˜é‡å’Œå±€éƒ¨å˜é‡)</p><h2 id="2-2-1-final-ä¿®é¥°ç±»"><a href="#2-2-1-final-ä¿®é¥°ç±»" class="headerlink" title="2.2.1 final ä¿®é¥°ç±»"></a>2.2.1 final ä¿®é¥°ç±»</h2><p>ä½¿ç”¨finalä¿®é¥°ç±»åˆ™è¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ï¼ŒåŒæ—¶ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼å®šä¹‰ä¸ºfinalæ–¹æ³•ï¼ˆåªæœ‰åœ¨éœ€è¦ç¡®ä¿ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½ä¸è¢«é‡å†™æ—¶æ‰ä½¿ç”¨finalä¿®é¥°ç±»ï¼‰ã€‚finalä¿®é¥°ç±»çš„æˆå‘˜å˜é‡æ˜¯å¯ä»¥æ›´æ”¹çš„</p><p>public final class FinalClass{</p><p>int ( i &#x3D; 1 ) ;</p><p>void test(){</p><p>System.out.println(â€œFinalClass:testâ€);</p><p>}</p><p>public static void main( String[] args ){</p><p>FinalClass ficl &#x3D; new FinalClass();</p><p>System.out.println(â€œficl.i &#x3D; â€œ + ficl.i);</p><p>fic1.i ( &#x3D; 2 ) ;</p><p>System.out.println(â€œficl.i &#x3D; â€œ + ficl.i);</p><p>}</p><p>}</p><h2 id="2-2-2-final-ä¿®é¥°æ–¹æ³•"><a href="#2-2-2-final-ä¿®é¥°æ–¹æ³•" class="headerlink" title="2.2.2 final ä¿®é¥°æ–¹æ³•"></a>2.2.2 final ä¿®é¥°æ–¹æ³•</h2><p>ä½¿ç”¨finalä¿®é¥°æ–¹æ³•å¯ä»¥å°†æ–¹æ³•â€œé”å®šâ€ï¼Œä»¥é˜²æ­¢ä»»ä½•ç»§æ‰¿ç±»å¯¹æ–¹æ³•çš„ä¿®æ”¹ï¼Œä¹Ÿå³ä½¿ç”¨finalä¿®é¥°æ–¹æ³•ï¼Œåˆ™å­ç±»æ— æ³•é‡å†™ (ä½†å¹¶ä¸å½±å“ç»§æ‰¿å’Œé‡è½½ï¼Œå³å­ç±»è°ƒç”¨çˆ¶ç±»æ–¹æ³•ä¸å—å½±å“)ã€‚</p><h2 id="2-2-3-final-ä¿®é¥°å˜é‡"><a href="#2-2-3-final-ä¿®é¥°å˜é‡" class="headerlink" title="2.2.3 final ä¿®é¥°å˜é‡"></a>2.2.3 final ä¿®é¥°å˜é‡</h2><p>ä½¿ç”¨finalå…³é”®å­—ä¿®é¥°å˜é‡æ˜¯ä½¿ç”¨æœ€å¤šçš„æƒ…å†µã€‚</p><p>ä½¿ç”¨finalä¿®é¥°å˜é‡çš„å€¼ä¸èƒ½åšå†æ¬¡æ›´æ”¹ï¼Œå³ä¸èƒ½é‡æ–°èµ‹å€¼ã€‚</p><ol><li><p>å¦‚æœfinalä¿®é¥°çš„å˜é‡æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ™å˜é‡çš„å€¼ä¸å¯æ›´æ”¹;</p></li><li><p>å¦‚æœfinalä¿®é¥°çš„å˜é‡æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œåˆ™è¯¥å˜é‡ä¸èƒ½å†æ¬¡æŒ‡å‘å…¶ä»–å¼•ç”¨ï¼ˆå¦‚é‡æ–°æŒ‡å‘æ–°çš„å¯¹è±¡æˆ–æ•°ç»„) ä½†æ˜¯è¯¥å˜é‡æœ¬èº«çš„å†…å®¹å¯ä»¥å†åšä¿®æ”¹ (å¦‚æ•°ç»„æœ¬èº«çš„å†…å®¹ï¼Œæˆ–è€…å¯¹è±¡çš„å±æ€§çš„ä¿®æ”¹ï¼‰ã€‚</p></li></ol><p>æ— è®ºfinalä¿®é¥°å®ä¾‹å˜é‡è¿˜æ˜¯å±€éƒ¨å˜é‡ï¼Œéƒ½å¿…é¡»åœ¨ä½¿ç”¨å‰æ˜¾å¼èµ‹åˆå€¼ã€‚</p><ol><li><p>Javaä¸­çš„å®ä¾‹å˜é‡ç³»ç»Ÿä¼šå¯¹å…¶é»˜è®¤èµ‹åˆå€¼ï¼Œä½†æ˜¯å±€éƒ¨å˜é‡å¿…é¡»å…ˆå£°æ˜åèµ‹å€¼å†ä½¿ç”¨ã€‚</p></li><li><p>è™½ç„¶å¯¹äºå®ä¾‹å˜é‡ï¼Œç³»ç»Ÿä¼šé»˜è®¤èµ‹åˆå€¼ï¼Œä½†æ˜¯Javaä»ç„¶è§„å®šfinalä¿®é¥°çš„å®ä¾‹å˜é‡å¿…é¡»æ˜¾å¼èµ‹åˆå€¼ã€‚å®ä¾‹å˜é‡æ˜¾å¼èµ‹å€¼çš„æ—¶æœºå¯ä»¥æ˜¯åœ¨å£°æ˜æ—¶ç›´æ¥èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥å…ˆå£°æ˜ï¼Œååœ¨æ„é€ æ–¹æ³•ä¸­èµ‹</p></li></ol><p>å€¼ï¼ˆå¯¹äºå«æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œå¿…é¡»åœ¨æ¯ä¸ªæ„é€ æ–¹æ³•ä¸­éƒ½æ˜¾ç¤ºèµ‹å€¼ï¼‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­:</p><p>public void fun(){</p><p>&#x2F;&#x2F;BufferedImage src &#x3D; null;&#x2F;&#x2F;0. å£°æ˜çš„åŒæ—¶èµ‹å€¼</p><p>BufferedImage ( \operatorname{src};&#x2F;&#x2F;1 ) . è¿™é‡Œä¸ç”¨èµ‹åˆå€¼,ä¹Ÿä¸ä¼šå‡ºé”™</p><p>try{</p><p>src &#x3D; ImageIO.read(new File(â€œ1.jpgâ€));&#x2F;&#x2F;2.</p><p>} catch (Exception e){</p><p>&#x2F;&#x2F;3. å¦‚æœå‡ºå¼‚å¸¸äº†å°±ä¼šè¿›å…¥è¿™é‡Œ, é‚£ä¹ˆsrcå¯èƒ½æ— æ³•è¢«èµ‹å€¼</p><p>}</p><p>System.out.println(src.getHeight()); &#x2F;&#x2F;4. srcä¸ä¸€å®šæœ‰å€¼, æ‰€ä»¥æ— æ³•ä½¿ç”¨ }</p><p>å¦‚æœé™æ€å˜é‡åŒæ—¶è¢«finalä¿®é¥°åˆ™å¯ä»¥å°†å˜é‡è§†ä¸ºå…¨å±€å˜é‡ï¼Œå³åœ¨æ•´ä¸ªç±»åŠ è½½æœŸé—´ï¼Œå…¶å€¼ä¸å˜ã€‚ï¼ˆstaticä¿è¯å˜é‡å±äºæ•´ä¸ªç±»ï¼Œåœ¨ç±»åŠ è½½æ—¶åªå¯¹å…¶åˆ†é…ä¸€æ¬¡å†…å­˜ï¼›finalä¿è¯å˜é‡çš„å€¼ä¸è¢«æ”¹å˜)</p><h2 id="2-3-static-å…³é”®å­—"><a href="#2-3-static-å…³é”®å­—" class="headerlink" title="2.3 static å…³é”®å­—"></a>2.3 static å…³é”®å­—</h2><p>staticæ–¹æ³•ä¸€èˆ¬ç§°ä½œé™æ€æ–¹æ³•ï¼Œç”±äºé™æ€æ–¹æ³•ä¸ä¾èµ–äºä»»ä½•å¯¹è±¡å°±å¯ä»¥è¿›è¡Œè®¿é—®ï¼Œå› æ­¤å¯¹äºé™æ€æ–¹æ³•æ¥è¯´ï¼Œæ˜¯æ²¡æœ‰thisçš„ï¼Œå› ä¸ºå®ƒä¸ä¾é™„äºä»»ä½•å¯¹è±¡ï¼Œæ—¢ç„¶éƒ½æ²¡æœ‰å¯¹è±¡ï¼Œå°±è°ˆä¸ä¸Šthisäº†ã€‚å¹¶ä¸”ç”±äºè¿™ä¸ªç‰¹æ€§ï¼Œ åœ¨é™æ€æ–¹æ³•ä¸­ä¸èƒ½è®¿é—®ç±»çš„éé™æ€æˆå‘˜å˜é‡å’Œéé™æ€æˆå‘˜æ–¹æ³•ï¼Œå› ä¸ºéé™æ€æˆå‘˜æ–¹æ³•&#x2F;å˜é‡éƒ½æ˜¯å¿…é¡»ä¾èµ–å…·ä½“çš„å¯¹è±¡æ‰èƒ½å¤Ÿè¢«è°ƒç”¨ã€‚</p><p>ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶åœ¨é™æ€æ–¹æ³•ä¸­ä¸èƒ½è®¿é—®éé™æ€æˆå‘˜æ–¹æ³•å’Œéé™æ€æˆå‘˜å˜é‡ï¼Œä½†æ˜¯åœ¨éé™æ€æˆå‘˜æ–¹æ³•ä¸­æ˜¯å¯ä»¥è®¿é—®é™æ€æˆå‘˜æ–¹æ³•&#x2F;å˜é‡çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåè¿‡æ¥æ˜¯å¯ä»¥çš„ã€‚</p><p>å¦‚æœè¯´æƒ³åœ¨ä¸åˆ›å»ºå¯¹è±¡çš„æƒ…å†µä¸‹è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªæ–¹æ³•è®¾ç½®ä¸ºstaticã€‚staticä¿®é¥°æˆå‘˜æ–¹æ³•æœ€å¤§çš„ä½œç”¨ï¼Œå°±æ˜¯å¯ä»¥ä½¿ç”¨â€ç±»å.æ–¹æ³•åâ€çš„æ–¹å¼è°ƒç”¨æ–¹æ³•ï¼Œé¿å…äº†newå‡ºå¯¹è±¡çš„ç¹çå’Œèµ„æºæ¶ˆè€—ã€‚</p><p>æˆ‘ä»¬æœ€å¸¸è§çš„staticæ–¹æ³•å°±æ˜¯mainæ–¹æ³•ã€‚è‡³äºä¸ºä»€ä¹ˆmainæ–¹æ³•å¿…é¡»æ˜¯staticçš„ï¼Œè¿™æ˜¯å› ä¸ºç¨‹åºåœ¨æ‰§è¡Œ mainæ–¹æ³•çš„æ—¶å€™æ²¡æœ‰åˆ›å»ºä»»ä½•å¯¹è±¡ï¼Œå› æ­¤åªæœ‰é€šè¿‡ç±»åæ¥è®¿é—®ã€‚</p><h2 id="2-3-1-static-å˜é‡"><a href="#2-3-1-static-å˜é‡" class="headerlink" title="2.3.1 static å˜é‡"></a>2.3.1 static å˜é‡</h2><p>staticå˜é‡ä¹Ÿç§°ä½œé™æ€å˜é‡ï¼Œé™æ€å˜é‡å’Œéé™æ€å˜é‡çš„åŒºåˆ«æ˜¯ï¼šé™æ€å˜é‡è¢«æ‰€æœ‰çš„å¯¹è±¡æ‰€å…±äº«ï¼Œåœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œå®ƒå½“ä¸”ä»…å½“åœ¨ç±»åˆæ¬¡åŠ è½½æ—¶ä¼šè¢«åˆå§‹åŒ–ã€‚è€Œéé™æ€å˜é‡æ˜¯å¯¹è±¡æ‰€æ‹¥æœ‰çš„ï¼Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™è¢«åˆå§‹åŒ–ï¼Œå­˜åœ¨å¤šä¸ªå‰¯æœ¬ï¼Œå„ä¸ªå¯¹è±¡æ‹¥æœ‰çš„å‰¯æœ¬äº’ä¸å½±å“ã€‚</p><p>staticæˆå‘˜å˜é‡çš„åˆå§‹åŒ–é¡ºåºæŒ‰ç…§å®šä¹‰çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–ã€‚</p><h2 id="2-3-2-static-ä»£ç å—"><a href="#2-3-2-static-ä»£ç å—" class="headerlink" title="2.3.2 static ä»£ç å—"></a>2.3.2 static ä»£ç å—</h2><p>staticå—å¯ä»¥ç½®äºç±»ä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œç±»ä¸­å¯ä»¥æœ‰å¤šä¸ªstaticå—ã€‚åœ¨ç±»åˆæ¬¡è¢«åŠ è½½çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§staticå—çš„é¡ºåºæ¥æ‰§è¡Œæ¯ä¸ªstaticå—ï¼Œå¹¶ä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ä¸ºä»€ä¹ˆè¯´staticå—å¯ä»¥ç”¨æ¥ä¼˜åŒ–ç¨‹åºæ€§èƒ½ï¼Œæ˜¯å› ä¸ºå®ƒçš„ç‰¹æ€§:åªä¼šåœ¨ç±»åŠ è½½çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ã€‚</p><p>æ‰€è°“çš„ä»£ç å—å°±æ˜¯å½“æˆ‘ä»¬åˆå§‹åŒ–staticä¿®é¥°çš„æˆå‘˜æ—¶ï¼Œå¯ä»¥å°†ä»–ä»¬ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªä»¥staticå¼€å§‹ï¼Œç”¨èŠ±æ‹¬å·åŒ…è£¹èµ·æ¥çš„å—çŠ¶è¯­å¥ä¸­ã€‚ä¾‹å¦‚ï¼š</p><hr><p>class Person{</p><p>private Date birthDate;</p><p>public Person(Date birthDate){</p><p>this.birthDate ( &#x3D; ) birthDate;</p><p>}</p><p>boolean isBornBoomer(){</p><p>Date startDate ( &#x3D; ) Date.valueOf(â€œ1946â€);</p><p>Date endDate ( &#x3D; ) Date.valueOf(â€œ1964â€);</p><p>return birthDate.compareTo(startDate) ( &gt; &#x3D; 0&amp; ) birthDate.compareTo(endDate)</p><p>( &lt; 0 ) ;</p><p>}</p><p>}</p><hr><p>isBornBoomeræ˜¯ç”¨æ¥è¿™ä¸ªäººæ˜¯å¦æ˜¯1946-1964å¹´å‡ºç”Ÿçš„ï¼Œè€Œæ¯æ¬¡isBornBoomerè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šç”ŸæˆstartDateå’ŒbirthDateä¸¤ä¸ªå¯¹è±¡ï¼Œé€ æˆäº†ç©ºé—´æµªè´¹ï¼Œå¦‚æœæ”¹æˆè¿™æ ·æ•ˆç‡ä¼šæ›´å¥½:</p><hr><p>class Person{</p><p>private Date birthDate;</p><p>private static Date startDate, endDate;</p><p>static{</p><p>startDate ( &#x3D; ) Date.valueOf(â€œ1946â€);</p><p>endDate ( &#x3D; ) Date.valueOf(â€œ1964â€);</p><p>}</p><p>public Person(Date birthDate){</p><p>this.birthDate ( &#x3D; ) birthDate;</p><p>}</p><p>boolean isBornBoomer(){</p><p>return birthDate.compareTo(startDate)&gt;&#x3D;0 &amp;&amp; birthDate.compareTo(endDate)</p><p>( &lt; 0 ) ;</p><p>}</p><p>}</p><hr><p>å°†ä¸€äº›åªéœ€è¦è¿›è¡Œä¸€æ¬¡çš„åˆå§‹åŒ–æ“ä½œéƒ½æ”¾åœ¨staticä»£ç å—ä¸­è¿›è¡Œã€‚</p><h2 id="2-4-this-å…³é”®å­—"><a href="#2-4-this-å…³é”®å­—" class="headerlink" title="2.4 this å…³é”®å­—"></a>2.4 this å…³é”®å­—</h2><p>thisä»£è¡¨å®ƒæ‰€åœ¨å‡½æ•°æ‰€å±å¯¹è±¡çš„å¼•ç”¨ã€‚ç®€å•è¯´ï¼šå“ªä¸ªå¯¹è±¡åœ¨è°ƒç”¨thisæ‰€åœ¨çš„å‡½æ•°ï¼Œthiså°±ä»£è¡¨å“ªä¸ªå¯¹è±¡ã€‚ thiså…³é”®å­—ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªä½œç”¨:</p><ol><li><p>thisè°ƒç”¨æœ¬ç±»ä¸­çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯ç±»ä¸­çš„æˆå‘˜å˜é‡;</p></li><li><p>thisè°ƒç”¨æœ¬ç±»ä¸­çš„å…¶ä»–æ–¹æ³•;</p></li><li><p>thisè°ƒç”¨æœ¬ç±»ä¸­çš„å…¶ä»–æ„é€ æ–¹æ³•ï¼Œè°ƒç”¨æ—¶è¦æ”¾åœ¨æ„é€ æ–¹æ³•çš„é¦–è¡Œã€‚(thisè¯­å¥åªèƒ½å®šä¹‰åœ¨æ„é€ å‡½æ•°çš„ç¬¬ä¸€è¡Œï¼Œå› ä¸ºåœ¨åˆå§‹åŒ–æ—¶é¡»å…ˆæ‰§è¡Œ)</p></li></ol><h2 id="2-4-1-å¼•ç”¨æˆå‘˜å˜é‡"><a href="#2-4-1-å¼•ç”¨æˆå‘˜å˜é‡" class="headerlink" title="2.4.1 å¼•ç”¨æˆå‘˜å˜é‡"></a>2.4.1 å¼•ç”¨æˆå‘˜å˜é‡</h2><p>public class Person{</p><p>String name; &#x2F;&#x2F;å®šä¹‰æˆå‘˜å˜é‡name</p><p>private void SetName(String name) { &#x2F;&#x2F;å®šä¹‰ä¸€ä¸ªå‚æ•°(å±€éƒ¨å˜é‡)name</p><p>this. name&#x3D;name; &#x2F;&#x2F;å°†å±€éƒ¨å˜é‡çš„å€¼ä¼ é€’ç»™æˆå‘˜å˜é‡</p><p>}</p><p>}</p><p>è™½ç„¶æˆ‘ä»¬å¯ä»¥çœ‹æ˜ç™½è¿™ä¸ªä»£ç çš„å«ä¹‰ï¼Œä½†æ˜¯ä½œä¸ºJavaç¼–è¯‘å™¨å®ƒæ˜¯æ€ä¹ˆåˆ¤æ–­çš„å‘¢?åˆ°åº•æ˜¯å°†å½¢å¼å‚æ•°name çš„å€¼ä¼ é€’ç»™æˆå‘˜å˜é‡nameï¼Œè¿˜æ˜¯åè¿‡æ¥å°†æˆå‘˜å˜é‡nameçš„å€¼ä¼ é€’ç»™å½¢å¼å‚æ•°nameå‘¢?ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸¤ä¸ªå˜é‡åå­—å¦‚æœç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆJavaå¦‚ä½•åˆ¤æ–­ä½¿ç”¨å“ªä¸ªå˜é‡ï¼Ÿæ­¤æ—¶thisè¿™ä¸ªå…³é”®å­—å°±èµ·åˆ°ä½œç”¨äº†ã€‚thisè¿™ä¸ªå…³é”®å­—å…¶ä»£è¡¨çš„å°±æ˜¯å¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡æˆ–è€…æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨æŸä¸ªå˜é‡å‰é¢åŠ ä¸Šä¸€ä¸ªthiså…³é”®å­—ï¼Œ å…¶æŒ‡çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡æˆ–è€…æ–¹æ³•ï¼Œè€Œä¸æ˜¯æŒ‡æˆå‘˜æ–¹æ³•çš„å½¢å¼å‚æ•°æˆ–è€…å±€éƒ¨å˜é‡ã€‚</p><h2 id="2-4-2-è°ƒç”¨ç±»çš„æ„é€ å™¨æ–¹æ³•"><a href="#2-4-2-è°ƒç”¨ç±»çš„æ„é€ å™¨æ–¹æ³•" class="headerlink" title="2.4.2 è°ƒç”¨ç±»çš„æ„é€ å™¨æ–¹æ³•"></a>2.4.2 è°ƒç”¨ç±»çš„æ„é€ å™¨æ–¹æ³•</h2><p>public class Person {</p><p>public Person(){ &#x2F;&#x2F;æ— å‚æ„é€ å™¨æ–¹æ³•</p><p>this(â€œHello!â€);</p><p>}</p><p>public Person(String name){ &#x2F;&#x2F;å®šä¹‰ä¸€ä¸ªå¸¦å½¢å¼å‚æ•°çš„æ„é€ æ–¹æ³•</p><p>}</p><p>}</p><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªå¸¦å‚æ•°ï¼Œå¦ä¸€ä¸ªæ²¡æœ‰å¸¦å‚æ•°ã€‚åœ¨ç¬¬ä¸€ä¸ªæ²¡æœ‰å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†this(â€œHello!â€)è¿™å¥ä»£ç ï¼Œè¿™å¥ä»£ç è¡¨ç¤ºä»€ä¹ˆå«ä¹‰å‘¢?åœ¨æ„é€ æ–¹æ³•ä¸­ä½¿thiså…³é”®å­—è¡¨ç¤ºè°ƒç”¨ç±»ä¸­çš„æ„é€ æ–¹æ³•ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼Œå› ä¸ºå…¶åå­—éƒ½ç›¸åŒï¼Œè·Ÿç±»åä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸ªthisåˆ°åº•æ˜¯è°ƒç”¨å“ªä¸ªæ„é€ æ–¹æ³•å‘¢?å…¶å®ï¼Œè¿™è·Ÿé‡‡ç”¨å…¶ä»–æ–¹æ³•å¼•ç”¨æ„é€ æ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡å½¢å¼å‚æ•°æ¥è°ƒç”¨æ„é€ æ–¹æ³•çš„ã€‚</p><p>æ³¨æ„çš„æ˜¯ï¼šåˆ©ç”¨thiså…³é”®å­—æ¥è°ƒç”¨æ„é€ æ–¹æ³•ï¼Œåªæœ‰åœ¨æ— å‚æ•°æ„é€ æ–¹æ³•ä¸­ç¬¬ä¸€å¥ä½¿ç”¨thisè°ƒç”¨æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ã€‚å¦åˆ™çš„è¯ï¼Œç¿»è¯‘çš„æ—¶å€™ï¼Œå°±ä¼šæœ‰é”™è¯¯ä¿¡æ¯ã€‚è¿™è·Ÿå¼•ç”¨æˆå‘˜å˜é‡ä¸åŒã€‚å¦‚æœå¼•ç”¨æˆå‘˜å˜é‡çš„è¯ï¼Œthis å…³é”®å­—æ˜¯æ²¡æœ‰ä½ç½®ä¸Šçš„é™åˆ¶çš„ã€‚</p><h2 id="2-4-3-è¿”å›å¯¹è±¡çš„å¼•ç”¨"><a href="#2-4-3-è¿”å›å¯¹è±¡çš„å¼•ç”¨" class="headerlink" title="2.4.3 è¿”å›å¯¹è±¡çš„å¼•ç”¨"></a>2.4.3 è¿”å›å¯¹è±¡çš„å¼•ç”¨</h2><p>public HttpConfig url(String url) {</p><p>urls.set(url);</p><p>&#x2F;&#x2F;return thiså°±æ˜¯è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨(å°±æ˜¯å®é™…è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å®ä¾‹åŒ–å¯¹è±¡)</p><p>return this;</p><p>}</p><p>return thiså°±æ˜¯è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨(å°±æ˜¯å®é™…è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å®ä¾‹åŒ–å¯¹è±¡)ï¼Œå°±åƒæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨ StringBuilderä¸€æ ·ï¼Œå¯ä»¥ä¸€ç›´ ( {}^{.;} ) append ( â—‹ ) ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨ï¼Œè¿”å›çš„éƒ½æ˜¯è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚</p><p>å…³äºå…³é”®å­—ï¼Œè¿™ç¯‡æ–‡ç« å°±æ€»ç»“è¿™ä¹ˆå¤šï¼Œå¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥ã€‚</p><h1 id="3-Javaçš„ä¸‰å¤§ç‰¹æ€§è¯¦è§£"><a href="#3-Javaçš„ä¸‰å¤§ç‰¹æ€§è¯¦è§£" class="headerlink" title="3. Javaçš„ä¸‰å¤§ç‰¹æ€§è¯¦è§£"></a>3. Javaçš„ä¸‰å¤§ç‰¹æ€§è¯¦è§£</h1><h2 id="3-1-å°è£…"><a href="#3-1-å°è£…" class="headerlink" title="3.1 å°è£…"></a>3.1 å°è£…</h2><h2 id="3-1-1-publicã€privateã€protectedä¿®é¥°ç¬¦"><a href="#3-1-1-publicã€privateã€protectedä¿®é¥°ç¬¦" class="headerlink" title="3.1.1 publicã€privateã€protectedä¿®é¥°ç¬¦"></a>3.1.1 publicã€privateã€protectedä¿®é¥°ç¬¦</h2><p>è¯´åˆ°å°è£…ï¼ŒJava ä¸­æœ‰ä¸‰ä¸ªè®¿é—®æƒé™ä¿®é¥°ç¬¦ï¼šprivateã€protected ä»¥åŠ publicï¼Œå¦‚æœä¸åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºåŒ…çº§å¯è§ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹è¿™ä¸‰ä¸ªä¿®é¥°ç¬¦çš„ä½œç”¨ã€‚</p><table><thead><tr><th>ä¿®é¥°ç¬¦</th><th>å½“å‰ç±»</th><th>åŒåŒ…</th><th>å­ç±»</th><th>å…¶ä»–åŒ…</th></tr></thead><tr><td>public</td><td>\( \sqrt{} \)</td><td>\( \sqrt{} \)</td><td>\( \sqrt{} \)</td><td>\( \sqrt{} \)</td></tr><tr><td>protected</td><td>\( \sqrt{} \)</td><td>\( \sqrt{} \)</td><td>\( \sqrt{} \)</td><td>\( \times \)</td></tr><tr><td>default</td><td>\( \sqrt{} \)</td><td>\( \sqrt{} \)</td><td>\( \times \)</td><td>\( \times \)</td></tr><tr><td>private</td><td>\( \sqrt{} \)</td><td>\( \times \)</td><td>\( \times \)</td><td>\( \times \)</td></tr></table><p>è®¾è®¡è‰¯å¥½çš„æ¨¡å—ä¼šéšè—æ‰€æœ‰çš„å®ç°ç»†èŠ‚ï¼ŒæŠŠå®ƒçš„ API ä¸å®ƒçš„å®ç°æ¸…æ™°åœ°éš”ç¦»å¼€æ¥ã€‚æ¨¡å—ä¹‹é—´åªé€šè¿‡å®ƒä»¬çš„ API è¿›è¡Œé€šä¿¡ï¼Œä¸€ä¸ªæ¨¡å—ä¸éœ€è¦çŸ¥é“å…¶ä»–æ¨¡å—çš„å†…éƒ¨å·¥ä½œæƒ…å†µï¼Œè¿™ä¸ªæ¦‚å¿µè¢«ç§°ä¸ºä¿¡æ¯éšè—æˆ–å°è£…ã€‚å› æ­¤è®¿é—®æƒé™åº”å½“å°½å¯èƒ½åœ°ä½¿æ¯ä¸ªç±»æˆ–è€…æˆå‘˜ä¸è¢«å¤–ç•Œè®¿é—®ã€‚</p><p>å¦‚æœå­ç±»çš„æ–¹æ³•é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¸­è¯¥æ–¹æ³•çš„è®¿é—®çº§åˆ«ä¸å…è®¸ä½äºçˆ¶ç±»çš„è®¿é—®çº§åˆ«ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿å¯ä»¥ä½¿ç”¨çˆ¶ç±»å®ä¾‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å®ä¾‹å»ä»£æ›¿ï¼Œä¹Ÿå°±æ˜¯ç¡®ä¿æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚</p><h2 id="3-1-2-è§„èŒƒ"><a href="#3-1-2-è§„èŒƒ" class="headerlink" title="3.1.2 è§„èŒƒ"></a>3.1.2 è§„èŒƒ</h2><p>å­—æ®µå†³ä¸èƒ½æ˜¯å…¬æœ‰çš„ï¼Œå› ä¸ºè¿™ä¹ˆåšçš„è¯å°±å¤±å»äº†å¯¹è¿™ä¸ªå­—æ®µä¿®æ”¹è¡Œä¸ºçš„æ§åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å¯¹å…¶éšæ„ä¿®æ”¹ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒAccessExample æ‹¥æœ‰ id å…¬æœ‰å­—æ®µï¼Œå¦‚æœåœ¨æŸä¸ªæ—¶åˆ»ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ int å­˜å‚¨ id å­—æ®µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æ‰€æœ‰çš„å®¢æˆ·ç«¯ä»£ç ã€‚</p><p>public class AccessExample {</p><p>public String id;</p><p>}</p><p>å¯ä»¥ä½¿ç”¨å…¬æœ‰çš„ getter å’Œ setter æ–¹æ³•æ¥æ›¿æ¢å…¬æœ‰å­—æ®µï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥æ§åˆ¶å¯¹å­—æ®µçš„ä¿®æ”¹è¡Œä¸ºã€‚</p><p>public class AccessExample {</p><p>private int id;</p><p>public string ( \operatorname{getId()}{ )</p><p>return ( \mathrm + ) â€œâ€;</p><p>}</p><p>public void setId(String id) {</p><p>this.id ( &#x3D; ) Integer.valueOf(id);</p><p>}</p><p>}</p><h2 id="3-1-3-å°è£…çš„å¥½å¤„"><a href="#3-1-3-å°è£…çš„å¥½å¤„" class="headerlink" title="3.1.3 å°è£…çš„å¥½å¤„"></a>3.1.3 å°è£…çš„å¥½å¤„</h2><ol><li><p>æé«˜æ•°æ®çš„å®‰å…¨æ€§ã€‚</p></li><li><p>æ“ä½œç®€å•ã€‚</p></li><li><p>éšè—äº†å®ç°ã€‚</p></li></ol><h2 id="3-2-ç»§æ‰¿"><a href="#3-2-ç»§æ‰¿" class="headerlink" title="3.2 ç»§æ‰¿"></a>3.2 ç»§æ‰¿</h2><p>ç»§æ‰¿æ˜¯ç±»ä¸ç±»çš„ä¸€ç§å…³ç³»ï¼Œæ˜¯ä¸€ç§â€œis aâ€çš„å…³ç³»ã€‚æ¯”å¦‚â€œç‹—â€ç»§æ‰¿â€œåŠ¨ç‰©â€ï¼Œè¿™é‡ŒåŠ¨ç‰©ç±»æ˜¯ç‹—ç±»çš„çˆ¶ç±»æˆ–è€…åŸºç±»ï¼Œç‹—ç±»æ˜¯åŠ¨ç‰©ç±»çš„å­ç±»æˆ–è€…æ´¾ç”Ÿç±»ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="/../img/java/2.jpg" alt="2"> çˆ¶ç±»ã€åŸºç±»å­ç±»ã€æ´¾ç”Ÿç±»</p><p>æ³¨: javaä¸­çš„ç»§æ‰¿æ˜¯å•ç»§æ‰¿ï¼Œå³ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªçˆ¶ç±»ã€‚</p><h2 id="3-2-1-ç»§æ‰¿çš„åˆå§‹åŒ–é¡ºåº"><a href="#3-2-1-ç»§æ‰¿çš„åˆå§‹åŒ–é¡ºåº" class="headerlink" title="3.2.1 ç»§æ‰¿çš„åˆå§‹åŒ–é¡ºåº"></a>3.2.1 ç»§æ‰¿çš„åˆå§‹åŒ–é¡ºåº</h2><ol><li><p>åˆå§‹åŒ–çˆ¶ç±»å†åˆå§‹åŒ–å­ç±»</p></li><li><p>å…ˆæ‰§è¡Œåˆå§‹åŒ–å¯¹è±¡ä¸­å±æ€§ï¼Œå†æ‰§è¡Œæ„é€ æ–¹æ³•ä¸­çš„åˆå§‹åŒ–ã€‚</p></li></ol><p>åŸºäºä¸Šé¢ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å°±çŸ¥é“å®ä¾‹åŒ–ä¸€ä¸ªå­ç±»ï¼Œjavaç¨‹åºçš„æ‰§è¡Œé¡ºåºæ˜¯:</p><p>çˆ¶ç±»å¯¹è±¡å±æ€§åˆå§‹åŒ–â€”-&gt;çˆ¶ç±»å¯¹è±¡æ„é€ æ–¹æ³•â€”-&gt;å­ç±»å¯¹è±¡å±æ€§åˆå§‹åŒ–â€”&gt;å­ç±»å¯¹è±¡æ„é€ æ–¹æ³•ç»§æ‰¿è¿™å—å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿï¼Œæˆ‘æ¥ä¸¾ä¸ªä¾‹å­:</p><h2 id="3-2-2-ç»§æ‰¿ç¤ºä¾‹"><a href="#3-2-2-ç»§æ‰¿ç¤ºä¾‹" class="headerlink" title="3.2.2 ç»§æ‰¿ç¤ºä¾‹"></a>3.2.2 ç»§æ‰¿ç¤ºä¾‹</h2><p>AnimalåŠ¨ç‰©:</p><p>public class Animal {</p><p>&#x2F;*<em>åç§°</em>&#x2F;</p><p>public String name;</p><p>&#x2F;*<em>é¢œè‰²</em>&#x2F;</p><p>public string color;</p><p>&#x2F;*<em>æ˜¾ç¤ºä¿¡æ¯</em>&#x2F;</p><p>public void show(){</p><p>System.out.println(â€œåç§°: â€œ+name+â€, é¢œè‰²: â€œ+color);</p><p>}</p><p>}</p><p>&#x2F;*<em>ç‹—ç»§æ‰¿è‡ªåŠ¨ç‰©, å­ç±» is a çˆ¶ç±»</em>&#x2F;</p><p>public class Dog extends Animal {</p><p>&#x2F;*<em>ä»·æ ¼</em>&#x2F;</p><p>public double price;</p><p>}</p><p>dogå¹¶æ²¡æœ‰å®šä¹‰colorå±æ€§ï¼Œä½†åœ¨ä½¿ç”¨ä¸­å¯ä»¥è°ƒç”¨ï¼Œæ˜¯å› ä¸ºdogç»§æ‰¿äº†çˆ¶ç±»Animalï¼Œçˆ¶ç±»çš„éç§æœ‰æˆå‘˜å°†è¢«å­ç±»ç»§æ‰¿ã€‚å¦‚æœå†å®šä¹‰å…¶å®ƒçš„åŠ¨ç‰©ç±»åˆ™æ— é¡»å†åå¤å®šä¹‰nameï¼Œcolorä¸showæ–¹æ³•ã€‚</p><h2 id="3-3-å¤šæ€"><a href="#3-3-å¤šæ€" class="headerlink" title="3.3 å¤šæ€"></a>3.3 å¤šæ€</h2><p>å¤šæ€è¿™å—ï¼Œæˆ‘è¦è·Ÿå¤§å®¶å¥½å¥½å” å¨å” å¨ï¼Œé¦–å…ˆæ¥çœ‹ä¸‹æ¦‚å¿µ:</p><h2 id="3-3-1-å¤šæ€æ¦‚å¿µ"><a href="#3-3-1-å¤šæ€æ¦‚å¿µ" class="headerlink" title="3.3.1 å¤šæ€æ¦‚å¿µ"></a>3.3.1 å¤šæ€æ¦‚å¿µ</h2><p>å¤šæ€: ä¸€ä¸ªå¯¹è±¡å…·å¤‡å¤šç§å½¢æ€ã€‚</p><p>â‘ çˆ¶ç±»çš„å¼•ç”¨ç±»å‹å˜é‡æŒ‡å‘äº†å­ç±»çš„å¯¹è±¡</p><p>â‘¡æ¥å£çš„å¼•ç”¨ç±»å‹å˜é‡æŒ‡å‘äº†æ¥å£å®ç°ç±»çš„å¯¹è±¡</p><p>å¤šæ€çš„å‰æ: å¿…é¡»å­˜åœ¨ç»§æ‰¿æˆ–è€…å®ç°å…³ç³»ã€‚</p><p>åŠ¨ç‰© ( a &#x3D; ) new ç‹— ( O ) ;</p><h2 id="3-3-2-å¤šæ€è¦æ³¨æ„çš„ç»†èŠ‚"><a href="#3-3-2-å¤šæ€è¦æ³¨æ„çš„ç»†èŠ‚" class="headerlink" title="3.3.2 å¤šæ€è¦æ³¨æ„çš„ç»†èŠ‚"></a>3.3.2 å¤šæ€è¦æ³¨æ„çš„ç»†èŠ‚</h2><ol><li><p>å¤šæ€æƒ…å†µä¸‹ï¼Œå­çˆ¶ç±»å­˜åœ¨åŒåçš„æˆå‘˜å˜é‡æ—¶ï¼Œè®¿é—®çš„æ˜¯çˆ¶ç±»çš„æˆå‘˜å˜é‡ã€‚</p></li><li><p>å¤šæ€æƒ…å†µä¸‹ï¼Œå­çˆ¶ç±»å­˜åœ¨åŒåçš„éé™æ€çš„æˆå‘˜å‡½æ•°æ—¶ï¼Œè®¿é—®çš„æ˜¯å­ç±»çš„æˆå‘˜å‡½æ•°ã€‚</p></li><li><p>å¤šæ€æƒ…å†µä¸‹ï¼Œå­çˆ¶ç±»å­˜åœ¨åŒåçš„é™æ€çš„æˆå‘˜å‡½æ•°æ—¶ï¼Œè®¿é—®çš„æ˜¯çˆ¶ç±»çš„æˆå‘˜å‡½æ•°ã€‚</p></li><li><p>å¤šæ€æƒ…å†µä¸‹ï¼Œä¸èƒ½è®¿é—®å­ç±»ç‰¹æœ‰çš„æˆå‘˜ã€‚</p></li></ol><p>æ€»ç»“: å¤šæ€æƒ…å†µä¸‹ï¼Œå­çˆ¶ç±»å­˜åœ¨åŒåçš„æˆå‘˜æ—¶ï¼Œè®¿é—®çš„éƒ½æ˜¯çˆ¶ç±»çš„æˆå‘˜ï¼Œé™¤äº†åœ¨åŒåéé™æ€å‡½æ•°æ—¶æ‰æ˜¯è®¿é—®å­ç±»çš„ã€‚</p><p>æ³¨æ„ï¼šjavaç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥å¼•ç”¨ç±»å‹å˜é‡æ‰€å±çš„ç±»æ˜¯å¦å…·å¤‡æŒ‡å®šçš„æˆå‘˜ï¼Œå¦‚æœä¸å…·å¤‡é©¬ä¸Šç¼–è¯‘æŠ¥é”™ã€‚ï¼ˆç¼–è¯‘çœ‹å·¦è¾¹ï¼‰</p><h2 id="3-3-3-å¤šæ€çš„åº”ç”¨"><a href="#3-3-3-å¤šæ€çš„åº”ç”¨" class="headerlink" title="3.3.3 å¤šæ€çš„åº”ç”¨"></a>3.3.3 å¤šæ€çš„åº”ç”¨</h2><ol><li><p>å¤šæ€ç”¨äºå½¢å‚ç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥æ¥æ”¶æ›´å¤šç±»å‹çš„æ•°æ®ã€‚</p></li><li><p>å¤šæ€ç”¨äºè¿”å›å€¼ç±»å‹çš„æ—¶å€™ï¼Œå¯ä»¥è¿”å›æ›´å¤šç±»å‹çš„æ•°æ®ã€‚</p></li></ol><p>å¤šæ€çš„å¥½å¤„ï¼šæé«˜äº†ä»£ç çš„æ‹“ å±•æ€§ã€‚</p><p>æˆ‘ä»¬æƒ³æƒ³ï¼Œå¹³æ—¶å†™MVCä¸‰å±‚æ¨¡å‹çš„æ—¶å€™ï¼Œserviceä¸ºä»€ä¹ˆè¦å†™æ¥å£å‘¢ï¼Ÿå› ä¸ºå¯èƒ½æœ‰ä¸ªserviceä¼šæœ‰å¤šç§ä¸åŒçš„å®ç°ã€‚serviceå°±æ˜¯æˆ‘ä»¬å¹³æ—¶ç”¨å¤šæ€æœ€å¤šçš„åœ°æ–¹ã€‚</p><h1 id="4-Java-ä¸­çš„-String-è¯¦è§£"><a href="#4-Java-ä¸­çš„-String-è¯¦è§£" class="headerlink" title="4. Java ä¸­çš„ String è¯¦è§£"></a>4. Java ä¸­çš„ String è¯¦è§£</h1><h2 id="4-1-çœ‹çœ‹æºç "><a href="#4-1-çœ‹çœ‹æºç " class="headerlink" title="4.1 çœ‹çœ‹æºç "></a>4.1 çœ‹çœ‹æºç </h2><p>å¤§å®¶éƒ½çŸ¥é“ï¼ŒString è¢«å£°æ˜ä¸º finalï¼Œå› æ­¤å®ƒä¸å¯è¢«ç»§æ‰¿ã€‚(Integer ç­‰åŒ…è£…ç±»ä¹Ÿä¸èƒ½è¢«ç»§æ‰¿) ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ String çš„æºç ã€‚</p><p>åœ¨ Java 8 ä¸­ï¼ŒString å†…éƒ¨ä½¿ç”¨ char æ•°ç»„å­˜å‚¨æ•°æ®ã€‚</p><p>public final class string</p><p>implements java.io.serializable, Comparable<String>, Charsequence {</p><p>&#x2F;** The value is used for character storage. *&#x2F;</p><p>private final char value[];</p><p>}</p><p>åœ¨ Java 9 ä¹‹åï¼ŒString ç±»çš„å®ç°æ”¹ç”¨ byte æ•°ç»„å­˜å‚¨å­—ç¬¦ä¸²ï¼ŒåŒæ—¶ä½¿ç”¨ coder æ¥æ ‡è¯†ä½¿ç”¨äº†å“ªç§ç¼–ç ã€‚</p><p>public final class String</p><p>implements java.io.serializable, Comparable<String>, Charsequence {</p><p>&#x2F;** The value is used for character storage. *&#x2F;</p><p>private final byte[] value;</p><p>&#x2F;** The identifier of the encoding used to encode the bytes in {@code value}.</p><p>*&#x2F;</p><p>private final byte coder;</p><p>}</p><p>value æ•°ç»„è¢«å£°æ˜ä¸º finalï¼Œè¿™æ„å‘³ç€ value æ•°ç»„åˆå§‹åŒ–ä¹‹åå°±ä¸èƒ½å†å¼•ç”¨å…¶å®ƒæ•°ç»„ã€‚å¹¶ä¸” String å†…éƒ¨æ²¡æœ‰æ”¹å˜ value æ•°ç»„çš„æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯ String ä¸å¯å˜ã€‚</p><h2 id="4-2-ä¸å¯å˜æœ‰ä»€ä¹ˆå¥½å¤„å‘¢"><a href="#4-2-ä¸å¯å˜æœ‰ä»€ä¹ˆå¥½å¤„å‘¢" class="headerlink" title="4.2 ä¸å¯å˜æœ‰ä»€ä¹ˆå¥½å¤„å‘¢"></a>4.2 ä¸å¯å˜æœ‰ä»€ä¹ˆå¥½å¤„å‘¢</h2><h2 id="4-2-1-å¯ä»¥ç¼“å­˜-hash-å€¼"><a href="#4-2-1-å¯ä»¥ç¼“å­˜-hash-å€¼" class="headerlink" title="4.2.1 å¯ä»¥ç¼“å­˜ hash å€¼"></a>4.2.1 å¯ä»¥ç¼“å­˜ hash å€¼</h2><p>å› ä¸º String çš„ hash å€¼ç»å¸¸è¢«ä½¿ç”¨ï¼Œä¾‹å¦‚ String ç”¨åš HashMap çš„ keyã€‚ä¸å¯å˜çš„ç‰¹æ€§å¯ä»¥ä½¿å¾— hash å€¼ä¹Ÿä¸å¯å˜ï¼Œå› æ­¤åªéœ€è¦è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚</p><h2 id="4-2-2-String-Pool-çš„ä½¿ç”¨"><a href="#4-2-2-String-Pool-çš„ä½¿ç”¨" class="headerlink" title="4.2.2 String Pool çš„ä½¿ç”¨"></a>4.2.2 String Pool çš„ä½¿ç”¨</h2><p>å¦‚æœä¸€ä¸ª String å¯¹è±¡å·²ç»è¢«åˆ›å»ºè¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¼šä» String Pool ä¸­å–å¾—å¼•ç”¨ã€‚åªæœ‰ String æ˜¯ä¸å¯å˜çš„ï¼Œ æ‰å¯èƒ½ä½¿ç”¨ String Poolã€‚</p><h2 id="4-2-3-å®‰å…¨æ€§"><a href="#4-2-3-å®‰å…¨æ€§" class="headerlink" title="4.2.3 å®‰å…¨æ€§"></a>4.2.3 å®‰å…¨æ€§</h2><p>String ç»å¸¸ä½œä¸ºå‚æ•°ï¼ŒString ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å‚æ•°ä¸å¯å˜ã€‚ä¾‹å¦‚åœ¨ä½œä¸ºç½‘ç»œè¿æ¥å‚æ•°çš„æƒ…å†µä¸‹å¦‚æœ String æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆåœ¨ç½‘ç»œè¿æ¥è¿‡ç¨‹ä¸­ï¼ŒString è¢«æ”¹å˜ï¼Œæ”¹å˜ String çš„é‚£ä¸€æ–¹ä»¥ä¸ºç°åœ¨è¿æ¥çš„æ˜¯å…¶å®ƒä¸»æœºï¼Œè€Œå®é™…æƒ…å†µå´ä¸ä¸€å®šæ˜¯ã€‚</p><h2 id="4-2-4-çº¿ç¨‹å®‰å…¨"><a href="#4-2-4-çº¿ç¨‹å®‰å…¨" class="headerlink" title="4.2.4 çº¿ç¨‹å®‰å…¨"></a>4.2.4 çº¿ç¨‹å®‰å…¨</h2><p>String ä¸å¯å˜æ€§å¤©ç”Ÿå…·å¤‡çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®‰å…¨åœ°ä½¿ç”¨ã€‚</p><h2 id="4-3-å†æ¥æ·±å…¥äº†è§£ä¸€ä¸‹-String"><a href="#4-3-å†æ¥æ·±å…¥äº†è§£ä¸€ä¸‹-String" class="headerlink" title="4.3 å†æ¥æ·±å…¥äº†è§£ä¸€ä¸‹ String"></a>4.3 å†æ¥æ·±å…¥äº†è§£ä¸€ä¸‹ String</h2><h2 id="4-3-1-â€œ-â€-è¿æ¥ç¬¦"><a href="#4-3-1-â€œ-â€-è¿æ¥ç¬¦" class="headerlink" title="4.3.1 â€œ+â€ è¿æ¥ç¬¦"></a>4.3.1 â€œ+â€ è¿æ¥ç¬¦</h2><p>å­—ç¬¦ä¸²å¯¹è±¡å¯ä»¥ä½¿ç”¨â€œ+â€è¿æ¥å…¶ä»–å¯¹è±¡ï¼Œå…¶ä¸­å­—ç¬¦ä¸²è¿æ¥æ˜¯é€šè¿‡ StringBuilderï¼ˆæˆ– StringBufferï¼‰ç±»åŠå…¶ append æ–¹æ³•å®ç°çš„ï¼Œå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ˜¯é€šè¿‡ toString æ–¹æ³•å®ç°çš„ã€‚å¯ä»¥é€šè¿‡åç¼–è¯‘éªŒè¯ä¸€ä¸‹:</p><hr><p>&#x2F;**</p><ul><li>æµ‹è¯•ä»£ç </li></ul><p>*&#x2F;</p><p>public class Test {</p><p>public static void main(String[] args) {</p><p>int ( i &#x3D; {10} ) ;</p><p>String ( s &#x3D; ) â€œabcâ€;</p><p>System.out.println(s + i);</p><p>}</p><p>}</p><p>&#x2F;**</p><ul><li>åç¼–è¯‘å</li></ul><p>*&#x2F;</p><p>public class Test {</p><p>public static void main(String args[]) { &#x2F;&#x2F;åˆ é™¤äº†é»˜è®¤æ„é€ å‡½æ•°å’Œå­—èŠ‚ç </p><p>byte byte0 ( &#x3D; {10} ) ;</p><p>String ( s &#x3D; ) â€œabcâ€;</p><p>System.out.println((new</p><p>StringBuilder()).append(s).append(byte0).toString());</p><p>}</p><p>}</p><hr><p>ç”±ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒJavaä¸­ä½¿ç”¨â€+â€è¿æ¥å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªStringBuilder()å¯¹è±¡ï¼Œå¹¶è°ƒç”¨append()æ–¹æ³•å°†æ•°æ®æ‹¼æ¥ï¼Œæœ€åè°ƒç”¨toString()æ–¹æ³•è¿”å›æ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²ã€‚é‚£è¿™ä¸ª â€œ+â€ çš„æ•ˆç‡æ€ä¹ˆæ ·å‘¢?</p><h2 id="4-3-2-â€œ-â€è¿æ¥ç¬¦çš„æ•ˆç‡"><a href="#4-3-2-â€œ-â€è¿æ¥ç¬¦çš„æ•ˆç‡" class="headerlink" title="4.3.2 â€œ+â€è¿æ¥ç¬¦çš„æ•ˆç‡"></a>4.3.2 â€œ+â€è¿æ¥ç¬¦çš„æ•ˆç‡</h2><p>ä½¿ç”¨â€œ+â€è¿æ¥ç¬¦æ—¶ï¼ŒJVMä¼šéšå¼åˆ›å»ºStringBuilderå¯¹è±¡ï¼Œè¿™ç§æ–¹å¼åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¹¶ä¸ä¼šé€ æˆæ•ˆç‡çš„æŸå¤±ï¼Œä¸è¿‡åœ¨è¿›è¡Œå¤§é‡å¾ªç¯æ‹¼æ¥å­—ç¬¦ä¸²æ—¶åˆ™éœ€è¦æ³¨æ„ã€‚æ¯”å¦‚ï¼š</p><p>String ( s &#x3D; ) â€œabcâ€;</p><p>for (int i&#x3D;0; i&lt;10000; i++) {</p><p>( \mathrm{s} + &#x3D; ) â€œabcâ€;</p><p>}</p><p>è¿™æ ·ç”±äºå¤§é‡StringBuilderåˆ›å»ºåœ¨å †å†…å­˜ä¸­ï¼Œè‚¯å®šä¼šé€ æˆæ•ˆç‡çš„æŸå¤±ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹å»ºè®®åœ¨å¾ªç¯ä½“å¤–åˆ›å»ºä¸€ä¸ªStringBuilderå¯¹è±¡è°ƒç”¨append()æ–¹æ³•æ‰‹åŠ¨æ‹¼æ¥ï¼ˆå¦‚ä¸Šé¢ä¾‹å­å¦‚æœä½¿ç”¨æ‰‹åŠ¨æ‹¼æ¥è¿è¡Œæ—¶é—´å°†ç¼©å°åˆ°1&#x2F;200å·¦å³ï¼‰ã€‚</p><p>ä¸æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œä¹Ÿå°±æ˜¯å½“â€+â€ä¸¤ç«¯å‡ä¸ºç¼–è¯‘æœŸç¡®å®šçš„å­—ç¬¦ä¸²å¸¸é‡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè¿›è¡Œç›¸åº”çš„ä¼˜åŒ–ï¼Œç›´æ¥å°†ä¸¤ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ‹¼æ¥å¥½ï¼Œä¾‹å¦‚:</p><p>System.out.println(â€œHelloâ€ + â€œworldâ€);</p><p>&#x2F;**</p><ul><li>åç¼–è¯‘å</li></ul><p>*&#x2F;</p><p>System.out.println(â€œHelloworldâ€);</p><h2 id="4-4-å­—ç¬¦ä¸²å¸¸é‡"><a href="#4-4-å­—ç¬¦ä¸²å¸¸é‡" class="headerlink" title="4.4 å­—ç¬¦ä¸²å¸¸é‡"></a>4.4 å­—ç¬¦ä¸²å¸¸é‡</h2><p>JVMä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜çš„å¼€é”€ï¼Œåœ¨å®ä¾‹åŒ–å­—ç¬¦ä¸²çš„æ—¶å€™è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼šä½¿ç”¨å­—ç¬¦ä¸²å¸¸é‡æ± ã€‚æ¯å½“åˆ›å»ºå­—ç¬¦ä¸²å¸¸é‡æ—¶ï¼ŒJVMä¼šé¦–å…ˆæ£€æŸ¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²å·²ç»å­˜åœ¨å¸¸é‡æ± ä¸­ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›å¸¸é‡æ± ä¸­çš„å®ä¾‹å¼•ç”¨ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸å­˜åœ¨å¸¸é‡æ± ä¸­ï¼Œå°±ä¼šå®ä¾‹åŒ–è¯¥å­—ç¬¦ä¸²å¹¶ä¸”å°†å…¶æ”¾åˆ°å¸¸é‡æ± ä¸­ã€‚ç”±äº Stringå­—ç¬¦ä¸²çš„ä¸å¯å˜æ€§ï¼Œå¸¸é‡æ± ä¸­ä¸€å®šä¸å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ã€‚</p><p><img src="/../img/java/3.jpg" alt="3"></p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­:</p><p>&#x2F;**</p><ul><li>è¿è¡Œç»“æœä¸ºtrue false</li></ul><p>*&#x2F;</p><p>String ( {s1} &#x3D; ) â€œabcâ€;</p><p>string ( {s2} &#x3D; ) â€œabcâ€;</p><p>String ( {s3} &#x3D; ) new String(â€œabcâ€);</p><p>System.out.println(s1 &#x3D;&#x3D; s2);</p><p>System.out.println(s1 &#x3D;&#x3D; s3);</p><p>ç”±äºå¸¸é‡æ± ä¸­ä¸å­˜åœ¨ä¸¤ä¸ªç›¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥s1å’Œs2éƒ½æ˜¯æŒ‡å‘JVMå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„â€ABâ€å¯¹è±¡ã€‚newå…³é”®å­—ä¸€å®šä¼šäº§ç”Ÿä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡å­˜å‚¨åœ¨å †ä¸­ã€‚æ‰€ä»¥string s3 &#x3D; new string(â€œABâ€); äº§ç”Ÿäº†ä¸¤ä¸ªå¯¹è±¡ï¼šä¿å­˜åœ¨æ ˆä¸­çš„s3å’Œä¿å­˜å †ä¸­çš„Stringå¯¹è±¡ã€‚</p><h1 id="5-StringBuffer-å’Œ-StringBuilder-è¯¦è§£"><a href="#5-StringBuffer-å’Œ-StringBuilder-è¯¦è§£" class="headerlink" title="5. StringBuffer å’Œ StringBuilder è¯¦è§£"></a>5. StringBuffer å’Œ StringBuilder è¯¦è§£</h1><p>StringBuilder å’Œ StringBuffer çš„é—®é¢˜å·²ç»æ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜æœ‰é‚£ä¹ˆå¤šé¢è¯•å®˜å–œæ¬¢é—®è¿™ä¸ªé—®é¢˜å‘¢? ä¸çŸ¥é“ï¼Œæˆ‘è§‰å¾—æ˜¯é¢è¯•å®˜å¤ªlowäº†â€¦â€¦</p><p>ä¸è¿‡æˆ‘ä¹Ÿæ¥æŠŠè¿™ä¸ªçŸ¥è¯†ç‚¹ç»™å¤§å®¶æ€»ç»“ä¸€ä¸‹ï¼Œå…ˆè¯´è¯´ä»–ä»¬çš„ç›¸åŒç‚¹ã€‚</p><h2 id="5-1-ç›¸åŒç‚¹"><a href="#5-1-ç›¸åŒç‚¹" class="headerlink" title="5.1 ç›¸åŒç‚¹"></a>5.1 ç›¸åŒç‚¹</h2><p>è¯´åˆ°è¿™å•ï¼Œæˆ‘åˆå¿ä¸ä½è¦è·Ÿå¤§å®¶å” å¨å” å¨ String äº†ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ String çš„ä¸€ä¸ªä¾‹å­:</p><p>String a &#x3D; â€œ123â€;</p><p>a ( &#x3D; ) â€œ456â€;</p><p>&#x2F;&#x2F; æ‰“å°å‡ºæ¥çš„aä¸º456</p><p>System.out.println(a)</p><p>ä¸æ˜¯è¯´ String æ˜¯ä¸å¯æ”¹å˜çš„å—? è¿™æ€ä¹ˆå°±å˜äº†å‘¢? é€—æˆ‘å—? å…¶å®æ˜¯æ²¡å˜çš„ï¼ŒåŸæ¥é‚£ä¸ª 123 æ²¡å˜ï¼Œç›¸å½“äºé‡æ–°åˆ›å»ºäº†ä¸€ä¸ª 456ï¼Œç„¶åæŠŠ a æŒ‡å‘äº†è¿™ä¸ª 456ï¼Œé‚£ä¸ª 123 ä¼šè¢«å›æ”¶æ‰ã€‚çœ‹çœ‹æˆ‘ç»™å¤§å®¶ç”»çš„å›¾ï¼š</p><p><img src="/../img/java/4.jpg" alt="4"></p><p>è€Œ StringBuffer å’Œ StringBuilder å°±ä¸ä¸€æ ·äº†ï¼Œä»–ä»¬æ˜¯å¯å˜çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºä»¥åï¼Œé€šè¿‡ append()ã€insert()ã€reverse()ã€setcharAt()ã€setLength()ç­‰æ–¹æ³•å¯ä»¥æ”¹å˜è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</p><p>çš„å­—ç¬¦åºåˆ—ã€‚ä¹Ÿæ¥çœ‹ä¸ªä¾‹å­:</p><p>StringBuffer ( b &#x3D; ) new StringBuffer(â€œ123â€);</p><p>b.append(â€œ456â€);</p><p>&#x2F;&#x2F; bæ‰“å°ç»“æœä¸º: 123456</p><p>System.out.println(b);</p><p><img src="/../img/java/5.jpg" alt="5"></p><p>OKï¼Œé‚£ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼ŒStringBuffer å’Œ StringBuilder æœ‰ä¸ªå…±åŒç‚¹ï¼Œé‚£å°±æ˜¯å®ƒä»¬ä»£è¡¨ä¸€ä¸ªå­—ç¬¦å¯å˜çš„å­—ç¬¦ä¸²ã€‚é‚£é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–ç›¸åŒç‚¹å‘¢?</p><p>è‚¯å®šæ˜¯æœ‰çš„ï¼Œæ¯”å¦‚:</p><ol><li><p>StringBuilder ä¸ StringBuffer æœ‰å…¬å…±çˆ¶ç±» AbstractStringBuilder (æŠ½è±¡ç±»);</p></li><li><p>StringBuilderã€StringBuffer çš„æ–¹æ³•éƒ½ä¼šè°ƒç”¨ AbstractStringBuilder ä¸­çš„å…¬å…±æ–¹æ³•ï¼Œå¦‚ super.append(â€¦)ã€‚</p></li></ol><h2 id="5-2-ä¸åŒç‚¹"><a href="#5-2-ä¸åŒç‚¹" class="headerlink" title="5.2 ä¸åŒç‚¹"></a>5.2 ä¸åŒç‚¹</h2><p>StringBuffer æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒStringBuilder æ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚æˆ‘ä»¬çœ‹æºç éƒ½çŸ¥é“ï¼ŒStringBuffer çš„æ–¹æ³•ä¸Šé¢éƒ½åŠ äº† synchronized å…³é”®å­—ï¼Œæ‰€ä»¥æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½ä¼šå—å½±å“ï¼Œæ‰€ä»¥ StringBuilder ä¼šæ¯” StringBuffer å¿«ï¼Œåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå»ºè®®ä½¿ç”¨ StringBuilderã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸ªä¸åŒç‚¹æ˜¯ç¼“å†²åŒºã€‚</p><p>å…ˆçœ‹ä¸‹ StringBuilder çš„ tostring() æ–¹æ³•:</p><p>@override</p><p>public string toString() {</p><p>&#x2F;&#x2F; Create a copy, donâ€™t share the array</p><p>return new String(value, 0, count);</p><p>}</p><p>å†çœ‹ä¸‹ StringBuffer çš„ tostring () æ–¹æ³•:</p><p>@override</p><p>public synchronized String toString() {</p><p>if (tostringCache ( &#x3D; &#x3D; ) null) {</p><p>toStringCache ( &#x3D; ) Arrays.copyOfRange(value, 0, count);</p><p>}</p><p>return new String(toStringCache, true);</p><p>}</p><p>å¯ä»¥çœ‹å‡ºï¼šStringBuffer æ¯æ¬¡è·å– toString éƒ½ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜åŒºçš„ toStringCache å€¼æ¥æ„é€ ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è€Œ StringBuilder åˆ™æ¯æ¬¡éƒ½éœ€è¦å¤åˆ¶ä¸€æ¬¡å­—ç¬¦æ•°ç»„ï¼Œå†æ„é€ ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>æ‰€ä»¥ï¼ŒStringBuffer å¯¹ç¼“å­˜åŒºä¼˜åŒ–ï¼Œä¸è¿‡ StringBuffer çš„è¿™ä¸ªtoString æ–¹æ³•ä»ç„¶æ˜¯åŒæ­¥çš„ã€‚</p><p>OKï¼ŒStringBuffer å’Œ StringBuilder å°±æ€»ç»“è¿™ä¹ˆå¤šå§ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚</p><h1 id="6-Java-åå°„è¯¦è§£"><a href="#6-Java-åå°„è¯¦è§£" class="headerlink" title="6. Java åå°„è¯¦è§£"></a>6. Java åå°„è¯¦è§£</h1><p>åå°„æ˜¯æ¡†æ¶è®¾è®¡çš„çµé­‚è¦ç´ ï¼</p><h2 id="6-1-åå°„æ˜¯ä»€ä¹ˆ"><a href="#6-1-åå°„æ˜¯ä»€ä¹ˆ" class="headerlink" title="6.1 åå°„æ˜¯ä»€ä¹ˆ?"></a>6.1 åå°„æ˜¯ä»€ä¹ˆ?</h2><p>æ‰€è°“çš„åå°„å°±æ˜¯javaè¯­è¨€åœ¨è¿è¡Œæ—¶æ‹¥æœ‰çš„ä¸€ç§è‡ªè§‚çš„èƒ½åŠ›,åå°„ä½¿æ‚¨çš„ç¨‹åºä»£ç èƒ½å¤Ÿå¾—åˆ°è£…è½½åˆ°VMä¸­çš„ç±»çš„å†…éƒ¨ä¿¡æ¯,å…è®¸æ‚¨æ‰§è¡Œç¨‹åºæ—¶æ‰å¾—åˆ°éœ€è¦ç±»çš„å†…éƒ¨ä¿¡æ¯ï¼Œè€Œä¸æ˜¯åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å°±å¿…é¡»è¦çŸ¥é“æ‰€éœ€ç±»çš„å†…éƒ¨ä¿¡æ¯;ä¹Ÿå¯ä»¥é€šä¿—çš„å°†è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ç§°ä¸ºJavaçš„åå°„æœºåˆ¶.</p><p>é€šè¿‡Javaçš„åå°„æœºåˆ¶,ç¨‹åºçŒ¿ä»¬å¯ä»¥æ›´æ·±å…¥çš„æ§åˆ¶ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹,å¦‚åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯è¿›è¡ŒéªŒè¯,è¿˜å¯ä»¥é€†å‘æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œè¿™ä¹Ÿä½¿åå°„æˆä¸ºæ„å»ºçµæ´»çš„åº”ç”¨çš„ä¸»è¦å·¥å…·ã€‚</p><h2 id="6-2-åå°„åŸç†å¤§è§£æ"><a href="#6-2-åå°„åŸç†å¤§è§£æ" class="headerlink" title="6.2 åå°„åŸç†å¤§è§£æ"></a>6.2 åå°„åŸç†å¤§è§£æ</h2><h2 id="6-2-1-åå°„çš„å¸¸ç”¨ç±»å’Œå‡½æ•°"><a href="#6-2-1-åå°„çš„å¸¸ç”¨ç±»å’Œå‡½æ•°" class="headerlink" title="6.2.1 åå°„çš„å¸¸ç”¨ç±»å’Œå‡½æ•°"></a>6.2.1 åå°„çš„å¸¸ç”¨ç±»å’Œå‡½æ•°</h2><p>Javaåå°„æœºåˆ¶çš„å®ç°è¦å€ŸåŠ©äº4ä¸ªç±»:</p><ul><li><p>Class ç±»å¯¹è±¡</p></li><li><p>Constructor ç±»çš„æ„é€ å™¨å¯¹è±¡</p></li><li><p>Field ç±»çš„å±æ€§å¯¹è±¡</p></li><li><p>Method ç±»çš„æ–¹æ³•å¯¹è±¡</p></li></ul><h2 id="6-2-2-Class-ç±»åŒ…å«çš„æ–¹æ³•"><a href="#6-2-2-Class-ç±»åŒ…å«çš„æ–¹æ³•" class="headerlink" title="6.2.2 Class ç±»åŒ…å«çš„æ–¹æ³•"></a>6.2.2 Class ç±»åŒ…å«çš„æ–¹æ³•</h2><p>é€šè¿‡è¿™å››ä¸ªå¯¹è±¡æˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„çœ‹åˆ°ä¸€ä¸ªç±»çš„å„ä¸ªç»„æˆéƒ¨åˆ†ã€‚å…¶ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯Classç±»ï¼Œå®ƒæ˜¯å®ç°åå°„çš„åŸºç¡€ï¼ŒClassç±»åŒ…å«çš„æ–¹æ³•ä¸»è¦æœ‰:</p><table><thead><tr><th>åºå·</th><th>åç§°</th><th>åŠŸèƒ½</th></tr></thead><tr><td>1</td><td>getName()</td><td>è·å–æ­¤ç±»å‹çš„å…¨é™å®šå</td></tr><tr><td>2</td><td>getSuperClass()</td><td>å¾—åˆ°æ­¤ç±»å‹çš„ç›´æ¥è¶…ç±»çš„å…¨é™å®šå</td></tr><tr><td>3</td><td>isInterface()</td><td>åˆ¤æ–­æ­¤ç±»å‹æ˜¯ç±»ç±»å‹è¿˜æ˜¯æ¥å£ç±»å‹</td></tr><tr><td>4</td><td>getTypeParamters()</td><td>è·å–è¿™ä¸ªç±»å‹çš„è®¿é—®ä¿®é¥°ç¬¦</td></tr><tr><td>5</td><td>getInterfaces()</td><td>è·å–ä»»ä½•ç›´æ¥è¶…æ¥å£çš„å…¨é™å®šåçš„æœ‰åºåˆ—è¡¨</td></tr><tr><td>6</td><td>getFields()</td><td>è·å–å­—æ®µä¿¡æ¯</td></tr><tr><td>7</td><td>getMethods()</td><td>è·å–æ–¹æ³•ä¿¡æ¯</td></tr></table><h2 id="6-2-3-åå°„çš„ä¸»è¦æ–¹æ³•"><a href="#6-2-3-åå°„çš„ä¸»è¦æ–¹æ³•" class="headerlink" title="6.2.3 åå°„çš„ä¸»è¦æ–¹æ³•"></a>6.2.3 åå°„çš„ä¸»è¦æ–¹æ³•</h2><p>åº”ç”¨åå°„æ—¶æˆ‘ä»¬æœ€å…³å¿ƒçš„ä¸€èˆ¬æ˜¯ä¸€ä¸ªç±»çš„æ„é€ å™¨ã€å±æ€§å’Œæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬ä¸»è¦ä»‹ç»Classç±»ä¸­é’ˆå¯¹è¿™ä¸‰ä¸ªå…ƒç´ çš„æ–¹æ³•:</p><h2 id="6-2-3-1-å¾—åˆ°æ„é€ å™¨çš„æ–¹æ³•"><a href="#6-2-3-1-å¾—åˆ°æ„é€ å™¨çš„æ–¹æ³•" class="headerlink" title="6.2.3.1 å¾—åˆ°æ„é€ å™¨çš„æ–¹æ³•"></a>6.2.3.1 å¾—åˆ°æ„é€ å™¨çš„æ–¹æ³•</h2><table><thead><tr><th>è¯­æ³•</th><th>åŠŸèƒ½</th></tr></thead><tr><td>Constructor getConstructor(Class[] params)</td><td>è·å¾—ä½¿ç”¨ç‰¹æ®Šçš„å‚æ•°ç±»å‹çš„å…¬å…±æ„é€ å‡½æ•°</td></tr><tr><td>Constructor[] getConstructors()</td><td>è·å¾—ç±»çš„æ‰€æœ‰å…¬å…±æ„é€ å‡½æ•°</td></tr><tr><td>Constructor getDeclaredConstructor(Class[] params)</td><td>è·å¾—ä½¿ç”¨ç‰¹å®šå‚æ•°ç±»å‹çš„æ„é€ å‡½æ•°(ä¸æ¥å…¥ çº§åˆ«æ— å…³ï¼‰</td></tr><tr><td>Constructor[] getDeclaredConstructors()</td><td>è·å¾—ç±»çš„æ‰€æœ‰æ„é€ å‡½æ•°(ä¸æ¥å…¥çº§åˆ«æ— å…³)</td></tr></table><h2 id="6-2-3-2-è·å¾—å­—æ®µä¿¡æ¯çš„æ–¹æ³•"><a href="#6-2-3-2-è·å¾—å­—æ®µä¿¡æ¯çš„æ–¹æ³•" class="headerlink" title="6.2.3.2 è·å¾—å­—æ®µä¿¡æ¯çš„æ–¹æ³•"></a>6.2.3.2 è·å¾—å­—æ®µä¿¡æ¯çš„æ–¹æ³•</h2><table><thead><tr><th>è¯­æ³•</th><th>åŠŸèƒ½</th></tr></thead><tr><td>Field getField(String name)</td><td>è·å¾—å‘½åçš„å…¬å…±å­—æ®µ</td></tr><tr><td>Field[] getFields()</td><td>è·å¾—ç±»çš„æ‰€æœ‰å…¬å…±å­—æ®µ</td></tr><tr><td>Field getDeclaredField(String name)</td><td>è·å¾—ç±»å£°æ˜çš„å‘½åçš„å­—æ®µ</td></tr><tr><td>Field[] getDeclaredFields()</td><td>è·å¾—ç±»å£°æ˜çš„æ‰€æœ‰å­—æ®µ</td></tr></table><h2 id="6-2-3-3-è·å¾—æ–¹æ³•ä¿¡æ¯çš„æ–¹æ³•"><a href="#6-2-3-3-è·å¾—æ–¹æ³•ä¿¡æ¯çš„æ–¹æ³•" class="headerlink" title="6.2.3.3 è·å¾—æ–¹æ³•ä¿¡æ¯çš„æ–¹æ³•"></a>6.2.3.3 è·å¾—æ–¹æ³•ä¿¡æ¯çš„æ–¹æ³•</h2><table><thead><tr><th>è¯­æ³•</th><th>åŠŸèƒ½</th></tr></thead><tr><td>Method getMethod(String name, Class[] params)</td><td>ä½¿ç”¨ç‰¹å®šçš„å‚æ•°ç±»å‹ï¼Œè·å¾—å‘½åçš„å…¬å…± æ–¹æ³•</td></tr><tr><td>Method[] getMethods()</td><td>è·å¾—ç±»çš„æ‰€æœ‰å…¬å…±æ–¹æ³•</td></tr><tr><td>Method getDeclaredMethod(String name, Class[] params)</td><td>ä½¿ç”¨ç‰¹å†™çš„å‚æ•°ç±»å‹ï¼Œè·å¾—ç±»å£°æ˜çš„å‘½ åçš„æ–¹æ³•</td></tr><tr><td>Method[] getDeclaredMethods()</td><td>è·å¾—ç±»å£°æ˜çš„æ‰€æœ‰æ–¹æ³•</td></tr></table><h2 id="6-2-4-åå°„å®æˆ˜çš„åŸºæœ¬æ­¥éª¤"><a href="#6-2-4-åå°„å®æˆ˜çš„åŸºæœ¬æ­¥éª¤" class="headerlink" title="6.2.4 åå°„å®æˆ˜çš„åŸºæœ¬æ­¥éª¤"></a>6.2.4 åå°„å®æˆ˜çš„åŸºæœ¬æ­¥éª¤</h2><p>Class actionClass&#x3D;Class.forName(â€œMyClassâ€);</p><p>Object action&#x3D;actionClass.newInstance();</p><p>Method method ( &#x3D; ) actionClass.getMethod(â€œmyMethodâ€, null);</p><p>method.invoke(action, null);</p><p>ä¸Šé¢å°±æ˜¯æœ€å¸¸è§çš„åå°„ä½¿ç”¨çš„ä¾‹å­ï¼Œå‰ä¸¤è¡Œå®ç°äº†ç±»çš„è£…è½½ã€é“¾æ¥å’Œåˆå§‹åŒ–ï¼ˆnewInstanceæ–¹æ³•å®é™…ä¸Šä¹Ÿæ˜¯ä½¿ç”¨åå°„è°ƒç”¨äº†<init>æ–¹æ³•ï¼‰ï¼Œåä¸¤è¡Œå®ç°äº†ä»classå¯¹è±¡ä¸­è·å–åˆ°methodå¯¹è±¡ç„¶åæ‰§è¡Œåå°„è°ƒç”¨ã€‚ä¸‹é¢ç®€å•åˆ†æä¸€ä¸‹è¯¥ä»£ç çš„å…·ä½“åŸç†ã€‚</p><h2 id="6-2-4-1-è·å¾—ç±»çš„Classå¯¹è±¡"><a href="#6-2-4-1-è·å¾—ç±»çš„Classå¯¹è±¡" class="headerlink" title="6.2.4.1 è·å¾—ç±»çš„Classå¯¹è±¡"></a>6.2.4.1 è·å¾—ç±»çš„Classå¯¹è±¡</h2><p>é€šå¸¸æœ‰ä¸‰ç§ä¸åŒçš„æ–¹æ³•:</p><ol><li><p>Class ( \mathrm{c} &#x3D; ) Class.forName(â€œjava.lang.Stringâ€)</p></li><li><p>Class ( \mathrm{c} &#x3D; ) MyClass.class</p></li><li><p>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥ç”¨Class ( \mathrm{c} &#x3D; ) int.class æˆ– Class ( \mathrm{c} &#x3D; ) Integer.TYPEè¿™æ ·çš„è¯­å¥.</p></li></ol><p>ä¸¾ä¸ªå°æ —å­ï¼šå…ˆé€šè¿‡åå°„æœºåˆ¶å¾—åˆ°æŸä¸ªç±»çš„æ„é€ å™¨ï¼Œç„¶åè°ƒç”¨è¯¥æ„é€ å™¨åˆ›å»ºè¯¥ç±»çš„ä¸€ä¸ªå®ä¾‹</p><p>PSï¼šåå°„çš„åŸç†ä¹‹ä¸€å…¶å®å°±æ˜¯åŠ¨æ€çš„ç”Ÿæˆç±»ä¼¼äºä¸Šè¿°çš„å­—èŠ‚ç ï¼ŒåŠ è½½åˆ°jvmä¸­è¿è¡Œã€‚</p><p>è®¾æƒ³ä¸€ä¸‹ï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœæƒ³è¦å®ç° method. invoke (action, null) è°ƒç”¨actionå¯¹è±¡çš„ myMethod æ–¹æ³•,åªéœ€è¦å®ç°è¿™æ ·ä¸€ä¸ªMethodç±»å³å¯:</p><p>class Method{</p><p>public Object invoke(Object obj, Object[] param){</p><p>MyClass myClass&#x3D;(MyClass)obj;</p><p>return myClass.myMethod();</p><p>}</p><p>}</p><h2 id="6-2-4-2-è·å–-Method-å¯¹è±¡"><a href="#6-2-4-2-è·å–-Method-å¯¹è±¡" class="headerlink" title="6.2.4.2 è·å– Method å¯¹è±¡"></a>6.2.4.2 è·å– Method å¯¹è±¡</h2><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹Methodå¯¹è±¡æ˜¯å¦‚ä½•ç”Ÿæˆçš„:</p><ul><li><p>ä½¿ç”¨Method m &#x3D;myclass.getMethod(â€œmyMethodâ€)è·å¾—äº†ä¸€ä¸ªClasså¯¹è±¡</p></li><li><p>æ¥ç€å¯¹å…¶è¿›è¡Œåˆ¤æ–­,å¦‚æœæ²¡æœ‰å¯¹åº”çš„cache,é‚£ä¹ˆJVMå°±ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªå¹¶æ”¾å…¥ç¼“å†²ç©ºé—´</p></li><li><p>å¤„ç†å™¨å†åˆ¤æ–­Cacheä¸­æ˜¯å¦å­˜åœ¨â€myMethodâ€</p></li><li><p>å¦‚æœæ²¡æœ‰åˆ™è¿”å›NoSuchMethodException</p></li><li><p>å¦‚æœå­˜åœ¨é‚£ä¹ˆå°±Copyä¸€ä»½â€myMethodâ€å¯¹è±¡å¹¶è¿”å›</p></li></ul><p>ä¸Šé¢çš„Classå¯¹è±¡æ˜¯åœ¨åŠ è½½ç±»æ—¶ç”±JVMæ„é€ çš„ï¼ŒJVMä¸ºæ¯ä¸ªç±»ç®¡ç†ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„Classå¯¹è±¡ï¼Œè¿™ä»½Classå¯¹è±¡é‡Œç»´æŠ¤ç€è¯¥ç±»çš„æ‰€æœ‰Methodï¼ŒFieldï¼ŒConstructorçš„cacheï¼Œè¿™ä»½cacheä¹Ÿå¯ä»¥è¢«ç§°ä½œæ ¹å¯¹è±¡ã€‚æ¯æ¬¡ getMethodè·å–åˆ°çš„Methodå¯¹è±¡éƒ½æŒæœ‰å¯¹æ ¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå› ä¸ºä¸€äº›é‡é‡çº§çš„Methodçš„æˆå‘˜å˜é‡ï¼ˆä¸»è¦æ˜¯MethodAccessorï¼‰ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ¯æ¬¡åˆ›å»ºMethodå¯¹è±¡éƒ½è¦é‡æ–°åˆå§‹åŒ–ï¼Œäºæ˜¯æ‰€æœ‰ä»£è¡¨åŒä¸€ä¸ªæ–¹æ³•çš„ Methodå¯¹è±¡éƒ½å…±äº«ç€æ ¹å¯¹è±¡çš„MethodAccessorï¼Œæ¯ä¸€æ¬¡åˆ›å»ºéƒ½ä¼šè°ƒç”¨æ ¹å¯¹è±¡çš„copyæ–¹æ³•å¤åˆ¶ä¸€ä»½ï¼š</p><p>Method copy() {</p><p>Method res &#x3D; new Method(clazz, name, parameterTypes, returnType,</p><p>exceptionTypes, modifiers, slot, signature,</p><p>annotations, parameterAnnotations,</p><p>annotationDefault);</p><p>res.root ( &#x3D; ) this;</p><p>res.methodAccessor ( &#x3D; ) methodAccessor;</p><p>return res;</p><h2 id="6-2-4-3-è°ƒç”¨invoke-æ–¹æ³•"><a href="#6-2-4-3-è°ƒç”¨invoke-æ–¹æ³•" class="headerlink" title="6.2.4.3 è°ƒç”¨invoke()æ–¹æ³•"></a>6.2.4.3 è°ƒç”¨invoke()æ–¹æ³•</h2><p>è·å–åˆ°Methodå¯¹è±¡ä¹‹åï¼Œè°ƒç”¨invokeæ–¹æ³•çš„æµç¨‹å¦‚ä¸‹:</p><p>m.invoke(obj, param);</p><ul><li><p>é¦–å…ˆè°ƒç”¨MethodAccess.invoke</p></li><li><p>å¦‚æœè¯¥æ–¹æ³•çš„ç´¯è®¡è°ƒç”¨æ¬¡æ•°&lt;&#x3D;15ï¼Œä¼šåˆ›å»ºå‡ºNativeMethodAccessorImp</p></li><li><p>å¦‚æœè¯¥æ–¹æ³•çš„ç´¯è®¡è°ƒç”¨æ¬¡æ•° ( &gt; {15} ) ï¼Œä¼šç”±javaä»£ç åˆ›å»ºå‡ºå­—èŠ‚ç ç»„è£…è€Œæˆçš„</p></li></ul><p>MethodAccessorImpl</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨Method.invokeä¹‹åï¼Œä¼šç›´æ¥å»è°ƒ MethodAccessor.invoke ã€‚MethodAccessorå°±æ˜¯ä¸Šé¢æåˆ°çš„æ‰€æœ‰åŒåmethodå…±äº«çš„ä¸€ä¸ªå®ä¾‹ï¼Œç”±ReflectionFactoryåˆ›å»ºã€‚åˆ›å»ºæœºåˆ¶é‡‡ç”¨äº†ä¸€ç§åä¸º inflationçš„æ–¹å¼ (JDK1.4ä¹‹å) : å¦‚æœè¯¥æ–¹æ³•çš„ç´¯è®¡è°ƒç”¨æ¬¡æ•°&lt;&#x3D;15, ä¼šåˆ›å»ºå‡º</p><p>NativeMethodAccessorImplï¼Œå®ƒçš„å®ç°å°±æ˜¯ç›´æ¥è°ƒç”¨nativeæ–¹æ³•å®ç°åå°„ï¼›å¦‚æœè¯¥æ–¹æ³•çš„ç´¯è®¡è°ƒç”¨æ¬¡æ•° &gt;15ï¼Œä¼šç”±javaä»£ç åˆ›å»ºå‡ºå­—èŠ‚ç ç»„è£…è€Œæˆçš„MethodAccessorImplã€‚ï¼ˆæ˜¯å¦é‡‡ç”¨inflationå’Œ15è¿™ä¸ªæ•°å­—éƒ½å¯ä»¥åœ¨jvmå‚æ•°ä¸­è°ƒæ•´)</p><p>ä»¥è°ƒç”¨ MyClass.myMethod(String s) ä¸ºä¾‹ï¼Œç”Ÿæˆå‡ºçš„MethodAccessorImplå­—èŠ‚ç ç¿»è¯‘æˆJavaä»£ç å¤§è‡´å¦‚ä¸‹:</p><p>public class GeneratedMethodAccessor1 extends MethodAccessorImpl {</p><p>public Object invoke(Object obj, Object[] args) throws Exception {</p><p>try ( { )</p><p>MyClass target ( &#x3D; ) (MyClass) obj;</p><p>String arg0 &#x3D; (String) args[0];</p><p>target.myMethod(arg0);</p><p>} catch (Throwable t) {</p><p>throw new InvocationTargetException(t);</p><p>}</p><p>}</p><p>}</p><p>é€šè¿‡å¯¹javaè¿è¡Œè¿‡ç¨‹çš„è¯¦ç»†åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å…¶ä¸­ç¬¬1æ¬¡å’Œç¬¬16æ¬¡è°ƒç”¨æ˜¯æœ€è€—æ—¶çš„(åˆå§‹åŒ– NativeMethodAccessorImplå’Œå­—èŠ‚ç æ‹¼è£…MethodAccessorImpl)ã€‚åˆå§‹åŒ–ä¸å¯é¿å…ï¼Œå› è€Œnativeæ–¹å¼çš„åˆå§‹åŒ–ä¼šæ›´å¿«ï¼Œæ‰€ä»¥å‰å‡ æ¬¡çš„è°ƒç”¨ä¼šé‡‡ç”¨nativeæ–¹æ³•ã€‚</p><p>éšç€è°ƒç”¨æ¬¡æ•°çš„å¢åŠ ï¼Œæ¯æ¬¡åå°„éƒ½ä½¿ç”¨JNIè·¨è¶Šnativeè¾¹ç•Œä¼šå¯¹ä¼˜åŒ–æœ‰é˜»ç¢ä½œç”¨ï¼Œç›¸å¯¹æ¥è¯´ä½¿ç”¨æ‹¼è£…å‡ºçš„å­—èŠ‚ç å¯ä»¥ç›´æ¥ä»¥Javaè°ƒç”¨çš„å½¢å¼å®ç°åå°„ï¼Œå‘æŒ¥äº†JITä¼˜åŒ–çš„ä½œç”¨ï¼Œé¿å…äº†JNIä¸ºäº†ç»´æŠ¤OopMap ï¼ˆHotSpotç”¨æ¥å®ç°å‡†ç¡®å¼GCçš„æ•°æ®ç»“æ„ï¼‰è¿›è¡Œå°è£…&#x2F;è§£å°è£…çš„æ€§èƒ½æŸè€—ã€‚</p><p>åœ¨å·²ç»åˆ›å»ºäº†MethodAccessorçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨Javaç‰ˆæœ¬çš„å®ç°ä¼šæ¯”nativeç‰ˆæœ¬æ›´å¿«ã€‚æ‰€ä»¥å½“è°ƒç”¨æ¬¡æ•°åˆ°è¾¾ä¸€å®šæ¬¡æ•°ï¼ˆ15æ¬¡ï¼‰åï¼Œä¼šåˆ‡æ¢æˆJavaå®ç°çš„ç‰ˆæœ¬ï¼Œæ¥ä¼˜åŒ–æœªæ¥å¯èƒ½çš„æ›´é¢‘ç¹çš„åå°„è°ƒç”¨ã€‚</p><h2 id="6-3-Javaåå°„çš„åº”ç”¨-Hibernateæ¡†æ¶"><a href="#6-3-Javaåå°„çš„åº”ç”¨-Hibernateæ¡†æ¶" class="headerlink" title="6.3 Javaåå°„çš„åº”ç”¨(Hibernateæ¡†æ¶)"></a>6.3 Javaåå°„çš„åº”ç”¨(Hibernateæ¡†æ¶)</h2><p>å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒJava åå°„æœºåˆ¶æä¾›äº†ä¸€ç§åŠ¨æ€é“¾æ¥ç¨‹åºç»„ä»¶çš„å¤šåŠŸèƒ½æ–¹æ³•ï¼Œå®ƒå…è®¸ç¨‹åºåˆ›å»ºå’Œæ§åˆ¶ä»»ä½•ç±»çš„å¯¹è±¡(æ ¹æ®å®‰å…¨æ€§é™åˆ¶)ä¹‹å‰ï¼Œæ— éœ€æå‰ç¡¬ç¼–ç ç›®æ ‡ç±»ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—åå°„ç‰¹åˆ«é€‚ç”¨äºåˆ›å»ºä»¥éå¸¸æ™®é€šçš„æ–¹å¼ä¸å¯¹è±¡åä½œçš„åº“ã€‚ä¾‹å¦‚ï¼Œåå°„ç»å¸¸åœ¨æŒç»­å­˜å‚¨å¯¹è±¡ä¸ºæ•°æ®åº“ã€XMLæˆ–å…¶å®ƒå¤–éƒ¨æ ¼å¼çš„æ¡†æ¶ä¸­ä½¿ç”¨ã€‚ä¸‹é¢å°±å·²Hibernateæ¡†æ¶ä¸ºä¾‹åƒå¤§å®¶é˜è¿°ä¸€ä¸‹åå°„çš„é‡è¦æ„ä¹‰ã€‚</p><p>Hibernateæ˜¯ä¸€ä¸ªå±è”½äº†JDBCï¼Œå®ç°äº†ORMçš„javaæ¡†æ¶ï¼Œåˆ©ç”¨è¯¥æ¡†æ¶æˆ‘ä»¬å¯ä»¥æŠ›å¼ƒæ‰ç¹ççš„sqlè¯­å¥è€Œæ˜¯åˆ©ç”¨Hibernateä¸­Sessionç±»çš„save()æ–¹æ³•ç›´æ¥å°†æŸä¸ªç±»çš„å¯¹è±¡å­˜åˆ°æ•°æ®åº“å½“ä¸­,ä¹Ÿå°±æ˜¯æ‰€æ¶‰åŠåˆ°sqlè¯­å¥çš„é‚£äº›ä»£ç Hibernateå¸®æˆ‘ä»¬åšäº†ã€‚è¿™æ—¶å€™å°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜, Hibernateæ€æ ·çŸ¥é“ä»–è¦å­˜çš„æŸä¸ªå¯¹è±¡éƒ½æœ‰ä»€ä¹ˆå±æ€§å‘¢ï¼Ÿè¿™äº›å±æ€§éƒ½æ˜¯ä»€ä¹ˆç±»å‹å‘¢ï¼Ÿæƒ³ä¸€æƒ³,å®ƒåœ¨å‘æ•°æ®åº“ä¸­å­˜å‚¨è¯¥å¯¹è±¡å±æ€§æ—¶çš„sqlè¯­å¥è¯¥æ€ä¹ˆæ„é€ </p><p>å‘¢? OK,åå°„çš„ä½œç”¨æ­¤åˆ»å°±ä½“ç°å‡ºæ¥äº†!</p><p>ä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­æ¥è¿›è¡Œé˜è¿°ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªUserç±»ï¼Œè¿™ä¸ªUserç±»ä¸­æœ‰20ä¸ªå±æ€§å’Œè¿™äº›å±æ€§çš„ getå’Œsetæ–¹æ³•ï¼Œç›¸åº”çš„åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªUserè¡¨ï¼Œè¿™ä¸ªUserè¡¨ä¸­å¯¹åº”ç€20ä¸ªå­—æ®µã€‚å‡è®¾æˆ‘ä»¬ä»Userè¡¨ä¸­æå–äº†ä¸€æ¡è®°å½•ï¼Œç°åœ¨éœ€è¦å°†è¿™æ¡è®°å½•çš„20ä¸ªå­—æ®µçš„å†…å®¹åˆ†åˆ«èµ‹ç»™ä¸€ä¸ªUserå¯¹è±¡myUserçš„20ä¸ªå±æ€§ï¼Œ è€ŒHibernateæ¡†æ¶åœ¨ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸çŸ¥é“è¿™ä¸ªUserç±»ï¼Œä»–æ— æ³•ç›´æ¥è°ƒç”¨myUser.getXXXæˆ–è€… myUser.setXXXæ–¹æ³•ï¼Œæ­¤æ—¶å°±ç”¨åˆ°äº†åå°„ï¼Œå…·ä½“å¤„ç†è¿‡ç¨‹å¦‚ä¸‹:</p><ol><li><p>æ ¹æ®æŸ¥è¯¢æ¡ä»¶æ„é€ PreparedStamentè¯­å¥ï¼Œè¯¥è¯­å¥è¿”å›20ä¸ªå­—æ®µçš„å€¼;</p></li><li><p>Hibernateé€šè¿‡è¯»å–é…ç½®æ–‡ä»¶å¾—åˆ°Userç±»çš„å±æ€§åˆ—è¡¨list(æ˜¯ä¸€ä¸ªStringæ•°ç»„)ä»¥åŠè¿™äº›å±æ€§çš„ç±»å‹ï¼›</p></li><li><p>åˆ›å»ºmyUseræ‰€å±ç±»çš„Classå¯¹è±¡c; ( \mathrm{c} &#x3D; ) myUser.getClass();</p></li><li><p>æ„é€ ä¸€ä¸ªforå¾ªç¯ï¼Œå¾ªç¯çš„æ¬¡æ•°ä¸ºliståˆ—è¡¨çš„é•¿åº¦;</p></li></ol><p>ã€‚ è¯»å–list[i]çš„å€¼ï¼Œç„¶åæ„é€ å¯¹åº”è¯¥å±æ€§çš„setæ–¹æ³•ï¼›</p><p>ã€‚åˆ¤æ–­list[i]çš„ç±»å‹XXXï¼Œè°ƒç”¨PreparedStamentè¯­å¥ä¸­çš„getXXX(i)ï¼Œè¿›è€Œå¾—åˆ°iå‡ºå­—æ®µçš„å€¼ï¼›</p><p>ã€‚ å°†4.2ä¸­å¾—åˆ°çš„å€¼ä½œä¸º4.1ä¸­å¾—åˆ°çš„setæ–¹æ³•çš„å‚æ•°ï¼Œè¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªå­—æ®µåƒä¸€ä¸ªå±æ€§çš„èµ‹å€¼ï¼Œ å¦‚æ­¤å¾ªç¯ç›´è‡³ç¨‹åºè¿è¡Œç»“æŸ;</p><p>å¦‚æœæ²¡æœ‰åå°„éš¾ä»¥æƒ³è±¡å®ç°è¿™ä¹ˆå¤æ‚çš„åŠŸèƒ½å°†ä¼šæœ‰å¤šä¹ˆéš¾ï¼</p><p>è¯è¯´å›æ¥,åå°„ç»™æˆ‘ä»¬å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ä¹Ÿæœ‰å®ƒè‡ªèº«çš„ç¼ºç‚¹ï¼Œæ¯”å¦‚æ€§èƒ½è¾ƒä½ã€å®‰å…¨æ€§è¾ƒä½ã€è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ç­‰ç­‰ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…ä¹Ÿå¯ä»¥åœ¨å®é™…å·¥ä½œä¸­å†æ·±å…¥ç ”ç©¶å“¦ï¼</p><h1 id="7-Java-å¼‚å¸¸è¯¦è§£"><a href="#7-Java-å¼‚å¸¸è¯¦è§£" class="headerlink" title="7. Java å¼‚å¸¸è¯¦è§£"></a>7. Java å¼‚å¸¸è¯¦è§£</h1><h2 id="7-1-å¼‚å¸¸çš„æ¦‚å¿µ"><a href="#7-1-å¼‚å¸¸çš„æ¦‚å¿µ" class="headerlink" title="7.1 å¼‚å¸¸çš„æ¦‚å¿µ"></a>7.1 å¼‚å¸¸çš„æ¦‚å¿µ</h2><p>å¦‚æœæŸä¸ªæ–¹æ³•ä¸èƒ½æŒ‰ç…§æ­£å¸¸çš„é€”å¾„å®Œæˆä»»åŠ¡ï¼Œå°±å¯ä»¥é€šè¿‡å¦ä¸€ç§è·¯å¾„é€€å‡ºæ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šæŠ›å‡ºä¸€ä¸ªå°è£…äº†é”™è¯¯ä¿¡æ¯çš„å¯¹è±¡ã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šç«‹åˆ»é€€å‡ºåŒæ—¶ä¸è¿”å›ä»»ä½•å€¼ã€‚å¦å¤–ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å…¶ä»–ä»£ç ä¹Ÿæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå¼‚å¸¸å¤„ç†æœºåˆ¶ä¼šå°†ä»£ç æ‰§è¡Œäº¤ç»™å¼‚å¸¸å¤„ç†å™¨ã€‚</p><p><img src="/../img/java/6.jpg" alt="6"></p><h2 id="7-2-Java-ä¸­å¼‚å¸¸åˆ†ä¸ºå“ªäº›ç§ç±»"><a href="#7-2-Java-ä¸­å¼‚å¸¸åˆ†ä¸ºå“ªäº›ç§ç±»" class="headerlink" title="7.2 Java ä¸­å¼‚å¸¸åˆ†ä¸ºå“ªäº›ç§ç±»"></a>7.2 Java ä¸­å¼‚å¸¸åˆ†ä¸ºå“ªäº›ç§ç±»</h2><p>æŒ‰ç…§å¼‚å¸¸éœ€è¦å¤„ç†çš„æ—¶æœºåˆ†ä¸ºç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆä¹Ÿå«å¼ºåˆ¶æ€§å¼‚å¸¸ï¼‰ä¹Ÿå«CheckedException å’Œè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆä¹Ÿå«éå¼ºåˆ¶æ€§å¼‚å¸¸ï¼‰ä¹Ÿå«RuntimeExceptionã€‚</p><p>åªæœ‰java è¯­è¨€æä¾›äº†Checked å¼‚å¸¸ï¼ŒJava è®¤ä¸º Checked å¼‚å¸¸éƒ½æ˜¯å¯ä»¥è¢«å¤„ç†çš„å¼‚å¸¸ï¼Œæ‰€ä»¥java ç¨‹åºå¿…é¡»æ˜¾å¼å¤„ç†Checked å¼‚å¸¸ã€‚å¦‚æœç¨‹åºæ²¡æœ‰å¤„ç†Checked å¼‚å¸¸ï¼Œè¯¥ç¨‹åºåœ¨ç¼–è¯‘æ—¶å°±ä¼šå‘ç”Ÿé”™è¯¯æ— æ³•ç¼–è¯‘ã€‚ è¿™ä½“ç°äº†Java çš„è®¾è®¡å“²å­¦ï¼šæ²¡æœ‰å®Œå–„é”™è¯¯å¤„ç†çš„ä»£ç æ ¹æœ¬æ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œã€‚å¯¹Checked å¼‚å¸¸å¤„ç†æ–¹æ³•æœ‰ä¸¤ç§:</p><ol><li><p>å½“å‰æ–¹æ³•çŸ¥é“å¦‚ä½•å¤„ç†è¯¥å¼‚å¸¸ï¼Œåˆ™ç”¨tryâ€¦catch å—æ¥å¤„ç†è¯¥å¼‚å¸¸ã€‚</p></li><li><p>å½“å‰æ–¹æ³•ä¸çŸ¥é“å¦‚ä½•å¤„ç†ï¼Œåˆ™åœ¨å®šä¹‰è¯¥æ–¹æ³•æ˜¯å£°æ˜æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p></li></ol><p>è¿è¡Œæ—¶å¼‚å¸¸åªæœ‰å½“ä»£ç åœ¨è¿è¡Œæ—¶æ‰å‘è¡Œçš„å¼‚å¸¸ï¼Œç¼–è¯‘æ—¶ä¸éœ€è¦try catchã€‚Runtime å¦‚é™¤æ•°æ˜¯0 å’Œæ•°ç»„ä¸‹æ ‡è¶Šç•Œç­‰ï¼Œå…¶äº§ç”Ÿé¢‘ç¹ï¼Œå¤„ç†éº»çƒ¦ï¼Œè‹¥æ˜¾ç¤ºç”³æ˜æˆ–è€…æ•è·å°†ä¼šå¯¹ç¨‹åºçš„å¯è¯»æ€§å’Œè¿è¡Œæ•ˆç‡å½±å“å¾ˆå¤§ã€‚æ‰€ä»¥ç”±ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶å°†å®ƒä»¬äº¤ç»™ç¼ºçœçš„å¼‚å¸¸å¤„ç†ç¨‹åºã€‚å½“ç„¶å¦‚æœä½ æœ‰å¤„ç†è¦æ±‚ä¹Ÿå¯ä»¥æ˜¾ç¤ºæ•è·å®ƒä»¬ã€‚</p><p>é‚£ä¹ˆï¼Œè°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼Œä¼šå¾—åˆ°ä»€ä¹ˆç»“æœå‘¢?</p><p>public int getNum(){</p><p>try {</p><p>int ( a &#x3D; 1&#x2F;0 ) ;</p><p>return 1 ;</p><p>} catch (Exception e) {</p><p>return 2;</p><p>}finally{</p><p>return 3;</p><p>}</p><p>}</p><p>ä»£ç åœ¨èµ°åˆ°ç¬¬3 è¡Œçš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªMathExceptionï¼Œè¿™æ—¶ç¬¬å››è¡Œçš„ä»£ç å°±ä¸ä¼šæ‰§è¡Œäº†ï¼Œä»£ç ç›´æ¥è·³è½¬åˆ° catchè¯­å¥ä¸­ï¼Œèµ°åˆ°ç¬¬6 è¡Œçš„æ—¶å€™ï¼Œå¼‚å¸¸æœºåˆ¶æœ‰è¿™ä¹ˆä¸€ä¸ªåŸåˆ™å¦‚æœåœ¨catch ä¸­é‡åˆ°äº†return æˆ–è€…å¼‚å¸¸ç­‰èƒ½ä½¿è¯¥å‡½æ•°ç»ˆæ­¢çš„è¯é‚£ä¹ˆæœ‰finally å°±å¿…é¡»å…ˆæ‰§è¡Œå®Œfinally ä»£ç å—é‡Œé¢çš„ä»£ç ç„¶åå†è¿”å›å€¼ã€‚å› æ­¤ä»£ç åˆè·³åˆ°ç¬¬ 8 è¡Œï¼Œå¯æƒœç¬¬ 8 è¡Œæ˜¯ä¸€ä¸ªreturn è¯­å¥ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æ–¹æ³•å°±ç»“æŸäº†ï¼Œå› æ­¤ç¬¬ 6 è¡Œçš„è¿”å›ç»“æœå°±æ— æ³•è¢«çœŸæ­£è¿”å›ã€‚å¦‚æœfinally ä»…ä»…æ˜¯å¤„ç†äº†ä¸€ä¸ªé‡Šæ”¾èµ„æºçš„æ“ä½œï¼Œé‚£ä¹ˆè¯¥é“é¢˜æœ€ç»ˆè¿”å›çš„ç»“æœå°±æ˜¯2ã€‚å› æ­¤ä¸Šé¢è¿”å›å€¼æ˜¯3ã€‚</p><h2 id="7-3-error-å’Œexception-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#7-3-error-å’Œexception-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="7.3 error å’Œexception æœ‰ä»€ä¹ˆåŒºåˆ«?"></a>7.3 error å’Œexception æœ‰ä»€ä¹ˆåŒºåˆ«?</h2><p>Error ç±»å’ŒException ç±»çš„çˆ¶ç±»éƒ½æ˜¯Throwable ç±»ï¼Œä»–ä»¬çš„åŒºåˆ«å¦‚ä¸‹ã€‚</p><p>Error ç±»ä¸€èˆ¬æ˜¯æŒ‡ä¸è™šæ‹Ÿæœºç›¸å…³çš„é—®é¢˜ï¼Œå¦‚ç³»ç»Ÿå´©æºƒï¼Œè™šæ‹Ÿæœºé”™è¯¯ï¼Œå†…å­˜ç©ºé—´ä¸è¶³ï¼Œæ–¹æ³•è°ƒç”¨æ ˆæº¢å‡ºç­‰ã€‚ å¯¹äºè¿™ç±»é”™è¯¯çš„å¯¼è‡´çš„åº”ç”¨ç¨‹åºä¸­æ–­ï¼Œä»…é ç¨‹åºæœ¬èº«æ— æ³•æ¢å¤å’Œå’Œé¢„é˜²ï¼Œé‡åˆ°è¿™æ ·çš„é”™è¯¯ï¼Œå»ºè®®è®©ç¨‹åºç»ˆæ­¢ã€‚</p><p>Exception ç±»è¡¨ç¤ºç¨‹åºå¯ä»¥å¤„ç†çš„å¼‚å¸¸ï¼Œå¯ä»¥æ•è·ä¸”å¯èƒ½æ¢å¤ã€‚é‡åˆ°è¿™ç±»å¼‚å¸¸ï¼Œåº”è¯¥å°½å¯èƒ½å¤„ç†å¼‚å¸¸ï¼Œä½¿ç¨‹åºæ¢å¤è¿è¡Œï¼Œè€Œä¸åº”è¯¥éšæ„ç»ˆæ­¢å¼‚å¸¸ã€‚</p><p>Exception ç±»åˆåˆ†ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ (Runtime Exception) å’Œå—æ£€æŸ¥çš„å¼‚å¸¸(Checked Exception )ï¼Œè¿è¡Œæ—¶å¼‚å¸¸ï¼›ArithmaticException, IllegalArgumentExceptionï¼Œç¼–è¯‘èƒ½é€šè¿‡ï¼Œä½†æ˜¯ä¸€è¿è¡Œå°±ç»ˆæ­¢äº†ï¼Œç¨‹åºä¸ä¼šå¤„ç†è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå‡ºç°è¿™ç±»å¼‚å¸¸ï¼Œç¨‹åºä¼šç»ˆæ­¢ã€‚è€Œå—æ£€æŸ¥çš„å¼‚å¸¸ï¼Œè¦ä¹ˆç”¨tryã€‚ã€‚ã€‚catch æ•è·ï¼Œè¦ä¹ˆç”¨ throws å­—å¥å£°æ˜æŠ›å‡ºï¼Œäº¤ç»™å®ƒçš„çˆ¶ç±»å¤„ç†ï¼Œå¦åˆ™ç¼–è¯‘ä¸ä¼šé€šè¿‡ã€‚</p><h2 id="7-4-throw-å’Œ-throws-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#7-4-throw-å’Œ-throws-çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="7.4 throw å’Œ throws çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>7.4 throw å’Œ throws çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><p>Java ä¸­çš„å¼‚å¸¸å¤„ç†é™¤äº†åŒ…æ‹¬æ•è·å¼‚å¸¸å’Œå¤„ç†å¼‚å¸¸ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬å£°æ˜å¼‚å¸¸å’ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ throws å…³é”®å­—åœ¨æ–¹æ³•ä¸Šå£°æ˜è¯¥æ–¹æ³•è¦æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæˆ–è€…åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ throw æŠ›å‡ºå¼‚å¸¸å¯¹è±¡ã€‚</p><p>throws å…³é”®å­—å’Œ throw å…³é”®å­—åœ¨ä½¿ç”¨ä¸Šçš„å‡ ç‚¹åŒºåˆ«å¦‚ä¸‹:</p><ol><li><p>throw å…³é”®å­—ç”¨åœ¨æ–¹æ³•å†…éƒ¨ï¼Œåªèƒ½ç”¨äºæŠ›å‡ºä¸€ç§å¼‚å¸¸ï¼Œç”¨æ¥æŠ›å‡ºæ–¹æ³•æˆ–ä»£ç å—ä¸­çš„å¼‚å¸¸ï¼Œå—æŸ¥å¼‚å¸¸å’Œéå—æŸ¥å¼‚å¸¸éƒ½å¯ä»¥è¢«æŠ›å‡ºã€‚</p></li><li><p>throws å…³é”®å­—ç”¨åœ¨æ–¹æ³•å£°æ˜ä¸Šï¼Œå¯ä»¥æŠ›å‡ºå¤šä¸ªå¼‚å¸¸ï¼Œç”¨æ¥æ ‡è¯†è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸åˆ—è¡¨ã€‚ä¸€ä¸ªæ–¹æ³•ç”¨ throws æ ‡è¯†äº†å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸åˆ—è¡¨ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„æ–¹æ³•ä¸­å¿…é¡»åŒ…å«å¯å¤„ç†å¼‚å¸¸çš„ä»£ç ï¼Œå¦åˆ™ä¹Ÿè¦åœ¨æ–¹æ³•ç­¾åä¸­ç”¨ throws å…³é”®å­—å£°æ˜ç›¸åº”çš„å¼‚å¸¸ã€‚</p></li></ol><h2 id="7-5-Java-çš„å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#7-5-Java-çš„å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="7.5 Java çš„å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>7.5 Java çš„å¼‚å¸¸å¤„ç†æœºåˆ¶</h2><p>Java å¯¹å¼‚å¸¸è¿›è¡Œäº†åˆ†ç±»ï¼Œä¸åŒç±»å‹çš„å¼‚å¸¸åˆ†åˆ«ç”¨ä¸åŒçš„Java ç±»è¡¨ç¤ºï¼Œæ‰€æœ‰å¼‚å¸¸çš„æ ¹ç±»ä¸º</p><p>java.lang.Throwableï¼ŒThrowable ä¸‹é¢åˆæ´¾ç”Ÿäº†ä¸¤ä¸ªå­ç±»ï¼šError å’ŒExceptionï¼ŒError è¡¨ç¤ºåº”ç”¨ç¨‹åºæœ¬èº«æ— æ³•å…‹æœå’Œæ¢å¤çš„ä¸€ç§ä¸¥é‡é—®é¢˜ã€‚</p><p>Exception è¡¨ç¤ºç¨‹åºè¿˜èƒ½å¤Ÿå…‹æœå’Œæ¢å¤çš„é—®é¢˜ï¼Œå…¶ä¸­åˆåˆ†ä¸ºç³»ç»Ÿå¼‚å¸¸å’Œæ™®é€šå¼‚å¸¸ï¼Œç³»ç»Ÿå¼‚å¸¸æ˜¯è½¯ä»¶æœ¬èº«ç¼ºé™·æ‰€å¯¼è‡´çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è½¯ä»¶å¼€å‘äººå‘˜è€ƒè™‘ä¸å‘¨æ‰€å¯¼è‡´çš„é—®é¢˜ï¼Œè½¯ä»¶ä½¿ç”¨è€…æ— æ³•å…‹æœå’Œæ¢å¤è¿™ç§é—®é¢˜ï¼Œ ä½†åœ¨è¿™ç§é—®é¢˜ä¸‹è¿˜å¯ä»¥è®©è½¯ä»¶ç³»ç»Ÿç»§ç»­è¿è¡Œæˆ–è€…è®©è½¯ä»¶æ­»æ‰ï¼Œä¾‹å¦‚ï¼Œæ•°ç»„è„šæœ¬è¶Šç•Œ</p><p>ï¼ˆArrayIndexOutOfBoundsExceptionï¼‰ï¼Œç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆNullPointerExceptionï¼‰ã€ç±»è½¬æ¢å¼‚å¸¸</p><p>ï¼ˆClassCastExceptionï¼‰ï¼›æ™®é€šå¼‚å¸¸æ˜¯è¿è¡Œç¯å¢ƒçš„å˜åŒ–æˆ–å¼‚å¸¸æ‰€å¯¼è‡´çš„é—®é¢˜ï¼Œæ˜¯ç”¨æˆ·èƒ½å¤Ÿå…‹æœçš„é—®é¢˜ï¼Œ</p><p>ä¾‹å¦‚ï¼Œç½‘ç»œæ–­çº¿ï¼Œç¡¬ç›˜ç©ºé—´ä¸å¤Ÿï¼Œå‘ç”Ÿè¿™æ ·çš„å¼‚å¸¸åï¼Œç¨‹åºä¸åº”è¯¥æ­»æ‰ã€‚java ä¸ºç³»ç»Ÿå¼‚å¸¸å’Œæ™®é€šå¼‚å¸¸æä¾›äº†ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œç¼–è¯‘å™¨å¼ºåˆ¶æ™®é€šå¼‚å¸¸å¿…é¡»try..catch å¤„ç†æˆ–ç”¨throws å£°æ˜ç»§ç»­æŠ›ç»™ä¸Šå±‚è°ƒç”¨æ–¹æ³•å¤„ç†ï¼Œæ‰€ä»¥æ™®é€šå¼‚å¸¸ä¹Ÿç§°ä¸ºchecked å¼‚å¸¸ï¼Œè€Œç³»ç»Ÿå¼‚å¸¸å¯ä»¥å¤„ç†ä¹Ÿå¯ä»¥ä¸å¤„ç†ï¼Œæ‰€ä»¥ï¼Œç¼–è¯‘å™¨ä¸å¼ºåˆ¶ç”¨ try..catch å¤„ç†æˆ–ç”¨throws å£°æ˜ï¼Œæ‰€ä»¥ç³»ç»Ÿå¼‚å¸¸ä¹Ÿç§°ä¸ºunchecked å¼‚å¸¸ã€‚</p><h2 id="7-6-è¯·å†™å‡ºä½ æœ€å¸¸è§çš„5-ä¸ªRuntimeException"><a href="#7-6-è¯·å†™å‡ºä½ æœ€å¸¸è§çš„5-ä¸ªRuntimeException" class="headerlink" title="7.6 è¯·å†™å‡ºä½ æœ€å¸¸è§çš„5 ä¸ªRuntimeException"></a>7.6 è¯·å†™å‡ºä½ æœ€å¸¸è§çš„5 ä¸ªRuntimeException</h2><p>è¿™æ˜¯é¢è¯•è¿‡ç¨‹ä¸­ï¼Œå¾ˆå–œæ¬¢é—®çš„é—®é¢˜ï¼Œä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå¸¸è§çš„RuntimeExceptionã€‚</p><p>1ï¼‰java.lang.NullPointerException ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›å‡ºç°åŸå› ï¼šè°ƒç”¨äº†æœªç»åˆå§‹åŒ–çš„å¯¹è±¡æˆ–è€…æ˜¯ä¸å­˜åœ¨çš„å¯¹è±¡ã€‚</p><p>2ï¼‰java.lang.ClassNotFoundException æŒ‡å®šçš„ç±»æ‰¾ä¸åˆ°ï¼›å‡ºç°åŸå› ï¼šç±»çš„åç§°å’Œè·¯å¾„åŠ è½½é”™è¯¯ï¼›é€šå¸¸éƒ½æ˜¯ç¨‹åºè¯•å›¾é€šè¿‡å­—ç¬¦ä¸²æ¥åŠ è½½æŸä¸ªç±»æ—¶å¯èƒ½å¼•å‘å¼‚å¸¸ã€‚</p><p>3ï¼‰java.lang.NumberFormatException å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—å¼‚å¸¸ï¼›å‡ºç°åŸå› ï¼šå­—ç¬¦å‹æ•°æ®ä¸­åŒ…å«éæ•°å­—å‹å­—ç¬¦ã€‚</p><p>4ï¼‰java.lang.IndexOutOfBoundsException æ•°ç»„è§’æ ‡è¶Šç•Œå¼‚å¸¸ï¼Œå¸¸è§äºæ“ä½œæ•°ç»„å¯¹è±¡æ—¶å‘ç”Ÿã€‚</p><p>5ï¼‰java.lang.IllegalArgumentException æ–¹æ³•ä¼ é€’å‚æ•°é”™è¯¯ã€‚</p><ol start="6"><li>java.lang.ClassCastException æ•°æ®ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</li></ol><p>7ï¼‰java.lang.NoClassDefFoundException æœªæ‰¾åˆ°ç±»å®šä¹‰é”™è¯¯ã€‚</p><p>8ï¼‰SQLException SQL å¼‚å¸¸ï¼Œå¸¸è§äºæ“ä½œæ•°æ®åº“æ—¶çš„SQL è¯­å¥é”™è¯¯ã€‚</p><ol start="9"><li><p>java.lang.InstantiationException å®ä¾‹åŒ–å¼‚å¸¸ã€‚</p></li><li><p>java.lang.NoSuchMethodException æ–¹æ³•ä¸å­˜åœ¨å¼‚å¸¸ã€‚</p></li></ol><h2 id="7-7-finalã€finallyã€finalize-çš„åŒºåˆ«"><a href="#7-7-finalã€finallyã€finalize-çš„åŒºåˆ«" class="headerlink" title="7.7 finalã€finallyã€finalize çš„åŒºåˆ«"></a>7.7 finalã€finallyã€finalize çš„åŒºåˆ«</h2><ol><li><p>finalï¼šç”¨äºå£°æ˜å±æ€§ï¼Œæ–¹æ³•å’Œç±»ï¼Œåˆ†åˆ«è¡¨ç¤ºå±æ€§ä¸å¯å˜ï¼Œæ–¹æ³•ä¸å¯è¦†ç›–ï¼Œè¢«å…¶ä¿®é¥°çš„ç±»ä¸å¯ç»§æ‰¿ã€‚</p></li><li><p>finally: å¼‚å¸¸å¤„ç†è¯­å¥ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œè¡¨ç¤ºæ€»æ˜¯æ‰§è¡Œã€‚</p></li><li><p>finalizeï¼šObject ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨åƒåœ¾å›æ”¶å™¨æ‰§è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨è¢«å›æ”¶å¯¹è±¡çš„æ­¤æ–¹æ³•ï¼Œå¯ä»¥è¦†ç›–æ­¤æ–¹æ³•æä¾›åƒåœ¾æ”¶é›†æ—¶çš„å…¶ä»–èµ„æºå›æ”¶ï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶ç­‰ã€‚è¯¥æ–¹æ³•æ›´åƒæ˜¯ä¸€ä¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ä¸´ç»ˆæ–¹æ³•ï¼Œ</p></li></ol><p>å½“è¯¥æ–¹æ³•è¢«ç³»ç»Ÿè°ƒç”¨åˆ™ä»£è¡¨è¯¥å¯¹è±¡å³å°†â€œæ­»äº¡â€ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸»åŠ¨è¡Œä¸ºä¸Šå»è°ƒç”¨è¯¥æ–¹æ³•å¹¶ä¸ä¼šå¯¼è‡´è¯¥å¯¹è±¡â€œæ­»äº¡â€ï¼Œè¿™æ˜¯ä¸€ä¸ªè¢«åŠ¨çš„æ–¹æ³•ï¼ˆå…¶å®å°±æ˜¯å›è°ƒæ–¹æ³•ï¼‰ï¼Œä¸éœ€è¦æˆ‘ä»¬è°ƒç”¨ã€‚</p><h2 id="7-8-NoClassDefFoundError-å’Œ-ClassNotFoundException-åŒºåˆ«"><a href="#7-8-NoClassDefFoundError-å’Œ-ClassNotFoundException-åŒºåˆ«" class="headerlink" title="7.8 NoClassDefFoundError å’Œ ClassNotFoundException åŒºåˆ«"></a>7.8 NoClassDefFoundError å’Œ ClassNotFoundException åŒºåˆ«</h2><p>NoClassDefFoundError æ˜¯ä¸€ä¸ª Error ç±»å‹çš„å¼‚å¸¸ï¼Œæ˜¯ç”± JVM å¼•èµ·çš„ï¼Œä¸åº”è¯¥å°è¯•æ•è·è¿™ä¸ªå¼‚å¸¸ã€‚</p><p>å¼•èµ·è¯¥å¼‚å¸¸çš„åŸå› æ˜¯ JVM æˆ– ClassLoader å°è¯•åŠ è½½æŸç±»æ—¶åœ¨å†…å­˜ä¸­æ‰¾ä¸åˆ°è¯¥ç±»çš„å®šä¹‰ï¼Œè¯¥åŠ¨ä½œå‘ç”Ÿåœ¨è¿è¡ŒæœŸé—´ï¼Œå³ç¼–è¯‘æ—¶è¯¥ç±»å­˜åœ¨ï¼Œä½†æ˜¯åœ¨è¿è¡Œæ—¶å´æ‰¾ä¸åˆ°äº†ï¼Œå¯èƒ½æ˜¯å˜å¼‚åè¢«åˆ é™¤äº†ç­‰åŸå› å¯¼è‡´ï¼›</p><p>ClassNotFoundException æ˜¯ä¸€ä¸ªå—æŸ¥å¼‚å¸¸ï¼Œéœ€è¦æ˜¾å¼åœ°ä½¿ç”¨ try-catch å¯¹å…¶è¿›è¡Œæ•è·å’Œå¤„ç†ï¼Œæˆ–åœ¨æ–¹æ³•ç­¾åä¸­ç”¨ throws å…³é”®å­—è¿›è¡Œå£°æ˜ã€‚å½“ä½¿ç”¨ Class.forName, ClassLoader.loadClass æˆ–</p><p>ClassLoader.findSystemClass åŠ¨æ€åŠ è½½ç±»åˆ°å†…å­˜çš„æ—¶å€™ï¼Œé€šè¿‡ä¼ å…¥çš„ç±»è·¯å¾„å‚æ•°æ²¡æœ‰æ‰¾åˆ°è¯¥ç±»ï¼Œå°±ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ï¼›å¦ä¸€ç§æŠ›å‡ºè¯¥å¼‚å¸¸çš„å¯èƒ½åŸå› æ˜¯æŸä¸ªç±»å·²ç»ç”±ä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½è‡³å†…å­˜ä¸­ï¼Œå¦ä¸€ä¸ªåŠ è½½å™¨åˆå°è¯•å»åŠ è½½å®ƒã€‚</p><p>Java å¼‚å¸¸ å°±æ€»ç»“è¿™ä¹ˆå¤šï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œæ¬¢è¿è®¨è®ºã€‚</p><h1 id="8-Java-IO-æµè¯¦è§£"><a href="#8-Java-IO-æµè¯¦è§£" class="headerlink" title="8. Java IO æµè¯¦è§£"></a>8. Java IO æµè¯¦è§£</h1><h2 id="8-1-Java-IOæ¦‚å¿µ"><a href="#8-1-Java-IOæ¦‚å¿µ" class="headerlink" title="8.1 Java IOæ¦‚å¿µ"></a>8.1 Java IOæ¦‚å¿µ</h2><p>Java IOï¼šå³ Java è¾“å…¥ &#x2F; è¾“å‡ºç³»ç»Ÿã€‚</p><p>Java çš„ IO æ¨¡å‹è®¾è®¡éå¸¸ä¼˜ç§€ï¼Œå®ƒä½¿ç”¨ Decorator (è£…é¥°è€…)æ¨¡å¼ï¼ŒæŒ‰åŠŸèƒ½åˆ’åˆ† streamï¼Œæ‚¨å¯ä»¥åŠ¨æ€è£…é…è¿™äº› streamï¼Œä»¥ä¾¿è·å¾—æ‚¨éœ€è¦çš„åŠŸèƒ½ã€‚</p><p>Streamï¼šJAVA ä¸­å°†æ•°æ®çš„è¾“å…¥è¾“å‡ºæŠ½è±¡ä¸ºæµï¼Œæµæ˜¯ä¸€ç»„æœ‰é¡ºåºçš„ã€å•å‘çš„ï¼Œæœ‰èµ·ç‚¹å’Œç»ˆç‚¹çš„æ•°æ®é›†åˆã€‚æŒ‰ç…§æµä¸­çš„æœ€å°æ•°æ®å•å…ƒåˆåˆ†ä¸ºå­—èŠ‚æµå’Œå­—ç¬¦æµã€‚</p><p>IO æµç”¨æ¥å¤„ç†è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼ŒJava ç¨‹åºä¸­ï¼Œå¯¹äºæ•°æ®çš„è¾“å…¥&#x2F;è¾“å‡ºæ“ä½œ éƒ½æ˜¯ä»¥â€œæµâ€çš„æ–¹å¼è¿›è¡Œçš„ã€‚ java.io åŒ…ä¸‹æä¾›äº†å„ç§â€œæµâ€ç±»çš„æ¥å£ï¼Œç”¨ä»¥è·å–ä¸åŒç§ç±»çš„æ•°æ®ï¼Œå¹¶é€šè¿‡æ ‡å‡†çš„æ–¹æ³•è¾“å…¥æˆ–è¾“å‡ºæ•°æ®ã€‚</p><p>å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œæ•°æ®æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼è¯»å‡ºæˆ–å†™å…¥ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ–‡ä»¶æƒ³è±¡ä¸ºä¸€ä¸ªæ¡¶ï¼Œæˆ‘ä»¬é€šè¿‡ç®¡é“å°†æ¡¶é‡Œçš„æ°´æŠ½å‡ºæ¥ã€‚è¿™é‡Œçš„ç®¡é“ä¹Ÿå°±ç›¸å½“äºJavaä¸­çš„æµã€‚æµçš„æœ¬è´¨æ˜¯ä¸€ç§æœ‰åºçš„æ•°æ®é›†åˆï¼Œæœ‰æ•°æ®æºå’Œç›®çš„åœ°ã€‚</p><h2 id="8-2-Java-IOæµåˆ†ç±»"><a href="#8-2-Java-IOæµåˆ†ç±»" class="headerlink" title="8.2 Java IOæµåˆ†ç±»"></a>8.2 Java IOæµåˆ†ç±»</h2><ol><li>æŒ‰ç…§æµçš„æ–¹å‘ (è¾“å‡ºè¾“å…¥éƒ½æ˜¯ç«™åœ¨ç¨‹åºæ‰€åœ¨å†…å­˜çš„è§’åº¦ä¸ºä¾æ®åˆ’åˆ†çš„)</li></ol><p>ã€‚ è¾“å…¥æµï¼šåªèƒ½ä»å†…å­˜ä¸­è¯»æ•°æ®</p><p>ã€‚ è¾“å‡ºæµï¼šåªèƒ½å‘æ–‡ä»¶ä¸­å†™æ•°æ®</p><p>â—‹ è¾“å…¥ï¼šè¯»å–å¤–éƒ¨æ•°æ®ï¼ˆç£ç›˜ã€å…‰ç›˜ç­‰å­˜å‚¨è®¾å¤‡çš„æ•°æ®ï¼‰åˆ°ç¨‹åºï¼ˆå†…å­˜ï¼‰ä¸­ã€‚</p><p>ã€‚ è¾“å‡ºï¼šå°†ç¨‹åºï¼ˆå†…å­˜ï¼‰æ•°æ®è¾“å‡ºåˆ°ç£ç›˜ã€å…‰ç›˜ç­‰å­˜å‚¨è®¾å¤‡ä¸­</p><table><thead><tr><th>.</th><th>å­—èŠ‚æµ</th><th>å­—ç¬¦æµ</th></tr></thead><tr><td>è¾“å…¥æµ</td><td>InputStream</td><td>Reader</td></tr><tr><td>è¾“å‡ºæµ</td><td>OutputStream</td><td>Writer</td></tr></table><ul><li><p>Inputstream: å­—èŠ‚è¾“å…¥æµ</p></li><li><p>OutputStream: å­—èŠ‚è¾“å‡ºæµ</p></li><li><p>Reader: å­—ç¬¦è¾“å…¥æµ</p></li><li><p>Writer: å­—ç¬¦è¾“å‡ºæµ</p></li></ul><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œå­—èŠ‚æµä¸€èˆ¬ç”¨æ¥å¤„ç†å›¾åƒï¼Œè§†é¢‘ï¼Œä»¥åŠPPTï¼ŒWordç±»å‹çš„æ–‡ä»¶ã€‚å­—ç¬¦æµä¸€èˆ¬ç”¨äºå¤„ç†çº¯æ–‡æœ¬ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚TXTæ–‡ä»¶ç­‰ï¼Œå­—èŠ‚æµå¯ä»¥ç”¨æ¥å¤„ç†çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œä½†æ˜¯å­—ç¬¦æµä¸èƒ½ç”¨äºå¤„ç†å›¾åƒè§†é¢‘ç­‰éæ–‡æœ¬ç±»å‹çš„æ–‡ä»¶ã€‚</p><ol start="2"><li>æŒ‰å¤„ç†æ•°æ®å•ä½(å­—èŠ‚æµä¸å­—ç¬¦æµ)</li></ol><p>1å­—ç¬¦ &#x3D; 2å­—èŠ‚ ã€ 1å­—èŠ‚(byte) &#x3D; 8ä½(bit) ã€ ä¸€ä¸ªæ±‰å­—å ä¸¤ä¸ªå­—èŠ‚é•¿åº¦</p><p>ã€‚ å­—èŠ‚æµï¼šæ¯æ¬¡è¯»å–(å†™å‡º)ä¸€ä¸ªå­—èŠ‚ï¼Œå½“ä¼ è¾“çš„èµ„æºæ–‡ä»¶æœ‰ä¸­æ–‡æ—¶ï¼Œå°±ä¼šå‡ºç°ä¹±ç ã€‚</p><p>ã€‚ å­—ç¬¦æµï¼šæ¯æ¬¡è¯»å–(å†™å‡º)ä¸¤ä¸ªå­—èŠ‚ï¼Œæœ‰ä¸­æ–‡æ—¶ï¼Œä½¿ç”¨è¯¥æµå°±å¯ä»¥æ­£ç¡®ä¼ è¾“æ˜¾ç¤ºä¸­æ–‡ã€‚</p><ol start="3"><li>æŒ‰åŠŸèƒ½ä¸åŒåˆ†ä¸º(èŠ‚ç‚¹æµä¸å¤„ç†æµ)</li></ol><p>â—‹ èŠ‚ç‚¹æµï¼šä»¥ä»æˆ–å‘ä¸€ä¸ªç‰¹å®šçš„åœ°æ–¹ (èŠ‚ç‚¹) è¯»å†™æ•°æ®ã€‚</p><ul><li><p>æ–‡ä»¶æµ: FileInputStream, FileOutputStrean, FileReader, FileWriter, å®ƒä»¬éƒ½ä¼šç›´æ¥æ“ä½œæ–‡ä»¶ï¼Œç›´æ¥ä¸ OS åº•å±‚äº¤äº’ã€‚å› æ­¤ä»–ä»¬è¢«ç§°ä¸ºèŠ‚ç‚¹æµï¼Œæ³¨æ„ï¼šä½¿ç”¨è¿™å‡ ä¸ªæµçš„å¯¹è±¡ä¹‹åï¼Œéœ€è¦å…³é—­æµå¯¹è±¡ï¼Œå› ä¸º java åƒåœ¾å›æ”¶å™¨ä¸ä¼šä¸»åŠ¨å›æ”¶ã€‚ä¸è¿‡åœ¨ Java7 ä¹‹åï¼Œå¯ä»¥åœ¨ try() æ‹¬å·ä¸­æ‰“å¼€æµï¼Œæœ€åç¨‹åºä¼šè‡ªåŠ¨å…³é—­æµå¯¹è±¡ï¼Œä¸å†éœ€è¦æ˜¾ç¤ºåœ° closeã€‚</p></li><li><p>æ•°ç»„æµ: ByteArrayInputStream, ByteArrayOutputStream, CharArrayReader,</p></li></ul><p>CharArrayWriterï¼Œå¯¹æ•°ç»„è¿›è¡Œå¤„ç†çš„èŠ‚ç‚¹æµã€‚</p><ul><li><p>å­—ç¬¦ä¸²æµ: StringReader, StringWriter, å…¶ä¸­ StringReader èƒ½ä» String ä¸­è¯»å–æ•°æ®å¹¶ä¿å­˜åˆ° char æ•°ç»„ã€‚</p></li><li><p>ç®¡é“æµ: PipedInputStream, PipedOutputStream, PipedReader, PipedWrite, å¯¹ç®¡é“è¿›è¡Œå¤„ç†çš„èŠ‚ç‚¹æµã€‚</p></li></ul><p>ã€‚ å¤„ç†æµï¼šæ˜¯å¯¹ä¸€ä¸ªå·²å­˜åœ¨çš„æµçš„è¿æ¥å’Œå°è£…ï¼Œé€šè¿‡æ‰€å°è£…çš„æµçš„åŠŸèƒ½è°ƒç”¨å®ç°æ•°æ®è¯»å†™ã€‚</p><ul><li><p>ç¼“å†²æµ : BufferedImputStrean, BufferedOutputStream, BufferedReader , BufferedWriterï¼Œéœ€è¦çˆ¶ç±»ä½œä¸ºå‚æ•°æ„é€ ï¼Œå¢åŠ ç¼“å†²åŠŸèƒ½ï¼Œé¿å…é¢‘ç¹è¯»å†™ç¡¬ç›˜ï¼Œå¯ä»¥åˆå§‹åŒ–ç¼“å†²æ•°æ®çš„å¤§å°ï¼Œç”±äºå¸¦äº†ç¼“å†²åŠŸèƒ½ï¼Œæ‰€ä»¥å°±å†™æ•°æ®çš„æ—¶å€™éœ€è¦ä½¿ç”¨ flush æ–¹æ³•ï¼Œå¦å¤–ï¼ŒBufferedReader æä¾›ä¸€ä¸ª readLine( ) æ–¹æ³•å¯ä»¥è¯»å–ä¸€è¡Œï¼Œè€Œ FileInputStream å’Œ FileReader åªèƒ½è¯»å–ä¸€ä¸ªå­—èŠ‚æˆ–è€…ä¸€ä¸ªå­—ç¬¦ï¼Œå› æ­¤ BufferedReader ä¹Ÿè¢«ç§°ä¸ºè¡Œè¯»å–å™¨ã€‚</p></li><li><p>è½¬æ¢æµ: InputStreamReader, OutputStreamWriter, è¦ inputStream æˆ– OutputStream ä½œä¸ºå‚æ•°ï¼Œå®ç°ä»å­—èŠ‚æµåˆ°å­—ç¬¦æµçš„è½¬æ¢ï¼Œæˆ‘ä»¬ç»å¸¸åœ¨è¯»å–é”®ç›˜è¾“å…¥ (System.in) æˆ–ç½‘ç»œé€šä¿¡çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸¤ä¸ªç±»ã€‚</p></li><li><p>æ•°æ®æµï¼šDataInputStreamï¼ŒDataOutputStreamï¼Œæä¾›å°†åŸºç¡€æ•°æ®ç±»å‹å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œ æˆ–è€…è¯»å–å‡ºæ¥ã€‚</p></li></ul><p>ä»¥BufferedReaderä¸ºä¾‹ã€‚å¤„ç†æµçš„æ„é€ æ–¹æ³•æ€»è¦å¸¦ä¸Šä¸€ä¸ªå…¶ä»–çš„æµå¯¹è±¡åšå‚æ•°ã€‚ä¸€ä¸ªæµå¯¹è±¡ä¼šç»è¿‡å…¶ä»–æµçš„å¤šæ¬¡åŒ…è£…ã€‚</p><h2 id="8-3-Java-IOæµç‰¹æ€§"><a href="#8-3-Java-IOæµç‰¹æ€§" class="headerlink" title="8.3 Java IOæµç‰¹æ€§"></a>8.3 Java IOæµç‰¹æ€§</h2><ol><li><p>é¡ºåºå­˜å–:å¯ä»¥ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å¾€æµä¸­å†™å…¥ä¸€ä¸²å­—èŠ‚ï¼Œè¯»å‡ºæ—¶ä¹Ÿå°†æŒ‰å†™å…¥é¡ºåºè¯»å–ä¸€ä¸²å­—èŠ‚ï¼Œä¸èƒ½éšæœºè®¿é—®ä¸­é—´çš„æ•°æ®ã€‚ï¼ˆRandomAccessFileå¯ä»¥ä»æ–‡ä»¶çš„ä»»æ„ä½ç½®è¿›è¡Œå­˜å–ï¼ˆè¾“å…¥è¾“å‡ºï¼‰æ“ä½œï¼‰</p></li><li><p>å…ˆè¿›å…ˆå‡º:æœ€å…ˆå†™å…¥è¾“å‡ºæµçš„æ•°æ®æœ€å…ˆè¢«è¾“å…¥æµè¯»å–åˆ°ã€‚</p></li><li><p>åªè¯»æˆ–åªå†™ï¼šæ¯ä¸ªæµåªèƒ½æ˜¯è¾“å…¥æµæˆ–è¾“å‡ºæµçš„ä¸€ç§ï¼Œä¸èƒ½åŒæ—¶å…·å¤‡ä¸¤ä¸ªåŠŸèƒ½ï¼Œè¾“å…¥æµåªèƒ½è¿›è¡Œè¯»æ“ä½œï¼Œå¯¹è¾“å‡ºæµåªèƒ½è¿›è¡Œå†™æ“ä½œã€‚åœ¨ä¸€ä¸ªæ•°æ®ä¼ è¾“é€šé“ä¸­ï¼Œå¦‚æœæ—¢è¦å†™å…¥æ•°æ®ï¼Œåˆè¦è¯»å–æ•°æ®ï¼Œåˆ™è¦åˆ†åˆ«æä¾›ä¸¤ä¸ªæµã€‚</p></li></ol><h2 id="8-4-Java-IOæµæ¥å£"><a href="#8-4-Java-IOæµæ¥å£" class="headerlink" title="8.4 Java IOæµæ¥å£"></a>8.4 Java IOæµæ¥å£</h2><ol><li><p>Fileï¼ˆæ–‡ä»¶ç‰¹å¾ä¸ç®¡ç†ï¼‰ï¼šFileç±»æ˜¯å¯¹æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶ä»¥åŠæ–‡ä»¶å¤¹è¿›è¡Œå°è£…çš„å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¯¹è±¡çš„æ€æƒ³æ¥æ“ä½œæ–‡ä»¶å’Œæ–‡ä»¶å¤¹ã€‚ Fileç±»ä¿å­˜æ–‡ä»¶æˆ–ç›®å½•çš„å„ç§å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€æ–‡ä»¶é•¿åº¦ã€æœ€åä¿®æ”¹æ—¶é—´ã€æ˜¯å¦å¯è¯»ã€è·å–å½“å‰æ–‡ä»¶çš„è·¯å¾„åï¼Œåˆ¤æ–­æŒ‡å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€è·å¾—å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼Œåˆ›å»ºã€åˆ é™¤æ–‡ä»¶å’Œç›®å½•ç­‰æ–¹æ³•ã€‚</p></li><li><p>InputStreamï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼šæŠ½è±¡ç±»ï¼ŒåŸºäºå­—èŠ‚çš„è¾“å…¥æ“ä½œï¼Œæ˜¯æ‰€æœ‰è¾“å…¥æµçš„çˆ¶ç±»ã€‚å®šä¹‰äº†æ‰€æœ‰è¾“å…¥æµéƒ½å…·æœ‰çš„å…±åŒç‰¹å¾ã€‚</p></li><li><p>OutputStreamï¼ˆäºŒè¿›åˆ¶ï¼‰ï¼šæŠ½è±¡ç±»ã€‚åŸºäºå­—èŠ‚çš„è¾“å‡ºæ“ä½œã€‚æ˜¯æ‰€æœ‰è¾“å‡ºæµçš„çˆ¶ç±»ã€‚å®šä¹‰äº†æ‰€æœ‰è¾“å‡ºæµéƒ½å…·æœ‰çš„å…±åŒç‰¹å¾ã€‚</p></li><li><p>Reader (æ–‡ä»¶æ ¼å¼) : æŠ½è±¡ç±»ï¼ŒåŸºäºå­—ç¬¦çš„è¾“å…¥æ“ä½œã€‚</p></li><li><p>Writer (æ–‡ä»¶æ ¼å¼) : æŠ½è±¡ç±»ï¼ŒåŸºäºå­—ç¬¦çš„è¾“å‡ºæ“ä½œã€‚</p></li><li><p>RandomAccessFileï¼ˆéšæœºæ–‡ä»¶ï¼‰ï¼šä¸€ä¸ªç‹¬ç«‹çš„ç±»ï¼Œç›´æ¥ç»§æ‰¿è‡³Object.å®ƒçš„åŠŸèƒ½ä¸°å¯Œï¼Œå¯ä»¥ä»æ–‡ä»¶çš„ä»»æ„ä½ç½®è¿›è¡Œå­˜å–ï¼ˆè¾“å…¥è¾“å‡ºï¼‰æ“ä½œã€‚</p></li></ol><p>ä¸€ä¸ªæ¥å£æŒ‡çš„æ˜¯Serializable.æŒæ¡äº†è¿™äº›IOçš„æ ¸å¿ƒæ“ä½œé‚£ä¹ˆå¯¹äºJavaä¸­çš„IOä½“ç³»ä¹Ÿå°±æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†äº†ã€‚</p><h2 id="8-5-Java-IOæµå¯¹è±¡"><a href="#8-5-Java-IOæµå¯¹è±¡" class="headerlink" title="8.5 Java IOæµå¯¹è±¡"></a>8.5 Java IOæµå¯¹è±¡</h2><h2 id="8-5-1-è¾“å…¥å­—èŠ‚æµInputStream"><a href="#8-5-1-è¾“å…¥å­—èŠ‚æµInputStream" class="headerlink" title="8.5.1 è¾“å…¥å­—èŠ‚æµInputStream"></a>8.5.1 è¾“å…¥å­—èŠ‚æµInputStream</h2><ol><li><p>ByteArrayInputStreamï¼šå­—èŠ‚æ•°ç»„è¾“å…¥æµï¼Œè¯¥ç±»çš„åŠŸèƒ½å°±æ˜¯ä»å­—èŠ‚æ•°ç»„(byte[])ä¸­è¿›è¡Œä»¥å­—èŠ‚ä¸ºå•ä½çš„è¯»å–ï¼Œä¹Ÿå°±æ˜¯å°†èµ„æºæ–‡ä»¶éƒ½ä»¥å­—èŠ‚çš„å½¢å¼å­˜å…¥åˆ°è¯¥ç±»ä¸­çš„å­—èŠ‚æ•°ç»„ä¸­ã€‚</p></li><li><p>PipedInputStreamï¼šç®¡é“å­—èŠ‚è¾“å…¥æµï¼Œå®ƒå’ŒPipedOutputStreamä¸€èµ·ä½¿ç”¨ï¼Œèƒ½å®ç°å¤šçº¿ç¨‹é—´çš„ç®¡é“é€šä¿¡ã€‚</p></li><li><p>FilterInputStream : è£…é¥°è€…æ¨¡å¼ä¸­å¤„äºè£…é¥°è€…ï¼Œå…·ä½“çš„è£…é¥°è€…éƒ½è¦ç»§æ‰¿å®ƒï¼Œæ‰€ä»¥åœ¨è¯¥ç±»çš„å­ç±»ä¸‹éƒ½æ˜¯ç”¨æ¥è£…é¥°åˆ«çš„æµçš„ï¼Œä¹Ÿå°±æ˜¯å¤„ç†ç±»ã€‚å…·ä½“è£…é¥°è€…æ¨¡å¼åœ¨ä¸‹é¢ä¼šè®²è§£åˆ°ï¼Œåˆ°æ—¶å°±æ˜ç™½äº†ã€‚</p></li><li><p>BufferedInputStream: ç¼“å†²æµï¼Œå¯¹å¤„ç†æµè¿›è¡Œè£…é¥°ï¼Œå¢å¼ºï¼Œå†…éƒ¨ä¼šæœ‰ä¸€ä¸ªç¼“å­˜åŒºï¼Œç”¨æ¥å­˜æ”¾å­—èŠ‚ï¼Œæ¯æ¬¡éƒ½æ˜¯å°†ç¼“å­˜åŒºå­˜æ»¡ç„¶åå‘é€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—èŠ‚æˆ–ä¸¤ä¸ªå­—èŠ‚è¿™æ ·å‘é€ã€‚æ•ˆç‡æ›´é«˜ã€‚</p></li><li><p>DataInputStreamï¼šæ•°æ®è¾“å…¥æµï¼Œå®ƒæ˜¯ç”¨æ¥è£…é¥°å…¶å®ƒè¾“å…¥æµï¼Œå®ƒâ€œå…è®¸åº”ç”¨ç¨‹åºä»¥ä¸æœºå™¨æ— å…³æ–¹å¼ä»åº•å±‚è¾“å…¥æµä¸­è¯»å–åŸºæœ¬ Java æ•°æ®ç±»å‹â€ã€‚</p></li><li><p>FileInputSream: æ–‡ä»¶è¾“å…¥æµã€‚å®ƒé€šå¸¸ç”¨äºå¯¹æ–‡ä»¶è¿›è¡Œè¯»å–æ“ä½œã€‚</p></li><li><p>Fileï¼šå¯¹æŒ‡å®šç›®å½•çš„æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹è®²è§£Fileçš„åšæ–‡ã€‚æ³¨æ„ï¼Œè¯¥ç±»è™½ç„¶æ˜¯åœ¨IOåŒ…ä¸‹ï¼Œä½†æ˜¯å¹¶ä¸ç»§æ‰¿è‡ªå››å¤§åŸºç¡€ç±»ã€‚</p></li><li><p>ObjectInputStreamï¼šå¯¹è±¡è¾“å…¥æµï¼Œç”¨æ¥æä¾›å¯¹â€œåŸºæœ¬æ•°æ®æˆ–å¯¹è±¡â€çš„æŒä¹…å­˜å‚¨ã€‚åœ¨ååºåˆ—åŒ–ä¸­ä½¿ç”¨ã€‚</p></li></ol><h2 id="8-5-2-è¾“å‡ºå­—èŠ‚æµOutputStream"><a href="#8-5-2-è¾“å‡ºå­—èŠ‚æµOutputStream" class="headerlink" title="8.5.2 è¾“å‡ºå­—èŠ‚æµOutputStream"></a>8.5.2 è¾“å‡ºå­—èŠ‚æµOutputStream</h2><ol><li><p>OutputStream æ˜¯æ‰€æœ‰çš„è¾“å‡ºå­—èŠ‚æµçš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</p></li><li><p>ByteArrayOutputStreamã€FileOutputStream æ˜¯ä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å‘Byte æ•°ç»„ã€å’Œæœ¬åœ°æ–‡ä»¶ä¸­å†™å…¥æ•°æ®ã€‚PipedOutputStream æ˜¯å‘ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­å†™å…¥æ•°æ®ã€‚</p></li><li><p>ObjectOutputStream å’Œæ‰€æœ‰FilterOutputStream çš„å­ç±»éƒ½æ˜¯è£…é¥°æµï¼ŒåŒæ ·åœ¨åºåˆ—åŒ–ä¸­ä½¿ç”¨ã€‚</p></li></ol><h2 id="8-5-3-å­—ç¬¦è¾“å…¥æµ-Reader"><a href="#8-5-3-å­—ç¬¦è¾“å…¥æµ-Reader" class="headerlink" title="8.5.3 å­—ç¬¦è¾“å…¥æµ Reader"></a>8.5.3 å­—ç¬¦è¾“å…¥æµ Reader</h2><ol><li><p>Reader : æ‰€æœ‰çš„è¾“å…¥å­—ç¬¦æµçš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</p></li><li><p>CharReader ã€StringReaderï¼šä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å°†Char æ•°ç»„ã€Stringä¸­è¯»å–æ•°æ®ã€‚ PipedReader æ˜¯ä»ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­è¯»å–æ•°æ®ã€‚</p></li><li><p>BufferedReader : ä¸€ä¸ªè£…é¥°å™¨ï¼Œå®ƒå’Œå…¶å­ç±»è´Ÿè´£è£…é¥°å…¶å®ƒReader å¯¹è±¡ã€‚</p></li><li><p>FilterReader: æ‰€æœ‰è‡ªå®šä¹‰å…·ä½“è£…é¥°æµçš„çˆ¶ç±»ï¼Œå…¶å­ç±»PushbackReader å¯¹Reader å¯¹è±¡è¿›è¡Œè£…é¥°ï¼Œä¼šå¢åŠ ä¸€ä¸ªè¡Œå·ã€‚</p></li><li><p>InputstreamReader : ä¸€ä¸ªè¿æ¥å­—èŠ‚æµå’Œå­—ç¬¦æµçš„æ¡¥æ¢ï¼Œå®ƒå°†å­—èŠ‚æµè½¬å˜ä¸ºå­—ç¬¦æµã€‚ FileReader å¯ä»¥è¯´æ˜¯ä¸€ä¸ªè¾¾åˆ°æ­¤åŠŸèƒ½ã€å¸¸ç”¨çš„å·¥å…·ç±»ï¼Œåœ¨å…¶æºä»£ç ä¸­æ˜æ˜¾ä½¿ç”¨äº†å°†FileInputStream è½¬å˜ä¸º Reader çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªç±»ä¸­å¾—åˆ°ä¸€å®šçš„æŠ€å·§ã€‚Reader ä¸­å„ä¸ªç±»çš„ç”¨é€”å’Œä½¿ç”¨æ–¹æ³•åŸºæœ¬å’Œ InputStream ä¸­çš„ç±»ä½¿ç”¨ä¸€è‡´ã€‚åé¢ä¼šæœ‰Reader ä¸InputStream çš„å¯¹åº”å…³ç³»ã€‚</p></li></ol><h2 id="8-5-4-å­—ç¬¦è¾“å‡ºæµWriter"><a href="#8-5-4-å­—ç¬¦è¾“å‡ºæµWriter" class="headerlink" title="8.5.4 å­—ç¬¦è¾“å‡ºæµWriter"></a>8.5.4 å­—ç¬¦è¾“å‡ºæµWriter</h2><ol><li><p>Writerï¼šæ‰€æœ‰çš„è¾“å‡ºå­—ç¬¦æµçš„çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ã€‚</p></li><li><p>CharArrayWriterã€StringWriterï¼šä¸¤ç§åŸºæœ¬çš„ä»‹è´¨æµï¼Œå®ƒä»¬åˆ†åˆ«å‘Char æ•°ç»„ã€String ä¸­å†™å…¥æ•°æ®ã€‚PipedWriter æ˜¯å‘ä¸å…¶å®ƒçº¿ç¨‹å…±ç”¨çš„ç®¡é“ä¸­å†™å…¥æ•°æ®ï¼Œ</p></li><li><p>BufferedWriter: ä¸€ä¸ªè£…é¥°å™¨ä¸ºWriter æä¾›ç¼“å†²åŠŸèƒ½ã€‚</p></li><li><p>PrintWriter å’ŒPrintStream æå…¶ç±»ä¼¼ï¼ŒåŠŸèƒ½å’Œä½¿ç”¨ä¹Ÿéå¸¸ç›¸ä¼¼ã€‚</p></li><li><p>OutputStreamWriter æ˜¯OutputStream åˆ°Writer è½¬æ¢çš„æ¡¥æ¢ï¼Œå®ƒçš„å­ç±»FileWriter å…¶å®å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªå®ç°æ­¤åŠŸèƒ½çš„ç±»ã€‚åŠŸèƒ½å’Œä½¿ç”¨å’ŒOutputStreamç±»ä¼¼ã€‚</p></li></ol><h2 id="8-6-Java-IOæµæ–¹æ³•"><a href="#8-6-Java-IOæµæ–¹æ³•" class="headerlink" title="8.6 Java IOæµæ–¹æ³•"></a>8.6 Java IOæµæ–¹æ³•</h2><h2 id="8-6-1-å­—èŠ‚æµæ–¹æ³•"><a href="#8-6-1-å­—èŠ‚æµæ–¹æ³•" class="headerlink" title="8.6.1 å­—èŠ‚æµæ–¹æ³•"></a>8.6.1 å­—èŠ‚æµæ–¹æ³•</h2><p>å­—èŠ‚è¾“å…¥æµInputStreamä¸»è¦æ–¹æ³•:</p><p>read() : ä»æ­¤è¾“å…¥æµä¸­è¯»å–ä¸€ä¸ªæ•°æ®å­—èŠ‚ã€‚</p><p>read(byte[] b) : ä»æ­¤è¾“å…¥æµä¸­å°†æœ€å¤š b.length ä¸ªå­—èŠ‚çš„æ•°æ®è¯»å…¥ä¸€ä¸ª byte æ•°ç»„ä¸­ã€‚</p><p>read(byte[] b, int off, int len) : ä»æ­¤è¾“å…¥æµä¸­å°†æœ€å¤š len ä¸ªå­—èŠ‚çš„æ•°æ®è¯»å…¥ä¸€ä¸ª byte æ•°ç»„ä¸­ã€‚</p><p>close(): å…³é—­æ­¤è¾“å…¥æµå¹¶é‡Šæ”¾ä¸è¯¥æµå…³è”çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚</p><p>å­—èŠ‚è¾“å‡ºæµOutputStreamä¸»è¦æ–¹æ³•:</p><p>write(byte[] b) : å°† b.length ä¸ªå­—èŠ‚ä»æŒ‡å®š byte æ•°ç»„å†™å…¥æ­¤æ–‡ä»¶è¾“å‡ºæµä¸­ã€‚</p><p>write(byte[] b, int off, int len) : å°†æŒ‡å®š byte æ•°ç»„ä¸­ä»åç§»é‡ off å¼€å§‹çš„ len ä¸ªå­—èŠ‚å†™å…¥æ­¤æ–‡ä»¶è¾“å‡ºæµã€‚</p><p>write(int b) : å°†æŒ‡å®šå­—èŠ‚å†™å…¥æ­¤æ–‡ä»¶è¾“å‡ºæµã€‚</p><p>close() : å…³é—­æ­¤è¾“å…¥æµå¹¶é‡Šæ”¾ä¸è¯¥æµå…³è”çš„æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚</p><h2 id="8-6-2-å­—ç¬¦æµæ–¹æ³•"><a href="#8-6-2-å­—ç¬¦æµæ–¹æ³•" class="headerlink" title="8.6.2 å­—ç¬¦æµæ–¹æ³•"></a>8.6.2 å­—ç¬¦æµæ–¹æ³•</h2><p>å­—ç¬¦è¾“å…¥æµReaderä¸»è¦æ–¹æ³•:</p><p>read(): è¯»å–å•ä¸ªå­—ç¬¦ã€‚</p><p>read(char[] cbuf) : å°†å­—ç¬¦è¯»å…¥æ•°ç»„ã€‚</p><p>read(char[] cbuf, int off, int len) : å°†å­—ç¬¦è¯»å…¥æ•°ç»„çš„æŸä¸€éƒ¨åˆ†ã€‚</p><p>read(CharBuffer target) : è¯•å›¾å°†å­—ç¬¦è¯»å…¥æŒ‡å®šçš„å­—ç¬¦ç¼“å†²åŒºã€‚</p><p>flush() : åˆ·æ–°è¯¥æµçš„ç¼“å†²ã€‚</p><p>close() : å…³é—­æ­¤æµï¼Œä½†è¦å…ˆåˆ·æ–°å®ƒã€‚</p><p>å­—ç¬¦è¾“å‡ºæµWriterä¸»è¦æ–¹æ³•:</p><p>write(char[] cbuf) ï¼šå†™å…¥å­—ç¬¦æ•°ç»„ã€‚</p><p>write(char[] cbuf, int off, int len) : å†™å…¥å­—ç¬¦æ•°ç»„çš„æŸä¸€éƒ¨åˆ†ã€‚</p><p>write(int c) : å†™å…¥å•ä¸ªå­—ç¬¦ã€‚</p><p>write(String str) : å†™å…¥å­—ç¬¦ä¸²ã€‚</p><p>write(String str, int off, int len) : å†™å…¥å­—ç¬¦ä¸²çš„æŸä¸€éƒ¨åˆ†ã€‚</p><p>flush() : åˆ·æ–°è¯¥æµçš„ç¼“å†²ã€‚</p><p>close() ï¼šå…³é—­æ­¤æµï¼Œä½†è¦å…ˆåˆ·æ–°å®ƒã€‚</p><p>BufferedWriterç±»newLine() : å†™å…¥ä¸€ä¸ªè¡Œåˆ†éš”ç¬¦ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè‡ªåŠ¨é€‚é…æ‰€åœ¨ç³»ç»Ÿçš„è¡Œåˆ†éš”ç¬¦ã€‚</p><p>BufferedReaderç±»readLine() : è¯»å–ä¸€ä¸ªæ–‡æœ¬è¡Œã€‚</p><h2 id="8-7-å­—èŠ‚æµä¸å­—ç¬¦æµçš„è½¬æ¢"><a href="#8-7-å­—èŠ‚æµä¸å­—ç¬¦æµçš„è½¬æ¢" class="headerlink" title="8.7 å­—èŠ‚æµä¸å­—ç¬¦æµçš„è½¬æ¢"></a>8.7 å­—èŠ‚æµä¸å­—ç¬¦æµçš„è½¬æ¢</h2><p>å­—èŠ‚æµä¸å­—ç¬¦æµçš„è½¬æ¢ä¸»è¦ç”¨äºæ–‡æœ¬æ–‡ä»¶åœ¨ç¡¬ç›˜ä¸­ä»¥å­—èŠ‚æµçš„å½¢å¼å­˜å‚¨æ—¶ï¼Œé€šè¿‡InputStreamReaderè¯»å–åè½¬åŒ–ä¸ºå­—ç¬¦æµç»™ç¨‹åºå¤„ç†ï¼Œç¨‹åºå¤„ç†çš„å­—ç¬¦æµé€šè¿‡OutputStreamWriterè½¬æ¢ä¸ºå­—èŠ‚æµä¿å­˜ã€‚</p><p>è½¬æ¢æµæœ‰å“ªäº›åŸºæœ¬ç‰¹ç‚¹å‘¢?</p><ol><li><p>æ˜¯å­—ç¬¦æµå’Œå­—èŠ‚æµä¹‹é—´çš„æ¡¥æ¢</p></li><li><p>å¯å¯¹è¯»å–åˆ°çš„å­—èŠ‚æ•°æ®ç»è¿‡æŒ‡å®šç¼–ç è½¬æ¢æˆå­—ç¬¦</p></li><li><p>å¯å¯¹è¯»å–åˆ°çš„å­—ç¬¦æ•°æ®ç»è¿‡æŒ‡å®šç¼–ç è½¬æ¢æˆå­—èŠ‚</p></li></ol><p>é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä½¿ç”¨è½¬æ¢æµå‘¢?</p><ol><li><p>å½“å­—èŠ‚å’Œå­—ç¬¦ä¹‹é—´æœ‰è½¬æ¢åŠ¨ä½œ</p></li><li><p>æµæ“ä½œçš„æ•°æ®éœ€è¦ç¼–ç æˆ–è§£ç </p></li></ol><p>å…·ä½“çš„å¯¹è±¡ä½“ç°åœ¨å“ªäº›æ–¹é¢?</p><ol><li><p>InputStreamReader:å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢</p></li><li><p>OutputStreamwriter:å­—ç¬¦åˆ°å­—èŠ‚çš„æ¡¥æ¢</p></li></ol><p>è¿™ä¸¤ä¸ªæµå¯¹è±¡æ˜¯å­—ç¬¦ä½“ç³»ä¸­çš„æˆå‘˜ï¼Œå®ƒä»¬æœ‰è½¬æ¢ä½œç”¨ï¼Œæœ¬èº«åˆæ˜¯å­—ç¬¦æµï¼Œæ‰€ä»¥åœ¨æ„é€ çš„æ—¶å€™éœ€è¦ä¼ å…¥å­—èŠ‚æµå¯¹è±¡è¿›æ¥ã€‚</p><ol><li><p>Outputstreamwriter(Outstreamout) :å°†å­—èŠ‚æµä»¥å­—ç¬¦æµè¾“å‡ºã€‚</p></li><li><p>InputstreamReader(Inputstream in): å°†å­—èŠ‚æµä»¥å­—ç¬¦æµè¾“å…¥ã€‚</p></li></ol><p>public class IOTest {</p><p>public static void write(File file) throws IOException {</p><p>&#x2F;&#x2F; OutputStreamwriterå¯ä»¥æ˜¾ç¤ºæŒ‡å®šå­—ç¬¦é›†, å¦åˆ™ä½¿ç”¨é»˜è®¤å­—ç¬¦é›†</p><p>OutputStreamwriter osw &#x3D; new OutputStreamWriter(new</p><p>FileOutputStream(file, true), â€œUTF-8â€);</p><p>&#x2F;&#x2F; è¦å†™å…¥çš„å­—ç¬¦ä¸²</p><p>string string ( &#x3D; ) â€œæ¾ä¸‹é—®ç«¥å­,è¨€å¸ˆé‡‡è¯å»ã€‚åªåœ¨æ­¤å±±ä¸­,äº‘æ·±ä¸çŸ¥å¤„ã€‚â€;</p><p>osw.write(string);</p><p>osw.close();</p><p>}</p><p>public static String read(File file) throws IOException {</p><p>InputStreamReader isr &#x3D; new InputStreamReader(new FileInputStream(file),</p><p>â€œUTF-8â€);</p><p>&#x2F;&#x2F; å­—ç¬¦æ•°ç»„: ä¸€æ¬¡è¯»å–å¤šå°‘ä¸ªå­—ç¬¦</p><p>char[] chars ( &#x3D; ) new char[1024];</p><p>&#x2F;&#x2F; æ¯æ¬¡è¯»å–çš„å­—ç¬¦æ•°ç»„å…ˆappendåˆ°StringBuilderä¸­</p><p>StringBuilder ( \mathrm &#x3D; ) new StringBuilder();</p><p>&#x2F;&#x2F; è¯»å–åˆ°çš„å­—ç¬¦æ•°ç»„é•¿åº¦, ä¸º-1æ—¶è¡¨ç¤ºæ²¡æœ‰æ•°æ®</p><p>int length;</p><p>&#x2F;&#x2F; å¾ªç¯å–æ•°æ®</p><p>while ((length &#x3D; isr.read(chars)) !&#x3D; -1) {</p><p>&#x2F;&#x2F; å°†è¯»å–çš„å†…å®¹è½¬æ¢æˆå­—ç¬¦ä¸²</p><p>sb.append(chars, 0, length);</p><p>}</p><p>&#x2F;&#x2F; å…³é—­æµ</p><p>isr.close();</p><p>return sb.toString()</p><p>}</p><h2 id="8-8-å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«"><a href="#8-8-å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«" class="headerlink" title="8.8 å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«"></a>8.8 å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«</h2><ol><li><p>è¯»å†™çš„å•ä½æœ‰æ‰€ä¸åŒï¼šå­—èŠ‚æµä»¥å­—èŠ‚ (8bit) ä¸ºå•ä½ï¼Œå­—ç¬¦æµä»¥å­—ç¬¦ä¸ºå•ä½ï¼Œæ ¹æ®ç è¡¨æ˜ å°„å­—ç¬¦ï¼Œ ä¸€æ¬¡å¯èƒ½è¯»å¤šä¸ªå­—èŠ‚ã€‚</p></li><li><p>å¤„ç†çš„å¯¹è±¡æœ‰æ‰€ä¸åŒï¼šå­—èŠ‚æµèƒ½å¤„ç†æ‰€æœ‰ç±»å‹çš„æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€aviç­‰ï¼‰ï¼Œè€Œå­—ç¬¦æµåªèƒ½å¤„ç†å­—ç¬¦ç±»å‹çš„æ•°æ®ã€‚</p></li><li><p>å­—èŠ‚æµæ²¡æœ‰ç¼“å†²åŒºï¼Œæ˜¯ç›´æ¥è¾“å‡ºçš„ï¼Œè€Œå­—ç¬¦æµæ˜¯è¾“å‡ºåˆ°ç¼“å†²åŒºçš„ã€‚å› æ­¤åœ¨è¾“å‡ºæ—¶ï¼Œå­—èŠ‚æµä¸è°ƒç”¨ colse()æ–¹æ³•æ—¶ï¼Œä¿¡æ¯å·²ç»è¾“å‡ºäº†ï¼Œè€Œå­—ç¬¦æµåªæœ‰åœ¨è°ƒç”¨close()æ–¹æ³•å…³é—­ç¼“å†²åŒºæ—¶ï¼Œä¿¡æ¯æ‰è¾“å‡ºã€‚è¦æƒ³å­—ç¬¦æµåœ¨æœªå…³é—­æ—¶è¾“å‡ºä¿¡æ¯ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è°ƒç”¨flush()æ–¹æ³•ã€‚</p></li></ol><h2 id="8-9-å°ç»“"><a href="#8-9-å°ç»“" class="headerlink" title="8.9 å°ç»“"></a>8.9 å°ç»“</h2><p>æƒ³è¦æ›´ç³»ç»Ÿçš„å­¦ä¹ java IOç³»ç»Ÿï¼Œé™¤äº†æŒæ¡è¿™äº›åŸºç¡€çš„IOçŸ¥è¯†ä»¥å¤–ï¼Œé‡ç‚¹æ˜¯è¦å­¦ä¼šIOæ¨¡å‹ï¼Œäº†è§£äº†å„ç§IO æ¨¡å‹ä¹‹åæ‰å¯ä»¥æ›´å¥½çš„ç†è§£java IOï¼Œæ‰€ä»¥å¤§å®¶åœ¨çœ‹äº†è¿™ç¯‡æ–‡ç« ä¹‹åè¿˜éœ€è¦å†å»æ·±å…¥å­¦ä¹ ä¸€äº›å…³äºIOæ¨¡å‹çš„çŸ¥è¯†ä¸è¿ç”¨å“¦~</p><h1 id="9-Java-æ³¨è§£è¯¦è§£"><a href="#9-Java-æ³¨è§£è¯¦è§£" class="headerlink" title="9. Java æ³¨è§£è¯¦è§£"></a>9. Java æ³¨è§£è¯¦è§£</h1><p>æ³¨è§£ï¼Œè‹±æ–‡åAnnotationã€‚å®˜æ–¹æ–‡æ¡£ä¸­å¯¹æ³¨è§£çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼šJavaæ³¨è§£ç”¨äºä¸ºJavaä»£ç æä¾›å…ƒæ•°æ®ã€‚ ä½œä¸ºå…ƒæ•°æ®ï¼Œæ³¨è§£ä¸ç›´æ¥å½±å“ä½ çš„ä»£ç è¿è¡Œï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç±»å‹çš„æ³¨è§£å®é™…ä¸Šå¯ä»¥ç”¨äºè¿™äº›ç›®çš„ã€‚</p><p>Javaæ³¨è§£æ˜¯ä» Java5 å¼€å§‹æ·»åŠ åˆ° Java é‡Œé¢çš„ã€‚çœ‹å®Œè¿™å¥è¯ä½ å¯èƒ½å¯¹æ³¨è§£çš„å®šä¹‰è¿˜æ˜¯ä¸€å¤´é›¾æ°´ï¼Œæ¥ä¸‹æ¥å°±å’Œæˆ‘ä¸€èµ·ç»“åˆæ¡ˆä¾‹æ¥æ·±å…¥å­¦ä¹ Javaæ³¨è§£ç›¸å…³çš„çŸ¥è¯†å§ã€‚</p><h2 id="9-1-ä»€ä¹ˆæ˜¯æ³¨è§£"><a href="#9-1-ä»€ä¹ˆæ˜¯æ³¨è§£" class="headerlink" title="9.1 ä»€ä¹ˆæ˜¯æ³¨è§£?"></a>9.1 ä»€ä¹ˆæ˜¯æ³¨è§£?</h2><p>æ—¥å¸¸å¼€å‘ä¸­æ–°å»º Java ç±»ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ classã€interface ç­‰ï¼Œè€Œæ³¨è§£åŒæ ·ä¹Ÿå±äºä¸€ç§ç±»ï¼Œåªä¸è¿‡å®ƒçš„ä¿®é¥°ç¬¦æ˜¯ â€˜@interfaceâ€™ã€‚</p><p>public interface override extends Annotation {</p><p>ä¸€ä¸ªæ³¨è§£å‡†ç¡®æ„ä¹‰ä¸Šæ¥è¯´ï¼Œåªä¸è¿‡æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ³¨é‡Šè€Œå·²ï¼Œå¦‚æœæ²¡æœ‰è§£æå®ƒçš„ä»£ç ï¼Œå®ƒå¯èƒ½è¿æ³¨é‡Šéƒ½ä¸æ˜¯ã€‚</p><h2 id="9-2-å…ƒæ³¨è§£æ¢ç§˜"><a href="#9-2-å…ƒæ³¨è§£æ¢ç§˜" class="headerlink" title="9.2 å…ƒæ³¨è§£æ¢ç§˜"></a>9.2 å…ƒæ³¨è§£æ¢ç§˜</h2><p>å…ƒæ³¨è§£æ˜¯ç”¨äºä¿®é¥°æ³¨è§£çš„æ³¨è§£ï¼Œé€šå¸¸ç”¨åœ¨æ³¨è§£çš„å®šä¹‰ä¸Šã€‚</p><p>Java ä¸­å…ƒæ³¨è§£æœ‰ä»¥ä¸‹å‡ ç§å½¢å¼:</p><ul><li><p>@Target: æ³¨è§£çš„ä½œç”¨ç›®æ ‡</p></li><li><p>@Inherited: æ˜¯å¦å…è®¸å­ç±»ç»§æ‰¿è¯¥æ³¨è§£</p></li><li><p>@Retention: æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ</p></li><li><p>@Documented: æ³¨è§£æ˜¯å¦åº”å½“è¢«åŒ…å«åœ¨ JavaDoc æ–‡æ¡£ä¸­</p></li><li><p>@Repeatableï¼šè¯´æ˜è¢«è¿™ä¸ªå…ƒæ³¨è§£ä¿®é¥°çš„æ³¨è§£å¯ä»¥åŒæ—¶ä½œç”¨ä¸€ä¸ªå¯¹è±¡å¤šæ¬¡ï¼Œæ¯æ¬¡ä½œç”¨æ³¨è§£ä»£è¡¨ä¸åŒçš„å«ä¹‰</p></li></ul><h2 id="9-2-1-Target"><a href="#9-2-1-Target" class="headerlink" title="9.2.1 Target"></a>9.2.1 Target</h2><ul><li><p>@Targetå…ƒæ³¨è§£è¡¨ç¤ºæˆ‘ä»¬çš„æ³¨è§£ä½œç”¨çš„èŒƒå›´å°±å¾ˆå¤§ï¼Œæœ‰ç±»ï¼Œæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°å˜é‡ç­‰ï¼Œè¿˜å¯é€šè¿‡æšä¸¾ç±»ElementTypeæ¥è¡¨ç¤ºä½œç”¨ç±»å‹ã€‚</p></li><li><p>@Target(ElementType.TYPE) ä½œç”¨æ¥å£ã€ç±»ã€æšä¸¾ã€æ³¨è§£ã€‚</p></li><li><p>@Target(ElementType.FIELD) ä½œç”¨å±æ€§å­—æ®µã€æšä¸¾çš„å¸¸é‡ã€‚</p></li><li><p>@Target(ElementType.METHOD) ä½œç”¨æ–¹æ³•ã€‚</p></li><li><p>@Target(ElementType.PARAMETER) ä½œç”¨æ–¹æ³•å‚æ•°ã€‚</p></li><li><p>@Target(ElementType.CONSTRUCTOR) ä½œç”¨æ„é€ å‡½æ•°ã€‚</p></li><li><p>@Target(ElementType.LOCAL_VARIABLE) ä½œç”¨å±€éƒ¨å˜é‡ã€‚</p></li><li><p>@Target(ElementType.ANNOTATION_TYPE) ä½œç”¨äºæ³¨è§£ (@Retentionæ³¨è§£ä¸­å°±ä½¿ç”¨è¯¥å±æ€§ï¼‰ã€‚</p></li><li><p>@Target(ElementType.PACKAGE) ä½œç”¨äºåŒ…ã€‚</p></li><li><p>@Target(ElementType.TYPE_PARAMETER) ä½œç”¨äºç±»å‹æ³›å‹ï¼Œå³æ³›å‹æ–¹æ³•ã€æ³›å‹ç±»ã€æ³›å‹æ¥å£ ï¼ˆjdk1.8åŠ å…¥ï¼‰ã€‚</p></li><li><p>( @ ) Target(ElementType.TYPE_USE) ç±»å‹ä½¿ç”¨.å¯ä»¥ç”¨äºæ ‡æ³¨ä»»æ„ç±»å‹é™¤äº† class (jdk1.8åŠ å…¥) - èˆ¬æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ElementType.TYPEç±»å‹ã€‚</p></li></ul><p>PSï¼š@Target ç”¨äºæŒ‡æ˜è¢«ä¿®é¥°çš„æ³¨è§£æœ€ç»ˆå¯ä»¥ä½œç”¨çš„ç›®æ ‡æ˜¯è°ï¼Œä¹Ÿå°±æ˜¯æŒ‡æ˜ï¼Œä½ çš„æ³¨è§£åˆ°åº•æ˜¯ç”¨æ¥ä¿®é¥°æ–¹æ³•ã€ä¿®é¥°ç±»äº¦æˆ–è€…æ˜¯ç”¨æ¥ä¿®é¥°å­—æ®µå±æ€§çš„ã€‚</p><h2 id="9-2-2-Inherited"><a href="#9-2-2-Inherited" class="headerlink" title="9.2.2 @Inherited"></a>9.2.2 @Inherited</h2><ul><li>Inherited çš„æ„æ€æ˜¯ç»§æ‰¿ï¼Œä½†æ˜¯è¿™ä¸ªç»§æ‰¿å’Œæˆ‘ä»¬å¹³æ—¶ç†è§£çš„ç»§æ‰¿å¤§åŒå°å¼‚ï¼Œä¸€ä¸ªè¢« @Inherited æ³¨è§£äº†çš„æ³¨è§£ä¿®é¥°äº†ä¸€ä¸ªçˆ¶ç±»ï¼Œå¦‚æœä»–çš„å­ç±»æ²¡æœ‰è¢«å…¶ä»–æ³¨è§£ä¿®é¥°ï¼Œåˆ™å®ƒçš„å­ç±»ä¹Ÿç»§æ‰¿äº†çˆ¶ç±»çš„æ³¨è§£ã€‚</li></ul><h2 id="è‡ªå®šä¹‰æ³¨è§£"><a href="#è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="&#x2F;*è‡ªå®šä¹‰æ³¨è§£&#x2F;"></a>&#x2F;*<em>è‡ªå®šä¹‰æ³¨è§£</em>&#x2F;</h2><p>@Documented</p><p>@Inherited</p><p>@Retention(RetentionPolicy.RUNTIME)</p><p>@Target(ElementType.TYPE)</p><p>public @interface MyTestAnnotation {</p><p>}</p><p>&#x2F;*<em>çˆ¶ç±»æ ‡æ³¨è‡ªå®šä¹‰æ³¨è§£</em>&#x2F;</p><p>@MyTestAnnotation</p><p>public class Father {</p><p>}</p><p>&#x2F;*<em>å­ç±»</em>&#x2F;</p><p>public class Son extends Father {</p><p>}</p><p>&#x2F;*<em>æµ‹è¯•å­ç±»è·å–çˆ¶ç±»è‡ªå®šä¹‰æ³¨è§£</em>&#x2F;</p><p>public class test {</p><p>public static void main(String[] args){</p><p>&#x2F;&#x2F;è·å–Sonçš„classå¯¹è±¡</p><p>Class<Son> sonClass &#x3D; Son.class;</p><p>&#x2F;&#x2F; è·å–Sonç±»ä¸Šçš„æ³¨è§£MyTestAnnotationå¯ä»¥æ‰§è¡ŒæˆåŠŸ</p><p>MyTestAnnotation annotation ( &#x3D; )</p><p>sonClass.getAnnotation(MyTestAnnotation.class);</p><p>}</p><p>}</p><h2 id="9-2-3-Retention"><a href="#9-2-3-Retention" class="headerlink" title="9.2.3 @Retention"></a>9.2.3 @Retention</h2><ul><li><p>Retentionæœ‰ä¿ç•™ã€ä¿æŒçš„æ„æ€ï¼Œå®ƒè¡¨ç¤ºæ³¨è§£å­˜åœ¨é˜¶æ®µæ˜¯ä¿ç•™åœ¨æºç ï¼ˆç¼–è¯‘æœŸï¼‰ï¼Œå­—èŠ‚ç ï¼ˆç±»åŠ è½½ï¼‰ æˆ–è€…è¿è¡ŒæœŸï¼ˆJVMä¸­è¿è¡Œï¼‰ã€‚åœ¨@Retentionæ³¨è§£ä¸­ä½¿ç”¨æšä¸¾RetentionPolicyæ¥è¡¨ç¤ºæ³¨è§£ä¿ç•™æ—¶æœŸã€‚</p></li><li><p>@Retention(RetentionPolicy.CLASS)ï¼Œé»˜è®¤çš„ä¿ç•™ç­–ç•¥ï¼Œæ³¨è§£ä¼šåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œä½†è¿è¡Œæ—¶æ— æ³•è·å¾—ã€‚</p></li><li><p>@Retention(RetentionPolicy.SOURCE)ï¼Œæ³¨è§£ä»…å­˜åœ¨äºæºç ä¸­ï¼Œåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­å¹¶ä¸åŒ…å«ã€‚</p></li><li><p>@Retention(RetentionPolicy.RUNTIME)ï¼Œæ³¨è§£ä¼šåœ¨classå­—èŠ‚ç æ–‡ä»¶ä¸­å­˜åœ¨ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„è·å–åˆ°ã€‚</p></li><li><p>å¦‚æœæˆ‘ä»¬æ˜¯è‡ªå®šä¹‰æ³¨è§£ï¼Œåˆ™é€šè¿‡å‰é¢åˆ†æï¼Œæˆ‘ä»¬è‡ªå®šä¹‰æ³¨è§£å¦‚æœåªå­˜ç€æºç ä¸­æˆ–è€…å­—èŠ‚ç æ–‡ä»¶ä¸­å°±æ— æ³•å‘æŒ¥ä½œç”¨ï¼Œè€Œåœ¨è¿è¡ŒæœŸé—´èƒ½è·å–åˆ°æ³¨è§£æ‰èƒ½å®ç°æˆ‘ä»¬ç›®çš„ï¼Œæ‰€ä»¥è‡ªå®šä¹‰æ³¨è§£ä¸­è‚¯å®šæ˜¯ä½¿ç”¨ @Retention(RetentionPolicy.RUNTIME)ã€‚</p></li></ul><h2 id="9-2-4-Documented"><a href="#9-2-4-Documented" class="headerlink" title="9.2.4 @Documented"></a>9.2.4 @Documented</h2><ul><li>Documentçš„è‹±æ–‡æ„æ€æ˜¯æ–‡æ¡£ã€‚å®ƒçš„ä½œç”¨æ˜¯èƒ½å¤Ÿå°†æ³¨è§£ä¸­çš„å…ƒç´ åŒ…å«åˆ° Javadoc ä¸­å»ã€‚</li></ul><h2 id="9-2-5-Repeatable"><a href="#9-2-5-Repeatable" class="headerlink" title="9.2.5 @Repeatable"></a>9.2.5 @Repeatable</h2><ul><li>Repeatableè¡¨ç¤ºå¯é‡å¤çš„ã€‚ä»å­—é¢æ„æ€æ¥ç†è§£å°±æ˜¯è¯´æ˜è¢«è¿™ä¸ªå…ƒæ³¨è§£ä¿®é¥°çš„æ³¨è§£å¯ä»¥åŒæ—¶ä½œç”¨ä¸€ä¸ªå¯¹è±¡å¤šæ¬¡ï¼Œä½†æ˜¯æ¯æ¬¡ä½œç”¨æ³¨è§£åˆå¯ä»¥ä»£è¡¨ä¸åŒçš„å«ä¹‰ã€‚</li></ul><hr><p>&#x2F;*<em>å°Yå–œæ¬¢ç©æ¸¸æˆ, ä»–å–œæ¬¢ç©è‹±é›„è”ç›Ÿ, ç»åœ°æ±‚ç”Ÿ, æå“é£è½¦, å°˜åŸƒ4ç­‰, åˆ™æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªäººçš„æ³¨è§£, ä»–å±æ€§ä»£è¡¨å–œæ¬¢ç©æ¸¸æˆé›†åˆ, ä¸€ä¸ªæ¸¸æˆæ³¨è§£, æ¸¸æˆå±æ€§ä»£è¡¨æ¸¸æˆåç§°</em>&#x2F;</p><p>&#x2F;*<em>ç©å®¶æ³¨è§£</em>&#x2F;</p><p>@Documented</p><p>@Retention(RetentionPolicy.RUNTIME)</p><p>@Target(ElementType.TYPE)</p><p>public @interface People {</p><p>Game[] value() ;</p><p>}</p><p>&#x2F;*<em>æ¸¸æˆæ³¨è§£</em>&#x2F;</p><hr><p>@Repeatable(People.class)</p><p>@Retention(RetentionPolicy.RUNTIME)</p><p>@Target(ElementType.TYPE)</p><p>public @interface Game {</p><p>String value() default â€œâ€;</p><p>}</p><p>&#x2F;*<em>ç©æ¸¸æˆç±»</em>&#x2F;</p><p>@Game(value &#x3D; â€œLOLâ€)</p><p>@Game(value &#x3D; â€œPUBGâ€)</p><p>@Game(value &#x3D; â€œNFSâ€)</p><p>@Game(value &#x3D; â€œDirt4â€)</p><p>public class PlayGame {</p><p>}</p><h2 id="9-3-æ³¨è§£å±æ€§çŸ¥å¤šå°‘"><a href="#9-3-æ³¨è§£å±æ€§çŸ¥å¤šå°‘" class="headerlink" title="9.3 æ³¨è§£å±æ€§çŸ¥å¤šå°‘"></a>9.3 æ³¨è§£å±æ€§çŸ¥å¤šå°‘</h2><p>æ³¨è§£çš„å±æ€§å…¶å®å’Œç±»ä¸­å®šä¹‰çš„å˜é‡æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ï¼Œåªæ˜¯æ³¨è§£ä¸­çš„å˜é‡éƒ½æ˜¯æˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰ï¼Œå¹¶ä¸”æ³¨è§£ä¸­æ˜¯æ²¡æœ‰æ–¹æ³•çš„ï¼Œåªæœ‰æˆå‘˜å˜é‡ï¼Œå˜é‡åå°±æ˜¯ä½¿ç”¨æ³¨è§£æ‹¬å·ä¸­å¯¹åº”çš„å‚æ•°åï¼Œå˜é‡è¿”å›å€¼æ³¨è§£æ‹¬å·ä¸­å¯¹åº”å‚æ•°ç±»å‹ã€‚ç›¸ä¿¡è¿™ä¼šä½ åº”è¯¥ä¼šå¯¹ä¸Šé¢çš„ä¾‹å­æœ‰ä¸€ä¸ªæ›´æ·±çš„è®¤è¯†ã€‚è€Œ ( @ ) Repeatable æ³¨è§£ä¸­çš„å˜é‡åˆ™ç±»å‹åˆ™æ˜¯å¯¹åº” Annotation (æ¥å£) çš„æ³›å‹ Classã€‚</p><p>&#x2F;*<em>æ³¨è§£Repeatableæºç </em>&#x2F;</p><p>@Documented</p><p>@Retention(RetentionPolicy.RUNTIME)</p><p>@Target(ElementType.ANNOTATION_TYPE)</p><p>public @interface Repeatable {</p><p>&#x2F;**</p><ul><li><p>Indicates the <em>containing annotation type</em> for the</p></li><li><p>repeatable annotation type.</p></li><li><p>@return the containing annotation type</p></li></ul><p>*&#x2F;</p><p>Class&lt;? extends Annotation&gt; value();</p><p>}</p><h1 id="9-è‡ªå®šä¹‰æ³¨è§£"><a href="#9-è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="9. è‡ªå®šä¹‰æ³¨è§£"></a>9. è‡ªå®šä¹‰æ³¨è§£</h1><h2 id="9-4-1-æ³¨è§£çš„æœ¬è´¨"><a href="#9-4-1-æ³¨è§£çš„æœ¬è´¨" class="headerlink" title="9.4.1 æ³¨è§£çš„æœ¬è´¨"></a>9.4.1 æ³¨è§£çš„æœ¬è´¨</h2><p>æ³¨è§£çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªAnnotationæ¥å£ã€‚</p><p>&#x2F;*<em>Annotationæ¥å£æºç </em>&#x2F;</p><p>public interface Annotation {</p><p>boolean equals(Object obj);</p><p>int hashCode();</p><p>Class&lt;? extends Annotation&gt; annotationType();</p><p>}</p><p>ä»ä¸Šè¿°ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ³¨è§£æœ¬èº«å°±æ˜¯Annotationæ¥å£çš„å­æ¥å£ï¼Œä¹Ÿå°±æ˜¯è¯´æ³¨è§£ä¸­å…¶å®æ˜¯å¯ä»¥æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯æ¥å£ä¸­çš„å±æ€§éƒ½æ˜¯static finalçš„ï¼Œå¯¹äºæ³¨è§£æ¥è¯´æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œè€Œæˆ‘ä»¬å®šä¹‰æ¥å£çš„æ–¹æ³•å°±ç›¸å½“äºæ³¨è§£çš„å±æ€§ï¼Œä¹Ÿå°±å¯¹åº”äº†å‰é¢è¯´çš„ä¸ºä»€ä¹ˆæ³¨è§£åªæœ‰å±æ€§æˆå‘˜å˜é‡ï¼Œå…¶å®ä»–å°±æ˜¯æ¥å£çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆå‘˜å˜é‡ä¼šæœ‰æ‹¬å·ï¼Œä¸åŒäºæ¥å£æˆ‘ä»¬å¯ä»¥åœ¨æ³¨è§£çš„æ‹¬å·ä¸­ç»™æˆå‘˜å˜é‡èµ‹å€¼ã€‚</p><h2 id="9-4-2-æ³¨è§£å±æ€§ç±»å‹"><a href="#9-4-2-æ³¨è§£å±æ€§ç±»å‹" class="headerlink" title="9.4.2 æ³¨è§£å±æ€§ç±»å‹"></a>9.4.2 æ³¨è§£å±æ€§ç±»å‹</h2><ul><li><p>åŸºæœ¬æ•°æ®ç±»å‹</p></li><li><p>String</p></li><li><p>æšä¸¾ç±»å‹</p></li><li><p>æ³¨è§£ç±»å‹</p></li><li><p>Classç±»å‹</p></li><li><p>ä»¥ä¸Šç±»å‹çš„ä¸€ç»´æ•°ç»„ç±»å‹</p></li></ul><h2 id="9-4-3-ä¸ºæ³¨è§£æˆå‘˜å˜é‡èµ‹å€¼"><a href="#9-4-3-ä¸ºæ³¨è§£æˆå‘˜å˜é‡èµ‹å€¼" class="headerlink" title="9.4.3 ä¸ºæ³¨è§£æˆå‘˜å˜é‡èµ‹å€¼"></a>9.4.3 ä¸ºæ³¨è§£æˆå‘˜å˜é‡èµ‹å€¼</h2><p>å¦‚æœæ³¨è§£åˆå¤šä¸ªå±æ€§ï¼Œåˆ™å¯ä»¥åœ¨æ³¨è§£æ‹¬å·ä¸­ç”¨â€œï¼Œâ€å·éš”å¼€åˆ†åˆ«ç»™å¯¹åº”çš„å±æ€§èµ‹å€¼ï¼Œå¦‚ä¸‹ä¾‹å­ï¼Œæ³¨è§£åœ¨çˆ¶ç±»ä¸­èµ‹å€¼å±æ€§ã€‚</p><p>@Documented</p><p>@Inherited</p><p>@Retention(RetentionPolicy.RUNTIME)</p><p>@Target(ElementType.TYPE)</p><p>public @interface MyTestAnnotation {</p><p>String name() default â€œmaoâ€;</p><p>int age() default 18;</p><p>}</p><p>@MyTestAnnotation(name &#x3D; â€œfatherâ€, age &#x3D; 50)</p><p>public class Father {</p><p>}</p><h2 id="9-4-4-è·å–æ³¨è§£çš„å±æ€§"><a href="#9-4-4-è·å–æ³¨è§£çš„å±æ€§" class="headerlink" title="9.4.4 è·å–æ³¨è§£çš„å±æ€§"></a>9.4.4 è·å–æ³¨è§£çš„å±æ€§</h2><p>å‰é¢æˆ‘ä»¬è¯´äº†å¾ˆå¤šæ³¨è§£å¦‚ä½•å®šä¹‰ï¼Œæ”¾åœ¨å“ªï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹å­¦ä¹ æ³¨è§£å±æ€§çš„æå–äº†ï¼Œè¿™æ‰æ˜¯ä½¿ç”¨æ³¨è§£çš„å…³é”®ï¼Œè·å–å±æ€§çš„å€¼æ‰æ˜¯ä½¿ç”¨æ³¨è§£çš„ç›®çš„ã€‚å¦‚æœè·å–æ³¨è§£å±æ€§ï¼Œå½“ç„¶æ˜¯åå°„å•¦ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªåŸºæœ¬çš„æ–¹æ³•:</p><p>&#x2F;*<em>æ˜¯å¦å­˜åœ¨å¯¹åº” Annotation å¯¹è±¡</em>&#x2F;</p><p>public boolean isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)</p><p>{</p><p>return GenericDeclaration.super.isAnnotationPresent(annotationClass);</p><p>}</p><p>&#x2F;*<em>è·å– Annotation å¯¹è±¡</em>&#x2F;</p><p>public <A extends Annotation> A getAnnotation(Class<A> annotationClass) {</p><p>Objects.requireNonNull(annotationClass);</p><p>return (A) annotationData().annotations.get(annotationClass);</p><p>}</p><p>&#x2F;*<em>è·å–æ‰€æœ‰ Annotation å¯¹è±¡æ•°ç»„</em>&#x2F;</p><p>public Annotation[] getAnnotations() { return AnnotationParser.toArray(annotationData().annotations);</p><p>ä¸‹é¢ç»“åˆå‰é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥è·å–ä¸€ä¸‹æ³¨è§£å±æ€§ï¼Œåœ¨è·å–ä¹‹å‰æˆ‘ä»¬è‡ªå®šä¹‰çš„æ³¨è§£å¿…é¡»ä½¿ç”¨å…ƒæ³¨è§£ @Retention(RetentionPolicy.RUNTIME)ã€‚</p><p>public class test {</p><p>public static void main(String[] args) throws NoSuchMethodException {</p><p>&#x2F;**</p><ul><li>è·å–ç±»æ³¨è§£å±æ€§</li></ul><p>*&#x2F;</p><p>Class<Father> fatherClass &#x3D; Father.class;</p><p>boolean annotationPresent ( &#x3D; )</p><p>fatherClass. isAnnotationPresent(MyTestAnnotation.class);</p><p>if(annotationPresent){</p><p>MyTestAnnotation annotation ( &#x3D; )</p><p>fatherClass.getAnnotation(MyTestAnnotation.class);</p><p>System.out.println(annotation.name());</p><p>System.out.println(annotation.age());</p><p>}</p><p>&#x2F;**</p><ul><li>è·å–æ–¹æ³•æ³¨è§£å±æ€§</li></ul><p>*&#x2F;</p><p>try ( { )</p><p>Field age &#x3D; fatherClass.getDeclaredField(â€œageâ€);</p><p>boolean annotationPresent1 &#x3D; age.isAnnotationPresent(Age.class);</p><p>if(annotationPresent1){</p><p>Age annotation ( &#x3D; ) age.getAnnotation(Age.class);</p><p>System.out.println(annotation.value());</p><p>}</p><p>Method play ( &#x3D; ) PlayGame.class.getDeclaredMethod(â€œplayâ€);</p><p>if (play!&#x3D;null){</p><p>People annotation2 &#x3D; play.getAnnotation(People.class);</p><p>Game[] value ( &#x3D; ) annotation2.value();</p><p>for (Game game : value) {</p><p>System.out.println(game.value());</p><p>}</p><p>}</p><p>} catch (NoSuchFieldException e) {</p><p>e.printstackTrace();</p><p>}</p><p>}</p><p>}</p><h2 id="9-5-JDKæä¾›çš„æ³¨è§£"><a href="#9-5-JDKæä¾›çš„æ³¨è§£" class="headerlink" title="9.5 JDKæä¾›çš„æ³¨è§£"></a>9.5 JDKæä¾›çš„æ³¨è§£</h2><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tr><td>@SuppressWarnings</td><td>å¯¹ç¨‹åºä¸­çš„è­¦å‘Šå»é™¤ã€‚</td></tr><tr><td>@Deprecated</td><td>å®ƒæ˜¯ç”¨äºæè¿°å½“å‰æ–¹æ³•æ˜¯ä¸€ä¸ªè¿‡æ—¶çš„æ–¹æ³•ã€‚</td></tr></table><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tr><td>@Override</td><td>ä¸»è¦æ˜¯ç”¨æ¥æè¿°å½“å‰æ–¹æ³•æ˜¯ä¸€ä¸ªé‡å†™çš„æ–¹æ³•ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå¯¹æ–¹æ³•è¿›è¡Œæ£€ æŸ¥ã€‚jdk1.5ä¸­å®ƒåªèƒ½æè¿°ç»§æ‰¿ä¸­çš„é‡å†™ï¼Œjdk1.6ä¸­å®ƒå¯ä»¥æè¿°æ¥å£å®ç°çš„ é‡å†™,ä¹Ÿèƒ½æè¿°ç±»çš„ç»§æ‰¿çš„é‡å†™ã€‚</td></tr></table><h2 id="9-6-æ³¨è§£çš„è¿ç”¨"><a href="#9-6-æ³¨è§£çš„è¿ç”¨" class="headerlink" title="9.6 æ³¨è§£çš„è¿ç”¨"></a>9.6 æ³¨è§£çš„è¿ç”¨</h2><p>å¦‚æœä½ æ˜¯ä¸€åAndroid å¼€å‘è€…ï¼Œå¹³å¸¸æ‰€ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ButterKnifeï¼ŒRetrofit2ï¼ŒDagger2ç­‰éƒ½æœ‰æ³¨è§£çš„åº”ç”¨ï¼Œå¦‚æœæƒ³è¦äº†è§£è¿™äº›æ¡†æ¶çš„åŸç†ï¼Œåˆ™æ³¨è§£çš„åŸºç¡€çŸ¥è¯†åˆ™æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p><h2 id="9-7-æ³¨è§£çš„æ„ä¹‰"><a href="#9-7-æ³¨è§£çš„æ„ä¹‰" class="headerlink" title="9.7 æ³¨è§£çš„æ„ä¹‰"></a>9.7 æ³¨è§£çš„æ„ä¹‰</h2><ul><li><p>æä¾›ä¿¡æ¯ç»™ç¼–è¯‘å™¨ï¼š ç¼–è¯‘å™¨å¯ä»¥åˆ©ç”¨æ³¨è§£æ¥æ£€æµ‹å‡ºé”™è¯¯æˆ–è€…è­¦å‘Šä¿¡æ¯ï¼Œæ‰“å°å‡ºæ—¥å¿—ã€‚</p></li><li><p>ç¼–è¯‘é˜¶æ®µæ—¶çš„å¤„ç†ï¼š è½¯ä»¶å·¥å…·å¯ä»¥ç”¨æ¥åˆ©ç”¨æ³¨è§£ä¿¡æ¯æ¥è‡ªåŠ¨ç”Ÿæˆä»£ç ã€æ–‡æ¡£æˆ–è€…åšå…¶å®ƒç›¸åº”çš„è‡ªåŠ¨å¤„ç†ã€‚</p></li><li><p>è¿è¡Œæ—¶å¤„ç†ï¼šæŸäº›æ³¨è§£å¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™æ¥å—ä»£ç çš„æå–ï¼Œè‡ªåŠ¨åšç›¸åº”çš„æ“ä½œã€‚</p></li></ul><ul><li>æ­£å¦‚å®˜æ–¹æ–‡æ¡£çš„é‚£å¥è¯æ‰€è¯´ï¼Œæ³¨è§£èƒ½å¤Ÿæä¾›å…ƒæ•°æ®ï¼Œè½¬è´¦ä¾‹å­ä¸­å¤„ç†è·å–æ³¨è§£å€¼çš„è¿‡ç¨‹æ˜¯æˆ‘ä»¬å¼€å‘è€…ç›´æ¥å†™çš„æ³¨è§£æå–é€»è¾‘ï¼Œå¤„ç†æå–å’Œå¤„ç† Annotation çš„ä»£ç ç»Ÿç§°ä¸º APT (Annotation</li></ul><p>Processing Tool)ã€‚ä¸Šé¢è½¬è´¦ä¾‹å­ä¸­çš„processAnnotationMoneyæ–¹æ³•å°±å¯ä»¥ç†è§£ä¸ºAPTå·¥å…·ç±»ã€‚</p><p>æ›´å¤šå…³äºæ³¨è§£çš„æœ‰æ„æ€çš„å­¦ä¹ ç»å†ä¹Ÿéœ€è¦é å¤§å®¶åœ¨æ—¥å¸¸å·¥ä½œä¸­è®¤çœŸå»ä½“ä¼šå•¦ï¼</p><h1 id="10-Java-æ³›å‹"><a href="#10-Java-æ³›å‹" class="headerlink" title="10. Java æ³›å‹"></a>10. Java æ³›å‹</h1><h2 id="10-1-æ³›å‹çš„æå‡ºï¼Ÿ"><a href="#10-1-æ³›å‹çš„æå‡ºï¼Ÿ" class="headerlink" title="10.1 æ³›å‹çš„æå‡ºï¼Ÿ"></a>10.1 æ³›å‹çš„æå‡ºï¼Ÿ</h2><ul><li>æ³›å‹å®è´¨ä¸Šå°±æ˜¯æ˜¯ç¨‹åºå‘˜å®šä¹‰å®‰å…¨çš„ç±»å‹ã€‚åœ¨æ²¡æœ‰å‡ºç°æ³›å‹ä¹‹å‰ï¼ŒJavaæä¾›äº†å¯¹Objectçš„å¼•ç”¨â€œä»»æ„åŒ–â€œæ“ä½œï¼Œè¿™ç§â€œä»»æ„åŒ–â€æ“ä½œå°±æ˜¯å¯¹Objectå¼•ç”¨è¿›è¡Œå‘ä¸‹è½¬å‹åŠå‘ä¸Šè½¬å‹æ“ä½œï¼Œä½†æŸäº›å¼ºåˆ¶ç±»å‹è½¬æ¢çš„é”™è¯¯ä¹Ÿè®¸ä¸ä¼šè¢«ç¼–è¯‘å™¨æ•æ‰ï¼Œè€Œåœ¨è¿è¡Œåå‡ºç°å¼‚å¸¸ï¼Œå¯å‰å®‰å¼ºåˆ¶ç±»å‹è½¬æ¢å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œæ‰€ä»¥åœ¨æ­¤æä¾›äº†æ³›å‹æœºåˆ¶ã€‚</li></ul><ul><li>æ³›å‹çš„æœ¬è´¨æ˜¯ä¸ºäº†å‚æ•°åŒ–ç±»å‹ï¼ˆåœ¨ä¸åˆ›å»ºæ–°çš„ç±»å‹çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡æ³›å‹æŒ‡å®šçš„ä¸åŒç±»å‹æ¥æ§åˆ¶å½¢å‚å…·ä½“é™åˆ¶çš„ç±»å‹ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨æ³›å‹ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ“ä½œçš„æ•°æ®ç±»å‹è¢«æŒ‡å®šä¸ºä¸€ä¸ªå‚æ•°ï¼Œè¿™ç§å‚æ•°ç±»å‹å¯ä»¥ç”¨åœ¨ç±»ã€æ¥å£å’Œæ–¹æ³•ä¸­ï¼Œåˆ†åˆ«è¢«ç§°ä¸ºæ³›å‹ç±»ã€æ³›å‹æ¥å£ã€æ³›å‹æ–¹æ³•ã€‚</li></ul><p>è¯´å†å¤šä¸å¦‚ä¸¾äº†ä¾‹å­æ¥å¸®åŠ©å¤§å®¶ç†è§£:</p><p>List arrayList ( &#x3D; ) new ArrayList();</p><p>arrayList.add(â€œaaaaâ€);</p><p>arrayList.add(100);</p><p>for(int ( i &#x3D; 0 ) ; ( i &lt; \operatorname{arrayList.size();}i + + ){ )</p><p>String item ( &#x3D; ) (String)arrayList.get(i);</p><p>Log. ( d ) (â€œæ³›å‹æµ‹è¯•â€,â€item ( &#x3D; ) â€œ + item);</p><p>}</p><p>è¿™æ ·çš„ä»£ç è¿è¡Œçš„æœ€ç»ˆç»“æœå¿…ç„¶æ˜¯ä¼šå´©æºƒçš„:</p><p>java.lang.classCastException: java.lang.Integer cannot be cast to</p><p>java.lang.string</p><p>ArrayListå¯ä»¥å­˜æ”¾ä»»æ„ç±»å‹ï¼Œä¾‹å­ä¸­æ·»åŠ äº†ä¸€ä¸ªStringç±»å‹ï¼Œæ·»åŠ äº†ä¸€ä¸ªIntegerç±»å‹ï¼Œå†ä½¿ç”¨æ—¶éƒ½ä»¥ Stringçš„æ–¹å¼ä½¿ç”¨ï¼Œå› æ­¤ç¨‹åºå´©æºƒäº†ã€‚ä¸ºäº†è§£å†³ç±»ä¼¼è¿™æ ·çš„é—®é¢˜ï¼ˆåœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ä»¥è§£å†³ï¼‰ï¼Œæ³›å‹åº”è¿è€Œç”Ÿã€‚</p><p>æˆ‘ä»¬å°†ç¬¬ä¸€è¡Œå£°æ˜åˆå§‹åŒ–listçš„ä»£ç æ›´æ”¹ä¸€ä¸‹ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½å¤Ÿå¸®æˆ‘ä»¬å‘ç°ç±»ä¼¼è¿™æ ·çš„é—®é¢˜ã€‚</p><p>List<String> arrayList &#x3D; new ArrayList<String>();</p><p>( \cdots )</p><p>&#x2F;&#x2F;arrayList.add(100); åœ¨ç¼–è¯‘é˜¶æ®µ, ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ä½¿é›†åˆèƒ½å¤Ÿè®°ä½é›†åˆå†…å…ƒç´ å„ç±»å‹ï¼Œä¸”èƒ½å¤Ÿè¾¾åˆ°åªè¦ç¼–è¯‘æ—¶ä¸å‡ºç°é—®é¢˜ï¼Œè¿è¡Œæ—¶å°±ä¸ä¼šå‡ºç°â€œjava.lang.ClassCastExceptionâ€å¼‚å¸¸å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨æ³›å‹ã€‚</p><h2 id="10-2-å¸¸ç”¨çš„æ³›å‹ç±»å‹å˜é‡"><a href="#10-2-å¸¸ç”¨çš„æ³›å‹ç±»å‹å˜é‡" class="headerlink" title="10.2 å¸¸ç”¨çš„æ³›å‹ç±»å‹å˜é‡"></a>10.2 å¸¸ç”¨çš„æ³›å‹ç±»å‹å˜é‡</h2><p>E: å…ƒç´  (Element) ï¼Œå¤šç”¨äºjavaé›†åˆæ¡†æ¶ã€‚</p><p>Kï¼šå…³é”®å­—ï¼ˆKeyï¼‰ã€‚</p><p>N: æ•°å­— (Number) ã€‚</p><p>Tï¼šç±»å‹ï¼ˆTypeï¼‰ã€‚</p><p>Vï¼šå€¼ï¼ˆValueï¼‰ã€‚</p><h2 id="10-3-æ³›å‹çš„ä½¿ç”¨"><a href="#10-3-æ³›å‹çš„ä½¿ç”¨" class="headerlink" title="10.3 æ³›å‹çš„ä½¿ç”¨"></a>10.3 æ³›å‹çš„ä½¿ç”¨</h2><p>æ³›å‹æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼Œåˆ†åˆ«ä¸º:</p><ul><li><p>æ³›å‹ç±»</p></li><li><p>æ³›å‹æ¥å£</p></li><li><p>æ³›å‹æ–¹æ³•</p></li></ul><h2 id="1-0-3-1-æ³›å‹ç±»"><a href="#1-0-3-1-æ³›å‹ç±»" class="headerlink" title="1.0.3.1 æ³›å‹ç±»"></a>1.0.3.1 æ³›å‹ç±»</h2><p>æ³›å‹ç±»å‹ç”¨äºç±»çš„å®šä¹‰ä¸­ï¼Œè¢«ç§°ä¸ºæ³›å‹ç±»ã€‚é€šè¿‡æ³›å‹å¯ä»¥å®Œæˆå¯¹ä¸€ç»„ç±»çš„æ“ä½œå¯¹å¤–å¼€æ”¾ç›¸åŒçš„æ¥å£ã€‚æœ€å…¸å‹çš„å°±æ˜¯å„ç§å®¹å™¨ç±»ï¼Œå¦‚ï¼šListã€Setã€Mapã€‚</p><p>å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»:</p><p>class ç±»åç§° ( &lt; ) æ³›å‹æ ‡è¯†: å¯ä»¥éšä¾¿å†™ä»»æ„æ ‡è¯†å·,æ ‡è¯†æŒ‡å®šçš„æ³›å‹çš„ç±»å‹ ( &gt; { )</p><p>private æ³›å‹æ ‡è¯† &#x2F;* (æˆå‘˜å˜é‡ç±»å‹) *&#x2F; var;</p><p>( \cdots )</p><p>}</p><p>}</p><h2 id="å°†æ¡ˆä¾‹å…·ä½“åŒ–"><a href="#å°†æ¡ˆä¾‹å…·ä½“åŒ–" class="headerlink" title="å°†æ¡ˆä¾‹å…·ä½“åŒ–:"></a>å°†æ¡ˆä¾‹å…·ä½“åŒ–:</h2><p>public class Generic<T>{</p><p>&#x2F;&#x2F;keyè¿™ä¸ªæˆå‘˜å˜é‡çš„ç±»å‹ä¸º ( T, T ) çš„ç±»å‹ç”±å¤–éƒ¨æŒ‡å®š</p><p>private ( T ) key;</p><p>public Generic(T key) { &#x2F;&#x2F;æ³›å‹æ„é€ æ–¹æ³•å½¢å‚keyçš„ç±»å‹ä¹Ÿä¸ºT, Tçš„ç±»å‹ç”±å¤–éƒ¨æŒ‡å®š this.key ( &#x3D; ) key; }</p><p>public T getKey() { &#x2F;&#x2F;æ³›å‹æ–¹æ³•getKeyçš„è¿”å›å€¼ç±»å‹ä¸ºT, Tçš„ç±»å‹ç”±å¤–éƒ¨æŒ‡å®š</p><p>return key;</p><p>}</p><p>}</p><p>&#x2F;&#x2F;æ³›å‹çš„ç±»å‹å‚æ•°åªèƒ½æ˜¯ç±»ç±»å‹ (åŒ…æ‹¬è‡ªå®šä¹‰ç±»), ä¸èƒ½æ˜¯ç®€å•ç±»å‹</p><p>&#x2F;&#x2F;ä¼ å…¥çš„å®å‚ç±»å‹éœ€ä¸æ³›å‹çš„ç±»å‹å‚æ•°ç±»å‹ç›¸åŒ, å³ä¸ºInteger.</p><p>Generic<Integer> genericInteger &#x3D; new Generic<Integer>(123456);</p><p>&#x2F;&#x2F;ä¼ å…¥çš„å®å‚ç±»å‹éœ€ä¸æ³›å‹çš„ç±»å‹å‚æ•°ç±»å‹ç›¸åŒ, å³ä¸ºString.</p><p>Generic<String> genericString &#x3D; new Generic<String>(â€œkey_vlaueâ€);</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key is â€œ + genericInteger.getKey());</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key is â€œ + genericString.getKey());</p><p>æµ‹è¯•ç»“æœ:</p><p>12-27 09:20:04.432 13063-13063&#x2F;? D&#x2F;æ³›å‹æµ‹è¯•: key is 123456</p><p>12-27 09:20:04.432 13063-13063&#x2F;? D&#x2F;æ³›å‹æµ‹è¯•: key is key_vlaue</p><p>å®šä¹‰çš„æ³›å‹ç±»å¹¶ä¸æ˜¯ä¸€å®šè¦ä¼ å…¥æ³›å‹ç±»å‹å®å‚ã€‚åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™å¦‚æœä¼ å…¥æ³›å‹å®å‚ï¼Œåˆ™ä¼šæ ¹æ®ä¼ å…¥çš„æ³›å‹å®å‚åšç›¸åº”çš„é™åˆ¶ï¼Œæ­¤æ—¶æ³›å‹æ‰ä¼šèµ·åˆ°æœ¬åº”èµ·åˆ°çš„é™åˆ¶ä½œç”¨ã€‚å¦‚æœä¸ä¼ å…¥æ³›å‹ç±»å‹å®å‚çš„è¯ï¼Œåœ¨æ³›å‹ç±»ä¸­ä½¿ç”¨æ³›å‹çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡å®šä¹‰çš„ç±»å‹å¯ä»¥ä¸ºä»»ä½•çš„ç±»å‹ã€‚</p><p>å†ä¸¾ä¸€ä¸ªä¾‹å­:</p><p>Generic generic &#x3D; new Generic(â€œ111111â€);</p><p>Generic generic1 &#x3D; new Generic(4444);</p><p>Generic generic2 &#x3D; new Generic(55.55);</p><p>Generic generic3 &#x3D; new Generic(false);</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key is â€œ + generic.getKey());</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key is â€œ + generic1.getKey());</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key is â€œ + generic2.getKey());</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key is â€œ + generic3.getKey());</p><p>è¿è¡Œç»“æœ:</p><p>D&#x2F;æ³›å‹æµ‹è¯•: key is 111111</p><p>D&#x2F;æ³›å‹æµ‹è¯•ï¼škey is 4444</p><p>D&#x2F;æ³›å‹æµ‹è¯•: key is ( {55.55} )</p><p>D&#x2F;æ³›å‹æµ‹è¯•: key is false</p><h2 id="å€¼å¾—æ³¨æ„çš„æ˜¯"><a href="#å€¼å¾—æ³¨æ„çš„æ˜¯" class="headerlink" title="å€¼å¾—æ³¨æ„çš„æ˜¯:"></a>å€¼å¾—æ³¨æ„çš„æ˜¯:</h2><ol><li><p>æ³›å‹çš„ç±»å‹å‚æ•°åªèƒ½æ˜¯ç±»ç±»å‹ï¼Œä¸èƒ½æ˜¯ç®€å•ç±»å‹ã€‚</p></li><li><p>ä¸èƒ½å¯¹ç¡®åˆ‡çš„æ³›å‹ç±»å‹ä½¿ç”¨instanceofæ“ä½œã€‚å¦‚ä¸‹é¢çš„æ“ä½œæ˜¯éæ³•çš„ï¼Œç¼–è¯‘æ—¶ä¼šå‡ºé”™ã€‚</p></li></ol><p>if(ex_num instanceof Generic<Number>){ }</p><h2 id="10-3-2-æ³›å‹æ¥å£"><a href="#10-3-2-æ³›å‹æ¥å£" class="headerlink" title="10.3.2 æ³›å‹æ¥å£"></a>10.3.2 æ³›å‹æ¥å£</h2><p>å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£: public interface GenericIntercace{}</p><p>public interface GenericIntercace<T> {</p><p>T getData();</p><p>}</p><p>å®ç°æ³›å‹æ¥å£æ–¹å¼ä¸€ï¼špublic class ImplGenericInterface1 implements GenericIntercace</p><hr><p>public class ImplGenericInterface1<T> implements GenericIntercace<T> {</p><p>private ( T ) data;</p><p>private void setData(T data) {</p><p>this.data ( &#x3D; ) data;</p><p>}</p><p>@override</p><p>public T getData() {</p><p>return data;</p><p>}</p><p>public static void main(String[] args) {</p><p>ImplGenericInterface1<String> implGenericInterface1 &#x3D; new</p><p>ImplGenericInterface1&lt;&gt;();</p><p>implGenericInterface1.setData(â€œGeneric Interface1â€);</p><p>System.out.println(implGenericInterface1.getData());</p><p>}</p><p>}</p><hr><p>å®ç°æ³›å‹æ¥å£æ–¹å¼äºŒï¼špublic class ImplGenericInterface2 implements GenericIntercace {}</p><p>public class ImplGenericInterface2 implements GenericIntercace<String> {</p><p>@override</p><p>public String getData() {</p><p>return â€œGeneric Interface2â€;</p><p>}</p><p>public static void main(String[] args) {</p><p>ImplGenericInterface2 implGenericInterface2 &#x3D; new</p><p>ImplGenericInterface2();</p><p>System.out.println(implGenericInterface2.getData());</p><p>}</p><p>}</p><h2 id="10-3-3-æ³›å‹æ–¹æ³•"><a href="#10-3-3-æ³›å‹æ–¹æ³•" class="headerlink" title="10.3.3 æ³›å‹æ–¹æ³•"></a>10.3.3 æ³›å‹æ–¹æ³•</h2><p>æ³›å‹æ–¹æ³•æ˜¯åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™æŒ‡æ˜æ³›å‹çš„å…·ä½“ç±»å‹ã€‚</p><p>&#x2F;**</p><ul><li><p>æ³›å‹æ–¹æ³•çš„åŸºæœ¬ä»‹ç»</p></li><li><p>@param tclass ä¼ å…¥çš„æ³›å‹å®å‚</p></li><li><p>@return T è¿”å›å€¼ä¸ºTç±»å‹</p></li><li><p>è¯´æ˜:</p></li></ul><ol><li>public ä¸ è¿”å›å€¼ä¸­é—´<T>éå¸¸é‡è¦, å¯ä»¥ç†è§£ä¸ºå£°æ˜æ­¤æ–¹æ³•ä¸ºæ³›å‹æ–¹æ³•ã€‚</li></ol><p>2ï¼‰åªæœ‰å£°æ˜äº†<T>çš„æ–¹æ³•æ‰æ˜¯æ³›å‹æ–¹æ³•, æ³›å‹ç±»ä¸­çš„ä½¿ç”¨äº†æ³›å‹çš„æˆå‘˜æ–¹æ³•å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•ã€‚</p><p>3ï¼‰ ( &lt; \mathrm{T} &gt; ) è¡¨æ˜è¯¥æ–¹æ³•å°†ä½¿ç”¨æ³›å‹ç±»å‹Tï¼Œæ­¤æ—¶æ‰å¯ä»¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹ç±»å‹Tã€‚</p><ol start="4"><li>ä¸æ³›å‹ç±»çš„å®šä¹‰ä¸€æ ·,æ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†,å¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨</li></ol><p>ç¤ºæ³›å‹ã€‚</p><p>*&#x2F;</p><p>public ( &lt; T &gt; T ) genericMethod(Class ( &lt; T &gt; ) tclass)throws InstantiationException,</p><p>IllegalAccessException{</p><p>T instance ( &#x3D; ) tclass.newInstance();</p><p>return instance;</p><p>}</p><p>object obj &#x3D; genericMethod(Class.forName(â€œcom.test.testâ€));</p><h2 id="10-3-3-1-æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•"><a href="#10-3-3-1-æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="10.3.3.1 æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•"></a>10.3.3.1 æ³›å‹æ–¹æ³•çš„åŸºæœ¬ç”¨æ³•</h2><p>public class GenericTest {</p><p>&#x2F;&#x2F;è¿™ä¸ªç±»æ˜¯ä¸ªæ³›å‹ç±», åœ¨ä¸Šé¢å·²ç»ä»‹ç»è¿‡</p><p>public class Generic<T>{</p><p>private ( T ) key;</p><p>public Generic(T key) {</p><p>this.key ( &#x3D; ) key;</p><p>}</p><p>&#x2F;&#x2F;æˆ‘æƒ³è¯´çš„å…¶å®æ˜¯è¿™ä¸ª, è™½ç„¶åœ¨æ–¹æ³•ä¸­ä½¿ç”¨äº†æ³›å‹, ä½†æ˜¯è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•ã€‚</p><p>&#x2F;&#x2F;è¿™åªæ˜¯ç±»ä¸­ä¸€ä¸ªæ™®é€šçš„æˆå‘˜æ–¹æ³•, åªä¸è¿‡ä»–çš„è¿”å›å€¼æ˜¯åœ¨å£°æ˜æ³›å‹ç±»å·²ç»å£°æ˜è¿‡çš„æ³›å‹ã€‚</p><p>&#x2F;&#x2F;æ‰€ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰å¯ä»¥ç»§ç»­ä½¿ç”¨ ( \mathrm{T} ) è¿™ä¸ªæ³›å‹ã€‚</p><p>public T getKey(){</p><p>return key;</p><p>}</p><p>&#x2F;**</p><ul><li><p>è¿™ä¸ªæ–¹æ³•æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„, åœ¨ç¼–è¯‘å™¨ä¼šç»™æˆ‘ä»¬æç¤ºè¿™æ ·çš„é”™è¯¯ä¿¡æ¯â€cannot reslove symbol</p></li><li><p>å› ä¸ºåœ¨ç±»çš„å£°æ˜ä¸­å¹¶æœªå£°æ˜æ³›å‹E,æ‰€ä»¥åœ¨ä½¿ç”¨Eåšå½¢å‚å’Œè¿”å›å€¼ç±»å‹æ—¶,ç¼–è¯‘å™¨ä¼šæ— æ³•è¯†åˆ«ã€‚</p></li></ul><p>public ( E ) setKey(E ( {key}){ )</p><p>this.key ( &#x3D; ) keu</p><p>}</p><p>*&#x2F;</p><p>&#x2F;**</p><ul><li>è¿™æ‰æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ³›å‹æ–¹æ³•ã€‚</li></ul><p>é¦–å…ˆåœ¨publicä¸è¿”å›å€¼ä¹‹é—´çš„<T>å¿…ä¸å¯å°‘, è¿™è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•, å¹¶ä¸”å£°æ˜äº†ä¸€ä¸ªæ³›å‹T</p><ul><li>è¿™ä¸ªTå¯ä»¥å‡ºç°åœ¨è¿™ä¸ªæ³›å‹æ–¹æ³•çš„ä»»æ„ä½ç½®.</li></ul><p>â€™æ³›å‹çš„æ•°é‡ä¹Ÿå¯ä»¥ä¸ºä»»æ„å¤šä¸ª</p><p>å¦‚: public &lt;T, K&gt; K showKeyName(Generic<T> container){</p><ul><li>. .</li></ul><p>}</p><p>*&#x2F;</p><p>public <T> T showKeyName(Generic<T> container){</p><p>System.out.println(â€œcontainer key :â€ + container.getKey());</p><p>&#x2F;&#x2F;å½“ç„¶è¿™ä¸ªä¾‹å­ä¸¾çš„ä¸å¤ªåˆé€‚, åªæ˜¯ä¸ºäº†è¯´æ˜æ³›å‹æ–¹æ³•çš„ç‰¹æ€§ã€‚</p><p>( T ) test ( &#x3D; ) container.getKey();</p><p>return test;</p><p>}</p><p>&#x2F;&#x2F;è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•, è¿™å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•, åªæ˜¯ä½¿ç”¨äº†Generic<Number>è¿™ä¸ªæ³›å‹ç±»åšå½¢å‚è€Œå·²ã€‚</p><p>public void showKeyValue1(Generic<Number> obj){</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key value is â€œ + obj.getKey());</p><p>}</p><p>&#x2F;&#x2F;è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•, è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„æ–¹æ³•, åªä¸è¿‡ä½¿ç”¨äº†æ³›å‹é€šé…ç¬¦?</p><p>&#x2F;&#x2F;åŒæ—¶è¿™ä¹Ÿå°è¯äº†æ³›å‹é€šé…ç¬¦ç« èŠ‚æ‰€æè¿°çš„, ?æ˜¯ä¸€ç§ç±»å‹å®å‚, å¯ä»¥çœ‹åšä¸ºNumberç­‰æ‰€æœ‰ç±»çš„çˆ¶ç±»</p><p>public void showKeyValue2(Generic&lt;?&gt; obj){</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key value is â€œ + obj.getKey());</p><p>}</p><p>&#x2F;**</p><ul><li><p>è¿™ä¸ªæ–¹æ³•æ˜¯æœ‰é—®é¢˜çš„,ç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æç¤ºé”™è¯¯ä¿¡æ¯: â€œUnKnown class â€˜Eâ€™ â€œ</p></li><li><p>è™½ç„¶æˆ‘ä»¬å£°æ˜äº† ( &lt; \mathrm{T} &gt; ) ,ä¹Ÿè¡¨æ˜äº†è¿™æ˜¯ä¸€ä¸ªå¯ä»¥å¤„ç†æ³›å‹çš„ç±»å‹çš„æ³›å‹æ–¹æ³•ã€‚</p></li><li><p>ä½†æ˜¯åªå£°æ˜äº†æ³›å‹ç±»å‹T,å¹¶æœªå£°æ˜æ³›å‹ç±»å‹E,å› æ­¤ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†Eè¿™ä¸ªç±»å‹ã€‚</p></li></ul><p>public <T> T showKeyName(Generic<E> container){</p><p>( \cdots )</p><p>}</p><p>*&#x2F;</p><p>&#x2F;**</p><ul><li><p>è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æœ‰é—®é¢˜çš„,ç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æç¤ºé”™è¯¯ä¿¡æ¯: â€œUnknown class â€˜Tâ€™ â€œ</p></li><li><p>å¯¹äºç¼–è¯‘å™¨æ¥è¯´Tè¿™ä¸ªç±»å‹å¹¶æœªé¡¹ç›®ä¸­å£°æ˜è¿‡, å› æ­¤ç¼–è¯‘ä¹Ÿä¸çŸ¥é“è¯¥å¦‚ä½•ç¼–è¯‘è¿™ä¸ªç±»ã€‚</p></li><li><p>æ‰€ä»¥è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªæ­£ç¡®çš„æ³›å‹æ–¹æ³•å£°æ˜ã€‚</p></li></ul><p>public void showkey(T genericobj){</p><p>}</p><p>*&#x2F;</p><p>public static void main(String[] args) {</p><p>} }</p><h2 id="10-3-3-2-ç±»ä¸­çš„æ³›å‹æ–¹æ³•"><a href="#10-3-3-2-ç±»ä¸­çš„æ³›å‹æ–¹æ³•" class="headerlink" title="10.3.3.2 ç±»ä¸­çš„æ³›å‹æ–¹æ³•"></a>10.3.3.2 ç±»ä¸­çš„æ³›å‹æ–¹æ³•</h2><p>å½“ç„¶è¿™å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•çš„å…¨éƒ¨ï¼Œæ³›å‹æ–¹æ³•å¯ä»¥å‡ºç°æ‚ä»»ä½•åœ°æ–¹å’Œä»»ä½•åœºæ™¯ä¸­ä½¿ç”¨ã€‚ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µæ˜¯éå¸¸ç‰¹æ®Šçš„ï¼Œå½“æ³›å‹æ–¹æ³•å‡ºç°åœ¨æ³›å‹ç±»ä¸­æ—¶ï¼Œæˆ‘ä»¬å†é€šè¿‡ä¸€ä¸ªä¾‹å­çœ‹ä¸€ä¸‹</p><hr><p>public class GenericFruit {</p><p>class Fruit{</p><p>@override</p><p>public string toString() {</p><p>return â€œfruitâ€;</p><p>}</p><p>}</p><p>class Apple extends Fruit{</p><p>@override</p><p>public string toString() {</p><p>return â€œappleâ€;</p><p>} }</p><hr><h2 id="10-3-3-3-é™æ€æ–¹æ³•ä¸æ³›å‹"><a href="#10-3-3-3-é™æ€æ–¹æ³•ä¸æ³›å‹" class="headerlink" title="10.3.3.3 é™æ€æ–¹æ³•ä¸æ³›å‹"></a>10.3.3.3 é™æ€æ–¹æ³•ä¸æ³›å‹</h2><hr><p>class Person{</p><p>@override</p><p>public string toString() {</p><p>return â€œPersonâ€;</p><p>}</p><p>}</p><p>class GenerateTest<T>{</p><p>public void show_1(T t){</p><p>System.out.println(t.toString());</p><p>}</p><p>&#x2F;&#x2F;åœ¨æ³›å‹ç±»ä¸­å£°æ˜äº†ä¸€ä¸ªæ³›å‹æ–¹æ³•,ä½¿ç”¨æ³›å‹ ( \mathrm{E} ) ,è¿™ç§æ³›å‹ ( \mathrm{E} ) å¯ä»¥ä¸ºä»»æ„ç±»å‹ã€‚å¯ä»¥ç±»å‹ä¸ ( \mathrm{T} ) ç›¸åŒ,ä¹Ÿå¯ä»¥ä¸åŒã€‚</p><p>&#x2F;&#x2F;ç”±äºæ³›å‹æ–¹æ³•åœ¨å£°æ˜çš„æ—¶å€™ä¼šå£°æ˜æ³›å‹ ( &lt; \mathrm{E} &gt; ) ,å› æ­¤å³ä½¿åœ¨æ³›å‹ç±»ä¸­å¹¶æœªå£°æ˜æ³›å‹,ç¼–è¯‘å™¨ä¹Ÿèƒ½å¤Ÿæ­£ç¡®è¯†åˆ«æ³›å‹æ–¹æ³•ä¸­è¯†åˆ«çš„æ³›å‹ã€‚</p><p>public <E> void show_3(E t){</p><p>System.out.println(t.toString());</p><p>}</p><p>&#x2F;&#x2F;åœ¨æ³›å‹ç±»ä¸­å£°æ˜äº†ä¸€ä¸ªæ³›å‹æ–¹æ³•, ä½¿ç”¨æ³›å‹T, æ³¨æ„è¿™ä¸ªTæ˜¯ä¸€ç§å…¨æ–°çš„ç±»å‹, å¯ä»¥ä¸æ³›å‹ç±»ä¸­å£°æ˜çš„Tä¸æ˜¯åŒä¸€ç§ç±»å‹ã€‚</p><p>public <T> void show_2(T t){</p><p>System.out.println(t.toString());</p><p>}</p><p>}</p><p>public static void main(String[] args) {</p><p>Apple apple ( &#x3D; ) new Apple();</p><p>Person person ( &#x3D; ) new Person();</p><p>GenerateTest<Fruit> generateTest &#x3D; new GenerateTest<Fruit>();</p><p>&#x2F;&#x2F;appleæ˜¯Fruitçš„å­ç±», æ‰€ä»¥è¿™é‡Œå¯ä»¥</p><p>generateTest.show_1(apple);</p><p>&#x2F;&#x2F;ç¼–è¯‘å™¨ä¼šæŠ¥é”™, å› ä¸ºæ³›å‹ç±»å‹å®å‚æŒ‡å®šçš„æ˜¯ Fruit, è€Œä¼ å…¥çš„å®å‚ç±»æ˜¯ Person</p><p>&#x2F;&#x2F;generateTest.show_1(person);</p><p>&#x2F;&#x2F;ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æˆåŠŸ</p><p>generateTest.show_2(apple);</p><p>generateTest.show_2(person);</p><p>&#x2F;&#x2F;ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¹Ÿéƒ½å¯ä»¥æˆåŠŸ</p><p>generateTest.show_3(apple);</p><p>generateTest.show_3(person);</p><p>} }</p><p>é™æ€æ–¹æ³•æœ‰ä¸€ç§æƒ…å†µéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œé‚£å°±æ˜¯åœ¨ç±»ä¸­çš„é™æ€æ–¹æ³•ä½¿ç”¨æ³›å‹ï¼šé™æ€æ–¹æ³•æ— æ³•è®¿é—®ç±»ä¸Šå®šä¹‰çš„æ³›å‹ï¼›å¦‚æœé™æ€æ–¹æ³•æ“ä½œçš„å¼•ç”¨æ•°æ®ç±»å‹ä¸ç¡®å®šçš„æ—¶å€™ï¼Œå¿…é¡»è¦å°†æ³›å‹å®šä¹‰åœ¨æ–¹æ³•ä¸Šã€‚</p><hr><p>å³ï¼šå¦‚æœé™æ€æ–¹æ³•è¦ä½¿ç”¨æ³›å‹çš„è¯ï¼Œå¿…é¡»å°†é™æ€æ–¹æ³•ä¹Ÿå®šä¹‰æˆæ³›å‹æ–¹æ³•ã€‚</p><p>public class StaticGenerator<T> {</p><p>( \cdots )</p><p>â€¦ â€¦</p><p>&#x2F;**</p><ul><li><p>å¦‚æœåœ¨ç±»ä¸­å®šä¹‰ä½¿ç”¨æ³›å‹çš„é™æ€æ–¹æ³•, éœ€è¦æ·»åŠ é¢å¤–çš„æ³›å‹å£°æ˜ (å°†è¿™ä¸ªæ–¹æ³•å®šä¹‰æˆæ³›å‹æ–¹æ³•)</p></li><li><p>å³ä½¿é™æ€æ–¹æ³•è¦ä½¿ç”¨æ³›å‹ç±»ä¸­å·²ç»å£°æ˜è¿‡çš„æ³›å‹ä¹Ÿä¸å¯ä»¥ã€‚</p></li><li><p>å¦‚: public static void show(T t){..},æ­¤æ—¶ç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ä¿¡æ¯:</p></li></ul><p>â€œStaticGenerator cannot be refrenced from static contextâ€</p><p>*&#x2F;</p><p>public static ( &lt; T &gt; ) void show(T t){</p><p>}</p><p>}</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨ä½¿ç”¨æ³›å‹ç±»æ—¶ï¼Œè™½ç„¶æœ‰ä¸åŒçš„æ³›å‹å®å‚ä¼ å…¥ï¼Œä½†å¹¶æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šç”Ÿæˆä¸åŒçš„ç±»å‹ï¼Œä¸åŒæ³›å‹å®å‚çš„æ³›å‹ç±»ä¼ å…¥å†…å­˜å¹¶åªæœ‰ä¸€ä¸ªï¼Œå³è¿˜æ˜¯åŸæ¥çš„æœ€åŸºæœ¬çš„ç±»å‹ï¼Œå½“ç„¶ï¼Œåœ¨é€»è¾‘ä¸Šæˆ‘ä»¬å¯ä»¥ç†è§£æˆå¤šä¸ªä¸åŒçš„æ³›å‹ç±»å‹ã€‚</p><p>ç»†æƒ³åŸå› ï¼Œåœ¨äºJavaä¸­çš„æ³›å‹è¿™ä¸€æ¦‚å¿µæå‡ºçš„ç›®çš„ï¼Œå¯¼è‡´å…¶åªæ˜¯ä½œç”¨äºä»£ç ç¼–è¯‘é˜¶æ®µï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œ å¯¹äºæ­£ç¡®æ£€éªŒæ³›å‹ç»“æœåï¼Œä¼šå°†æ³›å‹çš„ç›¸å…³ä¿¡æ¯æ“¦å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæˆåŠŸç¼–è¯‘è¿‡åçš„classæ–‡ä»¶ä¸­æ˜¯ä¸åŒ…å«ä»»ä½•æ³›å‹ä¿¡æ¯çš„ã€‚æ³›å‹ä¿¡æ¯ä¸ä¼šè¿›å…¥åˆ°è¿è¡Œæ—¶é˜¶æ®µã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼šæ³›å‹ç±»å‹åœ¨é€»è¾‘ä¸Šçœ‹ä»¥çœ‹æˆæ˜¯å¤šä¸ªä¸åŒçš„ç±»å‹ï¼Œå®é™…ä¸Šéƒ½æ˜¯ç›¸åŒçš„åŸºæœ¬ç±»å‹ã€‚</p><h2 id="10-4-æ³›å‹é€šé…ç¬¦"><a href="#10-4-æ³›å‹é€šé…ç¬¦" class="headerlink" title="10.4 æ³›å‹é€šé…ç¬¦"></a>10.4 æ³›å‹é€šé…ç¬¦</h2><p>æˆ‘ä»¬çŸ¥é“Ingeteræ˜¯Numberçš„ä¸€ä¸ªå­ç±»ï¼ŒåŒæ—¶åœ¨ç‰¹æ€§ç« èŠ‚ä¸­æˆ‘ä»¬ä¹ŸéªŒè¯è¿‡Genericä¸Genericå®é™…ä¸Šæ˜¯ç›¸åŒçš„ä¸€ç§åŸºæœ¬ç±»å‹ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨ä½¿ç”¨Genericä½œä¸ºå½¢å‚çš„æ–¹æ³•ä¸­ï¼Œèƒ½å¦ä½¿ç”¨Genericçš„å®ä¾‹ä¼ å…¥å‘¢ï¼Ÿåœ¨é€»è¾‘ä¸Šç±»ä¼¼äºGenericå’ŒGenericæ˜¯å¦å¯ä»¥çœ‹æˆå…·æœ‰çˆ¶å­å…³ç³»çš„æ³›å‹ç±»å‹å‘¢ï¼Ÿ</p><p>å¼„æ¸…æ¥šè¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨Genericè¿™ä¸ªæ³›å‹ç±»ç»§ç»­çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><p>public void showKeyValue1(Generic<Number> obj){</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key value is â€œ + obj.getKey());</p><p>}</p><p>Generic<Integer> gInteger &#x3D; new Generic<Integer>(123);</p><p>Generic<Number> gNumber &#x3D; new Generic<Number>(456);</p><p>showKeyValue(gNumber);</p><p>&#x2F;&#x2F; showKeyValueè¿™ä¸ªæ–¹æ³•ç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æŠ¥é”™ï¼šGeneric&lt;java.lang.Integer&gt;</p><p>&#x2F;&#x2F; cannot be applied to Generic&lt;java.lang.Number&gt;</p><p>&#x2F;&#x2F; showKeyValue(gInteger);</p><p>åœ¨æç¤ºä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Genericä¸èƒ½è¢«çœ‹ä½œä¸º Genericçš„å­ç±»ã€‚</p><p>ç”±æ­¤å¯ä»¥çœ‹å‡º:åŒä¸€ç§æ³›å‹å¯ä»¥å¯¹åº”å¤šä¸ªç‰ˆæœ¬ï¼ˆå› ä¸ºå‚æ•°ç±»å‹æ˜¯ä¸ç¡®å®šçš„ï¼‰ï¼Œä¸åŒç‰ˆæœ¬çš„æ³›å‹ç±»å®ä¾‹æ˜¯ä¸å…¼å®¹çš„ã€‚</p><p>å†å›åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œé‚£ä¹ˆç©¶ç«Ÿå¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜å‘¢?</p><p>æˆ–è®¸æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨é€»è¾‘ä¸Šå¯ä»¥è¡¨ç¤ºåŒæ—¶æ˜¯Genericå’ŒGenericçˆ¶ç±»çš„å¼•ç”¨ç±»å‹ã€‚è‡³æ­¤ç±»å‹é€šé…ç¬¦åº”è¿è€Œç”Ÿã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„æ–¹æ³•æ”¹ä¸€ä¸‹:</p><p>public void showKeyValue1(Generic&lt;?&gt; obj){</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key value is â€œ + obj.getKey());</p><p>}</p><p>ç±»å‹é€šé…ç¬¦ä¸€èˆ¬æ˜¯ä½¿ç”¨ï¼Ÿ ä»£æ›¿å…·ä½“çš„ç±»å‹å®å‚ï¼Œæ³¨æ„äº†ï¼Œæ­¤å¤„ï¼Ÿ æ˜¯ç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ç±»å‹å½¢å‚ã€‚</p><h2 id="è¦è¯´ä¸‰é"><a href="#è¦è¯´ä¸‰é" class="headerlink" title="è¦è¯´ä¸‰é!"></a>è¦è¯´ä¸‰é!</h2><p>æ­¤å¤„? æ˜¯ç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ç±»å‹å½¢å‚!</p><p>æ­¤å¤„? æ˜¯ç±»å‹å®å‚ï¼Œè€Œä¸æ˜¯ç±»å‹å½¢å‚!</p><p>å†ç›´ç™½ç‚¹çš„æ„æ€å°±æ˜¯ï¼Œæ­¤å¤„çš„? å’ŒNumberã€Stringã€Integerä¸€æ ·éƒ½æ˜¯ä¸€ç§å®é™…çš„ç±»å‹ï¼Œå¯ä»¥æŠŠ? çœ‹æˆæ‰€æœ‰ç±»å‹çš„çˆ¶ç±»ã€‚æ˜¯ä¸€ç§çœŸå®çš„ç±»å‹ã€‚</p><p>å¯ä»¥è§£å†³å½“å…·ä½“ç±»å‹ä¸ç¡®å®šçš„æ—¶å€™ï¼Œè¿™ä¸ªé€šé…ç¬¦å°±æ˜¯ï¼Ÿã€‚</p><p>å½“æ“ä½œç±»å‹æ—¶ï¼Œä¸éœ€è¦ä½¿ç”¨ç±»å‹çš„å…·ä½“åŠŸèƒ½æ—¶ï¼Œåªä½¿ç”¨Objectç±»ä¸­çš„åŠŸèƒ½ã€‚é‚£ä¹ˆå¯ä»¥ç”¨ï¼Ÿé€šé…ç¬¦æ¥è¡¨æœªçŸ¥ç±»å‹ã€‚</p><h2 id="10-5-æ³›å‹ä¸Šä¸‹è¾¹ç•Œ"><a href="#10-5-æ³›å‹ä¸Šä¸‹è¾¹ç•Œ" class="headerlink" title="10.5 æ³›å‹ä¸Šä¸‹è¾¹ç•Œ"></a>10.5 æ³›å‹ä¸Šä¸‹è¾¹ç•Œ</h2><p>åœ¨ä½¿ç”¨æ³›å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºä¼ å…¥çš„æ³›å‹ç±»å‹å®å‚è¿›è¡Œä¸Šä¸‹è¾¹ç•Œçš„é™åˆ¶ï¼Œå¦‚ï¼šç±»å‹å®å‚åªå‡†ä¼ å…¥æŸç§ç±»å‹çš„çˆ¶ç±»æˆ–æŸç§ç±»å‹çš„å­ç±»ã€‚</p><p>æ·»åŠ ä¸Šè¾¹ç•Œï¼Œå°±æ˜¯æŒ‡ä¼ å…¥çš„ç±»å‹å®å‚å¿…é¡»æ˜¯æŒ‡å®šç±»å‹çš„å­ç±»å‹ã€‚</p><p>public void showKeyValue1(Generic&lt;? extends Number&gt; obj){</p><p>Log.d(â€œæ³›å‹æµ‹è¯•â€,â€key value is â€œ + obj.getKey());</p><p>}</p><p>Generic<String> generic1 &#x3D; new Generic<String>(â€œsâ€);</p><p>Generic<Integer> generic2 &#x3D; new Generic<Integer>(1314520);</p><p>Generic<Float> generic3 &#x3D; new Generic<Float>(11.11f);</p><p>Generic<Double> generic4 &#x3D; new Generic<Double>(3.14);</p><p>&#x2F;&#x2F;è¿™ä¸€è¡Œä»£ç ç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯, å› ä¸ºstringç±»å‹å¹¶ä¸æ˜¯Numberç±»å‹çš„å­ç±»</p><p>&#x2F;&#x2F;showKeyValue1(generic1);</p><p>showKeyValue1(generic2);</p><p>showKeyValue1(generic3);</p><p>showKeyValue1(generic4);</p><p>å¦‚æœå†æŠŠæŠŠæ³›å‹ç±»çš„å®šä¹‰ä¹Ÿæ”¹ä¸€ä¸‹:</p><p>public class Generic<T extends Number>{</p><p>private ( T ) key;</p><p>public Generic(T key) {</p><p>this.key ( &#x3D; ) key;</p><p>}</p><p>public T getKey(){</p><p>return key;</p><p>}</p><p>}</p><p>&#x2F;&#x2F;è¿™ä¸€è¡Œä»£ç ä¹Ÿä¼šæŠ¥é”™, å› ä¸ºStringä¸æ˜¯Numberçš„å­ç±»</p><p>Generic<String> generic1 &#x3D; new Generic<String>(â€œ11111â€);</p><p>æˆ‘ä»¬å‘ç°ï¼šæ³›å‹çš„ä¸Šä¸‹è¾¹ç•Œæ·»åŠ ï¼Œå¿…é¡»ä¸æ³›å‹çš„å£°æ˜åœ¨ä¸€èµ·ã€‚</p><h2 id="10-6-æ³›å‹å­˜åœ¨çš„çº¦æŸ"><a href="#10-6-æ³›å‹å­˜åœ¨çš„çº¦æŸ" class="headerlink" title="10.6 æ³›å‹å­˜åœ¨çš„çº¦æŸ"></a>10.6 æ³›å‹å­˜åœ¨çš„çº¦æŸ</h2><ul><li><p>æ— æ³•å®ä¾‹åŒ–æ³›å‹ç±»</p></li><li><p>æ— æ³•ä½¿ç”¨instanceofå…³é”®å­—æˆ–&#x3D;&#x3D;åˆ¤æ–­æ³›å‹ç±»çš„ç±»å‹</p></li><li><p>æ³›å‹ç±»ä¸èƒ½ç»§æ‰¿Exceptionæˆ–è€…Throwable</p></li><li><p>ä¸èƒ½æ•è·æ³›å‹ç±»å‹é™å®šçš„å¼‚å¸¸ä½†å¯ä»¥å°†æ³›å‹é™å®šçš„å¼‚å¸¸æŠ›å‡º</p></li><li><p>æ³›å‹ç±»çš„åŸç”Ÿç±»å‹ä¸æ‰€ä¼ é€’çš„æ³›å‹æ— å…³ï¼Œæ— è®ºä¼ é€’ä»€ä¹ˆç±»å‹ï¼ŒåŸç”Ÿç±»æ˜¯ä¸€æ ·çš„</p></li><li><p>é™æ€å˜é‡æˆ–æ–¹æ³•ä¸èƒ½å¼•ç”¨æ³›å‹ç±»å‹å˜é‡ï¼Œä½†æ˜¯é™æ€æ³›å‹æ–¹æ³•æ˜¯å¯ä»¥çš„</p></li><li><p>åŸºæœ¬ç±»å‹æ— æ³•ä½œä¸ºæ³›å‹ç±»å‹</p></li><li><p>æ³›å‹æ•°ç»„å¯ä»¥å£°æ˜ä½†æ— æ³•å®ä¾‹åŒ–</p></li></ul><p>æ›´å¤šå…³äºJavaæ³›å‹çš„æœ‰æ„æ€çš„å­¦ä¹ ç»å†ä¹Ÿéœ€è¦é å¤§å®¶åœ¨æ—¥å¸¸å·¥ä½œä¸­è®¤çœŸå»ä½“ä¼šå•¦~</p><h1 id="11-Java-æšä¸¾"><a href="#11-Java-æšä¸¾" class="headerlink" title="11. Java æšä¸¾"></a>11. Java æšä¸¾</h1><h2 id="11-1-ä»€ä¹ˆæ˜¯æšä¸¾"><a href="#11-1-ä»€ä¹ˆæ˜¯æšä¸¾" class="headerlink" title="11.1 ä»€ä¹ˆæ˜¯æšä¸¾?"></a>11.1 ä»€ä¹ˆæ˜¯æšä¸¾?</h2><p>æšä¸¾æ˜¯Java1.5å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œé€šè¿‡å…³é”®å­—enumæ¥å®šä¹‰æšä¸¾ç±»ã€‚æšä¸¾ç±»æ˜¯ä¸€ç§ç‰¹æ®Šç±»ï¼Œå®ƒå’Œæ™®é€šç±»ä¸€æ ·å¯ä»¥ä½¿ç”¨æ„é€ å™¨ã€å®šä¹‰æˆå‘˜å˜é‡å’Œæ–¹æ³•ï¼Œä¹Ÿèƒ½å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£,ä½†æšä¸¾ç±»ä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ã€‚</p><p>ä¾‹å¦‚ï¼Œä½ è¦æŒ‡å®šä¸€æ•´ä¸ªæ˜ŸæœŸçš„å¤©çš„æšä¸¾ç±»å‹æ˜¯:</p><p>public enum Day {</p><p>SUNDAY, MONDAY, TUESDAY, WEDNESDAY,</p><p>THURSDAY, FRIDAY, SATURDAY</p><p>}</p><p>æˆ‘ä»¬åº”è¯¥åœ¨éœ€è¦ä½¿ç”¨å›ºå®šç»„å¸¸é‡çš„ä»»ä½•æ—¶å€™ä½¿ç”¨æšä¸¾ç±»å‹ã€‚è¿™åŒ…æ‹¬è‡ªç„¶æšä¸¾ç±»å‹ï¼Œä¾‹å¦‚é“¶æ²³ç³»çš„è¡Œæ˜Ÿï¼Œ</p><p>è¿™äº›ä½ å¯ä»¥åœ¨ç¼–è¯‘æ—¶çŸ¥é“ä»»ä½•å¯èƒ½å€¼ã€‚è¿˜æœ‰èœå•é€‰æ‹©ï¼Œå‘½ä»¤è¡Œæ ‡å¿—ç­‰ã€‚</p><h2 id="11-2-å¦‚ä½•å£°æ˜æšä¸¾ç±»å‹ï¼Ÿ"><a href="#11-2-å¦‚ä½•å£°æ˜æšä¸¾ç±»å‹ï¼Ÿ" class="headerlink" title="11.2 å¦‚ä½•å£°æ˜æšä¸¾ç±»å‹ï¼Ÿ"></a>11.2 å¦‚ä½•å£°æ˜æšä¸¾ç±»å‹ï¼Ÿ</h2><p>è¿™é‡Œæœ‰ä¸€äº›ä»‹ç»å¦‚ä½•ä½¿ç”¨Dayæšä¸¾ç±»å‹å£°æ˜çš„ä»£ç ï¼Œå¦‚ä¸‹:</p><p>public class EnumTest {</p><p>Day day;</p><p>public EnumTest(Day day) {</p><p>this.day ( &#x3D; ) day;</p><p>}</p><p>public void tellItLikeItIs() {</p><p>switch (day) {</p><p>case MONDAY:</p><p>System.out.println(â€œMondays are bad.â€);</p><p>break;</p><p>case FRIDAY:</p><p>System.out.println(â€œFridays are better.â€);</p><p>break;</p><p>case SATURDAY: case SUNDAY:</p><p>System.out.println(â€œWeekends are best.â€);</p><p>break;</p><p>default:</p><p>System.out.println(â€œMidweek days are so-so.â€);</p><p>break;</p><p>}</p><p>}</p><p>public static void main(String[] args) {</p><p>EnumTest firstDay ( &#x3D; ) new EnumTest(Day.MONDAY);</p><p>firstDay.tellItLikeItIs();</p><p>EnumTest thirdDay &#x3D; new EnumTest(Day.WEDNESDAY);</p><p>thirdDay.tellItLikeItIs();</p><p>EnumTest fifthDay &#x3D; new EnumTest(Day.FRIDAY);</p><p>fifthDay.tellItLikeItIs();</p><p>EnumTest sixthDay &#x3D; new EnumTest(Day.SATURDAY);</p><p>sixthDay.tellItLikeItIs();</p><p>EnumTest seventhDay &#x3D; new EnumTest(Day.SUNDAY);</p><p>seventhDay.tellItLikeItIs();</p><p>}</p><p>}</p><h2 id="ä¸Šè¿°ä»£ç è¾“å‡ºä¸º"><a href="#ä¸Šè¿°ä»£ç è¾“å‡ºä¸º" class="headerlink" title="ä¸Šè¿°ä»£ç è¾“å‡ºä¸º:"></a>ä¸Šè¿°ä»£ç è¾“å‡ºä¸º:</h2><p>Mondays are bad.</p><p>Midweek days are so-so.</p><p>Fridays are better.</p><p>weekends are best.</p><p>weekends are best.</p><p>æ³¨æ„ï¼šä»»æ„ä¸¤ä¸ªæšä¸¾æˆå‘˜ä¸èƒ½å…·æœ‰ç›¸åŒçš„åç§°ï¼Œä¸”å®ƒçš„å¸¸æ•°å€¼å¿…é¡»åœ¨è¯¥æšä¸¾çš„åŸºç¡€ç±»å‹çš„èŒƒå›´ä¹‹å†…ï¼Œå¤šä¸ªæšä¸¾æˆå‘˜ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚</p><p>å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°å£°æ˜åŸºç¡€ç±»å‹çš„æšä¸¾ï¼Œé‚£ä¹ˆæ„å‘³ç€å®ƒæ‰€å¯¹åº”çš„åŸºç¡€ç±»å‹æ˜¯ intã€‚</p><h2 id="11-2-1-æšä¸¾ç±»"><a href="#11-2-1-æšä¸¾ç±»" class="headerlink" title="11.2.1 æšä¸¾ç±»"></a>11.2.1 æšä¸¾ç±»</h2><p>Java ä¸­çš„æ¯ä¸€ä¸ªæšä¸¾éƒ½ç»§æ‰¿è‡ª java.lang.Enum ç±»ã€‚å½“å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹æ—¶ï¼Œæ¯ä¸€ä¸ªæšä¸¾ç±»å‹æˆå‘˜éƒ½å¯ä»¥çœ‹ä½œæ˜¯ Enum ç±»çš„å®ä¾‹ï¼Œè¿™äº›æšä¸¾æˆå‘˜é»˜è®¤éƒ½è¢« finalã€public, static ä¿®é¥°ï¼Œå½“ä½¿ç”¨æšä¸¾ç±»å‹æˆå‘˜æ—¶ï¼Œç›´æ¥ä½¿ç”¨æšä¸¾åç§°è°ƒç”¨æˆå‘˜å³å¯ã€‚</p><table><thead><tr><th>æ–¹æ³•åç§°</th><th>æè¿°</th></tr></thead><tr><td>values()</td><td>ä»¥æ•°ç»„å½¢å¼è¿”å›æšä¸¾ç±»å‹çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>valueOf()</td><td>å°†æ™®é€šå­—ç¬¦ä¸²è½¬æ¢ä¸ºæšä¸¾å®ä¾‹</td></tr><tr><td>compareTo()</td><td>æ¯”è¾ƒä¸¤ä¸ªæšä¸¾æˆå‘˜åœ¨å®šä¹‰æ—¶çš„é¡ºåº</td></tr><tr><td>ordinal()</td><td>è·å–æšä¸¾æˆå‘˜çš„ç´¢å¼•ä½ç½®</td></tr></table><h2 id="11-3-ä»å®‡å®™å…¥æ‰‹æ·±å…¥äº†è§£æšä¸¾ç±»å‹"><a href="#11-3-ä»å®‡å®™å…¥æ‰‹æ·±å…¥äº†è§£æšä¸¾ç±»å‹" class="headerlink" title="11.3 ä»å®‡å®™å…¥æ‰‹æ·±å…¥äº†è§£æšä¸¾ç±»å‹"></a>11.3 ä»å®‡å®™å…¥æ‰‹æ·±å…¥äº†è§£æšä¸¾ç±»å‹</h2><p>Javaç¼–ç¨‹è¯­è¨€æšä¸¾ç±»å‹æ¯”å…¶ä»–ç¼–ç¨‹è¯­è¨€æ›´åŠ å¼ºå¤§ã€‚enumå£°æ˜ï¼Œå®šä¹‰äº†ç±»(ç§°ä¸ºenumç±»å‹)ã€‚æšä¸¾ç±»ä½“ï¼Œ å¯ä»¥åŒ…å«æ–¹æ³•å’Œå…¶ä»–å­—æ®µã€‚ç¼–è¯‘å™¨ä¸ºenumè‡ªåŠ¨æ·»åŠ ç‰¹æ®Šçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªé™æ€çš„valuesæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªæŒ‰ç…§å£°æ˜é¡ºåºæ’åˆ—çš„enumå€¼æ•°ç»„ã€‚è¿™ä¸ªæ–¹æ³•é€šå¸¸ç»“åˆfor-eachç»“æ„ï¼Œéå†enumç±»å‹çš„æ‰€æœ‰å€¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢Planetç±»é‡Œçš„ä»£ç ï¼Œæ¼”ç¤ºäº†éå†é“¶æ²³ç³»çš„æ‰€æœ‰è¡Œæ˜Ÿã€‚</p><p>for (Planet ( p ) : Planet.values()) {</p><p>System.out.printf(â€œYour weight on %s is %f%nâ€,</p><p>p, p.surfaceweight(mass));</p><p>}</p><p>æ‰€æœ‰enumç±»éšå¼ç»§æ‰¿java.lang.Enumã€‚ç”±äºjavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œæ‰€æœ‰enumä¹Ÿä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ã€‚</p><p>Planetæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œä»£è¡¨é“¶æ²³ç³»é‡Œçš„æ‰€æœ‰è¡Œæ˜Ÿã€‚ä»–ä»¬æ˜¯æ’å®šçš„è´¨é‡å’ŒåŠå¾„å±æ€§å®šä¹‰ã€‚</p><p>æ¯ä¸ªæšä¸¾å¸¸é‡éƒ½æœ‰è´¨é‡å’ŒåŠå¾„å‚æ•°çš„å£°æ˜ã€‚è¿™äº›å€¼ï¼Œé€šè¿‡æ„é€ æ–¹æ³•ï¼Œåœ¨å¸¸é‡åˆå§‹åŒ–æ—¶ä¼ é€’è¿›æ¥ã€‚javaè¦æ±‚å¸¸é‡é¦–å…ˆå®šä¹‰ï¼Œå…¶æ¬¡æ‰æ˜¯å­—æ®µå’Œæ–¹æ³•ã€‚æ‰€ä»¥ï¼Œåœ¨å­—æ®µå’Œæ–¹æ³•ä¹‹å‰ï¼Œenumå¸¸é‡åˆ—è¡¨å¿…é¡»ä»¥åˆ†å·(;)ç»“æŸã€‚</p><p>æ³¨æ„ï¼šenumç±»å‹çš„æ„é€ æ–¹æ³•å¿…é¡»æ˜¯åŒ…å†…ç§æœ‰æˆ–è€…æ˜¯privateè®¿é—®ã€‚å®ƒè‡ªåŠ¨åˆ›å»ºåœ¨enumä½“å†…çš„å¼€å§‹åˆ›å»ºå£°æ˜çš„å¸¸é‡ï¼Œä¸å…è®¸ç›´æ¥è°ƒç”¨enumçš„æ„é€ æ–¹æ³•ã€‚</p><p>å¯¹äºå®ƒçš„å±æ€§å’Œæ„é€ æ–¹æ³•ï¼Œè¡Œæ˜Ÿä¸Šæœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æ£€ç´¢æ¯ä¸ªè¡Œæ˜Ÿçš„è¡¨é¢å¼•åŠ›å’Œé‡é‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œæ ¹æ®ä½ åœ¨åœ°çƒçš„ä½“é‡(ä»»ä½•å•ä½),è®¡ç®—å¹¶æ‰“å°ä½ åœ¨æ‰€æœ‰çš„è¡Œæ˜Ÿçš„ä½“é‡ï¼ˆç›¸åŒå•ä½ï¼‰ï¼š</p><p>public enum Planet {</p><p>MERCURY (3.303e+23, 2.4397e6),</p><p>VENUS (4.869e+24, 6.0518e6),</p><p>EARTH (5.976e+24, 6.37814e6),</p><p>MARS (6.421e+23, 3.3972e6),</p><p>JUPITER (1.9e+27, 7.1492e7),</p><p>SATURN (5.688e+26, 6.0268e7),</p><p>URANUS (8.686e+25, 2.5559e7),</p><p>NEPTUNE (1.024e+26, 2.4746e7);</p><p>private final double mass; &#x2F;&#x2F; in kilograms</p><p>private final double radius; &#x2F;&#x2F; in meters</p><p>Planet(double mass, double radius) {</p><p>this.mass ( &#x3D; ) mass;</p><p>this.radius ( &#x3D; ) radius;</p><p>}</p><p>private double mass() { return mass; }</p><p>private double radius() { return radius; }</p><p>&#x2F;&#x2F; universal gravitational constant (m3 kg-1 s-2)</p><p>public static final double ( G &#x3D; {6.67300E} - {11} ) ;</p><p>double surfaceGravity() {</p><p>return G * mass &#x2F; (radius * radius);</p><p>}</p><p>double surfaceweight(double otherMass) {</p><p>return otherMass * surfaceGravity();</p><p>}</p><p>public static void main(String[] args) {</p><p>if (args.length ( ! &#x3D; 1 ) ) {</p><p>System.err.println(â€œUsage: java Planet <earth_weight>â€œ);</p><p>System.exit(-1);</p><p>}</p><p>double earthweight ( &#x3D; ) Double.parseDouble(args[0]);</p><p>double mass ( &#x3D; ) earthweight&#x2F;EARTH.surfaceGravity();</p><p>for (Planet ( p ) : Planet.values ())</p><p>System.out.printf(â€œYour weight on %s is %f%nâ€,</p><p>p, p.surfaceweight(mass));</p><p>} }</p><p>å¦‚æœåœ¨å‘½ä»¤è¡Œè¿è¡ŒPlanet.classï¼Œå‚æ•°æ˜¯175ï¼Œè¾“å‡ºæ˜¯:</p><p>$ java Planet 175</p><p>Your weight on MERCURY is 66.107583</p><p>Your weight on VENUS is 158.374842</p><p>Your weight on EARTH is 175.000000</p><p>Your weight on MARS is 66.279007</p><p>YOUR WEIGHTER IS 442.847567</p><p>Your weight on SATURN is 186.552719</p><p>Your weight on URANUS is 158.397260</p><p>Your weight on NEPTUNE is 199.207413</p><h2 id="11-4-EnumMap-ä¸-EnumSet"><a href="#11-4-EnumMap-ä¸-EnumSet" class="headerlink" title="11.4 EnumMap ä¸ EnumSet"></a>11.4 EnumMap ä¸ EnumSet</h2><p>ä¸ºäº†æ›´å¥½åœ°æ”¯æŒæšä¸¾ç±»å‹ï¼Œjava.util ä¸­æ·»åŠ äº†ä¸¤ä¸ªæ–°ç±»ï¼šEnumMap å’Œ EnumSetã€‚ä½¿ç”¨å®ƒä»¬å¯ä»¥æ›´é«˜æ•ˆåœ°æ“ä½œæšä¸¾ç±»å‹ã€‚</p><ul><li>EnumMap ç±»</li></ul><p>EnumMap æ˜¯ä¸“é—¨ä¸ºæšä¸¾ç±»å‹é‡èº«å®šåšçš„ Map å®ç°ã€‚è™½ç„¶ä½¿ç”¨å…¶ä»–çš„ Mapï¼ˆå¦‚ HashMapï¼‰å®ç°ä¹Ÿèƒ½å®Œæˆæšä¸¾ç±»å‹å®ä¾‹åˆ°å€¼çš„æ˜ å°„ï¼Œä½†æ˜¯ä½¿ç”¨ EnumMap ä¼šæ›´åŠ é«˜æ•ˆã€‚</p><ul><li>HashMap åªèƒ½æ¥æ”¶åŒä¸€æšä¸¾ç±»å‹çš„å®ä¾‹ä½œä¸ºé”®å€¼ï¼Œå¹¶ä¸”ç”±äºæšä¸¾ç±»å‹å®ä¾‹çš„æ•°é‡ç›¸å¯¹å›ºå®šå¹¶ä¸”æœ‰é™ï¼Œæ‰€ä»¥ EnumMap ä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾ä¸æšä¸¾ç±»å‹å¯¹åº”çš„å€¼ï¼Œä½¿å¾— EnumMap çš„æ•ˆç‡éå¸¸é«˜ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä½¿ç”¨ EnumMap çš„ä¸€ä¸ªä»£ç ç¤ºä¾‹ã€‚æšä¸¾ç±»å‹ DataBaseType é‡Œå­˜æ”¾äº†ç°åœ¨æ”¯æŒçš„æ‰€æœ‰æ•°æ®åº“ç±»å‹ã€‚é’ˆå¯¹ä¸åŒçš„æ•°æ®åº“ï¼Œä¸€äº›æ•°æ®åº“ç›¸å…³çš„æ–¹æ³•éœ€è¦è¿”å›ä¸ä¸€æ ·çš„å€¼ï¼Œä¾‹å¦‚ç¤ºä¾‹ä¸­ getURL() æ–¹æ³•ã€‚</p><p>&#x2F;&#x2F;å®šä¹‰æ•°æ®åº“ç±»å‹æšä¸¾</p><p>public enum DataBaseType</p><p>{</p><p>MYSQUORACLE , DB2 , SQLSERVER</p><p>}</p><p>&#x2F;&#x2F;æŸç±»ä¸­å®šä¹‰çš„è·å–æ•°æ®åº“URLçš„æ–¹æ³•ä»¥åŠEnumMapçš„å£°æ˜</p><p>private EnumMap&lt;DataBaseType, String&gt;urls&#x3D;new EnumMap&lt;DataBaseType, String&gt;</p><p>(DataBaseType.class);</p><p>public DataBaseInfo()</p><p>{</p><p>urls.put(DataBaseType.DB2,â€jdbc:db2:&#x2F;&#x2F;localhost:5000&#x2F;sampleâ€);</p><p>urls.put(DataBaseType.MYSQL,â€jdbc:mysql:&#x2F;&#x2F;localhost&#x2F;mydbâ€);</p><p>urls.put(DataBaseType.ORACLE, â€œjdbc:oracle:thin:@localhost:1521:sampleâ€);</p><p>urls . put (DataBaseType . SQLSERVER, â€œjdbc : microsoft : sq1server : &#x2F;&#x2F;sq1 : 1433 ; Database&#x3D;myd</p><p>bâ€);</p><p>}</p><p>&#x2F;&#x2F;æ ¹æ®ä¸åŒçš„æ•°æ®åº“ç±»å‹, è¿”å›å¯¹åº”çš„URL</p><p>&#x2F;&#x2F;@param type DataBaseType æšä¸¾ç±»æ–°å®ä¾‹</p><p>&#x2F;&#x2F;@return</p><p>public String getURL(DataBaseType type)</p><p>{</p><p>return this.urls.get(type);</p><p>}</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒEnumMapå¯¹è±¡urlså¾€å¾€æ˜¯ç”±å¤–éƒ¨è´Ÿè´£æ•´ä¸ªåº”ç”¨åˆå§‹åŒ–çš„ä»£ç æ¥å¡«å……çš„ã€‚</p><p>ä»æœ¬ä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨EnumMapå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ºæšä¸¾ç±»å‹åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ç»‘å®šåˆ°ä¸åŒçš„å€¼ä¸Šã€‚æœ¬ä¾‹å­ä¸­getURLç»‘å®šåˆ°URLä¸Šï¼Œåœ¨å…¶ä»–çš„åœ°æ–¹å¯èƒ½åˆè¢«ç»‘å®šåˆ°æ•°æ®åº“é©±åŠ¨ä¸Šå»ã€‚</p><h2 id="EnumSet-ç±»"><a href="#EnumSet-ç±»" class="headerlink" title="EnumSet ç±»"></a>EnumSet ç±»</h2><p>EnumSet æ˜¯æšä¸¾ç±»å‹çš„é«˜æ€§èƒ½ Set å®ç°ï¼Œå®ƒè¦æ±‚æ”¾å…¥å®ƒçš„æšä¸¾å¸¸é‡å¿…é¡»å±äºåŒä¸€æšä¸¾ç±»å‹ã€‚EnumSet æä¾›äº†è®¸å¤šå·¥å‚æ–¹æ³•ä»¥ä¾¿äºåˆå§‹åŒ–ï¼Œå¦‚è¡¨ 2 æ‰€ç¤º</p><table><thead><tr><th>æ–¹æ³•åç§°</th><th>æè¿°</th></tr></thead><tr><td>of(E first, e...rest)</td><td>åˆ›å»ºåŒ…å«æŒ‡å®šæšä¸¾æˆå‘˜çš„ EnumSet å¯¹è±¡</td></tr><tr><td>allOf(Class element type)</td><td>åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šæšä¸¾ç±»å‹ä¸­æ‰€æœ‰æšä¸¾æˆå‘˜çš„ EnumSet å¯¹è±¡</td></tr><tr><td>range(E from, E to)</td><td>åˆ›å»ºä¸€ä¸ª EnumSet å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº† from åˆ° to ä¹‹é—´çš„æ‰€æœ‰ æšä¸¾æˆå‘˜</td></tr><tr><td>complementOf(EnumSet s)</td><td>åˆ›å»ºä¸€ä¸ªä¸æŒ‡å®š EnumSet å¯¹è±¡ s ç›¸åŒçš„æšä¸¾ç±»å‹ EnumSet å¯¹ è±¡ï¼Œå¹¶åŒ…å«æ‰€æœ‰ s ä¸­æœªåŒ…å«çš„æšä¸¾æˆå‘˜</td></tr><tr><td>copyOf(EnumSet s)</td><td>åˆ›å»ºä¸€ä¸ªä¸æŒ‡å®š EnumSet å¯¹è±¡ s ç›¸åŒçš„æšä¸¾ç±»å‹ EnumSet å¯¹ è±¡ï¼Œå¹¶ä¸ s åŒ…å«ç›¸åŒçš„æšä¸¾æˆå‘˜</td></tr></table><table><thead><tr><th>æ–¹æ³•åç§°</th><th>æè¿°</th></tr></thead><tr><td>noneOf(<Class elementType)</td><td>åˆ›å»ºæŒ‡å®šæšä¸¾ç±»å‹çš„ç©º EnumSet å¯¹è±¡</td></tr></table><h2 id="11-5-ä½¿ç”¨æšä¸¾ç±»å‹çš„ä¼˜åŠ¿"><a href="#11-5-ä½¿ç”¨æšä¸¾ç±»å‹çš„ä¼˜åŠ¿" class="headerlink" title="11.5 ä½¿ç”¨æšä¸¾ç±»å‹çš„ä¼˜åŠ¿"></a>11.5 ä½¿ç”¨æšä¸¾ç±»å‹çš„ä¼˜åŠ¿</h2><p>æšä¸¾ç±»å‹å£°æ˜æä¾›äº†ä¸€ç§ç”¨æˆ·å‹å¥½çš„å˜é‡å®šä¹‰æ–¹æ³•ï¼Œæšä¸¾äº†æŸç§æ•°æ®ç±»å‹æ‰€æœ‰å¯èƒ½å‡ºç°çš„å€¼ã€‚æ€»ç»“æšä¸¾ç±»å‹ï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹:</p><ul><li><p>ç±»å‹å®‰å…¨</p></li><li><p>ç´§å‡‘æœ‰æ•ˆçš„æ•°æ®å®šä¹‰</p></li><li><p>å¯ä»¥å’Œç¨‹åºå…¶ä»–éƒ¨åˆ†å®Œç¾äº¤äº’</p></li><li><p>è¿è¡Œæ•ˆç‡é«˜</p></li></ul><p>æ›´å¤šå…³äºJavaæ³›å‹çš„æœ‰æ„æ€çš„å­¦ä¹ ç»å†ä¹Ÿéœ€è¦é å¤§å®¶åœ¨æ—¥å¸¸å·¥ä½œä¸­è®¤çœŸå»ä½“ä¼šå•¦~</p><h1 id="12-Java-8-æ–°ç‰¹æ€§"><a href="#12-Java-8-æ–°ç‰¹æ€§" class="headerlink" title="12. Java 8 æ–°ç‰¹æ€§"></a>12. Java 8 æ–°ç‰¹æ€§</h1><h2 id="12-1-Java-8-ç®€ä»‹"><a href="#12-1-Java-8-ç®€ä»‹" class="headerlink" title="12.1 Java 8 ç®€ä»‹"></a>12.1 Java 8 ç®€ä»‹</h2><p>Java 8æ˜¯Javaè‡ª Java 5 (å‘å¸ƒäº2004å¹´) ä¹‹åçš„æœ€é‡è¦çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªç‰ˆæœ¬åŒ…å«è¯­è¨€ã€ç¼–è¯‘å™¨ã€åº“ã€å·¥å…·å’ŒJVMç­‰æ–¹é¢çš„åå¤šä¸ªæ–°ç‰¹æ€§ã€‚åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬å°†å­¦ä¹ è¿™äº›æ–°ç‰¹æ€§ï¼Œå¹¶ç”¨å®é™…çš„ä¾‹å­è¯´æ˜åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹é€‚åˆä½¿ç”¨ã€‚</p><p>æœ¬æ–‡ä¸­æˆ‘ä»¬å‡è®¾Javaå¼€å‘è€…ç»å¸¸é¢å¯¹çš„å‡ ç±»é—®é¢˜:</p><ul><li><p>è¯­è¨€</p></li><li><p>ç¼–è¯‘å™¨</p></li><li><p>åº“</p></li></ul><p>ã€‚ å·¥å…·</p><ul><li>è¿è¡Œæ—¶ (JVM)</li></ul><h2 id="12-2-Java-8-ç‰¹æ€§è¯¦è§£"><a href="#12-2-Java-8-ç‰¹æ€§è¯¦è§£" class="headerlink" title="12.2 Java 8 ç‰¹æ€§è¯¦è§£"></a>12.2 Java 8 ç‰¹æ€§è¯¦è§£</h2><h2 id="12-2-1-Lambdaè¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£"><a href="#12-2-1-Lambdaè¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£" class="headerlink" title="12.2.1 Lambdaè¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£"></a>12.2.1 Lambdaè¡¨è¾¾å¼å’Œå‡½æ•°å¼æ¥å£</h2><p>Lambdaè¡¨è¾¾å¼ï¼ˆä¹Ÿç§°ä¸ºé—­åŒ…ï¼‰æ˜¯Java 8ä¸­æœ€å¤§å’Œæœ€ä»¤äººæœŸå¾…çš„è¯­è¨€æ”¹å˜ã€‚å®ƒå…è®¸æˆ‘ä»¬å°†å‡½æ•°å½“æˆå‚æ•°ä¼ é€’ç»™æŸä¸ªæ–¹æ³•ï¼Œæˆ–è€…æŠŠä»£ç æœ¬èº«å½“ä½œæ•°æ®å¤„ç†ï¼šå‡½æ•°å¼å¼€å‘è€…éå¸¸ç†Ÿæ‚‰è¿™äº›æ¦‚å¿µã€‚å¦‚æœæ²¡æœ‰lambdaï¼Œ Streamç”¨èµ·æ¥ç›¸å½“åˆ«æ‰­ï¼Œä»–ä¼šäº§ç”Ÿå¤§é‡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œæ‰€ä»¥lambda+default methodä½¿å¾—jdkåº“æ›´åŠ å¼ºå¤§ï¼Œä»¥åŠçµæ´»ï¼ŒStreamä»¥åŠé›†åˆæ¡†æ¶çš„æ”¹è¿›ä¾¿æ˜¯æœ€å¥½çš„è¯æ˜ã€‚</p><p>(1). Lambdaçš„è®¾è®¡è€—è´¹äº†å¾ˆå¤šæ—¶é—´å’Œå¾ˆå¤§çš„ç¤¾åŒºåŠ›é‡ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ç§æŠ˜ä¸­çš„å®ç°æ–¹æ¡ˆï¼Œå¯ä»¥å®ç°ç®€æ´è€Œç´§å‡‘çš„è¯­è¨€ç»“æ„ã€‚</p><p>Arrays.asList(â€œaâ€, â€œbâ€, â€œdâ€).forEach( e -&gt; System.out.println( e ));</p><p>ä¸Šé¢è¿™ä¸ªä»£ç ä¸­çš„å‚æ•°eçš„ç±»å‹æ˜¯ç”±ç¼–è¯‘å™¨æ¨ç†å¾—å‡ºçš„ï¼Œä½ ä¹Ÿå¯ä»¥æ˜¾å¼æŒ‡å®šè¯¥å‚æ•°çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p><p>Arrays.asList(â€œaâ€, â€œbâ€, â€œdâ€).forEach( (String e ) -&gt; System.out.println( e ) );</p><p>(2). å½“Lambdaè¡¨è¾¾å¼éœ€è¦æ›´å¤æ‚çš„è¯­å¥å—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·å°†è¯¥è¯­å¥å—æ‹¬èµ·æ¥ï¼Œç±»ä¼¼äºJavaä¸­çš„å‡½æ•°ä½“ï¼Œä¾‹å¦‚:</p><p>Arrays.asList(â€œaâ€, â€œbâ€, â€œdâ€).forEach( e -&gt; {</p><p>System.out.print( e );</p><p>System.out.print( e );</p><p>});</p><p>(3). Lambdaè¡¨è¾¾å¼å¯ä»¥å¼•ç”¨ç±»æˆå‘˜å’Œå±€éƒ¨å˜é‡ï¼ˆä¼šå°†è¿™äº›å˜é‡éšå¼å¾—è½¬æ¢æˆfinalçš„ï¼‰ï¼Œä¸‹åˆ—ä¸¤ä¸ªä»£ç å—çš„æ•ˆæœä¸€è‡´:</p><p>String separator ( &#x3D; ) â€œ,â€;</p><p>Arrays.asList(â€œaâ€, â€œbâ€, â€œdâ€).forEach(</p><p>( String e ) -&gt; System.out.print( e + separator ) );</p><p>final String separator ( &#x3D; ) â€œ,â€;</p><p>Arrays.asList(â€œaâ€, â€œbâ€, â€œdâ€).forEach(</p><p>( String e ) -&gt; System.out.print( e + separator ) );</p><p>(4). Lambdaè¡¨è¾¾å¼æ˜¯å¯ä»¥æœ‰è¿”å›å€¼çš„ï¼Œè¿”å›å€¼çš„ç±»å‹ä¹Ÿç”±ç¼–è¯‘å™¨æ¨ç†å¾—å‡ºã€‚å¦‚æœLambdaè¡¨è¾¾å¼ä¸­çš„è¯­å¥å—åªæœ‰ä¸€è¡Œï¼Œåˆ™å¯ä»¥ä¸ç”¨ä½¿ç”¨returnè¯­å¥ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><p>Arrays.asList(â€œaâ€, â€œbâ€, â€œdâ€).sort(( e1, e2)) -&gt; e1.compareTo( e2 ));</p><p>Arrays.asList(â€œaâ€, â€œbâ€, â€œdâ€ ).sort( ( e1, e2 ) -&gt; {</p><p>int result ( &#x3D; ) e1.compareTo(e2);</p><p>return result;</p><p>});</p><p>ä¸ºäº†è®©ç°æœ‰çš„åŠŸèƒ½ä¸Lambdaè¡¨è¾¾å¼è‰¯å¥½å…¼å®¹ï¼Œå‡½æ•°æ¥å£åº”è¿è€Œç”Ÿã€‚å‡½æ•°æ¥å£æŒ‡çš„æ˜¯åªæœ‰ä¸€ä¸ªå‡½æ•°çš„æ¥ ( â–± ) ï¼Œè¿™æ ·çš„æ¥å£å¯ä»¥éšå¼è½¬æ¢ä¸ºLambdaè¡¨è¾¾å¼ã€‚java.lang.Runnableå’Œjava.util.concurrent.Callableæ˜¯å‡½æ•°å¼æ¥å£çš„æœ€ä½³ä¾‹å­ã€‚åœ¨å®è·µä¸­ï¼Œå‡½æ•°å¼æ¥å£éå¸¸è„†å¼±ï¼šåªè¦æŸä¸ªå¼€å‘è€…åœ¨è¯¥æ¥å£ä¸­æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œ åˆ™è¯¥æ¥å£å°±ä¸å†æ˜¯å‡½æ•°å¼æ¥å£è¿›è€Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚ä¸ºäº†å…‹æœè¿™ç§ä»£ç å±‚é¢çš„è„†å¼±æ€§ï¼Œå¹¶æ˜¾å¼è¯´æ˜æŸä¸ªæ¥å£æ˜¯å‡½æ•°å¼æ¥å£ï¼ŒJava 8 æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„æ³¨è§£@FunctionalInterfaceï¼Œä¸¾ä¸ªç®€å•çš„å‡½æ•°å¼æ¥å£çš„å®šä¹‰:</p><p>@FunctionalInterface</p><p>public interface Functional {</p><p>void method();</p><p>}</p><p>å¦‚æœä½ éœ€è¦äº†è§£æ›´å¤šLambdaè¡¨è¾¾å¼çš„ç»†èŠ‚ï¼Œä¸€å®šè¦å»çœ‹çœ‹å®˜æ–¹æ–‡æ¡£å“¦ã€‚</p><h2 id="12-2-2-æ–¹æ³•å¼•ç”¨"><a href="#12-2-2-æ–¹æ³•å¼•ç”¨" class="headerlink" title="12.2.2 æ–¹æ³•å¼•ç”¨"></a>12.2.2 æ–¹æ³•å¼•ç”¨</h2><p>æ–¹æ³•å¼•ç”¨ä½¿å¾—å¼€å‘è€…å¯ä»¥ç›´æ¥å¼•ç”¨ç°å­˜çš„æ–¹æ³•ã€Javaç±»çš„æ„é€ æ–¹æ³•æˆ–è€…å®ä¾‹å¯¹è±¡ã€‚æ–¹æ³•å¼•ç”¨å’ŒLambdaè¡¨è¾¾å¼é…åˆä½¿ç”¨ï¼Œä½¿å¾—javaç±»çš„æ„é€ æ–¹æ³•çœ‹èµ·æ¥ç´§å‡‘è€Œç®€æ´ï¼Œæ²¡æœ‰å¾ˆå¤šå¤æ‚çš„æ¨¡æ¿ä»£ç ã€‚</p><p>ä¸¾ä¸ªä¾‹å­:</p><hr><p>public static class Car {</p><p>public static Car create( final Supplier&lt; Car &gt; supplier ) {</p><p>return supplier.get();</p><p>}</p><p>public static void collide( final Car car ) {</p><p>System.out.println( â€œCollidedâ€ + car.toString() );</p><p>}</p><p>public void follow( final Car another ) {</p><p>System.out.println( â€œFollowing the â€œ + another.toString() );</p><p>}</p><p>public void repair() {</p><p>System.out.println( â€œRepaired â€œ + this.toString() );</p><p>}</p><p>}</p><hr><p>æ–¹æ³•ä¸€å¼•ç”¨çš„ç±»å‹æ˜¯æ„é€ å™¨å¼•ç”¨ï¼Œè¯­æ³•æ˜¯Class::newï¼Œæˆ–è€…æ›´ä¸€èˆ¬çš„å½¢å¼ï¼šClass::newã€‚æ³¨æ„ï¼šè¿™ä¸ªæ„é€ å™¨æ²¡æœ‰å‚æ•°ã€‚</p><p>final car car &#x3D; Car.create( Car::new );</p><p>final List&lt; Car &gt; cars &#x3D; Arrays.asList( car );</p><p>æ–¹æ³•äºŒå¼•ç”¨çš„ç±»å‹æ˜¯é™æ€æ–¹æ³•å¼•ç”¨ï¼Œè¯­æ³•æ˜¯Class::static_methodã€‚æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªCarç±»å‹çš„å‚æ•°ã€‚</p><p>cars.forEach( Car::collide );</p><p>æ–¹æ³•ä¸‰å¼•ç”¨çš„ç±»å‹æ˜¯æŸä¸ªå®ä¾‹å¯¹è±¡çš„æˆå‘˜æ–¹æ³•çš„å¼•ç”¨ï¼Œè¯­æ³•æ˜¯instance::methodã€‚æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªCarç±»å‹çš„å‚æ•°:</p><p>final Car police ( &#x3D; ) Car.create(Car::new);</p><p>cars.forEach( police::follow );</p><p>æ–¹æ³•å››å¼•ç”¨çš„ç±»å‹æ˜¯æŸä¸ªç±»çš„æˆå‘˜æ–¹æ³•çš„å¼•ç”¨ï¼Œè¯­æ³•æ˜¯Class::methodï¼Œæ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡æœ‰å®šä¹‰å…¥å‚ï¼š</p><p>cars.forEach( Car::repair );</p><p>è¿è¡Œä¸Šè¿°ä¾‹å­ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼ˆCarå®ä¾‹å¯èƒ½ä¸åŒï¼‰ï¼š</p><p>collided com.javacodegeeks.java8.method.references.MethodReferences$Car@7a81197d Repaired com.javacodegeeks.java8.method.references.MethodReferences$Car@7a81197d Following the</p><p>com. javacodegeeks . java8 . method . references . MethodReferences $Car@7a81197d</p><h2 id="12-2-3-æ¥å£çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•"><a href="#12-2-3-æ¥å£çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•" class="headerlink" title="12.2.3 æ¥å£çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•"></a>12.2.3 æ¥å£çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•</h2><p>Java 8ä½¿ç”¨ä¸¤ä¸ªæ–°æ¦‚å¿µæ‰©å±•äº†æ¥å£çš„å«ä¹‰ï¼šé»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ã€‚é»˜è®¤æ–¹æ³•ä½¿å¾—æ¥å£æœ‰ç‚¹ç±»ä¼¼traitsï¼Œä¸è¿‡è¦å®ç°çš„ç›®æ ‡ä¸ä¸€æ ·ã€‚é»˜è®¤æ–¹æ³•ä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨ ä¸ç ´åäºŒè¿›åˆ¶å…¼å®¹æ€§çš„å‰æä¸‹ï¼Œå¾€ç°å­˜æ¥å£ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œå³ä¸å¼ºåˆ¶é‚£äº›å®ç°äº†è¯¥æ¥å£çš„ç±»ä¹ŸåŒæ—¶å®ç°è¿™ä¸ªæ–°åŠ çš„æ–¹æ³•ã€‚</p><p>é»˜è®¤æ–¹æ³•å’ŒæŠ½è±¡æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«åœ¨äºæŠ½è±¡æ–¹æ³•éœ€è¦å®ç°ï¼Œè€Œé»˜è®¤æ–¹æ³•ä¸éœ€è¦ã€‚æ¥å£æä¾›çš„é»˜è®¤æ–¹æ³•ä¼šè¢«æ¥å£çš„å®ç°ç±»ç»§æ‰¿æˆ–è€…è¦†å†™ï¼Œä¾‹å­ä»£ç å¦‚ä¸‹:</p><hr><p>private interface Defaulable {</p><p>&#x2F;&#x2F; Interfaces now allow default methods, the implementer may or</p><p>&#x2F;&#x2F; may not implement (override) them.</p><p>default String notRequired() {</p><p>return â€œDefault implementationâ€;</p><p>}</p><p>}</p><p>private static class DefaultableImpl implements Defaulable {</p><p>}</p><p>private static class OverridableImpl implements Defaulable {</p><p>@override</p><p>public string notRequired() {</p><p>return â€œOverridden implementationâ€;</p><p>}</p><p>}</p><hr><p>Defaulableæ¥å£ä½¿ç”¨å…³é”®å­—defaultå®šä¹‰äº†ä¸€ä¸ªé»˜è®¤æ–¹æ³•notRequired()ã€‚DefaultableImplç±»å®ç°äº†è¿™ä¸ªæ¥å£ï¼ŒåŒæ—¶é»˜è®¤ç»§æ‰¿äº†è¿™ä¸ªæ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•ï¼›OverridableImplç±»ä¹Ÿå®ç°äº†è¿™ä¸ªæ¥å£ï¼Œä½†è¦†å†™äº†è¯¥æ¥å£çš„é»˜è®¤æ–¹æ³•ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªä¸åŒçš„å®ç°ã€‚</p><p>Java 8çš„å¦ä¸€ä¸ªæœ‰è¶£çš„ç‰¹æ€§æ˜¯åœ¨æ¥å£ä¸­å®šä¹‰é™æ€æ–¹æ³•ï¼Œä¾‹å­ä»£ç å¦‚ä¸‹ï¼š</p><p>private interface DefaulableFactory {</p><p>&#x2F;&#x2F; Interfaces now allow static methods</p><p>static Defaulable create( Supplier&lt; Defaulable &gt; supplier ) {</p><p>return supplier.get();</p><p>}</p><p>}</p><p>ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ•´åˆäº†é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯ï¼š</p><p>public static void main( String[] args ) {</p><p>Defaulable defaulable ( &#x3D; ) DefaulableFactory.create(DefaultableImpl::new);</p><p>System.out.println( defaulable.notRequired());</p><p>defaulable ( &#x3D; ) DefaulableFactory.create(OverridableImpl::new);</p><p>System.out.println( defaulable.notRequired()); }</p><p>è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœå¦‚ä¸‹:</p><p>Default implementation</p><p>Overridden implementation</p><p>ç”±äºJVMä¸Šçš„é»˜è®¤æ–¹æ³•çš„å®ç°åœ¨å­—èŠ‚ç å±‚é¢æä¾›äº†æ”¯æŒï¼Œå› æ­¤æ•ˆç‡éå¸¸é«˜ã€‚é»˜è®¤æ–¹æ³•å…è®¸åœ¨ä¸æ‰“ç ´ç°æœ‰ç»§</p><p>æ‰¿ä½“ç³»çš„åŸºç¡€ä¸Šæ”¹è¿›æ¥å£ã€‚è¯¥ç‰¹æ€§åœ¨å®˜æ–¹åº“ä¸­çš„åº”ç”¨æ˜¯ï¼šç»™java.util.Collectionæ¥å£æ·»åŠ æ–°æ–¹æ³•ï¼Œå¦‚</p><p>stream()ã€parallelStream()ã€forEach()å’ŒremoveIf()ç­‰ç­‰ã€‚</p><h2 id="12-2-4-æ›´å¥½çš„ç±»å‹æ¨æ–­"><a href="#12-2-4-æ›´å¥½çš„ç±»å‹æ¨æ–­" class="headerlink" title="12.2.4 æ›´å¥½çš„ç±»å‹æ¨æ–­"></a>12.2.4 æ›´å¥½çš„ç±»å‹æ¨æ–­</h2><p>Java 8ç¼–è¯‘å™¨åœ¨ç±»å‹æ¨æ–­æ–¹é¢æœ‰å¾ˆå¤§çš„æå‡ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ç¼–è¯‘å™¨å¯ä»¥æ¨å¯¼å‡ºæŸä¸ªå‚æ•°çš„æ•°æ®ç±»å‹ï¼Œä»è€Œä½¿å¾—ä»£ç æ›´ä¸ºç®€æ´ã€‚ä¾‹å­ä»£ç å¦‚ä¸‹:</p><hr><p>package com.javacodegeeks.java8.type.inference;</p><p>public class value&lt; ( T &gt; { )</p><p>public static&lt; ( T &gt; T ) defaultvalue() {</p><p>return null;</p><p>}</p><p>public ( T ) getOrDefault( ( T ) value, ( T ) defaultvalue ( ){ )</p><p>return ( value !&#x3D; null ) ? value : defaultvalue;</p><p>}</p><p>}</p><hr><h2 id="ä¸‹åˆ—ä»£ç æ˜¯Valueç±»å‹çš„åº”ç”¨"><a href="#ä¸‹åˆ—ä»£ç æ˜¯Valueç±»å‹çš„åº”ç”¨" class="headerlink" title="ä¸‹åˆ—ä»£ç æ˜¯Valueç±»å‹çš„åº”ç”¨:"></a>ä¸‹åˆ—ä»£ç æ˜¯Valueç±»å‹çš„åº”ç”¨:</h2><p>package com.javacodegeeks.java8.type.inference;</p><p>public class TypeInference {</p><p>public static void main(String[] args) {</p><p>final value&lt; String ( &gt; ) value ( &#x3D; ) new value ( &lt; &gt; \left( \right) ) ;</p><p>value.getOrDefault(â€œ22â€, value.defaultvalue());</p><p>}</p><p>}</p><p>å‚æ•°Value.defaultValue()çš„ç±»å‹ç”±ç¼–è¯‘å™¨æ¨å¯¼å¾—å‡ºï¼Œä¸éœ€è¦æ˜¾å¼æŒ‡æ˜ã€‚åœ¨Java 7ä¸­è¿™æ®µä»£ç ä¼šæœ‰ç¼–è¯‘é”™è¯¯ï¼Œé™¤éä½¿ç”¨Value.defaultValue()ã€‚</p><h2 id="12-2-5-é‡å¤æ³¨è§£"><a href="#12-2-5-é‡å¤æ³¨è§£" class="headerlink" title="12.2.5 é‡å¤æ³¨è§£"></a>12.2.5 é‡å¤æ³¨è§£</h2><p>è‡ªä»Java 5ä¸­å¼•å…¥æ³¨è§£ä»¥æ¥ï¼Œè¿™ä¸ªç‰¹æ€§å¼€å§‹å˜å¾—éå¸¸æµè¡Œï¼Œå¹¶åœ¨å„ä¸ªæ¡†æ¶å’Œé¡¹ç›®ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚ä¸è¿‡ï¼Œæ³¨è§£æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é™åˆ¶æ˜¯ï¼šåœ¨åŒä¸€ä¸ªåœ°æ–¹ä¸èƒ½å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ã€‚Java 8æ‰“ç ´äº†è¿™ä¸ªé™åˆ¶ï¼Œå¼•å…¥äº†é‡å¤æ³¨è§£çš„æ¦‚å¿µï¼Œå…è®¸åœ¨åŒä¸€ä¸ªåœ°æ–¹å¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªæ³¨è§£ã€‚</p><p>åœ¨Java 8ä¸­ä½¿ç”¨@Repeatableæ³¨è§£å®šä¹‰é‡å¤æ³¨è§£ï¼Œå®é™…ä¸Šï¼Œè¿™å¹¶ä¸æ˜¯è¯­è¨€å±‚é¢çš„æ”¹è¿›ï¼Œè€Œæ˜¯ç¼–è¯‘å™¨åšçš„ä¸€ä¸ªtrickï¼Œåº•å±‚çš„æŠ€æœ¯ä»ç„¶ç›¸åŒã€‚å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„ä»£ç è¯´æ˜ï¼š</p><hr><p>package com.javacodegeeks.java8.repeatable.annotations;</p><p>import java.lang.annotation.ElementType;</p><p>import java.lang.annotation.Repeatable;</p><p>import java.lang.annotation.Retention;</p><hr><hr><p>import java.lang.annotation.RetentionPolicy;</p><p>import java.lang.annotation.Target;</p><p>public class RepeatingAnnotations {</p><p>@Target( ElementType.TYPE )</p><p>@Retention( RetentionPolicy.RUNTIME )</p><p>public @interface Filters {</p><p>Filter[] value();</p><p>}</p><p>@Target( ElementType.TYPE )</p><p>@Retention( RetentionPolicy.RUNTIME )</p><p>@Repeatable( Filters.class )</p><p>public @interface Filter {</p><p>String value();</p><p>};</p><p>@Filter(â€œfilter1â€)</p><p>@Filter(â€œfilter2â€)</p><p>public interface Filterable {</p><p>}</p><p>public static void main(String[] args) {</p><p>for( Filter filter: Filterable.class.getAnnotationsByType( Filter.class )</p><p>) {</p><p>System.out.println( filter.value() );</p><p>}</p><p>}</p><p>}</p><hr><p>å¦‚ä¸Šæ‰€è§ï¼Œè¿™çš„Filterç±»ä½¿ç”¨@Repeatable(Filters.class)æ³¨è§£ä¿®é¥°ï¼Œè€ŒFiltersæ˜¯å­˜æ”¾Filteræ³¨è§£çš„å®¹å™¨ï¼Œç¼–è¯‘å™¨å°½é‡å¯¹å¼€å‘è€…å±è”½è¿™äº›ç»†èŠ‚ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´ï¼ŒFilterableæ¥å£å¯ä»¥ç”¨ä¸¤ä¸ªFilteræ³¨è§£æ³¨é‡Šï¼ˆè¿™é‡Œå¹¶æ²¡æœ‰æåˆ°ä»»ä½•å…³äºFiltersçš„ä¿¡æ¯ï¼‰ã€‚</p><p>å¦å¤–ï¼Œåå°„APIæä¾›äº†ä¸€ä¸ªæ–°çš„æ–¹æ³•ï¼šgetAnnotationsByType()ï¼Œå¯ä»¥è¿”å›æŸä¸ªç±»å‹çš„é‡å¤æ³¨è§£ï¼Œä¾‹å¦‚ Filterable.class.getAnnoation(Filters.class)å°†è¿”å›ä¸¤ä¸ªFilterå®ä¾‹ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p>filter1</p><p>filter2</p><h2 id="12-2-6-æ‹“å±•æ³¨è§£"><a href="#12-2-6-æ‹“å±•æ³¨è§£" class="headerlink" title="12.2.6 æ‹“å±•æ³¨è§£"></a>12.2.6 æ‹“å±•æ³¨è§£</h2><p>Java 8æ‹“å®½äº†æ³¨è§£çš„åº”ç”¨åœºæ™¯ã€‚ç°åœ¨ï¼Œæ³¨è§£å‡ ä¹å¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•å…ƒç´ ä¸Šï¼šå±€éƒ¨å˜é‡ã€æ¥å£ç±»å‹ã€è¶…ç±»å’Œæ¥å£å®ç°ç±»ï¼Œç”šè‡³å¯ä»¥ç”¨åœ¨å‡½æ•°çš„å¼‚å¸¸å®šä¹‰ä¸Šã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š</p><p>package com.javacodegeeks.java8.annotations;</p><p>import java.lang.annotation.ElementType;</p><p>import java.lang.annotation.Retention;</p><p>import java.lang.annotation.RetentionPolicy;</p><p>import java.lang.annotation.Target;</p><p>import java.util.ArrayList;</p><p>import java.util.Collection;</p><p>public class Annotations {</p><p>@Retention( RetentionPolicy.RUNTIME )</p><p>@Target( { ElementType.TYPE_USE, ElementType.TYPE_PARAMETER })</p><p>public @interface NonEmpty {</p><p>}</p><p>public static class Holder&lt; @NonEmpty T &gt; extends @NonEmpty object {</p><p>public void method() throws @NonEmpty Exception {</p><p>}</p><p>}</p><p>@Suppresswarnings(â€œunusedâ€)</p><p>public static void main(String[] args) {</p><p>final Holder&lt; String &gt; holder &#x3D; new @NonEmpty Holder&lt; String &gt;();</p><p>@NonEmpty Collection&lt; @NonEmpty String &gt; strings &#x3D; new ArrayList&lt;&gt;(); } }</p><p>ElementType.TYPE_USERå’ŒElementType.TYPE_PARAMETERæ˜¯Java 8æ–°å¢çš„ä¸¤ä¸ªæ³¨è§£ï¼Œç”¨äºæè¿°æ³¨è§£çš„ä½¿ç”¨åœºæ™¯ã€‚Java è¯­è¨€ä¹Ÿåšäº†å¯¹åº”çš„æ”¹å˜ï¼Œä»¥è¯†åˆ«è¿™äº›æ–°å¢çš„æ³¨è§£ã€‚</p><h2 id="12-2-7-Javaç¼–è¯‘å™¨çš„æ–°ç‰¹æ€§"><a href="#12-2-7-Javaç¼–è¯‘å™¨çš„æ–°ç‰¹æ€§" class="headerlink" title="12.2.7 Javaç¼–è¯‘å™¨çš„æ–°ç‰¹æ€§"></a>12.2.7 Javaç¼–è¯‘å™¨çš„æ–°ç‰¹æ€§</h2><p>ä¸ºäº†åœ¨è¿è¡Œæ—¶è·å¾—Javaç¨‹åºä¸­æ–¹æ³•çš„å‚æ•°åç§°ï¼Œè€ä¸€è¾ˆçš„Javaç¨‹åºå‘˜å¿…é¡»ä½¿ç”¨ä¸åŒæ–¹æ³•ï¼Œä¾‹å¦‚</p><p>Paranamer liberaryã€‚Java 8ç»ˆäºå°†è¿™ä¸ªç‰¹æ€§è§„èŒƒåŒ–ï¼Œåœ¨è¯­è¨€å±‚é¢ï¼ˆä½¿ç”¨åå°„APIå’Œ</p><p>Parameter.getName()æ–¹æ³•ï¼‰å’Œå­—èŠ‚ç å±‚é¢ï¼ˆä½¿ç”¨æ–°çš„javacç¼–è¯‘å™¨ä»¥åŠ-parameterså‚æ•°ï¼‰æä¾›æ”¯æŒã€‚</p><p>package com.javacodegeeks.java8.parameter.names;</p><p>import java.lang.reflect.Method;</p><p>import java.lang.reflect.Parameter;</p><p>public class ParameterNames {</p><p>public static void main(String[] args) throws Exception {</p><p>Method method &#x3D; ParameterNames.class.getMethod(â€œmainâ€, String[].class );</p><p>for( final Parameter parameter: method.getParameters() ) {</p><p>System.out.println(â€œParameter: â€œ + parameter.getName() );</p><p>}</p><p>}</p><p>}</p><p>åœ¨Java 8ä¸­è¿™ä¸ªç‰¹æ€§æ˜¯é»˜è®¤å…³é—­çš„ï¼Œå› æ­¤å¦‚æœä¸å¸¦-parameterså‚æ•°ç¼–è¯‘ä¸Šè¿°ä»£ç å¹¶è¿è¡Œï¼Œåˆ™ä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœ:</p><p>Parameter: arg0</p><p>å¦‚æœå¸¦-parameterså‚æ•°ï¼Œåˆ™ä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœï¼ˆæ­£ç¡®çš„ç»“æœï¼‰ï¼š</p><p>Parameter: args</p><p>å¦‚æœä½ ä½¿ç”¨Mavenè¿›è¡Œé¡¹ç›®ç®¡ç†ï¼Œåˆ™å¯ä»¥åœ¨maven-compiler-pluginç¼–è¯‘å™¨çš„é…ç½®é¡¹ä¸­é…ç½®-parameters å‚æ•°:</p><plugin><p><groupId>org.apache.maven.plugins</groupId></p><p><artifactId>maven-compiler-plugin</artifactId></p><p><version>3.1</version></p><configuration><p><compilerArgument>-parameters</compilerArgument></p><source>1.8</source><p><target>1.8</target></p></configuration></plugin><h4 id="12-2-8-Optional"><a href="#12-2-8-Optional" class="headerlink" title="12.2.8 Optional"></a>12.2.8 Optional</h4><p>Javaåº”ç”¨ä¸­æœ€å¸¸è§çš„bugå°±æ˜¯ç©ºå€¼å¼‚å¸¸ã€‚åœ¨Java 8ä¹‹å‰ï¼ŒGoogle Guavaå¼•å…¥äº†Optionalsç±»æ¥è§£å†³</p><p>NullPointerExceptionï¼Œä»è€Œé¿å…æºç è¢«å„ç§nullæ£€æŸ¥æ±¡æŸ“ï¼Œä»¥ä¾¿å¼€å‘è€…å†™å‡ºæ›´åŠ æ•´æ´çš„ä»£ç ã€‚Java 8ä¹Ÿå°†OptionalåŠ å…¥äº†å®˜æ–¹åº“ã€‚</p><p>Optionalä»…ä»…æ˜¯ä¸€ä¸ªå®¹æ˜“ï¼šå­˜æ”¾Tç±»å‹çš„å€¼æˆ–è€…nullã€‚å®ƒæä¾›äº†ä¸€äº›æœ‰ç”¨çš„æ¥å£æ¥é¿å…æ˜¾å¼çš„nullæ£€æŸ¥ï¼Œ å¯ä»¥å‚è€ƒJava 8å®˜æ–¹æ–‡æ¡£äº†è§£æ›´å¤šç»†èŠ‚ã€‚</p><p>æ¥ä¸‹æ¥çœ‹ä¸€ç‚¹ä½¿ç”¨Optionalçš„ä¾‹å­ï¼šå¯èƒ½ä¸ºç©ºçš„å€¼æˆ–è€…æŸä¸ªç±»å‹çš„å€¼ï¼š</p><p>Optional&lt; String &gt; fullName &#x3D; Optional.ofNullable( null );</p><p>System.out.println(â€œFull Name is set?â€ + fullName.isPresent() );</p><p>System.out.println(â€œFull Name: â€œ + fullName.orElseGet( () -&gt; â€œ[none]â€ ) );</p><p>System.out.println( fullName.map( s -&gt; â€œHeyâ€ + s + â€œ!â€ ).orElse( â€œHey Stranger!â€ ï¼‰ï¼‰ï¼›</p><p>å¦‚æœOptionalå®ä¾‹æŒæœ‰ä¸€ä¸ªéç©ºå€¼ï¼Œåˆ™isPresent()æ–¹æ³•è¿”å›trueï¼Œå¦åˆ™è¿”å›falseï¼›orElseGet()æ–¹æ³•ï¼Œ Optionalå®ä¾‹æŒæœ‰nullï¼Œåˆ™å¯ä»¥æ¥å—ä¸€ä¸ªlambdaè¡¨è¾¾å¼ç”Ÿæˆçš„é»˜è®¤å€¼ï¼›map()æ–¹æ³•å¯ä»¥å°†ç°æœ‰çš„ Opetionalå®ä¾‹çš„å€¼è½¬æ¢æˆæ–°çš„å€¼ï¼›orElse()æ–¹æ³•ä¸orElseGet()æ–¹æ³•ç±»ä¼¼ï¼Œä½†æ˜¯åœ¨æŒæœ‰nullçš„æ—¶å€™è¿”å›ä¼ å…¥çš„é»˜è®¤å€¼ã€‚</p><p>è¾“å‡ºç»“æœå¦‚ä¸‹:</p><p>Full Name is set? false</p><p>Full Name: [none]</p><p>Hey Stranger!</p><h2 id="12-2-9-Streams"><a href="#12-2-9-Streams" class="headerlink" title="12.2.9 Streams"></a>12.2.9 Streams</h2><p>æ–°å¢çš„Stream APIï¼ˆjava.util.streamï¼‰å°†ç”Ÿæˆç¯å¢ƒçš„å‡½æ•°å¼ç¼–ç¨‹å¼•å…¥äº†Javaåº“ä¸­ã€‚è¿™æ˜¯ç›®å‰ä¸ºæ­¢æœ€å¤§çš„ä¸€æ¬¡å¯¹Javaåº“çš„å®Œå–„ï¼Œä»¥ä¾¿å¼€å‘è€…èƒ½å¤Ÿå†™å‡ºæ›´åŠ æœ‰æ•ˆã€æ›´åŠ ç®€æ´å’Œç´§å‡‘çš„ä»£ç ã€‚</p><p>Steam APIæå¤§å¾—ç®€åŒ–äº†é›†åˆæ“ä½œï¼ˆåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ä¸æ­¢æ˜¯é›†åˆï¼‰ï¼Œé¦–å…ˆçœ‹ä¸‹è¿™ä¸ªå«Taskçš„ç±»ï¼š</p><p>public class Streams {</p><p>private enum Status {</p><p>OPEN, CLOSED</p><p>};</p><p>private static final class Task {</p><p>private final Status status;</p><p>private final Integer points;</p><hr><p>Task( final Status status, final Integer points ) {</p><p>this.status ( &#x3D; ) status;</p><p>this.points ( &#x3D; ) points;</p><p>}</p><p>public Integer getPoints() {</p><p>return points;</p><p>}</p><p>public Status getStatus() {</p><p>return status;</p><p>}</p><p>@override</p><p>public string tostring() {</p><p>return String.format(â€œ[%s, %d]â€, status, points );</p><p>}</p><p>} }</p><hr><p>Taskç±»æœ‰ä¸€ä¸ªåˆ†æ•° (æˆ–ä¼ªå¤æ‚åº¦) çš„æ¦‚å¿µï¼Œå¦å¤–è¿˜æœ‰ä¸¤ç§çŠ¶æ€ï¼šOPENæˆ–è€…CLOSEDã€‚ç°åœ¨å‡è®¾æœ‰ä¸€ä¸ª taské›†åˆ:</p><p>final Collection&lt; Task &gt; tasks &#x3D; Arrays.asList(</p><p>new Task( Status.OPEN, 5 ),</p><p>new Task( Status.OPEN, 13 ),</p><p>new Task( Status.CLOSED, 8 )</p><p>);</p><p>è¯•æƒ³ä¸€ä¸‹ï¼šåœ¨è¿™ä¸ªtaské›†åˆä¸­ä¸€å…±æœ‰å¤šå°‘ä¸ªå¤„äºOPENçŠ¶æ€çš„ç‚¹ï¼Ÿåœ¨Java 8ä¹‹å‰ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ™éœ€è¦ä½¿ç”¨foreachå¾ªç¯éå†taské›†åˆï¼›ä½†æ˜¯åœ¨Java 8ä¸­å¯ä»¥åˆ©ç”¨steamsè§£å†³ï¼šåŒ…æ‹¬ä¸€ç³»åˆ—å…ƒç´ çš„åˆ—è¡¨ï¼Œå¹¶ä¸”æ”¯æŒé¡ºåºå’Œå¹¶è¡Œå¤„ç†ã€‚</p><p>&#x2F;&#x2F; Calculate total points of all active tasks using sum()</p><p>final long totalPointsOfOpenTasks &#x3D; tasks</p><p>.stream()</p><p>.filter( task -&gt; task.getStatus() &#x3D;&#x3D; Status.OPEN )</p><p>.mapToInt( Task::getPoints )</p><p>.sum();</p><p>System.out.println( â€œTotal points: â€œ + totalPointsOfOpenTasks );</p><p>è¿è¡Œè¿™ä¸ªæ–¹æ³•çš„æ§åˆ¶å°è¾“å‡ºæ˜¯:</p><p>Total points: 18</p><ul><li><p>tasksé›†åˆè¢«è½¬æ¢æˆsteamè¡¨ç¤º;</p></li><li><p>åœ¨steamä¸Šçš„filteræ“ä½œä¼šè¿‡æ»¤æ‰æ‰€æœ‰CLOSEDçš„task;</p></li><li><p>mapToIntæ“ä½œåŸºäºæ¯ä¸ªtaskå®ä¾‹çš„Task::getPointsæ–¹æ³•å°†taskæµè½¬æ¢æˆIntegeré›†åˆ;</p></li><li><p>é€šè¿‡sumæ–¹æ³•è®¡ç®—æ€»å’Œï¼Œå¾—å‡ºæœ€åçš„ç»“æœã€‚</p></li></ul><h2 id="12-2-10-Date-Time-API-JSR-310"><a href="#12-2-10-Date-Time-API-JSR-310" class="headerlink" title="12.2.10 Date&#x2F;Time API(JSR 310)"></a>12.2.10 Date&#x2F;Time API(JSR 310)</h2><p>Java 8å¼•å…¥äº†æ–°çš„Date-Time API(JSR 310)æ¥æ”¹è¿›æ—¶é—´ã€æ—¥æœŸçš„å¤„ç†ã€‚æ—¶é—´å’Œæ—¥æœŸçš„ç®¡ç†ä¸€ç›´æ˜¯æœ€ä»¤Java å¼€å‘è€…ç—›è‹¦çš„é—®é¢˜ã€‚java.util.Dateå’Œåæ¥çš„java.util.Calendarä¸€ç›´æ²¡æœ‰è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆç”šè‡³ä»¤å¼€å‘è€…æ›´åŠ è¿·èŒ«ï¼‰ã€‚</p><p>ç”±ä¸Šè¿°åŸå› ï¼Œè¯ç”Ÿäº†ç¬¬ä¸‰æ–¹åº“Joda-Timeï¼Œå¯ä»¥æ›¿ä»£Javaçš„æ—¶é—´ç®¡ç†APIã€‚Java 8ä¸­æ–°çš„æ—¶é—´å’Œæ—¥æœŸç®¡ç† APIæ·±å—Joda-Timeå½±å“ï¼Œå¹¶å¸æ”¶äº†å¾ˆå¤šJoda-Timeçš„ç²¾åã€‚æ–°çš„java.timeåŒ…åŒ…å«äº†æ‰€æœ‰å…³äºæ—¥æœŸã€æ—¶é—´ã€æ—¶åŒºã€Instantï¼ˆè·Ÿæ—¥æœŸç±»ä¼¼ä½†æ˜¯ç²¾ç¡®åˆ°çº³ç§’ï¼‰ã€durationï¼ˆæŒç»­æ—¶é—´ï¼‰å’Œæ—¶é’Ÿæ“ä½œçš„ç±»ã€‚æ–°è®¾è®¡çš„ APIè®¤çœŸè€ƒè™‘äº†è¿™äº›ç±»çš„ä¸å˜æ€§ï¼ˆä»java.util.Calendarå¸å–çš„æ•™è®­ï¼‰ï¼Œå¦‚æœæŸä¸ªå®ä¾‹éœ€è¦ä¿®æ”¹ï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tr><td>now()</td><td>é™æ€æ–¹æ³•ï¼Œæ ¹æ®å½“å‰æ—¶é—´åˆ›å»ºå¯¹è±¡</td></tr><tr><td>of()</td><td>é™æ€æ–¹æ³•ï¼Œæ ¹æ®æŒ‡å®šæ—¥æœŸ/æ—¶é—´åˆ›å»º å¯¹è±¡</td></tr><tr><td>plusDays, plusWeeks, plusMonths, plusYears</td><td>å‘å½“å‰ LocalDate å¯¹è±¡æ·»åŠ å‡ å¤©ã€ å‡ å‘¨ã€å‡ ä¸ªæœˆã€ å‡ å¹´</td></tr><tr><td>minusDays, minusWeeks, minusMonths, minusYears</td><td>ä»å½“å‰ LocalDate å¯¹è±¡å‡å»å‡ å¤©ã€ å‡ å‘¨ã€å‡ ä¸ªæœˆ å‡ å¹´</td></tr><tr><td>plus, minus</td><td>æ·»åŠ æˆ–å‡å°‘ä¸€ä¸ª Durationæˆ– Period</td></tr><tr><td>withDayOfMonth, withDayOfYear, withMonth, withYear</td><td>å°†æœˆä»½å¤©æ•°ã€å¹´ä»½å¤©æ•°ã€æœˆä»½ã€å¹´ ä»½ä¿®æ”¹ä¸ºæŒ‡å®šçš„ å€¼å¹¶è¿”å›æ–°çš„ LocalDateå¯¹è±¡</td></tr><tr><td>getDayOfMonth</td><td>è·å¾—æœˆä»½å¤©æ•°(1-31)</td></tr><tr><td>getDayOfYear</td><td>è·å¾—å¹´ä»½å¤©æ•°(1-366)</td></tr><tr><td>getDayOfWeek</td><td>è·å¾—æ˜ŸæœŸå‡ (è¿”å›ä¸€ä¸ª DayOfWeek æšä¸¾å€¼</td></tr><tr><td>getMonth</td><td>è·å¾—æœˆä»½, è¿”å›ä¸€ä¸ª Monthæšä¸¾å€¼</td></tr><tr><td>getMonthValue</td><td>è·å¾—æœˆä»½(1-12)</td></tr><tr><td>getYear</td><td>è·å¾—å¹´ä»½</td></tr><tr><td>until</td><td>è·å¾—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„ Period å¯¹è±¡ï¼Œæˆ–è€…æŒ‡å®š ChronoUnitsçš„æ•°å­—</td></tr><tr><td>isBefore, isAfter</td><td>æ¯”è¾ƒä¸¤ä¸ª LocalDate</td></tr><tr><td>isLeapYear</td><td>åˆ¤æ–­æ˜¯å¦æ˜¯é—°å¹´</td></tr></table><p>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹java.timeåŒ…ä¸­çš„å…³é”®ç±»å’Œå„è‡ªçš„ä½¿ç”¨ä¾‹å­ã€‚</p><p>é¦–å…ˆï¼ŒClockç±»ä½¿ç”¨æ—¶åŒºæ¥è¿”å›å½“å‰çš„çº³ç§’æ—¶é—´å’Œæ—¥æœŸã€‚Clockå¯ä»¥æ›¿ä»£System.currentTimeMillis()å’Œ TimeZone.getDefault()ã€‚</p><p>&#x2F;&#x2F; Get the system clock as UTC offset</p><p>final clock clock ( &#x3D; ) clock.systemUTC();</p><p>System.out.println( clock.instant());</p><p>System.out.println( clock.millis() );</p><p>è¾“å‡ºçš„ç»“æœæ˜¯:</p><p>2014-04-12T15:19:29.282Z</p><p>1397315969360</p><p>LocalDateTimeç±»åŒ…å«äº†LocalDateå’ŒLocalTimeçš„ä¿¡æ¯ï¼Œä½†æ˜¯ä¸åŒ…å«ISO-8601æ—¥å†ç³»ç»Ÿä¸­çš„æ—¶åŒºä¿¡æ¯ã€‚ è¿™é‡Œæœ‰ä¸€äº›å…³äºLocalDateå’ŒLocalTimeçš„ä¾‹å­:</p><p>&#x2F;&#x2F; Get the local date&#x2F;time</p><p>final LocalDateTime datetime ( &#x3D; ) LocalDateTime.now();</p><p>final LocalDateTime datetimeFromClock &#x3D; LocalDateTime.now( clock );</p><p>System.out.println( datetime );</p><p>System.out.println( datetimeFromClock );</p><p>è¾“å‡ºçš„ç»“æœæ˜¯:</p><p>2014-04-12T11:37:52.309</p><p>2014-04-12T15:37:52.309</p><p>æœ€åçœ‹ä¸‹Durationç±»ï¼Œå®ƒæŒæœ‰çš„æ—¶é—´ç²¾ç¡®åˆ°ç§’å’Œçº³ç§’ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å¾—è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„ä¸åŒï¼Œä¾‹å­ä»£ç å¦‚ä¸‹:</p><p>&#x2F;&#x2F; Get duration between two dates</p><p>final LocalDateTime from &#x3D; LocalDateTime.of( 2014, Month.APRIL, 16, 0, 0, 0 );</p><p>final LocalDateTime to ( &#x3D; ) LocalDateTime.of( 2015, Month.APRIL, 16, 23, 59, 59);</p><p>final Duration duration ( &#x3D; ) Duration.between( from, to );</p><p>System.out.println( â€œDuration in days: â€œ + duration.toDays() );</p><p>System.out.println( â€œDuration in hours: â€œ + duration.toHours() );</p><p>è¿™ä¸ªä¾‹å­ç”¨äºè®¡ç®—2014å¹´4æœˆ16æ—¥å’Œ2015å¹´4æœˆ16æ—¥ä¹‹é—´çš„å¤©æ•°å’Œå°æ—¶æ•°ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><p>Duration in days: 365</p><p>Duration in hours: 8783</p><p>å¯¹äºJava 8çš„æ–°æ—¥æœŸæ—¶é—´çš„æ€»ä½“å°è±¡è¿˜æ˜¯æ¯”è¾ƒç§¯æçš„ï¼Œä¸€éƒ¨åˆ†æ˜¯å› ä¸ºJoda-Timeçš„ç§¯æå½±å“ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯å› ä¸ºå®˜æ–¹ç»ˆäºå¬å–äº†å¼€å‘äººå‘˜çš„éœ€æ±‚ã€‚</p><h2 id="12-2-11-Base64"><a href="#12-2-11-Base64" class="headerlink" title="12.2.11 Base64"></a>12.2.11 Base64</h2><p>å¯¹Base64ç¼–ç çš„æ”¯æŒå·²ç»è¢«åŠ å…¥åˆ°Java 8å®˜æ–¹åº“ä¸­ï¼Œè¿™æ ·ä¸éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å°±å¯ä»¥è¿›è¡ŒBase64ç¼–ç ï¼Œ ä¾‹å­ä»£ç å¦‚ä¸‹:</p><p>package com.javacodegeeks.java8.base64;</p><p>import java.nio.charset.StandardCharsets;</p><p>import java.util.Base64;</p><p>public class Base64s {</p><p>public static void main(String[] args) {</p><p>final String text &#x3D; â€œBase64 finally in Java 8!â€;</p><p>final String encoded ( &#x3D; ) Base64</p><p>.getEncoder()</p><p>.encodeToString( text.getBytes( StandardCharsets.UTF_8 ) );</p><p>System.out.println( encoded );</p><p>final string decoded ( &#x3D; ) new String(</p><p>Base64.getDecoder().decode( encoded ),</p><p>StandardCharsets.UTF_8 );</p><p>System.out.println( decoded ); } }</p><p>è¿™ä¸ªä¾‹å­çš„è¾“å‡ºç»“æœå¦‚ä¸‹:</p><p>QmFzZTY0IGZpbmFsbHkgaw4gSmF2YSA4IQ&#x3D;&#x3D;</p><p>Base64 finally in Java 8!</p><p>æ–°çš„Base64APIä¹Ÿæ”¯æŒURLå’ŒMINEçš„ç¼–ç è§£ç ã€‚</p><p>(Base64.getUrlEncoder() &#x2F; Base64.getUrlDecoder(), Base64.getMimeEncoder() &#x2F;</p><p>Base64.getMimeDecoder())ã€‚</p><h2 id="12-2-12-Nashorn-JavaScriptå¼•æ“"><a href="#12-2-12-Nashorn-JavaScriptå¼•æ“" class="headerlink" title="12.2.12 Nashorn JavaScriptå¼•æ“"></a>12.2.12 Nashorn JavaScriptå¼•æ“</h2><p>Java 8æä¾›äº†æ–°çš„Nashorn JavaScriptå¼•æ“ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨JVMä¸Šå¼€å‘å’Œè¿è¡ŒJSåº”ç”¨ã€‚Nashorn</p><p>JavaScriptå¼•æ“æ˜¯javax.script.ScriptEngineçš„å¦ä¸€ä¸ªå®ç°ç‰ˆæœ¬ï¼Œè¿™ç±»Scriptå¼•æ“éµå¾ªç›¸åŒçš„è§„åˆ™ï¼Œå…è®¸ Javaå’ŒJavaScriptäº¤äº’ä½¿ç”¨ï¼Œä¾‹å­ä»£ç å¦‚ä¸‹:</p><p>ScriptEngineManager manager &#x3D; new ScriptEngineManager();</p><p>ScriptEngine engine &#x3D; manager.getEngineByName(â€œJavaScriptâ€);</p><p>System.out.println( engine.getClass().getName());</p><p>System.out.println(â€œResult:â€ + engine.eval(â€œfunction ( f\left( \right) { ) return ( 1;} ;f\left( \right) + )</p><p>1;â€ ) );</p><p>è¿™ä¸ªä»£ç çš„è¾“å‡ºç»“æœå¦‚ä¸‹:</p><p>jdk.nashorn.api.scripting.NashornScriptEngine</p><p>Result: 2</p><h2 id="12-2-13-å¹¶è¡Œæ•°ç»„"><a href="#12-2-13-å¹¶è¡Œæ•°ç»„" class="headerlink" title="12.2.13 å¹¶è¡Œæ•°ç»„"></a>12.2.13 å¹¶è¡Œæ•°ç»„</h2><p>Java8ç‰ˆæœ¬æ–°å¢äº†å¾ˆå¤šæ–°çš„æ–¹æ³•ï¼Œç”¨äºæ”¯æŒå¹¶è¡Œæ•°ç»„å¤„ç†ã€‚æœ€é‡è¦çš„æ–¹æ³•æ˜¯parallelSort()ï¼Œå¯ä»¥æ˜¾è‘—åŠ å¿«å¤šæ ¸æœºå™¨ä¸Šçš„æ•°ç»„æ’åºã€‚ä¸‹é¢çš„ä¾‹å­è®ºè¯äº†parallexXxxç³»åˆ—çš„æ–¹æ³•ï¼š</p><p>package com.javacodegeeks.java8.parallel.arrays;</p><p>import java.util.Arrays;</p><p>import java.util.concurrent.ThreadLocalRandom;</p><p>public class ParallelArrays {</p><p>public static void main( String[] args ) {</p><p>long[] arrayOfLong &#x3D; new long [ 20000 ];</p><p>Arrays.parallelSetAll(arrayOfLong,</p><p>index -&gt; ThreadLocalRandom.current().nextInt( 1000000 );</p><p>Arrays.stream( arrayOfLong ).limit( 10 ).forEach(</p><p>i -&gt; System.out.print( i + â€œ â€œ ) );</p><p>System.out.println();</p><p>Arrays.parallelSort( arrayOfLong );</p><p>Arrays.stream( arrayOfLong ).limit( 10 ).forEach(</p><p>i -&gt; System.out.print( i + â€œ â€œ ) );</p><p>System.out.println(); } }</p><p>ä¸Šè¿°è¿™äº›ä»£ç ä½¿ç”¨parallelSetAll()æ–¹æ³•ç”Ÿæˆ20000ä¸ªéšæœºæ•°ï¼Œç„¶åä½¿ç”¨parallelSort()æ–¹æ³•è¿›è¡Œæ’åºã€‚è¿™ä¸ªç¨‹åºä¼šè¾“å‡ºä¹±åºæ•°ç»„å’Œæ’åºæ•°ç»„çš„å‰10ä¸ªå…ƒç´ ã€‚ä¸Šè¿°ä¾‹å­çš„ä»£ç è¾“å‡ºçš„ç»“æœæ˜¯:</p><p>Unsorted: 591217 891976 443951 424479 766825 351964 242997 642839 119108 552378</p><p>Sorted: 39 220 263 268 325 607 655 678 723 793</p><h2 id="12-2-14-å¹¶å‘æ€§"><a href="#12-2-14-å¹¶å‘æ€§" class="headerlink" title="12.2.14 å¹¶å‘æ€§"></a>12.2.14 å¹¶å‘æ€§</h2><p>åŸºäºæ–°å¢çš„lambdaè¡¨è¾¾å¼å’Œsteamç‰¹æ€§ï¼Œä¸ºJava 8ä¸­ä¸ºjava.util.concurrent.Concurrent.HashMapç±»æ·»åŠ äº†æ–°çš„æ–¹æ³•æ¥æ”¯æŒèšç„¦æ“ä½œï¼›å¦å¤–ï¼Œä¹Ÿä¸ºjava.util.concurrentForkjoinPoolç±»æ·»åŠ äº†æ–°çš„æ–¹æ³•æ¥æ”¯æŒé€šç”¨çº¿ç¨‹æ± æ“ä½œï¼ˆæ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒæˆ‘ä»¬çš„å¹¶å‘ç¼–ç¨‹è¯¾ç¨‹ï¼‰ã€‚</p><p>Java 8è¿˜æ·»åŠ äº†æ–°çš„java.util.concurrent.locks.StampedLockç±»ï¼Œç”¨äºæ”¯æŒåŸºäºå®¹é‡çš„é”â€”â€”è¯¥é”æœ‰ä¸‰ä¸ªæ¨¡å‹ç”¨äºæ”¯æŒè¯»å†™æ“ä½œï¼ˆå¯ä»¥æŠŠè¿™ä¸ªé”å½“åšæ˜¯java.util.concurrent.locks.ReadWriteLockçš„æ›¿ä»£è€…ï¼‰ã€‚</p><p>åœ¨java.util.concurrent.atomicåŒ…ä¸­ä¹Ÿæ–°å¢äº†ä¸å°‘å·¥å…·ç±»ï¼Œåˆ—ä¸¾å¦‚ä¸‹:</p><p>DoubleAccumulator</p><p>DoubleAdder</p><p>LongAccumulator</p><p>LongAdder</p><h2 id="12-2-15-JVMçš„æ–°ç‰¹æ€§"><a href="#12-2-15-JVMçš„æ–°ç‰¹æ€§" class="headerlink" title="12.2.15 JVMçš„æ–°ç‰¹æ€§"></a>12.2.15 JVMçš„æ–°ç‰¹æ€§</h2><p>ä½¿ç”¨Metaspace (JEP 122) ä»£æ›¿æŒä¹…ä»£ (PermGen space) ã€‚åœ¨JVMå‚æ•°æ–¹é¢ï¼Œä½¿ç”¨-</p><p>XX:MetaSpaceSizeå’Œ-XX:MaxMetaspaceSizeä»£æ›¿åŸæ¥çš„-XX:PermSizeå’Œ-XX:MaxPermSizeã€‚</p><p>è·JAVA 8æ›´è¡Œå·²æœ‰æ•°å¹´ä¹‹ä¹…ï¼Œç°åœ¨çš„å­¦ä¹ è€…å¤§å¤šåœ¨ä¸€å¼€å§‹å°±å·²ç»é€‚åº”äº†JAVA 8 çš„æ–°ç‰¹æ€§ï¼Œå¦‚æœæƒ³è¦äº†è§£æ›´å¤šå…³äºJAVA 8æ–°ç‰¹æ€§çš„ç»†èŠ‚ä¸€å®šè¦æµè§ˆå®˜ç½‘æ–‡æ¡£å“¦~ï¼ï¼ï¼</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++å›¾å­¦ä¹ æ•´ç†</title>
      <link href="/2024/06/23/C-%E5%9B%BE%E5%AD%A6%E4%B9%A0%E6%95%B4%E7%90%86/"/>
      <url>/2024/06/23/C-%E5%9B%BE%E5%AD%A6%E4%B9%A0%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="C-å›¾å­¦ä¹ æ•´ç†"><a href="#C-å›¾å­¦ä¹ æ•´ç†" class="headerlink" title="C++å›¾å­¦ä¹ æ•´ç†"></a>C++å›¾å­¦ä¹ æ•´ç†</h1><h2 id="æœ€å°ç”Ÿæˆæ ‘"><a href="#æœ€å°ç”Ÿæˆæ ‘" class="headerlink" title="æœ€å°ç”Ÿæˆæ ‘"></a>æœ€å°ç”Ÿæˆæ ‘</h2><p>åœ¨æ— å‘å›¾ä¸­ç”Ÿæˆä¸€æ£µæ ‘ï¼ˆn-1æ¡è¾¹ï¼Œæ— ç¯ï¼Œè¿é€šæ‰€æœ‰ç‚¹ï¼‰ï¼Œä¸”è¿™æ£µæ ‘çš„åŠå’Œæœ€å°</p><h3 id="æ™®åˆ©å§†ç®—æ³•ï¼ˆPrimï¼‰â€”â€”åŠ ç‚¹æ³•"><a href="#æ™®åˆ©å§†ç®—æ³•ï¼ˆPrimï¼‰â€”â€”åŠ ç‚¹æ³•" class="headerlink" title="æ™®åˆ©å§†ç®—æ³•ï¼ˆPrimï¼‰â€”â€”åŠ ç‚¹æ³•"></a>æ™®åˆ©å§†ç®—æ³•ï¼ˆPrimï¼‰â€”â€”åŠ ç‚¹æ³•</h3><ol><li><p>ä»»é€‰ä¸€ç‚¹å¼€å§‹ï¼Œæ‰¾åˆ°ç¦»è¿™ä¸ªç‚¹æœ€è¿‘çš„ç‚¹ï¼ŒåŠ å…¥æœ€å°ç”Ÿæˆæ ‘</p></li><li><p>å†ç»§ç»­å»æ‰¾ç¦»è¿™ä¸ªæœ€å°ç”Ÿæˆæ ‘æœ€è¿‘çš„ç‚¹ï¼ŒåŠ å…¥æœ€å°ç”Ÿæˆæ ‘ä¸­ï¼Œé‡å¤æ­¥éª¤2</p></li></ol><h3 id="å…‹é²æ–¯å¡å°”ç®—æ³•ï¼ˆKruskalï¼‰-â€”â€”åŠ è¾¹æ³•"><a href="#å…‹é²æ–¯å¡å°”ç®—æ³•ï¼ˆKruskalï¼‰-â€”â€”åŠ è¾¹æ³•" class="headerlink" title="å…‹é²æ–¯å¡å°”ç®—æ³•ï¼ˆKruskalï¼‰ â€”â€”åŠ è¾¹æ³•"></a>å…‹é²æ–¯å¡å°”ç®—æ³•ï¼ˆKruskalï¼‰ â€”â€”åŠ è¾¹æ³•</h3><ol><li>æ‰¾åˆ°æœ€çŸ­è¾¹ï¼Œåˆ¤æ–­å…¶ä¸¤ä¸ªç«¯ç‚¹åœ¨ä¸åœ¨ä¸€ä¸ªè¿é€šåˆ†é‡é‡Œ</li><li>è‹¥åœ¨ï¼Œåˆ™è·³è¿‡ï¼›è‹¥ä¸åœ¨ï¼ŒåŠ å…¥æœ€å°ç”Ÿæˆæ ‘</li></ol><h3 id="æ´›è°·ä¾‹é¢˜"><a href="#æ´›è°·ä¾‹é¢˜" class="headerlink" title="æ´›è°·ä¾‹é¢˜"></a>æ´›è°·ä¾‹é¢˜</h3><h4 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h4><p>å¦‚é¢˜ï¼Œç»™å‡ºä¸€ä¸ªæ— å‘å›¾ï¼Œæ±‚å‡ºæœ€å°ç”Ÿæˆæ ‘ï¼Œå¦‚æœè¯¥å›¾ä¸è¿é€šï¼Œåˆ™è¾“å‡º <code>orz</code>ã€‚</p><h4 id="è¾“å…¥æ ¼å¼"><a href="#è¾“å…¥æ ¼å¼" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h4><p>ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $N,M$ï¼Œè¡¨ç¤ºè¯¥å›¾å…±æœ‰ $N$ ä¸ªç»“ç‚¹å’Œ $M$ æ¡æ— å‘è¾¹ã€‚</p><p>æ¥ä¸‹æ¥ $M$ è¡Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $X_i,Y_i,Z_i$ï¼Œè¡¨ç¤ºæœ‰ä¸€æ¡é•¿åº¦ä¸º $Z_i$ çš„æ— å‘è¾¹è¿æ¥ç»“ç‚¹ $X_i,Y_i$ã€‚</p><h4 id="è¾“å‡ºæ ¼å¼"><a href="#è¾“å‡ºæ ¼å¼" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h4><p>å¦‚æœè¯¥å›¾è¿é€šï¼Œåˆ™è¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºæœ€å°ç”Ÿæˆæ ‘çš„å„è¾¹çš„é•¿åº¦ä¹‹å’Œã€‚å¦‚æœè¯¥å›¾ä¸è¿é€šåˆ™è¾“å‡º <code>orz</code>ã€‚</p><h4 id="æ ·ä¾‹-1"><a href="#æ ·ä¾‹-1" class="headerlink" title="æ ·ä¾‹ #1"></a>æ ·ä¾‹ #1</h4><h5 id="æ ·ä¾‹è¾“å…¥-1"><a href="#æ ·ä¾‹è¾“å…¥-1" class="headerlink" title="æ ·ä¾‹è¾“å…¥ #1"></a>æ ·ä¾‹è¾“å…¥ #1</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4 5</span><br><span class="line">1 2 2</span><br><span class="line">1 3 2</span><br><span class="line">1 4 3</span><br><span class="line">2 3 4</span><br><span class="line">3 4 3</span><br></pre></td></tr></table></figure><h5 id="æ ·ä¾‹è¾“å‡º-1"><a href="#æ ·ä¾‹è¾“å‡º-1" class="headerlink" title="æ ·ä¾‹è¾“å‡º #1"></a>æ ·ä¾‹è¾“å‡º #1</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7</span><br></pre></td></tr></table></figure><h4 id="æç¤º"><a href="#æç¤º" class="headerlink" title="æç¤º"></a>æç¤º</h4><p>æ•°æ®è§„æ¨¡ï¼š</p><p>å¯¹äº $20%$ çš„æ•°æ®ï¼Œ$N\le 5$ï¼Œ$M\le 20$ã€‚</p><p>å¯¹äº $40%$ çš„æ•°æ®ï¼Œ$N\le 50$ï¼Œ$M\le 2500$ã€‚</p><p>å¯¹äº $70%$ çš„æ•°æ®ï¼Œ$N\le 500$ï¼Œ$M\le 10^4$ã€‚</p><p>å¯¹äº $100%$ çš„æ•°æ®ï¼š$1\le N\le 5000$ï¼Œ$1\le M\le 2\times 10^5$ï¼Œ$1\le Z_i \le 10^4$ã€‚</p><p>æ ·ä¾‹è§£é‡Šï¼š</p><p> <img src="https://cdn.luogu.com.cn/upload/pic/2259.png"> </p><p>æ‰€ä»¥æœ€å°ç”Ÿæˆæ ‘çš„æ€»è¾¹æƒä¸º $2+2+3&#x3D;7$ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span>   <span class="comment">// åŒ…å«æ ‡å‡†è¾“å…¥è¾“å‡ºåº“</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span>    <span class="comment">// åŒ…å«ä¼˜å…ˆé˜Ÿåˆ—åº“</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 2147483647    <span class="comment">// å®šä¹‰æ— ç©·å¤§ï¼ˆè¡¨ç¤ºä¸å¯è¾¾è·ç¦»ï¼‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXN 5001         <span class="comment">// å®šä¹‰æœ€å¤§èŠ‚ç‚¹æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAXM 200001       <span class="comment">// å®šä¹‰æœ€å¤§è¾¹æ•°</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€å˜é‡</span></span><br><span class="line"><span class="type">int</span> head[MAXN], dis[MAXN];   <span class="comment">// headï¼šæ¯ä¸ªèŠ‚ç‚¹çš„é‚»æ¥è¡¨çš„å¤´æŒ‡é’ˆï¼Œdisï¼šèŠ‚ç‚¹åˆ°MSTçš„æœ€å°è·ç¦»</span></span><br><span class="line"><span class="type">bool</span> vis[MAXN];              <span class="comment">// visï¼šæ ‡è®°èŠ‚ç‚¹æ˜¯å¦å·²åŠ å…¥MST</span></span><br><span class="line"><span class="type">int</span> edge_sum = <span class="number">0</span>;            <span class="comment">// è¾¹è®¡æ•°</span></span><br><span class="line"><span class="type">int</span> n, m, MST;               <span class="comment">// nï¼šèŠ‚ç‚¹æ•°ï¼Œmï¼šè¾¹æ•°ï¼ŒMSTï¼šæœ€å°ç”Ÿæˆæ ‘çš„æƒé‡å’Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾¹ç»“æ„ä½“å®šä¹‰ï¼Œå­˜å‚¨è¾¹çš„ç›®æ ‡èŠ‚ç‚¹åŠæƒé‡</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> next, to, dis;</span><br><span class="line">&#125; edge[MAXM &lt;&lt; <span class="number">1</span>];   <span class="comment">// ä½¿ç”¨ä¸¤å€æœ€å¤§è¾¹æ•°çš„æ•°ç»„ï¼Œè€ƒè™‘æ— å‘å›¾æ¯æ¡è¾¹å­˜ä¸¤æ¬¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ è¾¹åˆ°é‚»æ¥è¡¨</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> dis)</span> </span>&#123;</span><br><span class="line">    edge[++edge_sum].next = head[from]; <span class="comment">// è®¾ç½®æ–°è¾¹çš„ä¸‹ä¸€ä¸ªæŒ‡é’ˆä¸ºå½“å‰å¤´æŒ‡é’ˆ</span></span><br><span class="line">    edge[edge_sum].to = to;             <span class="comment">// è®¾ç½®ç›®æ ‡èŠ‚ç‚¹</span></span><br><span class="line">    edge[edge_sum].dis = dis;           <span class="comment">// è®¾ç½®è¾¹çš„æƒé‡</span></span><br><span class="line">    head[from] = edge_sum;              <span class="comment">// æ›´æ–°å¤´æŒ‡é’ˆä¸ºæ–°è¾¹çš„ç´¢å¼•</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> u, dis;  <span class="comment">// uï¼šèŠ‚ç‚¹ç¼–å·ï¼Œdisï¼šè·ç¦»</span></span><br><span class="line">    <span class="comment">// é‡è½½è¿ç®—ç¬¦ &lt;ï¼Œä½¿å¾—ä¼˜å…ˆé˜Ÿåˆ—æŒ‰è·ç¦»ä»å°åˆ°å¤§æ’åº</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span> &lt;(<span class="type">const</span> node&amp; rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dis &gt; rhs.dis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Primç®—æ³•å®ç°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">prim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    priority_queue&lt;node&gt; q;  <span class="comment">// ä¼˜å…ˆé˜Ÿåˆ—ï¼Œç”¨äºé€‰æ‹©æœ€å°æƒé‡çš„è¾¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i++)  <span class="comment">// åˆå§‹åŒ–æ‰€æœ‰èŠ‚ç‚¹çš„è·ç¦»ä¸ºæ— ç©·å¤§</span></span><br><span class="line">        dis[i] = INF;</span><br><span class="line">    dis[<span class="number">1</span>] = <span class="number">0</span>;              <span class="comment">// è®¾ç½®èµ·å§‹èŠ‚ç‚¹1çš„è·ç¦»ä¸º0</span></span><br><span class="line">    q.<span class="built_in">push</span>((node&#123;<span class="number">1</span>, <span class="number">0</span>&#125;));    <span class="comment">// å°†èµ·å§‹èŠ‚ç‚¹1åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        node tmp = q.<span class="built_in">top</span>();  <span class="comment">// å–å‡ºè·ç¦»æœ€å°çš„èŠ‚ç‚¹</span></span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> u = tmp.u, d = tmp.dis;</span><br><span class="line">        <span class="keyword">if</span> (vis[u]) <span class="keyword">continue</span>;  <span class="comment">// å¦‚æœèŠ‚ç‚¹å·²è®¿é—®è¿‡ï¼Œè·³è¿‡</span></span><br><span class="line">        vis[u] = <span class="number">1</span>;            <span class="comment">// æ ‡è®°èŠ‚ç‚¹uä¸ºå·²è®¿é—®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">register</span> <span class="type">int</span> j = head[u]; j; j = edge[j].next) &#123;  <span class="comment">// éå†é‚»æ¥èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (!vis[edge[j].to] &amp;&amp; edge[j].dis &lt; dis[edge[j].to]) &#123;  <span class="comment">// å¦‚æœé‚»æ¥èŠ‚ç‚¹æœªè®¿é—®ä¸”è·ç¦»æ›´çŸ­</span></span><br><span class="line">                dis[edge[j].to] = edge[j].dis;  <span class="comment">// æ›´æ–°è·ç¦»</span></span><br><span class="line">                <span class="keyword">if</span> (!vis[edge[j].to]) q.<span class="built_in">push</span>((node)&#123;edge[j].to, dis[edge[j].to]&#125;);  <span class="comment">// å°†èŠ‚ç‚¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);  <span class="comment">// è¾“å…¥èŠ‚ç‚¹æ•°å’Œè¾¹æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">        <span class="type">int</span> x, y, z;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;x, &amp;y, &amp;z);  <span class="comment">// è¾“å…¥è¾¹çš„èµ·ç‚¹ã€ç»ˆç‚¹å’Œæƒé‡</span></span><br><span class="line">        <span class="built_in">addedge</span>(x, y, z);   <span class="comment">// æ·»åŠ è¾¹</span></span><br><span class="line">        <span class="built_in">addedge</span>(y, x, z);   <span class="comment">// æ— å‘å›¾éœ€è¦æ·»åŠ ä¸¤æ¬¡ï¼ˆåå‘è¾¹ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">prim</span>();  <span class="comment">// æ‰§è¡ŒPrimç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> flag = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">register</span> <span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;  <span class="comment">// æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹æ˜¯å¦éƒ½è¢«è®¿é—®è¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (dis[i] == INF)</span><br><span class="line">            flag = <span class="number">1</span>;   <span class="comment">// å¦‚æœæœ‰èŠ‚ç‚¹æœªè®¿é—®åˆ°ï¼Œè¯´æ˜å›¾ä¸è¿é€š</span></span><br><span class="line">        MST += dis[i];  <span class="comment">// ç´¯åŠ MSTçš„æ€»æƒé‡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!flag) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, MST);  <span class="comment">// å¦‚æœæ‰€æœ‰èŠ‚ç‚¹éƒ½è®¿é—®åˆ°ï¼Œè¾“å‡ºMSTçš„æ€»æƒé‡</span></span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;orz\n&quot;</span>);  <span class="comment">// å¦åˆ™è¾“å‡º&quot;orz&quot;ï¼Œè¡¨ç¤ºå›¾ä¸è¿é€š</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœ€çŸ­è·¯å¾„"><a href="#æœ€çŸ­è·¯å¾„" class="headerlink" title="æœ€çŸ­è·¯å¾„"></a>æœ€çŸ­è·¯å¾„</h2><h3 id="è¿ªæ°æ–¯ç‰¹æ‹‰ï¼ˆDijkstraï¼‰ç®—æ³•â€”â€”æ‰¾åˆ°aåˆ°å…¶ä»–ç‚¹çš„æœ€çŸ­è·¯å¾„"><a href="#è¿ªæ°æ–¯ç‰¹æ‹‰ï¼ˆDijkstraï¼‰ç®—æ³•â€”â€”æ‰¾åˆ°aåˆ°å…¶ä»–ç‚¹çš„æœ€çŸ­è·¯å¾„" class="headerlink" title="è¿ªæ°æ–¯ç‰¹æ‹‰ï¼ˆDijkstraï¼‰ç®—æ³•â€”â€”æ‰¾åˆ°aåˆ°å…¶ä»–ç‚¹çš„æœ€çŸ­è·¯å¾„"></a>è¿ªæ°æ–¯ç‰¹æ‹‰ï¼ˆDijkstraï¼‰ç®—æ³•â€”â€”æ‰¾åˆ°aåˆ°å…¶ä»–ç‚¹çš„æœ€çŸ­è·¯å¾„</h3><p>æ¯æ¬¡éƒ½é€‰è·ç¦»aæœ€è¿‘çš„ç‚¹ï¼Œç„¶åæ›´æ–°</p><p><img src="/../img/cpp/2.png" alt="2"></p><h3 id="å¼—æ´›ä¼Šå¾·ï¼ˆFloydï¼‰ç®—æ³•"><a href="#å¼—æ´›ä¼Šå¾·ï¼ˆFloydï¼‰ç®—æ³•" class="headerlink" title="å¼—æ´›ä¼Šå¾·ï¼ˆFloydï¼‰ç®—æ³•"></a>å¼—æ´›ä¼Šå¾·ï¼ˆFloydï¼‰ç®—æ³•</h3><p>æ±‚ä»»æ„ä¸¤ä¸ªç‚¹çš„æœ€çŸ­è·¯å¾„ï¼Œä½¿ç”¨é‚»æ¥çŸ©é˜µæ¥å­˜å‚¨</p><ul><li>æ•°ç»„Dä¿å­˜ä»»æ„ä¸¤ä¸ªç‚¹çš„æœ€çŸ­è·¯å¾„</li><li>æ•°ç»„Pathä¿å­˜ä»»æ„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„æœ¬èº«</li></ul><p><img src="/../img/cpp/3.png" alt="3"></p><p><img src="/../img/cpp/4.png" alt="4"></p><h2 id="å…³é”®è·¯å¾„â€”â€”AOEç½‘ä¸­æœ€é•¿çš„è·¯"><a href="#å…³é”®è·¯å¾„â€”â€”AOEç½‘ä¸­æœ€é•¿çš„è·¯" class="headerlink" title="å…³é”®è·¯å¾„â€”â€”AOEç½‘ä¸­æœ€é•¿çš„è·¯"></a>å…³é”®è·¯å¾„â€”â€”AOEç½‘ä¸­æœ€é•¿çš„è·¯</h2><h3 id="AOE"><a href="#AOE" class="headerlink" title="AOE"></a>AOE</h3><p>â€”è¾¹ä¸Šæœ‰æƒå€¼çš„å›¾</p><h3 id="æ‹“æ‰‘æ’åº"><a href="#æ‹“æ‰‘æ’åº" class="headerlink" title="æ‹“æ‰‘æ’åº"></a>æ‹“æ‰‘æ’åº</h3><p>â€”æ¯æ¬¡é€‰å…¥åº¦ä¸º0çš„ç‚¹ï¼Œç„¶ååˆ é™¤è¿™ä¸ªç‚¹å’Œå®ƒçš„å‡ºè¾¹</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>AOEç½‘ä¸­çš„èŠ‚ç‚¹ä¸ºäº‹ä»¶ï¼Œè¾¹ä¸ºè·¯å¾„</p><p>vâ€”vertex(äº‹ä»¶)ï¼›eâ€”earlyï¼›lâ€”late</p><p>å…ˆè®¾å˜é‡ve,vl,e,l</p><p>é€šè¿‡ä¸€æ¬¡æ‹“æ‰‘æ’åºï¼Œæ±‚å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„veï¼›</p><p>å†é€šè¿‡ä¸€æ¬¡é€†æ‹“æ‰‘æ’åºï¼Œæ±‚å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„vlï¼›</p>]]></content>
      
      
      
        <tags>
            
            <tag> c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch6å¤šå±‚æ„ŸçŸ¥æœº</title>
      <link href="/2024/06/21/Pytorch6-%E5%A4%9A%E5%B1%82%E6%84%9F%E7%9F%A5%E6%9C%BA/"/>
      <url>/2024/06/21/Pytorch6-%E5%A4%9A%E5%B1%82%E6%84%9F%E7%9F%A5%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="å¤šå±‚æ„ŸçŸ¥æœº"><a href="#å¤šå±‚æ„ŸçŸ¥æœº" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœº"></a>å¤šå±‚æ„ŸçŸ¥æœº</h1><h2 id="éšè—å±‚"><a href="#éšè—å±‚" class="headerlink" title="éšè—å±‚"></a>éšè—å±‚</h2><p>åœ¨å¤šå±‚æ„ŸçŸ¥æœºï¼ˆMultilayer Perceptron, MLPï¼‰ä¸­ï¼Œéšè—å±‚ï¼ˆHidden Layerï¼‰æ˜¯æŒ‡ä½äºè¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´çš„ç¥ç»å…ƒå±‚ã€‚å¤šå±‚æ„ŸçŸ¥æœºæ˜¯ä¸€ç§å‰é¦ˆç¥ç»ç½‘ç»œï¼Œé€šå¸¸ç”±å¤šä¸ªéšè—å±‚ç»„æˆï¼Œæ¯ä¸ªéšè—å±‚ç”±å¤šä¸ªç¥ç»å…ƒç»„æˆã€‚</p><p>éšè—å±‚çš„ä½œç”¨æ˜¯å¯¹è¾“å…¥æ•°æ®è¿›è¡Œéçº¿æ€§æ˜ å°„å’Œç‰¹å¾æå–ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ åˆ°å¤æ‚çš„æ¨¡å¼å’Œå…³ç³»ã€‚æ¯ä¸ªéšè—å±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒæ¥æ”¶æ¥è‡ªä¸Šä¸€å±‚ï¼ˆæˆ–è€…è¾“å…¥å±‚ï¼‰çš„è¾“å…¥ï¼Œé€šè¿‡åŠ æƒå’Œå’Œæ¿€æ´»å‡½æ•°å¤„ç†åè¾“å‡ºç»™ä¸‹ä¸€å±‚ï¼ˆæˆ–è€…è¾“å‡ºå±‚ï¼‰ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¤šå±‚æ„ŸçŸ¥æœºçš„è¿ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>è¾“å…¥å±‚</strong>æ¥æ”¶åŸå§‹æ•°æ®æˆ–ç‰¹å¾å‘é‡ä½œä¸ºè¾“å…¥ã€‚</li><li><strong>éšè—å±‚</strong>æ¥æ”¶æ¥è‡ªè¾“å…¥å±‚çš„è¾“å…¥ï¼Œå¯¹å…¶è¿›è¡Œçº¿æ€§åŠ æƒå’Œï¼Œå¹¶é€šè¿‡ä¸€ä¸ªéçº¿æ€§çš„æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ReLUã€sigmoidç­‰ï¼‰è¿›è¡Œè½¬æ¢ï¼Œè¾“å‡ºç»™ä¸‹ä¸€å±‚æˆ–è¾“å‡ºå±‚ã€‚</li><li><strong>è¾“å‡ºå±‚</strong>æ¥æ”¶æœ€åä¸€ä¸ªéšè—å±‚çš„è¾“å‡ºï¼Œè¿›è¡Œæœ€ç»ˆçš„å¤„ç†å’Œåˆ†ç±»ï¼Œè¾“å‡ºé¢„æµ‹ç»“æœã€‚</li></ol><p>éšè—å±‚çš„å¼•å…¥ä½¿å¾—å¤šå±‚æ„ŸçŸ¥æœºèƒ½å¤Ÿå¤„ç†å¤æ‚çš„éçº¿æ€§é—®é¢˜ï¼Œå¹¶ä¸”é€šè¿‡è°ƒæ•´éšè—å±‚çš„ç¥ç»å…ƒæ•°é‡å’Œç»“æ„ï¼Œå¯ä»¥å¢åŠ ç¥ç»ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ï¼Œæé«˜å…¶å¯¹æ•°æ®çš„å»ºæ¨¡èƒ½åŠ›å’Œé¢„æµ‹ç²¾åº¦ã€‚</p><h3 id="çº¿æ€§æ¨¡å‹å¯èƒ½ä¼šå‡ºé”™"><a href="#çº¿æ€§æ¨¡å‹å¯èƒ½ä¼šå‡ºé”™" class="headerlink" title="çº¿æ€§æ¨¡å‹å¯èƒ½ä¼šå‡ºé”™"></a>çº¿æ€§æ¨¡å‹å¯èƒ½ä¼šå‡ºé”™</h3><p>ä¾‹å¦‚ï¼Œçº¿æ€§æ„å‘³ç€<em>å•è°ƒ</em>å‡è®¾ï¼š ä»»ä½•ç‰¹å¾çš„å¢å¤§éƒ½ä¼šå¯¼è‡´æ¨¡å‹è¾“å‡ºçš„å¢å¤§ï¼ˆå¦‚æœå¯¹åº”çš„æƒé‡ä¸ºæ­£ï¼‰ï¼Œ æˆ–è€…å¯¼è‡´æ¨¡å‹è¾“å‡ºçš„å‡å°ï¼ˆå¦‚æœå¯¹åº”çš„æƒé‡ä¸ºè´Ÿï¼‰ã€‚ æœ‰æ—¶è¿™æ˜¯æœ‰é“ç†çš„ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¯•å›¾é¢„æµ‹ä¸€ä¸ªäººæ˜¯å¦ä¼šå¿è¿˜è´·æ¬¾ã€‚ æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œåœ¨å…¶ä»–æ¡ä»¶ä¸å˜çš„æƒ…å†µä¸‹ï¼Œ æ”¶å…¥è¾ƒé«˜çš„ç”³è¯·äººæ¯”æ”¶å…¥è¾ƒä½çš„ç”³è¯·äººæ›´æœ‰å¯èƒ½å¿è¿˜è´·æ¬¾ã€‚ ä½†æ˜¯ï¼Œè™½ç„¶æ”¶å…¥ä¸è¿˜æ¬¾æ¦‚ç‡å­˜åœ¨å•è°ƒæ€§ï¼Œä½†å®ƒä»¬ä¸æ˜¯çº¿æ€§ç›¸å…³çš„ã€‚ æ”¶å…¥ä»0å¢åŠ åˆ°5ä¸‡ï¼Œå¯èƒ½æ¯”ä»100ä¸‡å¢åŠ åˆ°105ä¸‡å¸¦æ¥æ›´å¤§çš„è¿˜æ¬¾å¯èƒ½æ€§ã€‚ å¤„ç†è¿™ä¸€é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯å¯¹æˆ‘ä»¬çš„æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œ ä½¿çº¿æ€§å˜å¾—æ›´åˆç†ï¼Œå¦‚ä½¿ç”¨æ”¶å…¥çš„å¯¹æ•°ä½œä¸ºæˆ‘ä»¬çš„ç‰¹å¾ã€‚</p><p>ç„¶è€Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“æ‰¾å‡ºè¿åå•è°ƒæ€§çš„ä¾‹å­ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æ ¹æ®ä½“æ¸©é¢„æµ‹æ­»äº¡ç‡ã€‚ å¯¹ä½“æ¸©é«˜äº37æ‘„æ°åº¦çš„äººæ¥è¯´ï¼Œæ¸©åº¦è¶Šé«˜é£é™©è¶Šå¤§ã€‚ ç„¶è€Œï¼Œå¯¹ä½“æ¸©ä½äº37æ‘„æ°åº¦çš„äººæ¥è¯´ï¼Œæ¸©åº¦è¶Šé«˜é£é™©å°±è¶Šä½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›å·§å¦™çš„é¢„å¤„ç†æ¥è§£å†³é—®é¢˜ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸37æ‘„æ°åº¦çš„è·ç¦»ä½œä¸ºç‰¹å¾ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚ä½•å¯¹çŒ«å’Œç‹—çš„å›¾åƒè¿›è¡Œåˆ†ç±»å‘¢ï¼Ÿ å¢åŠ ä½ç½®(13,17)å¤„åƒç´ çš„å¼ºåº¦æ˜¯å¦æ€»æ˜¯å¢åŠ ï¼ˆæˆ–é™ä½ï¼‰å›¾åƒæç»˜ç‹—çš„ä¼¼ç„¶ï¼Ÿ å¯¹çº¿æ€§æ¨¡å‹çš„ä¾èµ–å¯¹åº”äºä¸€ä¸ªéšå«çš„å‡è®¾ï¼Œ å³åŒºåˆ†çŒ«å’Œç‹—çš„å”¯ä¸€è¦æ±‚æ˜¯è¯„ä¼°å•ä¸ªåƒç´ çš„å¼ºåº¦ã€‚ åœ¨ä¸€ä¸ªå€’ç½®å›¾åƒåä¾ç„¶ä¿ç•™ç±»åˆ«çš„ä¸–ç•Œé‡Œï¼Œè¿™ç§æ–¹æ³•æ³¨å®šä¼šå¤±è´¥ã€‚</p><p>ä¸æˆ‘ä»¬å‰é¢çš„ä¾‹å­ç›¸æ¯”ï¼Œè¿™é‡Œçš„çº¿æ€§å¾ˆè’è°¬ï¼Œ è€Œä¸”æˆ‘ä»¬éš¾ä»¥é€šè¿‡ç®€å•çš„é¢„å¤„ç†æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ è¿™æ˜¯å› ä¸ºä»»ä½•åƒç´ çš„é‡è¦æ€§éƒ½ä»¥å¤æ‚çš„æ–¹å¼å–å†³äºè¯¥åƒç´ çš„ä¸Šä¸‹æ–‡ï¼ˆå‘¨å›´åƒç´ çš„å€¼ï¼‰ã€‚ æˆ‘ä»¬çš„æ•°æ®å¯èƒ½ä¼šæœ‰ä¸€ç§è¡¨ç¤ºï¼Œè¿™ç§è¡¨ç¤ºä¼šè€ƒè™‘åˆ°æˆ‘ä»¬åœ¨ç‰¹å¾ä¹‹é—´çš„ç›¸å…³äº¤äº’ä½œç”¨ã€‚ åœ¨æ­¤è¡¨ç¤ºçš„åŸºç¡€ä¸Šå»ºç«‹ä¸€ä¸ªçº¿æ€§æ¨¡å‹å¯èƒ½ä¼šæ˜¯åˆé€‚çš„ï¼Œ ä½†æˆ‘ä»¬ä¸çŸ¥é“å¦‚ä½•æ‰‹åŠ¨è®¡ç®—è¿™ä¹ˆä¸€ç§è¡¨ç¤ºã€‚ å¯¹äºæ·±åº¦ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬ä½¿ç”¨è§‚æµ‹æ•°æ®æ¥è”åˆå­¦ä¹ éšè—å±‚è¡¨ç¤ºå’Œåº”ç”¨äºè¯¥è¡¨ç¤ºçš„çº¿æ€§é¢„æµ‹å™¨ã€‚</p><h3 id="åœ¨ç½‘ç»œä¸­åŠ å…¥éšè—å±‚"><a href="#åœ¨ç½‘ç»œä¸­åŠ å…¥éšè—å±‚" class="headerlink" title="åœ¨ç½‘ç»œä¸­åŠ å…¥éšè—å±‚"></a>åœ¨ç½‘ç»œä¸­åŠ å…¥éšè—å±‚</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç½‘ç»œä¸­åŠ å…¥ä¸€ä¸ªæˆ–å¤šä¸ªéšè—å±‚æ¥å…‹æœçº¿æ€§æ¨¡å‹çš„é™åˆ¶ï¼Œ ä½¿å…¶èƒ½å¤„ç†æ›´æ™®éçš„å‡½æ•°å…³ç³»ç±»å‹ã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†è®¸å¤šå…¨è¿æ¥å±‚å †å åœ¨ä¸€èµ·ã€‚ æ¯ä¸€å±‚éƒ½è¾“å‡ºåˆ°ä¸Šé¢çš„å±‚ï¼Œç›´åˆ°ç”Ÿæˆæœ€åçš„è¾“å‡ºã€‚ æˆ‘ä»¬å¯ä»¥æŠŠå‰ğ¿âˆ’1å±‚çœ‹ä½œè¡¨ç¤ºï¼ŒæŠŠæœ€åä¸€å±‚çœ‹ä½œçº¿æ€§é¢„æµ‹å™¨ã€‚ è¿™ç§æ¶æ„é€šå¸¸ç§°ä¸º<em>å¤šå±‚æ„ŸçŸ¥æœº</em>ï¼ˆmultilayer perceptronï¼‰ï¼Œé€šå¸¸ç¼©å†™ä¸º<em>MLP</em>ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬ä»¥å›¾çš„æ–¹å¼æè¿°äº†å¤šå±‚æ„ŸçŸ¥æœº</p><p><img src="/../img/Pytorch1/pytorch6/1.png" alt="1"></p><p>è¿™ä¸ªå¤šå±‚æ„ŸçŸ¥æœºæœ‰4ä¸ªè¾“å…¥ï¼Œ3ä¸ªè¾“å‡ºï¼Œå…¶éšè—å±‚åŒ…å«5ä¸ªéšè—å•å…ƒã€‚ è¾“å…¥å±‚ä¸æ¶‰åŠä»»ä½•è®¡ç®—ï¼Œå› æ­¤ä½¿ç”¨æ­¤ç½‘ç»œäº§ç”Ÿè¾“å‡ºåªéœ€è¦å®ç°éšè—å±‚å’Œè¾“å‡ºå±‚çš„è®¡ç®—ã€‚ å› æ­¤ï¼Œè¿™ä¸ªå¤šå±‚æ„ŸçŸ¥æœºä¸­çš„å±‚æ•°ä¸º2ã€‚ æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå±‚éƒ½æ˜¯å…¨è¿æ¥çš„ã€‚ æ¯ä¸ªè¾“å…¥éƒ½ä¼šå½±å“éšè—å±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒï¼Œ è€Œéšè—å±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒåˆä¼šå½±å“è¾“å‡ºå±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒã€‚</p><p>ç„¶è€Œï¼Œå…·æœ‰å…¨è¿æ¥å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºçš„å‚æ•°å¼€é”€å¯èƒ½ä¼šé«˜å¾—ä»¤äººæœ›è€Œå´æ­¥ã€‚ å³ä½¿åœ¨ä¸æ”¹å˜è¾“å…¥æˆ–è¾“å‡ºå¤§å°çš„æƒ…å†µä¸‹ï¼Œ å¯èƒ½åœ¨å‚æ•°èŠ‚çº¦å’Œæ¨¡å‹æœ‰æ•ˆæ€§ä¹‹é—´è¿›è¡Œæƒè¡¡</p><h3 id="ä»çº¿æ€§åˆ°éçº¿æ€§"><a href="#ä»çº¿æ€§åˆ°éçº¿æ€§" class="headerlink" title="ä»çº¿æ€§åˆ°éçº¿æ€§"></a>ä»çº¿æ€§åˆ°éçº¿æ€§</h3><p>åœ¨æ¯ä¸€ä¸ªéšè—å±‚çš„è¾“å‡ºåé¢ä½¿ç”¨ä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼Œæ¥å¼•å…¥éçº¿æ€§ç‰¹æ€§å’Œå¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›</p><p>å¦‚æœæ²¡æœ‰æ¿€æ´»å‡½æ•°ï¼Œå¤šå±‚æ„ŸçŸ¥æœºå°±åªæ˜¯ç®€å•çš„çº¿æ€§å˜æ¢å †å ï¼Œæ— æ³•å­¦ä¹ éçº¿æ€§å‡½æ•°</p><h3 id="å¸¸è§æ¿€æ´»å‡½æ•°"><a href="#å¸¸è§æ¿€æ´»å‡½æ•°" class="headerlink" title="å¸¸è§æ¿€æ´»å‡½æ•°"></a>å¸¸è§æ¿€æ´»å‡½æ•°</h3><p><strong>Sigmoidå‡½æ•°ï¼ˆLogisticå‡½æ•°ï¼‰ï¼š</strong> å°†è¾“å…¥æ˜ å°„åˆ°(0, 1)åŒºé—´ï¼Œä¸»è¦ç”¨äºè¾“å‡ºå±‚çš„äºŒåˆ†ç±»é—®é¢˜ã€‚<br>$$<br>\sigma(x) &#x3D; \frac{1}{1 + e^{-x}}<br>$$<br><strong>ReLUå‡½æ•°ï¼ˆRectified Linear Unitï¼‰ï¼š</strong> å¯¹äºæ­£æ•°éƒ¨åˆ†è¾“å‡ºå…¶æœ¬èº«ï¼Œè´Ÿæ•°éƒ¨åˆ†è¾“å‡º0ï¼Œé€šå¸¸åœ¨éšè—å±‚ä¸­ä½¿ç”¨ï¼Œæœ‰åŠ©äºåŠ é€Ÿè®­ç»ƒã€‚<br>$$<br>\text{ReLU}(x) &#x3D; \max(0, x)<br>$$<br><strong>tanhå‡½æ•°ï¼ˆåŒæ›²æ­£åˆ‡å‡½æ•°ï¼‰ï¼š</strong> å°†è¾“å…¥æ˜ å°„åˆ°(-1, 1)åŒºé—´ï¼Œä¸sigmoidå‡½æ•°ç±»ä¼¼ï¼Œä½†è¾“å‡ºèŒƒå›´æ›´å¹¿æ³›ï¼Œæœ‰æ—¶åœ¨éšè—å±‚ä¸­ä½¿ç”¨ã€‚<br>$$<br>\tanh(x) &#x3D; \frac{e^x - e^{-x}}{e^x + e^{-x}}<br>$$</p><h2 id="å¤šå±‚æ„ŸçŸ¥æœºçš„pytorchå®ç°"><a href="#å¤šå±‚æ„ŸçŸ¥æœºçš„pytorchå®ç°" class="headerlink" title="å¤šå±‚æ„ŸçŸ¥æœºçš„pytorchå®ç°"></a>å¤šå±‚æ„ŸçŸ¥æœºçš„pytorchå®ç°</h2><p>ä¾æ—§ä½¿ç”¨Fashion-MNISTå›¾åƒåˆ†ç±»æ•°æ®é›†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br></pre></td></tr></table></figure><h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>ä¸softmaxå›å½’çš„pytorchå®ç°ç›¸æ¯”ï¼Œ å”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘ä»¬æ·»åŠ äº†2ä¸ªå…¨è¿æ¥å±‚ï¼ˆä¹‹å‰æˆ‘ä»¬åªæ·»åŠ äº†1ä¸ªå…¨è¿æ¥å±‚ï¼‰ã€‚ ç¬¬ä¸€å±‚æ˜¯éšè—å±‚ï¼Œå®ƒåŒ…å«256ä¸ªéšè—å•å…ƒï¼Œå¹¶ä½¿ç”¨äº†ReLUæ¿€æ´»å‡½æ•°ã€‚ ç¬¬äºŒå±‚æ˜¯è¾“å‡ºå±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential(nn.Flatten(),</span><br><span class="line">                    nn.Linear(<span class="number">784</span>, <span class="number">256</span>),</span><br><span class="line">                    nn.ReLU(),</span><br><span class="line">                    nn.Linear(<span class="number">256</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_weights</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(m) == nn.Linear:</span><br><span class="line">        nn.init.normal_(m.weight, std=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">net.apply(init_weights);</span><br></pre></td></tr></table></figure><p>è®­ç»ƒè¿‡ç¨‹çš„å®ç°ä¸æˆ‘ä»¬å®ç°softmaxå›å½’æ—¶å®Œå…¨ç›¸åŒï¼Œ è¿™ç§æ¨¡å—åŒ–è®¾è®¡ä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†ä¸æ¨¡å‹æ¶æ„æœ‰å…³çš„å†…å®¹ç‹¬ç«‹å‡ºæ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">batch_size, lr, num_epochs = <span class="number">256</span>, <span class="number">0.1</span>, <span class="number">10</span></span><br><span class="line">loss = nn.CrossEntropyLoss(reduction=<span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">trainer = torch.optim.SGD(net.parameters(), lr=lr)</span><br><span class="line"></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br><span class="line">d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, trainer)</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch6/2.png" alt="2"></p><h2 id="æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"><a href="#æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ" class="headerlink" title="æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ"></a>æ¨¡å‹é€‰æ‹©ã€æ¬ æ‹Ÿåˆå’Œè¿‡æ‹Ÿåˆ</h2><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å‘ç°<em>æ¨¡å¼</em>ï¼ˆpatternï¼‰ã€‚ä¸”æ¨¡å‹åº”è¯¥æ˜¯çœŸæ­£å‘ç°äº†ä¸€ç§æ³›åŒ–çš„æ¨¡å¼ï¼Œ è€Œä¸æ˜¯ç®€å•åœ°è®°ä½äº†æ•°æ®</p><p>å°†æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šæ‹Ÿåˆçš„æ¯”åœ¨æ½œåœ¨åˆ†å¸ƒä¸­æ›´æ¥è¿‘çš„ç°è±¡ç§°ä¸º<em>è¿‡æ‹Ÿåˆ</em>ï¼ˆoverfittingï¼‰ï¼Œ ç”¨äºå¯¹æŠ—è¿‡æ‹Ÿåˆçš„æŠ€æœ¯ç§°ä¸º<em>æ­£åˆ™åŒ–</em>ï¼ˆregularizationï¼‰</p><h3 id="è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"><a href="#è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®" class="headerlink" title="è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®"></a>è®­ç»ƒè¯¯å·®å’Œæ³›åŒ–è¯¯å·®</h3><p><em>è®­ç»ƒè¯¯å·®</em>ï¼ˆtraining errorï¼‰æ˜¯æŒ‡ï¼Œ æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®é›†ä¸Šè®¡ç®—å¾—åˆ°çš„è¯¯å·®ã€‚ <em>æ³›åŒ–è¯¯å·®</em>ï¼ˆgeneralization errorï¼‰æ˜¯æŒ‡ï¼Œ æ¨¡å‹åº”ç”¨åœ¨åŒæ ·ä»åŸå§‹æ ·æœ¬çš„åˆ†å¸ƒä¸­æŠ½å–çš„æ— é™å¤šæ•°æ®æ ·æœ¬æ—¶ï¼Œæ¨¡å‹è¯¯å·®çš„æœŸæœ›ã€‚</p><p>åœ¨å®é™…ä¸­ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡å°†æ¨¡å‹åº”ç”¨äºä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•é›†æ¥ä¼°è®¡æ³›åŒ–è¯¯å·®ï¼Œ è¯¥æµ‹è¯•é›†ç”±éšæœºé€‰å–çš„ã€æœªæ›¾åœ¨è®­ç»ƒé›†ä¸­å‡ºç°çš„æ•°æ®æ ·æœ¬æ„æˆã€‚</p><h3 id="è¿‡æ‹Ÿåˆã€æ¬ æ‹Ÿåˆ"><a href="#è¿‡æ‹Ÿåˆã€æ¬ æ‹Ÿåˆ" class="headerlink" title="è¿‡æ‹Ÿåˆã€æ¬ æ‹Ÿåˆ"></a>è¿‡æ‹Ÿåˆã€æ¬ æ‹Ÿåˆ</h3><p>å½“è®­ç»ƒè¯¯å·®å’ŒéªŒè¯è¯¯å·®éƒ½å¾ˆä¸¥é‡ï¼Œ ä½†å®ƒä»¬ä¹‹é—´ä»…æœ‰ä¸€ç‚¹å·®è·ã€‚ å¦‚æœæ¨¡å‹ä¸èƒ½é™ä½è®­ç»ƒè¯¯å·®ï¼Œè¿™å¯èƒ½æ„å‘³ç€æ¨¡å‹è¿‡äºç®€å•ï¼ˆå³è¡¨è¾¾èƒ½åŠ›ä¸è¶³ï¼‰ï¼Œ æ— æ³•æ•è·è¯•å›¾å­¦ä¹ çš„æ¨¡å¼ã€‚ æ­¤å¤–ï¼Œç”±äºæˆ‘ä»¬çš„è®­ç»ƒå’ŒéªŒè¯è¯¯å·®ä¹‹é—´çš„<em>æ³›åŒ–è¯¯å·®</em>å¾ˆå°ï¼Œ æˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡å¯ä»¥ç”¨ä¸€ä¸ªæ›´å¤æ‚çš„æ¨¡å‹é™ä½è®­ç»ƒè¯¯å·®ã€‚ è¿™ç§ç°è±¡è¢«ç§°ä¸º<em>æ¬ æ‹Ÿåˆ</em>ï¼ˆunderfittingï¼‰ã€‚å³å› æ¨¡å‹é—®é¢˜å¯¼è‡´è®­ç»ƒå’Œæ³›åŒ–è¯¯å·®éƒ½å¾ˆå¤§</p><p>å½“æˆ‘ä»¬çš„è®­ç»ƒè¯¯å·®æ˜æ˜¾ä½äºéªŒè¯è¯¯å·®æ—¶ï¼Œ è¿™è¡¨æ˜ä¸¥é‡çš„<em>è¿‡æ‹Ÿåˆ</em>ï¼ˆoverfittingï¼‰</p><p>ä½†æ˜¯ï¼Œ<em>è¿‡æ‹Ÿåˆ</em>å¹¶ä¸æ€»æ˜¯ä¸€ä»¶åäº‹ã€‚ ç‰¹åˆ«æ˜¯åœ¨æ·±åº¦å­¦ä¹ é¢†åŸŸï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œ æœ€å¥½çš„é¢„æµ‹æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¡¨ç°å¾€å¾€æ¯”åœ¨ä¿ç•™ï¼ˆéªŒè¯ï¼‰æ•°æ®ä¸Šå¥½å¾—å¤šã€‚ æœ€ç»ˆï¼Œæˆ‘ä»¬é€šå¸¸æ›´å…³å¿ƒéªŒè¯è¯¯å·®ï¼Œè€Œä¸æ˜¯è®­ç»ƒè¯¯å·®å’ŒéªŒè¯è¯¯å·®ä¹‹é—´çš„å·®è·ã€‚</p><p>æ˜¯å¦è¿‡æ‹Ÿåˆæˆ–æ¬ æ‹Ÿåˆå¯èƒ½å–å†³äºæ¨¡å‹å¤æ‚æ€§å’Œå¯ç”¨è®­ç»ƒæ•°æ®é›†çš„å¤§å°</p><h4 id="æ¨¡å‹å¤æ‚æ€§"><a href="#æ¨¡å‹å¤æ‚æ€§" class="headerlink" title="æ¨¡å‹å¤æ‚æ€§"></a>æ¨¡å‹å¤æ‚æ€§</h4><p>é«˜é˜¶å¤šé¡¹å¼å‡½æ•°æ¯”ä½é˜¶å¤šé¡¹å¼å‡½æ•°å¤æ‚å¾—å¤šã€‚ é«˜é˜¶å¤šé¡¹å¼çš„å‚æ•°è¾ƒå¤šï¼Œæ¨¡å‹å‡½æ•°çš„é€‰æ‹©èŒƒå›´è¾ƒå¹¿ã€‚ å› æ­¤åœ¨å›ºå®šè®­ç»ƒæ•°æ®é›†çš„æƒ…å†µä¸‹ï¼Œ é«˜é˜¶å¤šé¡¹å¼å‡½æ•°ç›¸å¯¹äºä½é˜¶å¤šé¡¹å¼çš„è®­ç»ƒè¯¯å·®åº”è¯¥å§‹ç»ˆæ›´ä½ï¼ˆæœ€åä¹Ÿæ˜¯ç›¸ç­‰ï¼‰ã€‚ äº‹å®ä¸Šï¼Œå½“æ•°æ®æ ·æœ¬åŒ…å«äº†ğ‘¥çš„ä¸åŒå€¼æ—¶ï¼Œ å‡½æ•°é˜¶æ•°ç­‰äºæ•°æ®æ ·æœ¬æ•°é‡çš„å¤šé¡¹å¼å‡½æ•°å¯ä»¥å®Œç¾æ‹Ÿåˆè®­ç»ƒé›†ã€‚ åœ¨ä¸‹å›¾ä¸­ï¼Œ æˆ‘ä»¬ç›´è§‚åœ°æè¿°äº†å¤šé¡¹å¼çš„é˜¶æ•°å’Œæ¬ æ‹Ÿåˆä¸è¿‡æ‹Ÿåˆä¹‹é—´çš„å…³ç³»ã€‚</p><p><img src="/../img/Pytorch1/pytorch6/3.png" alt="3"></p><h4 id="æ•°æ®é›†å¤§å°"><a href="#æ•°æ®é›†å¤§å°" class="headerlink" title="æ•°æ®é›†å¤§å°"></a>æ•°æ®é›†å¤§å°</h4><p>è®­ç»ƒæ•°æ®é›†ä¸­çš„æ ·æœ¬è¶Šå°‘ï¼Œæˆ‘ä»¬å°±è¶Šæœ‰å¯èƒ½ï¼ˆä¸”æ›´ä¸¥é‡åœ°ï¼‰è¿‡æ‹Ÿåˆã€‚ éšç€è®­ç»ƒæ•°æ®é‡çš„å¢åŠ ï¼Œæ³›åŒ–è¯¯å·®é€šå¸¸ä¼šå‡å°ã€‚ </p><h2 id="æƒé‡è¡°å‡"><a href="#æƒé‡è¡°å‡" class="headerlink" title="æƒé‡è¡°å‡"></a>æƒé‡è¡°å‡</h2><p>æƒé‡è¡°å‡ï¼ˆWeight Decayï¼‰æ˜¯ä¸€ç§åœ¨æ·±åº¦å­¦ä¹ ä¸­å¹¿æ³›ä½¿ç”¨çš„æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œæ—¨åœ¨å‡å°‘æ¨¡å‹çš„è¿‡æ‹Ÿåˆç°è±¡ã€‚ä»¥ä¸‹æ˜¯å…³äºæƒé‡è¡°å‡çš„è¯¦ç»†è§£é‡Šï¼š</p><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>æƒé‡è¡°å‡é€šè¿‡åœ¨æ¨¡å‹çš„æŸå¤±å‡½æ•°ä¸­å¼•å…¥ä¸€ä¸ªä¸æƒé‡å‚æ•°çš„å¹³æ–¹å’Œæˆæ­£æ¯”çš„æƒ©ç½šé¡¹ï¼Œæ¥é™åˆ¶æ¨¡å‹æƒé‡çš„å¤§å°ï¼Œä»è€Œé™ä½æ¨¡å‹çš„å¤æ‚åº¦ã€‚è¿™ç§æ­£åˆ™åŒ–æŠ€æœ¯èƒ½å¤Ÿæœ‰æ•ˆåœ°é˜²æ­¢æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šè¿‡æ‹Ÿåˆï¼Œå¹¶æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</p><h3 id="ä½œç”¨åŸç†"><a href="#ä½œç”¨åŸç†" class="headerlink" title="ä½œç”¨åŸç†"></a>ä½œç”¨åŸç†</h3><ol><li><strong>é™ä½æ¨¡å‹å¤æ‚åº¦</strong>ï¼šé€šè¿‡æƒ©ç½šæ¨¡å‹ä¸­çš„æƒé‡å‚æ•°ï¼Œä½¿å…¶è¶‹å‘äºè¾ƒå°çš„å€¼ï¼Œä»è€Œé™ä½æ¨¡å‹çš„å¤æ‚åº¦ã€‚è¿™æœ‰åŠ©äºå‡å°‘æ¨¡å‹å¯¹è®­ç»ƒæ•°æ®çš„è¿‡åº¦ä¾èµ–ï¼Œé¿å…åœ¨æµ‹è¯•æ•°æ®ä¸Šè¡¨ç°ä¸ä½³ã€‚</li><li><strong>å¹³è¡¡æ‹Ÿåˆèƒ½åŠ›ä¸æ³›åŒ–èƒ½åŠ›</strong>ï¼šé€šè¿‡è°ƒæ•´æƒé‡è¡°å‡çš„ç³»æ•°ï¼ˆæ­£åˆ™åŒ–å‚æ•°Î»ï¼‰ï¼Œå¯ä»¥å¹³è¡¡æ¨¡å‹çš„æ‹Ÿåˆèƒ½åŠ›å’Œæ³›åŒ–èƒ½åŠ›ã€‚è¾ƒå°çš„Î»å€¼å¯èƒ½å¯¼è‡´æ¨¡å‹å¯¹è®­ç»ƒæ•°æ®çš„æ‹Ÿåˆèƒ½åŠ›è¿‡å¼ºï¼Œè€Œè¾ƒå¤§çš„Î»å€¼åˆ™å¯èƒ½ä½¿æ¨¡å‹è¿‡äºç®€å•ï¼Œæ— æ³•å……åˆ†æ•æ‰æ•°æ®çš„ç‰¹å¾ã€‚</li><li><strong>å‡å°‘ç‰¹å¾ä¾èµ–æ€§</strong>ï¼šæƒé‡è¡°å‡å¯ä»¥å‡å°‘æ¨¡å‹å¯¹ç‰¹å®šç‰¹å¾çš„è¿‡åº¦ä¾èµ–ï¼Œä»è€Œé™ä½è¿‡æ‹Ÿåˆçš„é£é™©ã€‚</li></ol><h3 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h3><p>æƒé‡è¡°å‡çš„å®ç°é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼ï¼šL1æ­£åˆ™åŒ–å’ŒL2æ­£åˆ™åŒ–ã€‚</p><ul><li><strong>L1æ­£åˆ™åŒ–</strong>ï¼šå‘æŸå¤±å‡½æ•°ä¸­æ·»åŠ æƒé‡å‚æ•°çš„ç»å¯¹å€¼ä¹‹å’Œä½œä¸ºæƒ©ç½šé¡¹ã€‚è¿™ç§æ–¹å¼ä¼šä½¿éƒ¨åˆ†æƒé‡æ”¶ç¼©ä¸º0ï¼Œä»è€Œå®ç°ç‰¹å¾é€‰æ‹©çš„æ•ˆæœã€‚</li><li><strong>L2æ­£åˆ™åŒ–</strong>ï¼šå‘æŸå¤±å‡½æ•°ä¸­æ·»åŠ æƒé‡å‚æ•°çš„å¹³æ–¹å’Œä½œä¸ºæƒ©ç½šé¡¹ã€‚è¿™ç§æ–¹å¼ä¼šä½¿æ‰€æœ‰æƒé‡éƒ½è¶‹å‘äºè¾ƒå°çš„å€¼ï¼Œä»è€Œå®ç°æƒé‡è¡°å‡çš„æ•ˆæœã€‚L2æ­£åˆ™åŒ–ä¹Ÿç§°ä¸ºæƒé‡è¡°å‡ã€‚</li></ul><h3 id="æ•°å­¦è¡¨ç¤º"><a href="#æ•°å­¦è¡¨ç¤º" class="headerlink" title="æ•°å­¦è¡¨ç¤º"></a>æ•°å­¦è¡¨ç¤º</h3><p>å‡è®¾æ¨¡å‹çš„æƒé‡å‚æ•°ä¸ºWï¼ŒæŸå¤±å‡½æ•°ä¸ºLï¼Œé‚£ä¹ˆå¼•å…¥æƒé‡è¡°å‡åçš„æŸå¤±å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p>Lâ€™ &#x3D; L + Î» * ||W||^2</p><p>å…¶ä¸­ï¼Œ||W||^2è¡¨ç¤ºWçš„å¹³æ–¹å’Œï¼ŒÎ»æ˜¯æ­£åˆ™åŒ–å‚æ•°ï¼Œç”¨äºæ§åˆ¶æƒ©ç½šçš„å¤§å°ã€‚Î»è¶Šå¤§ï¼Œæƒ©ç½šçš„ä½œç”¨è¶Šå¼ºï¼Œæƒé‡å‚æ•°Wè¶Šè¶‹è¿‘äº0ã€‚</p><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><ol><li><strong>å®šä¹‰æ¨¡å‹ç»“æ„å’Œå‚æ•°</strong>ï¼šé¦–å…ˆï¼Œéœ€è¦å®šä¹‰æ·±åº¦å­¦ä¹ æ¨¡å‹çš„ç»“æ„å’Œå‚æ•°ã€‚</li><li><strong>å®šä¹‰æŸå¤±å‡½æ•°</strong>ï¼šç„¶åï¼Œå®šä¹‰æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„æŸå¤±å‡½æ•°ã€‚</li><li><strong>æ·»åŠ æ­£åˆ™åŒ–é¡¹</strong>ï¼šåœ¨æŸå¤±å‡½æ•°ä¸­æ·»åŠ ä¸æƒé‡å‚æ•°çš„å¹³æ–¹å’Œæˆæ­£æ¯”çš„æƒ©ç½šé¡¹ï¼Œå³æ­£åˆ™åŒ–é¡¹ã€‚</li><li><strong>æ„å»ºä¼˜åŒ–ç®—æ³•</strong>ï¼šä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æˆ–å…¶å˜ç§æ¥ä¼˜åŒ–æŸå¤±å‡½æ•°ï¼ŒåŒæ—¶æ›´æ–°æ¨¡å‹çš„æƒé‡å‚æ•°ã€‚</li><li><strong>è¿­ä»£è®­ç»ƒ</strong>ï¼šåœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œè®¡ç®—æ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„æŸå¤±å‡½æ•°ã€æ­£åˆ™åŒ–é¡¹å’Œæ€»çš„ç›®æ ‡å‡½æ•°ï¼Œå¹¶ä½¿ç”¨ä¼˜åŒ–ç®—æ³•æ›´æ–°æ¨¡å‹çš„æƒé‡å‚æ•°ã€‚</li></ol><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å®ç°æƒé‡è¡°å‡ï¼Œå¹¶é™ä½æ¨¡å‹çš„è¿‡æ‹Ÿåˆé£é™©ã€‚</p><h3 id="è‡ªæˆ‘æ„Ÿæ‚Ÿ"><a href="#è‡ªæˆ‘æ„Ÿæ‚Ÿ" class="headerlink" title="è‡ªæˆ‘æ„Ÿæ‚Ÿ"></a>è‡ªæˆ‘æ„Ÿæ‚Ÿ</h3><h4 id="æ­£åˆ™åŒ–å®šä¹‰"><a href="#æ­£åˆ™åŒ–å®šä¹‰" class="headerlink" title="æ­£åˆ™åŒ–å®šä¹‰"></a>æ­£åˆ™åŒ–å®šä¹‰</h4><p>å‡¡æ˜¯å¯ä»¥å‡å°‘æ³›åŒ–è¯¯å·®ï¼Œè€Œä¸æ˜¯å‡å°‘è®­ç»ƒè¯¯å·®çš„æ–¹æ³•ï¼Œå³å‡å°è¿‡æ‹Ÿåˆ</p><h4 id="åˆ©ç”¨L1ï¼ŒL2å‡å°è¿‡æ‹Ÿåˆçš„åŸå› "><a href="#åˆ©ç”¨L1ï¼ŒL2å‡å°è¿‡æ‹Ÿåˆçš„åŸå› " class="headerlink" title="åˆ©ç”¨L1ï¼ŒL2å‡å°è¿‡æ‹Ÿåˆçš„åŸå› "></a>åˆ©ç”¨L1ï¼ŒL2å‡å°è¿‡æ‹Ÿåˆçš„åŸå› </h4><p>å› ä¸ºé«˜ç»´çš„æ¨¡å‹åœ¨è®­ç»ƒè®­ç»ƒé›†æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°å¾ˆå¤§çš„wå€¼ï¼Œå³ä½¿æœ€åçš„æŸå¤±å‡½æ•°å¾ˆå°ï¼Œè¿‡å¤§çš„wå€¼åœ¨æµ‹è¯•é›†å¾ˆå®¹æ˜“å°†è¯¯å·®å’Œå™ªå£°å¢å¤§</p><p>è§£å†³ï¼šäººä¸ºåœ°ç»™å‚æ•°ç”»ä¸€ä¸ªæ¡†æ¡†ï¼Œå³å¯è¡ŒåŸŸèŒƒå›´ï¼šåœ¨æ±‚æŸå¤±å‡½æ•°çš„æ—¶å€™ï¼Œè§„å®šä¸€ä¸ªwçš„å¯è¡ŒåŸŸï¼Œå³èŒƒæ•°</p><h2 id="æš‚é€€æ³•"><a href="#æš‚é€€æ³•" class="headerlink" title="æš‚é€€æ³•"></a>æš‚é€€æ³•</h2><p>â€”-å¦ä¸€ç§å‡å°‘è¿‡æ‹Ÿåˆçš„æ–¹æ³•</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>å‰é¢æåˆ°ï¼Œå‡ºç°è¿‡æ‹Ÿåˆçš„åŸå› æ˜¯æƒé‡wè¿‡å¤§ï¼Œæš‚é€€æ³•é€šè¿‡éšæœºä¸¢å¼ƒä¸€äº›ç¥ç»å…ƒæ¥å‡å°‘ç¥ç»ç½‘ç»œå¯¹å•ä¸€ç¥ç»å…ƒçš„ä¾èµ–</p><h3 id="Pytorchå®ç°"><a href="#Pytorchå®ç°" class="headerlink" title="Pytorchå®ç°"></a>Pytorchå®ç°</h3><p>å¯¹äºæ·±åº¦å­¦ä¹ æ¡†æ¶çš„é«˜çº§APIï¼Œæˆ‘ä»¬åªéœ€åœ¨æ¯ä¸ªå…¨è¿æ¥å±‚ä¹‹åæ·»åŠ ä¸€ä¸ª<code>Dropout</code>å±‚ï¼Œ å°†æš‚é€€æ¦‚ç‡ä½œä¸ºå”¯ä¸€çš„å‚æ•°ä¼ é€’ç»™å®ƒçš„æ„é€ å‡½æ•°ã€‚ åœ¨è®­ç»ƒæ—¶ï¼Œ<code>Dropout</code>å±‚å°†æ ¹æ®æŒ‡å®šçš„æš‚é€€æ¦‚ç‡éšæœºä¸¢å¼ƒä¸Šä¸€å±‚çš„è¾“å‡ºï¼ˆç›¸å½“äºä¸‹ä¸€å±‚çš„è¾“å…¥ï¼‰ã€‚ åœ¨æµ‹è¯•æ—¶ï¼Œ<code>Dropout</code>å±‚ä»…ä¼ é€’æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential(nn.Flatten(),</span><br><span class="line">        nn.Linear(<span class="number">784</span>, <span class="number">256</span>),</span><br><span class="line">        nn.ReLU(),</span><br><span class="line">        <span class="comment"># åœ¨ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚ä¹‹åæ·»åŠ ä¸€ä¸ªdropoutå±‚</span></span><br><span class="line">        nn.Dropout(dropout1),</span><br><span class="line">        nn.Linear(<span class="number">256</span>, <span class="number">256</span>),</span><br><span class="line">        nn.ReLU(),</span><br><span class="line">        <span class="comment"># åœ¨ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ä¹‹åæ·»åŠ ä¸€ä¸ªdropoutå±‚</span></span><br><span class="line">        nn.Dropout(dropout2),</span><br><span class="line">        nn.Linear(<span class="number">256</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_weights</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(m) == nn.Linear:</span><br><span class="line">        nn.init.normal_(m.weight, std=<span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line">net.apply(init_weights);</span><br></pre></td></tr></table></figure><p>å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trainer = torch.optim.SGD(net.parameters(), lr=lr)</span><br><span class="line">d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, trainer)</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch6/4.png" alt="4"></p><h2 id="å‰å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­å’Œè®¡ç®—å›¾"><a href="#å‰å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­å’Œè®¡ç®—å›¾" class="headerlink" title="å‰å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­å’Œè®¡ç®—å›¾"></a>å‰å‘ä¼ æ’­ï¼Œåå‘ä¼ æ’­å’Œè®¡ç®—å›¾</h2><p>ä»¥å¸¦æƒé‡è¡°å‡ï¼ˆğ¿2æ­£åˆ™åŒ–ï¼‰çš„å•éšè—å±‚å¤šå±‚æ„ŸçŸ¥æœºä¸ºä¾‹ã€‚</p><h3 id="å‰å‘ä¼ æ’­"><a href="#å‰å‘ä¼ æ’­" class="headerlink" title="å‰å‘ä¼ æ’­"></a>å‰å‘ä¼ æ’­</h3><p>å‡è®¾è¾“å…¥æ ·æœ¬æ˜¯ ğ‘¥âˆˆğ‘…ğ‘‘ï¼Œ å¹¶ä¸”æˆ‘ä»¬çš„éšè—å±‚ä¸åŒ…æ‹¬åç½®é¡¹ã€‚</p><p><img src="/../img/Pytorch1/pytorch6/5.png" alt="5"></p><h3 id="å‰å‘ä¼ æ’­è®¡ç®—å›¾"><a href="#å‰å‘ä¼ æ’­è®¡ç®—å›¾" class="headerlink" title="å‰å‘ä¼ æ’­è®¡ç®—å›¾"></a>å‰å‘ä¼ æ’­è®¡ç®—å›¾</h3><p>è®¡ç®—å›¾å¯ä»¥å¯è§†åŒ–è®¡ç®—ä¸­æ“ä½œç¬¦å’Œå˜é‡çš„ä¾èµ–å…³ç³»</p><p>æ­£æ–¹å½¢ä¸ºå˜é‡ï¼›åœ†å½¢ä¸ºæ“ä½œç¬¦</p><p><img src="/../img/Pytorch1/pytorch6/6.png" alt="6"></p><h3 id="åå‘ä¼ æ’­"><a href="#åå‘ä¼ æ’­" class="headerlink" title="åå‘ä¼ æ’­"></a>åå‘ä¼ æ’­</h3><p>â€”â€”æŒ‡çš„æ˜¯è®¡ç®—ç¥ç»ç½‘ç»œå‚æ•°çš„æ–¹æ³•ï¼ŒåŠæ ¹æ®æ±‚å¯¼çš„é“¾å¼æ³•åˆ™ï¼ŒæŒ‰åé¡ºåºä»è¾“å‡ºå±‚åˆ°è¾“å…¥å±‚éå†ç½‘ç»œ</p><p>æœ€ç»ˆç›®çš„æ˜¯è®¡ç®—ï¼š<strong>Jå¯¹Wçš„åå¯¼</strong></p><p><img src="/../img/Pytorch1/pytorch6/7.png" alt="7"></p><h2 id="æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"><a href="#æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸"></a>æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸</h2><h3 id="æ¢¯åº¦æ¶ˆå¤±çš„åŸå› åŠå½±å“"><a href="#æ¢¯åº¦æ¶ˆå¤±çš„åŸå› åŠå½±å“" class="headerlink" title="æ¢¯åº¦æ¶ˆå¤±çš„åŸå› åŠå½±å“"></a>æ¢¯åº¦æ¶ˆå¤±çš„åŸå› åŠå½±å“</h3><p><strong>åŸå› ï¼š</strong></p><ol><li><strong>ç½‘ç»œå±‚æ•°è¿‡å¤š</strong>ï¼šéšç€ç½‘ç»œå±‚æ•°çš„å¢åŠ ï¼Œæ¢¯åº¦åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ä¼šé€å±‚ä¹˜ä»¥å‰é¢å±‚çš„å¯¼æ•°ï¼Œå¯¼è‡´æ¢¯åº¦å€¼é€æ¸å˜å°ã€‚</li><li><strong>æ¿€æ´»å‡½æ•°é€‰æ‹©ä¸å½“</strong>ï¼šä¾‹å¦‚ä½¿ç”¨sigmoidå‡½æ•°æ—¶ï¼Œå…¶å¯¼æ•°åœ¨ä¸¤ç«¯éå¸¸å°ï¼ˆæœ€å¤§ä¸º0.25ï¼‰ï¼Œå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ç°è±¡ä¸¥é‡ã€‚</li></ol><p><strong>å½±å“ï¼š</strong></p><ul><li>æ¢¯åº¦æ¶ˆå¤±ä¼šå¯¼è‡´å‚æ•°æ›´æ–°å‡ ä¹ä¸å‘ç”Ÿå˜åŒ–ï¼Œä½¿å¾—ç½‘ç»œéš¾ä»¥æ”¶æ•›ï¼Œå­¦ä¹ æ•ˆæœå·®ã€‚</li><li>è¿™ç§ç°è±¡é™åˆ¶äº†æ¨¡å‹çš„æœ€å¤§æ·±åº¦ï¼Œä½¿å¾—è®¸å¤šç†è®ºä¸Šå¯èƒ½æœ‰æ•ˆçš„æ·±åº¦æ¨¡å‹åœ¨å®é™…ä¸­æ— æ³•å®ç°ã€‚</li></ul><h3 id="æ¢¯åº¦çˆ†ç‚¸çš„åŸå› åŠå½±å“"><a href="#æ¢¯åº¦çˆ†ç‚¸çš„åŸå› åŠå½±å“" class="headerlink" title="æ¢¯åº¦çˆ†ç‚¸çš„åŸå› åŠå½±å“"></a>æ¢¯åº¦çˆ†ç‚¸çš„åŸå› åŠå½±å“</h3><p><strong>åŸå› ï¼š</strong></p><ol><li><strong>ç½‘ç»œå±‚æ•°è¿‡å¤š</strong>ï¼šä¸æ¢¯åº¦æ¶ˆå¤±ç±»ä¼¼ï¼Œéšç€ç½‘ç»œå±‚æ•°çš„å¢åŠ ï¼Œæ¢¯åº¦åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ä¼šé€å±‚ä¹˜ä»¥å‰é¢å±‚çš„å¯¼æ•°ï¼Œå¯¼è‡´æ¢¯åº¦å€¼é€æ¸å˜å¤§ã€‚</li><li><strong>å­¦ä¹ ç‡è®¾ç½®è¿‡é«˜</strong>ï¼šå¦‚æœå­¦ä¹ ç‡è®¾ç½®å¾—è¿‡é«˜ï¼Œæ¢¯åº¦æ›´æ–°çš„å¹…åº¦ä¹Ÿä¼šç›¸åº”å¢å¤§ï¼Œå®¹æ˜“å¯¼è‡´æ¢¯åº¦çˆ†ç‚¸ã€‚</li><li><strong>æŸå¤±å‡½æ•°è®¾è®¡ä¸åˆç†</strong>ï¼šæŸäº›æŸå¤±å‡½æ•°å¯èƒ½å¯¼è‡´æ¢¯åº¦å€¼åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ä¸æ–­æ”¾å¤§ã€‚</li></ol><p><strong>å½±å“ï¼š</strong></p><ul><li>æ¢¯åº¦çˆ†ç‚¸ä¼šå¯¼è‡´æ¨¡å‹æƒé‡å‚æ•°å˜åŒ–è¿‡å¤§ï¼Œä½¿æ•´ä¸ªç½‘ç»œå˜å¾—ä¸ç¨³å®šï¼Œç”šè‡³ç›´æ¥å¯¼è‡´æƒé‡å€¼æº¢å‡ºï¼ˆNaNï¼‰ã€‚</li><li>è¿™ç§ç°è±¡ä¼šå¯¼è‡´æ¨¡å‹æ— æ³•åˆ©ç”¨è®­ç»ƒæ•°æ®è¿›è¡Œæœ‰æ•ˆå­¦ä¹ ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„æ¢¯åº¦æ›´æ–°å˜å¾—éå¸¸å¤§ï¼Œä»è€Œä½¿å¾—æ¨¡å‹éš¾ä»¥è®­ç»ƒå’Œæ”¶æ•›ã€‚</li></ul><h3 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h3><p>é’ˆå¯¹æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œæœ‰å¤šç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><strong>æ›´æ¢æ¿€æ´»å‡½æ•°</strong>ï¼šä½¿ç”¨ReLUã€LeakyReLUã€PReLUç­‰éé¥±å’Œæ¿€æ´»å‡½æ•°ï¼Œè¿™äº›æ¿€æ´»å‡½æ•°åœ¨æ­£åŒºé—´å¯¼æ•°æ’ç­‰äº1ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œä½†éœ€è¦æ³¨æ„é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ã€‚</li><li><strong>æƒé‡åˆå§‹åŒ–ç­–ç•¥</strong>ï¼šé‡‡ç”¨Heæˆ–Xavieråˆå§‹åŒ–ç­–ç•¥ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶æƒé‡çš„åˆå§‹èŒƒå›´ï¼Œå‡å°‘æ¢¯åº¦çˆ†ç‚¸çš„å¯èƒ½æ€§ã€‚</li><li><strong>æ®‹å·®è¿æ¥</strong>ï¼šé€šè¿‡å¼•å…¥æ®‹å·®è¿æ¥ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç¼“è§£æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ã€‚</li><li><strong>æ‰¹é‡å½’ä¸€åŒ–</strong>ï¼šåœ¨æ¯ä¸€å±‚ä¹‹åæ·»åŠ æ‰¹é‡å½’ä¸€åŒ–æ“ä½œï¼Œå¯ä»¥ç¨³å®šç½‘ç»œçš„è®­ç»ƒè¿‡ç¨‹ï¼Œå‡å°‘æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸çš„å½±å“ã€‚</li><li><strong>æ¢¯åº¦è£å‰ª</strong>ï¼šåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­å¯¹æ¢¯åº¦å€¼è¿›è¡Œé™åˆ¶ï¼Œé˜²æ­¢å…¶è¿‡å¤§æˆ–è¿‡å°ã€‚</li><li><strong>è°ƒæ•´å­¦ä¹ ç‡</strong>ï¼šé€‚å½“è°ƒæ•´å­¦ä¹ ç‡ï¼Œé¿å…è¿‡å¤§æˆ–è¿‡å°çš„å­¦ä¹ ç‡å¯¼è‡´æ¢¯åº¦æ¶ˆå¤±æˆ–æ¢¯åº¦çˆ†ç‚¸ã€‚</li></ol><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç¼“è§£æ·±åº¦å­¦ä¹ ä¸­æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ï¼Œæé«˜æ¨¡å‹çš„è®­ç»ƒæ•ˆç‡å’Œæœ€ç»ˆæ€§èƒ½ã€‚</p><h4 id="å¦‚ä½•é€‰æ‹©æœ€é€‚åˆç‰¹å®šæ·±åº¦å­¦ä¹ ä»»åŠ¡çš„æ¿€æ´»å‡½æ•°ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±ï¼Ÿ"><a href="#å¦‚ä½•é€‰æ‹©æœ€é€‚åˆç‰¹å®šæ·±åº¦å­¦ä¹ ä»»åŠ¡çš„æ¿€æ´»å‡½æ•°ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±ï¼Ÿ" class="headerlink" title="å¦‚ä½•é€‰æ‹©æœ€é€‚åˆç‰¹å®šæ·±åº¦å­¦ä¹ ä»»åŠ¡çš„æ¿€æ´»å‡½æ•°ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±ï¼Ÿ"></a>å¦‚ä½•é€‰æ‹©æœ€é€‚åˆç‰¹å®šæ·±åº¦å­¦ä¹ ä»»åŠ¡çš„æ¿€æ´»å‡½æ•°ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±ï¼Ÿ</h4><p>é€‰æ‹©æœ€é€‚åˆç‰¹å®šæ·±åº¦å­¦ä¹ ä»»åŠ¡çš„æ¿€æ´»å‡½æ•°ä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘æ•°æ®ç‰¹å¾ã€ä»»åŠ¡ç±»å‹å’Œæ¨¡å‹å¤æ‚åº¦ç­‰å› ç´ ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“çš„å»ºè®®å’Œæ–¹æ³•ï¼š</p><ol><li><strong>æ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©æ¿€æ´»å‡½æ•°</strong>ï¼š<ul><li>å¯¹äºäºŒå…ƒæˆ–å¤šå…ƒåˆ†ç±»é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨sigmoidå‡½æ•°å’Œtanhå‡½æ•°ã€‚</li><li>å¯¹äºå›å½’é—®é¢˜å’Œä¸€äº›åˆ†ç±»é—®é¢˜ï¼ŒReLUå‡½æ•°å’ŒLeaky ReLUå‡½æ•°æ›´ä¸ºé€‚ç”¨ã€‚</li></ul></li><li><strong>å°è¯•å¤šç§æ¿€æ´»å‡½æ•°</strong>ï¼š<ul><li>åœ¨å®è·µä¸­ï¼Œå»ºè®®å°è¯•ä¸åŒçš„æ¿€æ´»å‡½æ•°ï¼Œå¹¶é€šè¿‡å®éªŒç¡®å®šæœ€é€‚åˆç‰¹å®šä»»åŠ¡çš„å‡½æ•°ã€‚</li><li>å¸¸è§çš„æ¿€æ´»å‡½æ•°åŒ…æ‹¬ReLUã€Leaky ReLUã€ELUã€Sigmoidã€Tanhå’ŒSoftmaxç­‰ã€‚</li></ul></li><li><strong>ä½¿ç”¨æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰å’ŒLSTMç»“æ„</strong>ï¼š<ul><li>æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰å¯ä»¥é€šè¿‡å¼•å…¥æ®‹å·®è¿æ¥æ¥ç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li><li>LSTMï¼ˆé•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼‰ä¹Ÿæ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ï¼Œç‰¹åˆ«é€‚ç”¨äºå¤„ç†æ—¶é—´åºåˆ—æ•°æ®ã€‚</li></ul></li><li><strong>æƒé‡åˆå§‹åŒ–å’Œæ­£åˆ™åŒ–æŠ€æœ¯</strong>ï¼š<ul><li>ä½¿ç”¨åˆé€‚çš„æƒé‡åˆå§‹åŒ–æ–¹æ³•ï¼Œå¦‚Xavieråˆå§‹åŒ–æˆ–Heåˆå§‹åŒ–ï¼Œå¯ä»¥å‡å°‘æ¢¯åº¦æ¶ˆå¤±çš„é£é™©ã€‚</li><li>åº”ç”¨æ¢¯åº¦å‰ªåˆ‡å’Œæ­£åˆ™åŒ–æŠ€æœ¯ä¹Ÿå¯ä»¥å¸®åŠ©æ§åˆ¶æ¢¯åº¦å¤§å°ï¼Œé˜²æ­¢æ¢¯åº¦æ¶ˆå¤±ã€‚</li></ul></li><li><strong>æ ‡å‡†åŒ–å¤„ç†</strong>ï¼š<ul><li>ä½¿ç”¨Batch Normalizationï¼ˆæ‰¹é‡å½’ä¸€åŒ–ï¼‰å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å†…éƒ¨åå˜é‡åç§»ï¼Œä»è€Œç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</li></ul></li></ol><h3 id="æ‰¹é‡å½’ä¸€åŒ–æ“ä½œå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè¿‡ç¨‹çš„å½±å“åŠå…¶æ•ˆæœè¯„ä¼°ã€‚"><a href="#æ‰¹é‡å½’ä¸€åŒ–æ“ä½œå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè¿‡ç¨‹çš„å½±å“åŠå…¶æ•ˆæœè¯„ä¼°ã€‚" class="headerlink" title="æ‰¹é‡å½’ä¸€åŒ–æ“ä½œå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè¿‡ç¨‹çš„å½±å“åŠå…¶æ•ˆæœè¯„ä¼°ã€‚"></a>æ‰¹é‡å½’ä¸€åŒ–æ“ä½œå¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè¿‡ç¨‹çš„å½±å“åŠå…¶æ•ˆæœè¯„ä¼°ã€‚</h3><p>æ‰¹é‡å½’ä¸€åŒ–ï¼ˆBatch Normalization, BNï¼‰æ˜¯æ·±åº¦å­¦ä¹ ä¸­ä¸€ç§é‡è¦çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯é€šè¿‡åœ¨æ¯ä¸ªæ‰¹æ¬¡ä¸­å¯¹ç¥ç»ç½‘ç»œä¸­æ¯ä¸ªå±‚æ¬¡çš„æ¯ä¸ªç¥ç»å…ƒçš„è¾“å…¥è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œä½¿å…¶éµå¾ªæ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆæ”¹å–„æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼Œæå‡æ¨¡å‹æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ã€‚</p><p>æ‰¹é‡å½’ä¸€åŒ–çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åˆ©ç”¨å°æ‰¹é‡çš„å‡å€¼å’Œæ–¹å·®è°ƒæ•´ç¥ç»ç½‘ç»œä¸­é—´è¾“å‡ºï¼Œä»è€Œç¨³å®šå±‚è¾“å…¥çš„åˆ†å¸ƒï¼Œä½¿æ·±åº¦ç¥ç»ç½‘ç»œçš„è®­ç»ƒæ›´åŠ å¿«é€Ÿå’Œç¨³å®šã€‚å…·ä½“æ¥è¯´ï¼Œæ‰¹é‡å½’ä¸€åŒ–é€šè¿‡å¯¹æ¯ä¸€æ‰¹è®­ç»ƒæ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œè®¡ç®—å‡ºå‡å€¼å’Œæ ‡å‡†å·®ï¼Œç„¶åæ ¹æ®è¿™äº›ç»Ÿè®¡é‡å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚è¿™æ ·å¯ä»¥å‡å°‘å†…éƒ¨åæ–¹å·®ï¼ˆinternal covariate shift, ICSï¼‰ï¼Œå³å‰å‡ å±‚æ›´æ–°æ—¶å¼•èµ·çš„å±‚è¾“å…¥åˆ†å¸ƒçš„å˜åŒ–ï¼Œä»è€Œç®€åŒ–äº†è®­ç»ƒè¿‡ç¨‹ã€‚</p><p>æ‰¹é‡å½’ä¸€åŒ–è¿˜å¯ä»¥åŠ é€Ÿæ·±å±‚ç½‘ç»œçš„æ”¶æ•›é€Ÿåº¦ï¼Œä½¿å¾—æ¨¡å‹å‚æ•°çš„æ›´æ–°æ›´åŠ å¹³æ»‘ï¼Œé¿å…äº†é è¿‘è¾“å‡ºå±‚è¾“å‡ºçš„å‰§çƒˆå˜åŒ–ã€‚æ­¤å¤–ï¼Œæ‰¹é‡å½’ä¸€åŒ–è¿˜å¯ä»¥å¸®åŠ©è®¾ç½®æ›´å°çš„å­¦ä¹ ç‡å’Œæ›´ä¸¥æ ¼çš„å‚æ•°åˆå§‹åŒ–ï¼Œè¿›ä¸€æ­¥æé«˜æ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚</p><p>ç„¶è€Œï¼Œå°½ç®¡æ‰¹é‡å½’ä¸€åŒ–åœ¨è®¸å¤šæƒ…å†µä¸‹è¡¨ç°å‡ºè‰²ï¼Œä½†åœ¨å°æ‰¹é‡å¤§å°ä¸‹ä¿è¯å…¶æœ‰æ•ˆæ€§ä»æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚æœªæ¥çš„ç ”ç©¶æ–¹å‘åŒ…æ‹¬å¼€å‘æ›´åŠ é€‚åº”ä¸åŒä»»åŠ¡å’Œåœºæ™¯çš„æ–°ä¸€ä»£å½’ä¸€åŒ–æ–¹æ³•ï¼Œä»¥å…‹æœç°æœ‰æŠ€æœ¯çš„å±€é™æ€§ã€‚</p><p>æ‰¹é‡å½’ä¸€åŒ–å¯¹æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè¿‡ç¨‹æœ‰æ˜¾è‘—çš„ç§¯æå½±å“ï¼Œèƒ½å¤Ÿæå‡æ¨¡å‹æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ï¼Œå¹¶åŠ é€Ÿæ”¶æ•›é€Ÿåº¦ã€‚</p><h3 id="æ¢¯åº¦è£å‰ªåœ¨é˜²æ­¢æ·±åº¦å­¦ä¹ æ¨¡å‹æ¢¯åº¦çˆ†ç‚¸ä¸­çš„åº”ç”¨åŠå…¶æ•ˆæœåˆ†æã€‚"><a href="#æ¢¯åº¦è£å‰ªåœ¨é˜²æ­¢æ·±åº¦å­¦ä¹ æ¨¡å‹æ¢¯åº¦çˆ†ç‚¸ä¸­çš„åº”ç”¨åŠå…¶æ•ˆæœåˆ†æã€‚" class="headerlink" title="æ¢¯åº¦è£å‰ªåœ¨é˜²æ­¢æ·±åº¦å­¦ä¹ æ¨¡å‹æ¢¯åº¦çˆ†ç‚¸ä¸­çš„åº”ç”¨åŠå…¶æ•ˆæœåˆ†æã€‚"></a>æ¢¯åº¦è£å‰ªåœ¨é˜²æ­¢æ·±åº¦å­¦ä¹ æ¨¡å‹æ¢¯åº¦çˆ†ç‚¸ä¸­çš„åº”ç”¨åŠå…¶æ•ˆæœåˆ†æã€‚</h3><p>æ¢¯åº¦è£å‰ªæŠ€æœ¯åœ¨é˜²æ­¢æ·±åº¦å­¦ä¹ æ¨¡å‹æ¢¯åº¦çˆ†ç‚¸ä¸­çš„åº”ç”¨åŠå…¶æ•ˆæœåˆ†æå¦‚ä¸‹ï¼š</p><p>æ¢¯åº¦è£å‰ªï¼ˆGradient Clippingï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œç”¨äºè§£å†³æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­å¸¸è§çš„æ¢¯åº¦çˆ†ç‚¸é—®é¢˜ã€‚æ¢¯åº¦çˆ†ç‚¸æ˜¯æŒ‡åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦çš„å¤§å°æ€¥å‰§å¢åŠ ï¼Œå¯¼è‡´æƒé‡æ›´æ–°è¿‡å¤§ï¼Œä»è€Œé˜»ç¢æ¨¡å‹è®­ç»ƒã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œæ¢¯åº¦è£å‰ªé€šè¿‡é™åˆ¶æ¢¯åº¦çš„èŒƒå›´æ¥æ§åˆ¶æ¢¯åº¦å¹…åº¦ï¼Œä½¿å…¶ä¿æŒåœ¨ä¸€ä¸ªåˆç†çš„èŒƒå›´å†…ã€‚</p><p>æ¢¯åº¦è£å‰ªä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯æŒ‰ç…§æ¢¯åº¦çš„ç»å¯¹å€¼è¿›è¡Œè£å‰ªï¼Œå³å¦‚æœæ¢¯åº¦çš„ç»å¯¹å€¼è¶…è¿‡äº†ä¸€ä¸ªé˜ˆå€¼ï¼Œå°±å°†å…¶è®¾ç½®ä¸ºè¯¥é˜ˆå€¼çš„ç¬¦å·ä¹˜ä»¥è¯¥é˜ˆå€¼ï¼›å¦ä¸€ç§æ˜¯æŒ‰ç…§æ¢¯åº¦çš„èŒƒæ•°è¿›è¡Œè£å‰ªã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥æœ‰æ•ˆåœ°é˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼Œä½†å…·ä½“é€‰æ‹©å“ªç§æ–¹æ³•å–å†³äºå…·ä½“ä»»åŠ¡å’Œæ¨¡å‹éœ€æ±‚ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¢¯åº¦è£å‰ªå¯ä»¥æ˜¾è‘—æé«˜æ¨¡å‹çš„è®­ç»ƒæ•ˆæœå’Œç¨³å®šæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨PyTorchä¸­ï¼Œå¯ä»¥é€šè¿‡<code>torch.nn.utils.clip _grad_norm_</code>æ–¹æ³•æ¥è¿›è¡Œæ¢¯åº¦è£å‰ªæ“ä½œï¼Œè¿™æœ‰åŠ©äºç¡®ä¿æ¨¡å‹è®­ç»ƒçš„ç¨³å®šæ€§å’Œæ”¶æ•›æ€§ã€‚æ­¤å¤–ï¼Œæ¢¯åº¦è£å‰ªè¿˜å¯ä»¥ä¸å…¶ä»–ä¼˜åŒ–æŠ€æœ¯ç»“åˆä½¿ç”¨ï¼Œä»¥è¿›ä¸€æ­¥æå‡æ¨¡å‹æ€§èƒ½ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitè¯¦è§£</title>
      <link href="/2024/06/17/git%E8%AF%A6%E8%A7%A3/"/>
      <url>/2024/06/17/git%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="gitè¯¦è§£"><a href="#gitè¯¦è§£" class="headerlink" title="gitè¯¦è§£"></a>gitè¯¦è§£</h1><h2 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h2><p>a.é¦–æ¬¡ä½¿ç”¨æ·»åŠ èº«ä»½è¯´æ˜ï¼Œä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;ä½ çš„æ˜µç§°&quot;</span>git config --global user.email é‚®ç®±@example.com</span><br></pre></td></tr></table></figure><p>b.åˆ›å»ºä»“åº“</p><p>â‘ åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨git bashè¾“å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><p>â‘¡ä½¿ç”¨ä»–äººé¡¹ç›®åˆ›å»ºä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> é¡¹ç›®url</span><br></pre></td></tr></table></figure><h2 id="çŠ¶æ€ä¸æäº¤ç‰ˆæœ¬"><a href="#çŠ¶æ€ä¸æäº¤ç‰ˆæœ¬" class="headerlink" title="çŠ¶æ€ä¸æäº¤ç‰ˆæœ¬"></a><strong>çŠ¶æ€ä¸æäº¤ç‰ˆæœ¬</strong></h2><p>åˆ›å»ºå®Œä¸€ä¸ªä»“åº“åï¼Œä¼šèµ‹äºˆè¿™ä¸ªä»“åº“æ¯ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ä¸€ä¸ªçŠ¶æ€</p><p>å¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„ï¼ŒçŠ¶æ€å‡ä¸ºï¼šæœªè¢«è·Ÿè¸ª</p><p>å½“ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬åï¼Œæœªè¢«è·Ÿè¸ªçš„æ–‡ä»¶å°±ä¸ä¼šåœ¨è¿™ä¸ªç‰ˆæœ¬é‡Œ</p><p>é‚£ä¹ˆä»–ä¹‹å‰çš„çŠ¶æ€ä¾¿æ— æ³•è¿½è¸ª</p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å•ç‹¬åœ°è·Ÿè¸ªä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;name&gt;    //å»è·Ÿè¸ªä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br></pre></td></tr></table></figure><p>è‹¥ä¸€ä¸ªæ–‡ä»¶è¢«è·Ÿè¸ªï¼Œåˆ™åœ¨è¿™ä¸ªä»“åº“é‡Œä¼šä¸€ç›´è¢«è·Ÿè¸ª</p><p>è§£é™¤è·Ÿè¸ªï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">rm</span> &lt;name&gt;    //è§£é™¤è·Ÿè¸ª</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">rm</span> --cache &lt;name&gt;    //è§£é™¤è·Ÿè¸ªä¸”ä¿ç•™åœ¨ç›®å½•ä¸­</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥å¯¹è·Ÿè¸ªçš„æ–‡ä»¶å°±è¡Œä¿®æ”¹ï¼Œä¿®æ”¹å®Œåï¼Œå°†å®ƒçš„çŠ¶æ€è®¾ç½®ä¸ºç¼“å­˜çŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;file-name&gt;    </span><br></pre></td></tr></table></figure><p>å–æ¶ˆç¼“å­˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gir reset HEAD &lt;name&gt;</span><br></pre></td></tr></table></figure><p>æäº¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit</span><br></pre></td></tr></table></figure><p>git commit å…·ä½“æ“ä½œ</p><p>â‘ git commit è¿›å…¥æäº¤ç•Œé¢, </p><p>â€‹    æŒ‰â€ i â€œé”®è¿›å…¥è¾“å…¥æ¨¡å¼åè¾“å…¥æœ¬æ¬¡æäº¤è¯¦æƒ…,</p><p>â€‹    ç„¶åescé€€å‡ºç¼–è¾‘æ¨¡å¼, æŒ‰â€ : â€œè¿›å…¥å‘½ä»¤æ , è¾“å…¥â€wqâ€ä¿å­˜å¹¶é€€å‡º.</p><p>â‘¡git commit -m â€˜ ä½ å¯¹æäº¤å†…å®¹çš„æè¿° â€˜</p><p>â‘¢git commit -a</p><p>â€‹    è¿å¸¦æœªæš‚å­˜æ–‡ä»¶ä¸€èµ·æäº¤</p><p>â€‹    git commit -am â€˜æäº¤æè¿°â€™</p><p>â‘£git reset head~ â€“soft</p><p>å–æ¶ˆæœ¬æ¬¡æäº¤ï¼Œä½¿ç”¨è¯¥å‘½ä»¤å–æ¶ˆæœ¬æ¬¡æäº¤, ä½†æ˜¯é¦–æ¬¡æäº¤ä¸å¯æ’¤å›</p><p>çŠ¶æ€æ€»ç»“ï¼š</p><p><img src="/../img/git/1.png" alt="1"></p><p>æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><ul><li>çº¢è‰²ï¼šå·²ä¿®æ”¹æœªæš‚å­˜</li><li>ç»¿è‰²ï¼šæš‚å­˜</li><li>æäº¤åï¼Œåˆ™ä¸æ˜¾ç¤º</li></ul><p>æŸ¥è¯¢æ–‡ä»¶å…·ä½“ä¿®æ”¹çš„ä½ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å†å²æäº¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸€ä¸ªå›¾å½¢åŒ–çš„æ–¹å¼å‘ˆç°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --graph</span><br></pre></td></tr></table></figure><h2 id="è¿œç¨‹ä»“åº“"><a href="#è¿œç¨‹ä»“åº“" class="headerlink" title="è¿œç¨‹ä»“åº“"></a>è¿œç¨‹ä»“åº“</h2><p>è¿æ¥è¿œç¨‹ä»“åº“ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remove add (åå­—) è¿œç¨‹ä»“åº“url</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¿æ¥çš„è¿œç¨‹ä»“åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br></pre></td></tr></table></figure><p>æ”¹åï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote rename æ—§å æ–°å</span><br></pre></td></tr></table></figure><p>æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git push è¿œç¨‹ä»“åº“å master     //å°†æœ¬åœ°ä»£ç ä¸­çš„masteråˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“</span><br><span class="line">git push -u è¿œç¨‹ä»“åº“å master      //ä½¿ç”¨-uå‘½ä»¤æ¨é€ä¸€æ¬¡ï¼Œåç»­çš„æ¨é€å³å¯ç®€å†™ä¸ºgit push</span><br></pre></td></tr></table></figure><p>é€šè¿‡sshé‰´æƒï¼š</p><p>è¿›å…¥åˆ°.sshç›®å½•ä¸‹ï¼Œæ‰§è¡Œssh-keygenç”Ÿæˆå¯†é’¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C (é‚®ç®±)      //-té€‰æ‹©ç”Ÿæˆå¯†é’¥çš„ç®—æ³•,-bé€‰æ‹©ç”Ÿæˆçš„å¤§å°,-Cæ·»åŠ è¯„è®º(Githubæ¨èè¯„è®ºä¸ºé‚®ç®±)</span><br></pre></td></tr></table></figure><p>åè¾“å…¥è¿™å¯¹å¯†é’¥çš„åå­—(eg.test)ï¼Œåœ¨sshç›®å½•ä¸‹ä¼šè‡ªåŠ¨ç”Ÿæˆtest.pub(å…¬é’¥)å’Œtest(ç§é’¥)</p><p>å¤åˆ¶å…¬é’¥ï¼Œæ·»åŠ åˆ°Github</p><h2 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h2><p>æ¯ä¸€ä¸ªæäº¤ç”Ÿæˆä¸€ä¸ªæ–°ç‰ˆæœ¬çš„åŒæ—¶ï¼Œå…¶å®ä¼šç”Ÿæˆä¸€ä¸ªæäº¤å¯¹è±¡ï¼Œæ¯ä¸ªæäº¤å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å“ˆå¸Œå€¼ã€‚</p><p><strong>åˆ†æ”¯å°±æ˜¯ä¸€ä¸ªåŒ…å«è¿™ä¸ªå“ˆå¸Œå€¼çš„ä¸€ä¸ªæ–‡ä»¶</strong>ï¼Œå¯ç®€å•ç†è§£ä¸ºæŒ‡å‘ä¸€ä¸ªæäº¤å¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæäº¤å¯¹è±¡ä¸Šæ–°å»ºå¤šä¸ªåˆ†æ”¯ã€‚</p><p>åœ¨æˆ‘ä»¬åˆå§‹åŒ–æœ¬åœ°ä»“åº“æ—¶ï¼Œå°±å·²ç»åˆ›å»ºäº†ä¸€ä¸ªmasteråˆ†æ”¯,å½“æ¯æ¬¡è¿›è¡Œä¸€ä¸ªæäº¤çš„æ—¶å€™ï¼Œåˆ†æ”¯ä¹Ÿè·Ÿç€æäº¤å¯¹è±¡è€Œå‘å‰ç§»åŠ¨</p><h3 id="æ“ä½œåˆ†æ”¯ï¼š"><a href="#æ“ä½œåˆ†æ”¯ï¼š" class="headerlink" title="æ“ä½œåˆ†æ”¯ï¼š"></a>æ“ä½œåˆ†æ”¯ï¼š</h3><ol><li><p>æŸ¥çœ‹åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span>     //HEAD-&gt;å½“å‰æ‰€å¤„åˆ†æ”¯</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status  </span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºåˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch (åˆ†æ”¯å)</span><br></pre></td></tr></table></figure></li><li><p>åˆ‡æ¢åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout (åˆ†æ”¯å)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b (åˆ†æ”¯å)               //æ–°å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯</span><br></pre></td></tr></table></figure></li></ol><h2 id="åˆ†æ”¯åˆå¹¶"><a href="#åˆ†æ”¯åˆå¹¶" class="headerlink" title="åˆ†æ”¯åˆå¹¶"></a>åˆ†æ”¯åˆå¹¶</h2><h3 id="æ— å†²çªåˆå¹¶"><a href="#æ— å†²çªåˆå¹¶" class="headerlink" title="æ— å†²çªåˆå¹¶"></a>æ— å†²çªåˆå¹¶</h3><p>åœ¨åˆå¹¶è‡³çš„åˆ†æ”¯ä½¿ç”¨</p><p>(master)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge (åˆ†æ”¯1)                   //å½“å‰æ‰€å¤„masteråˆ†æ”¯ï¼Œåˆå¹¶äº†åˆ†æ”¯1ä¸Šçš„ä¿®æ”¹</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ”¯å†²çª-merge-conflict"><a href="#åˆ†æ”¯å†²çª-merge-conflict" class="headerlink" title="åˆ†æ”¯å†²çª merge conflict"></a>åˆ†æ”¯å†²çª merge conflict</h3><p>å°† åˆ†æ”¯2 åˆå¹¶åˆ° masteråˆ†æ”¯ æ—¶, ä¸ åˆ†æ”¯1 å†²çªäº†. åŸå› æ˜¯ åˆ†æ”¯1 å’Œ åˆ†æ”¯2 ä¿®æ”¹äº†åŒä¸€å¤„å†…å®¹</p><p>git status æŸ¥çœ‹å“ªé‡Œæœ‰å†²çª</p><p>vi åˆ°å†²çªæ–‡ä»¶ä¸­, é€‰æ‹©ä¸€ä¸ªåˆ†æ”¯çš„å†…å®¹ä¿ç•™ä¸‹æ¥, ä¿å­˜é€€å‡º</p><p>git add æ–‡ä»¶å</p><p>git commit -m â€˜æäº¤æè¿°â€™</p><p>git log â€“all â€“graph æŸ¥çœ‹åˆå¹¶çŠ¶æ€</p><h2 id="æ¨æ‹‰ä¸è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯"><a href="#æ¨æ‹‰ä¸è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯" class="headerlink" title="æ¨æ‹‰ä¸è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯"></a><strong>æ¨æ‹‰ä¸è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯</strong></h2><h3 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push ä»“åº“å åˆ†æ”¯å</span><br></pre></td></tr></table></figure><p><strong>æˆ–è€…</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u ä»“åº“å åˆ†æ”¯å</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡ä½¿ç”¨ -u æŒ‡å®šæ¨é€ç›®æ ‡å, æ­¤åå¯ç›´æ¥ä½¿ç”¨git push</p><h3 id="æ‹‰å–"><a href="#æ‹‰å–" class="headerlink" title="æ‹‰å–"></a>æ‹‰å–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch           //æ‹‰å–åˆ†æ”¯</span><br></pre></td></tr></table></figure><p>è¿œç¨‹åˆ†æ”¯æœ¬åœ°åŒ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout è¿œç¨‹åˆ†æ”¯</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b æœ¬åœ°åˆ†æ”¯å è¿œç¨‹åˆ†æ”¯</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --track è¿œç¨‹åˆ†æ”¯</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
            <tag> Java </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch5çº¿æ€§ç¥ç»ç½‘ç»œ</title>
      <link href="/2024/06/13/Pytorch5%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
      <url>/2024/06/13/Pytorch5%E7%BA%BF%E6%80%A7%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="Pytorch-learning-notes5-â€“çº¿æ€§ç¥ç»ç½‘ç»œ"><a href="#Pytorch-learning-notes5-â€“çº¿æ€§ç¥ç»ç½‘ç»œ" class="headerlink" title="Pytorch learning notes5 â€“çº¿æ€§ç¥ç»ç½‘ç»œ"></a>Pytorch learning notes5 â€“çº¿æ€§ç¥ç»ç½‘ç»œ</h1><h2 id="çº¿æ€§å›å½’"><a href="#çº¿æ€§å›å½’" class="headerlink" title="çº¿æ€§å›å½’"></a>çº¿æ€§å›å½’</h2><p><em>å›å½’</em>ï¼ˆregressionï¼‰æ˜¯èƒ½ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå˜é‡ä¸å› å˜é‡ä¹‹é—´å…³ç³»å»ºæ¨¡çš„ä¸€ç±»æ–¹æ³•ã€‚ åœ¨è‡ªç„¶ç§‘å­¦å’Œç¤¾ä¼šç§‘å­¦é¢†åŸŸï¼Œå›å½’ç»å¸¸ç”¨æ¥è¡¨ç¤ºè¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„å…³ç³»ã€‚</p><p>åœ¨æœºå™¨å­¦ä¹ é¢†åŸŸä¸­çš„å¤§å¤šæ•°ä»»åŠ¡é€šå¸¸éƒ½ä¸<em>é¢„æµ‹</em>ï¼ˆpredictionï¼‰æœ‰å…³ã€‚</p><h3 id="çº¿æ€§å›å½’çš„åŸºæœ¬å…ƒç´ "><a href="#çº¿æ€§å›å½’çš„åŸºæœ¬å…ƒç´ " class="headerlink" title="çº¿æ€§å›å½’çš„åŸºæœ¬å…ƒç´ "></a>çº¿æ€§å›å½’çš„åŸºæœ¬å…ƒç´ </h3><p> çº¿æ€§å›å½’åŸºäºå‡ ä¸ªç®€å•çš„å‡è®¾ï¼š é¦–å…ˆï¼Œå‡è®¾è‡ªå˜é‡ğ‘¥å’Œå› å˜é‡ğ‘¦ä¹‹é—´çš„å…³ç³»æ˜¯çº¿æ€§çš„ï¼Œ å³ğ‘¦å¯ä»¥è¡¨ç¤ºä¸ºğ‘¥ä¸­å…ƒç´ çš„åŠ æƒå’Œï¼Œè¿™é‡Œé€šå¸¸å…è®¸åŒ…å«è§‚æµ‹å€¼çš„ä¸€äº›å™ªå£°ï¼› å…¶æ¬¡ï¼Œæˆ‘ä»¬å‡è®¾ä»»ä½•å™ªå£°éƒ½æ¯”è¾ƒæ­£å¸¸ï¼Œå¦‚å™ªå£°éµå¾ªæ­£æ€åˆ†å¸ƒã€‚</p><p>ä¸ºäº†è§£é‡Š<em>çº¿æ€§å›å½’</em>ï¼Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š æˆ‘ä»¬å¸Œæœ›æ ¹æ®æˆ¿å±‹çš„é¢ç§¯ï¼ˆå¹³æ–¹è‹±å°ºï¼‰å’Œæˆ¿é¾„ï¼ˆå¹´ï¼‰æ¥ä¼°ç®—æˆ¿å±‹ä»·æ ¼ï¼ˆç¾å…ƒï¼‰ã€‚ ä¸ºäº†å¼€å‘ä¸€ä¸ªèƒ½é¢„æµ‹æˆ¿ä»·çš„æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æ”¶é›†ä¸€ä¸ªçœŸå®çš„æ•°æ®é›†ã€‚ è¿™ä¸ªæ•°æ®é›†åŒ…æ‹¬äº†æˆ¿å±‹çš„é”€å”®ä»·æ ¼ã€é¢ç§¯å’Œæˆ¿é¾„ã€‚ åœ¨æœºå™¨å­¦ä¹ çš„æœ¯è¯­ä¸­ï¼Œè¯¥æ•°æ®é›†ç§°ä¸º<em>è®­ç»ƒæ•°æ®é›†</em>ï¼ˆtraining data setï¼‰ æˆ–<em>è®­ç»ƒé›†</em>ï¼ˆtraining setï¼‰ã€‚ æ¯è¡Œæ•°æ®ï¼ˆæ¯”å¦‚ä¸€æ¬¡æˆ¿å±‹äº¤æ˜“ç›¸å¯¹åº”çš„æ•°æ®ï¼‰ç§°ä¸º<em>æ ·æœ¬</em>ï¼ˆsampleï¼‰ï¼Œ ä¹Ÿå¯ä»¥ç§°ä¸º<em>æ•°æ®ç‚¹</em>ï¼ˆdata pointï¼‰æˆ–<em>æ•°æ®æ ·æœ¬</em>ï¼ˆdata instanceï¼‰ã€‚ æˆ‘ä»¬æŠŠè¯•å›¾é¢„æµ‹çš„ç›®æ ‡ï¼ˆæ¯”å¦‚é¢„æµ‹æˆ¿å±‹ä»·æ ¼ï¼‰ç§°ä¸º<em>æ ‡ç­¾</em>ï¼ˆlabelï¼‰æˆ–<em>ç›®æ ‡</em>ï¼ˆtargetï¼‰ã€‚ é¢„æµ‹æ‰€ä¾æ®çš„è‡ªå˜é‡ï¼ˆé¢ç§¯å’Œæˆ¿é¾„ï¼‰ç§°ä¸º<em>ç‰¹å¾</em>ï¼ˆfeatureï¼‰æˆ–<em>åå˜é‡</em>ï¼ˆcovariateï¼‰ã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨ğ‘›æ¥è¡¨ç¤ºæ•°æ®é›†ä¸­çš„æ ·æœ¬æ•°ã€‚ å¯¹ç´¢å¼•ä¸ºğ‘–çš„æ ·æœ¬ï¼Œå…¶è¾“å…¥è¡¨ç¤ºä¸ºğ‘¥(ğ‘–)&#x3D;[ğ‘¥1(ğ‘–),ğ‘¥2(ğ‘–)]âŠ¤ï¼Œ å…¶å¯¹åº”çš„æ ‡ç­¾æ˜¯ğ‘¦(ğ‘–)ã€‚</p><h4 id="çº¿æ€§æ¨¡å‹"><a href="#çº¿æ€§æ¨¡å‹" class="headerlink" title="çº¿æ€§æ¨¡å‹"></a>çº¿æ€§æ¨¡å‹</h4><p>çº¿æ€§å‡è®¾æ˜¯æŒ‡ç›®æ ‡ï¼ˆæˆ¿å±‹ä»·æ ¼ï¼‰å¯ä»¥è¡¨ç¤ºä¸ºç‰¹å¾ï¼ˆé¢ç§¯å’Œæˆ¿é¾„ï¼‰çš„åŠ æƒå’Œï¼Œå¦‚ä¸‹é¢çš„å¼å­ï¼š</p><p>(3.1.1)price&#x3D;ğ‘¤areaâ‹…area+ğ‘¤ageâ‹…age+ğ‘.</p><p>å…¶ä¸­çš„ğ‘¤areaå’Œğ‘¤age ç§°ä¸º<em>æƒé‡</em>ï¼ˆweightï¼‰ï¼Œæƒé‡å†³å®šäº†æ¯ä¸ªç‰¹å¾å¯¹æˆ‘ä»¬é¢„æµ‹å€¼çš„å½±å“ã€‚ ğ‘ç§°ä¸º<em>åç½®</em>ï¼ˆbiasï¼‰ã€<em>åç§»é‡</em>ï¼ˆoffsetï¼‰æˆ–<em>æˆªè·</em>ï¼ˆinterceptï¼‰ã€‚ åç½®æ˜¯æŒ‡å½“æ‰€æœ‰ç‰¹å¾éƒ½å–å€¼ä¸º0æ—¶ï¼Œé¢„æµ‹å€¼åº”è¯¥ä¸ºå¤šå°‘ã€‚ å³ä½¿ç°å®ä¸­ä¸ä¼šæœ‰ä»»ä½•æˆ¿å­çš„é¢ç§¯æ˜¯0æˆ–æˆ¿é¾„æ­£å¥½æ˜¯0å¹´ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åç½®é¡¹ã€‚ å¦‚æœæ²¡æœ‰åç½®é¡¹ï¼Œæˆ‘ä»¬æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›å°†å—åˆ°é™åˆ¶ã€‚ ä¸¥æ ¼æ¥è¯´ï¼Œ <a href="https://zh-v2.d2l.ai/chapter_linear-networks/linear-regression.html#equation-eq-price-area">(3.1.1)</a>æ˜¯è¾“å…¥ç‰¹å¾çš„ä¸€ä¸ª <em>ä»¿å°„å˜æ¢</em>ï¼ˆaffine transformationï¼‰ã€‚ ä»¿å°„å˜æ¢çš„ç‰¹ç‚¹æ˜¯é€šè¿‡åŠ æƒå’Œå¯¹ç‰¹å¾è¿›è¡Œ<em>çº¿æ€§å˜æ¢</em>ï¼ˆlinear transformationï¼‰ï¼Œ å¹¶é€šè¿‡åç½®é¡¹æ¥è¿›è¡Œ<em>å¹³ç§»</em>ï¼ˆtranslationï¼‰ã€‚</p><p>ç»™å®šä¸€ä¸ªæ•°æ®é›†ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯»æ‰¾æ¨¡å‹çš„æƒé‡ğ‘¤å’Œåç½®ğ‘ï¼Œ ä½¿å¾—æ ¹æ®æ¨¡å‹åšå‡ºçš„é¢„æµ‹å¤§ä½“ç¬¦åˆæ•°æ®é‡Œçš„çœŸå®ä»·æ ¼ã€‚ è¾“å‡ºçš„é¢„æµ‹å€¼ç”±è¾“å…¥ç‰¹å¾é€šè¿‡<em>çº¿æ€§æ¨¡å‹</em>çš„ä»¿å°„å˜æ¢å†³å®šï¼Œä»¿å°„å˜æ¢ç”±æ‰€é€‰æƒé‡å’Œåç½®ç¡®å®šã€‚</p><p>è€Œåœ¨æœºå™¨å­¦ä¹ é¢†åŸŸï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„æ˜¯é«˜ç»´æ•°æ®é›†ï¼Œå»ºæ¨¡æ—¶é‡‡ç”¨çº¿æ€§ä»£æ•°è¡¨ç¤ºæ³•ä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚ å½“æˆ‘ä»¬çš„è¾“å…¥åŒ…å«ğ‘‘ä¸ªç‰¹å¾æ—¶ï¼Œæˆ‘ä»¬å°†é¢„æµ‹ç»“æœğ‘¦^ ï¼ˆé€šå¸¸ä½¿ç”¨â€œå°–è§’â€ç¬¦å·è¡¨ç¤ºğ‘¦çš„ä¼°è®¡å€¼ï¼‰è¡¨ç¤ºä¸ºï¼š</p><p>â€‹                                                           ğ‘¦^&#x3D;ğ‘¤1ğ‘¥1+â€¦+ğ‘¤ğ‘‘ğ‘¥ğ‘‘+ğ‘.</p><p>å°†æ‰€æœ‰ç‰¹å¾æ”¾åˆ°å‘é‡ğ‘¥âˆˆğ‘…ğ‘‘ä¸­ï¼Œ å¹¶å°†æ‰€æœ‰æƒé‡æ”¾åˆ°å‘é‡ğ‘¤âˆˆğ‘…ğ‘‘ä¸­ï¼Œ æˆ‘ä»¬å¯ä»¥ç”¨ç‚¹ç§¯å½¢å¼æ¥ç®€æ´åœ°è¡¨è¾¾æ¨¡å‹ï¼š</p><p>â€‹                                                           ğ‘¦^&#x3D;ğ‘¤âŠ¤ğ‘¥+ğ‘.</p><p>åœ¨ <a href="https://zh-v2.d2l.ai/chapter_linear-networks/linear-regression.html#equation-eq-linreg-y">(3.1.3)</a>ä¸­ï¼Œ å‘é‡ğ‘¥å¯¹åº”äºå•ä¸ªæ•°æ®æ ·æœ¬çš„ç‰¹å¾ã€‚ ç”¨ç¬¦å·è¡¨ç¤ºçš„çŸ©é˜µğ‘‹âˆˆğ‘…ğ‘›Ã—ğ‘‘ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¼•ç”¨æˆ‘ä»¬æ•´ä¸ªæ•°æ®é›†çš„ğ‘›ä¸ªæ ·æœ¬ã€‚ å…¶ä¸­ï¼Œğ‘‹çš„æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªæ ·æœ¬ï¼Œæ¯ä¸€åˆ—æ˜¯ä¸€ç§ç‰¹å¾ã€‚</p><p>å¯¹äºç‰¹å¾é›†åˆğ‘‹ï¼Œé¢„æµ‹å€¼ğ‘¦^âˆˆğ‘…ğ‘› å¯ä»¥é€šè¿‡çŸ©é˜µ-å‘é‡ä¹˜æ³•è¡¨ç¤ºä¸ºï¼š</p><p>(3.1.4)ğ‘¦^&#x3D;ğ‘‹ğ‘¤+ğ‘</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸­çš„æ±‚å’Œå°†ä½¿ç”¨å¹¿æ’­æœºåˆ¶ã€‚ ç»™å®šè®­ç»ƒæ•°æ®ç‰¹å¾ğ‘‹å’Œå¯¹åº”çš„å·²çŸ¥æ ‡ç­¾ğ‘¦ï¼Œ çº¿æ€§å›å½’çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ç»„æƒé‡å‘é‡ğ‘¤å’Œåç½®ğ‘ï¼š å½“ç»™å®šä»ğ‘‹çš„åŒåˆ†å¸ƒä¸­å–æ ·çš„æ–°æ ·æœ¬ç‰¹å¾æ—¶ï¼Œ è¿™ç»„æƒé‡å‘é‡å’Œåç½®èƒ½å¤Ÿä½¿å¾—æ–°æ ·æœ¬é¢„æµ‹æ ‡ç­¾çš„è¯¯å·®å°½å¯èƒ½å°ã€‚</p><p>è™½ç„¶æˆ‘ä»¬ç›¸ä¿¡ç»™å®šğ‘¥é¢„æµ‹ğ‘¦çš„æœ€ä½³æ¨¡å‹ä¼šæ˜¯çº¿æ€§çš„ï¼Œ ä½†æˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªæœ‰ğ‘›ä¸ªæ ·æœ¬çš„çœŸå®æ•°æ®é›†ï¼Œå…¶ä¸­å¯¹äºæ‰€æœ‰çš„1â‰¤ğ‘–â‰¤ğ‘›ï¼Œğ‘¦(ğ‘–)å®Œå…¨ç­‰äºğ‘¤âŠ¤ğ‘¥(ğ‘–)+ğ‘ã€‚ æ— è®ºæˆ‘ä»¬ä½¿ç”¨ä»€ä¹ˆæ‰‹æ®µæ¥è§‚å¯Ÿç‰¹å¾ğ‘‹å’Œæ ‡ç­¾ğ‘¦ï¼Œ éƒ½å¯èƒ½ä¼šå‡ºç°å°‘é‡çš„è§‚æµ‹è¯¯å·®ã€‚ å› æ­¤ï¼Œå³ä½¿ç¡®ä¿¡ç‰¹å¾ä¸æ ‡ç­¾çš„æ½œåœ¨å…³ç³»æ˜¯çº¿æ€§çš„ï¼Œ æˆ‘ä»¬ä¹Ÿä¼šåŠ å…¥ä¸€ä¸ªå™ªå£°é¡¹æ¥è€ƒè™‘è§‚æµ‹è¯¯å·®å¸¦æ¥çš„å½±å“ã€‚</p><h4 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h4><p>åœ¨æˆ‘ä»¬å¼€å§‹è€ƒè™‘å¦‚ä½•ç”¨æ¨¡å‹<em>æ‹Ÿåˆ</em>ï¼ˆfitï¼‰æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šä¸€ä¸ªæ‹Ÿåˆç¨‹åº¦çš„åº¦é‡ã€‚ <em>æŸå¤±å‡½æ•°</em>ï¼ˆloss functionï¼‰èƒ½å¤Ÿé‡åŒ–ç›®æ ‡çš„<em>å®é™…</em>å€¼ä¸<em>é¢„æµ‹</em>å€¼ä¹‹é—´çš„å·®è·ã€‚ é€šå¸¸æˆ‘ä»¬ä¼šé€‰æ‹©éè´Ÿæ•°ä½œä¸ºæŸå¤±ï¼Œä¸”æ•°å€¼è¶Šå°è¡¨ç¤ºæŸå¤±è¶Šå°ï¼Œå®Œç¾é¢„æµ‹æ—¶çš„æŸå¤±ä¸º0ã€‚ å›å½’é—®é¢˜ä¸­æœ€å¸¸ç”¨çš„æŸå¤±å‡½æ•°æ˜¯å¹³æ–¹è¯¯å·®å‡½æ•°ã€‚ å½“æ ·æœ¬ğ‘–çš„é¢„æµ‹å€¼ä¸ºğ‘¦^(ğ‘–)ï¼Œå…¶ç›¸åº”çš„çœŸå®æ ‡ç­¾ä¸ºğ‘¦(ğ‘–)æ—¶ï¼Œ å¹³æ–¹è¯¯å·®å¯ä»¥å®šä¹‰ä¸ºä»¥ä¸‹å…¬å¼ï¼š</p><p>(3.1.5)ğ‘™(ğ‘–)(ğ‘¤,ğ‘)&#x3D;12(ğ‘¦^(ğ‘–)âˆ’ğ‘¦(ğ‘–))2.</p><p>å¸¸æ•°12ä¸ä¼šå¸¦æ¥æœ¬è´¨çš„å·®åˆ«ï¼Œä½†è¿™æ ·åœ¨å½¢å¼ä¸Šç¨å¾®ç®€å•ä¸€äº› ï¼ˆå› ä¸ºå½“æˆ‘ä»¬å¯¹æŸå¤±å‡½æ•°æ±‚å¯¼åå¸¸æ•°ç³»æ•°ä¸º1ï¼‰ã€‚ ç”±äºè®­ç»ƒæ•°æ®é›†å¹¶ä¸å—æˆ‘ä»¬æ§åˆ¶ï¼Œæ‰€ä»¥ç»éªŒè¯¯å·®åªæ˜¯å…³äºæ¨¡å‹å‚æ•°çš„å‡½æ•°ã€‚ ä¸ºäº†è¿›ä¸€æ­¥è¯´æ˜ï¼Œæ¥çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ æˆ‘ä»¬ä¸ºä¸€ç»´æƒ…å†µä¸‹çš„å›å½’é—®é¢˜ç»˜åˆ¶å›¾åƒï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p><img src="/../img/Pytorch1/pytorch5/1.png" alt="1"></p><p><em>å›¾3.1.1</em> ç”¨çº¿æ€§æ¨¡å‹æ‹Ÿåˆæ•°æ®ã€‚</p><p>ç”±äºå¹³æ–¹è¯¯å·®å‡½æ•°ä¸­çš„äºŒæ¬¡æ–¹é¡¹ï¼Œ ä¼°è®¡å€¼ğ‘¦^(ğ‘–)å’Œè§‚æµ‹å€¼ğ‘¦(ğ‘–)ä¹‹é—´è¾ƒå¤§çš„å·®å¼‚å°†å¯¼è‡´æ›´å¤§çš„æŸå¤±ã€‚ ä¸ºäº†åº¦é‡æ¨¡å‹åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šçš„è´¨é‡ï¼Œæˆ‘ä»¬éœ€è®¡ç®—åœ¨è®­ç»ƒé›†ğ‘›ä¸ªæ ·æœ¬ä¸Šçš„æŸå¤±å‡å€¼ï¼ˆä¹Ÿç­‰ä»·äºæ±‚å’Œï¼‰ã€‚</p><p>(3.1.6)ğ¿(ğ‘¤,ğ‘)&#x3D;1ğ‘›âˆ‘ğ‘–&#x3D;1ğ‘›ğ‘™(ğ‘–)(ğ‘¤,ğ‘)&#x3D;1ğ‘›âˆ‘ğ‘–&#x3D;1ğ‘›12(ğ‘¤âŠ¤ğ‘¥(ğ‘–)+ğ‘âˆ’ğ‘¦(ğ‘–))2.</p><p>åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ç»„å‚æ•°ï¼ˆğ‘¤âˆ—,ğ‘âˆ—ï¼‰ï¼Œ è¿™ç»„å‚æ•°èƒ½æœ€å°åŒ–åœ¨æ‰€æœ‰è®­ç»ƒæ ·æœ¬ä¸Šçš„æ€»æŸå¤±ã€‚å¦‚ä¸‹å¼ï¼š</p><p>â€‹            ğ‘¤âˆ—,ğ‘âˆ—&#x3D;argminğ‘¤,ğ‘ ğ¿(ğ‘¤,ğ‘).</p><h4 id="è§£æè§£"><a href="#è§£æè§£" class="headerlink" title="è§£æè§£"></a>è§£æè§£</h4><p>çº¿æ€§å›å½’åˆšå¥½æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¼˜åŒ–é—®é¢˜ã€‚ ä¸æˆ‘ä»¬å°†åœ¨æœ¬ä¹¦ä¸­æ‰€è®²åˆ°çš„å…¶ä»–å¤§éƒ¨åˆ†æ¨¡å‹ä¸åŒï¼Œçº¿æ€§å›å½’çš„è§£å¯ä»¥ç”¨ä¸€ä¸ªå…¬å¼ç®€å•åœ°è¡¨è¾¾å‡ºæ¥ï¼Œ è¿™ç±»è§£å«ä½œè§£æè§£ï¼ˆanalytical solutionï¼‰ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å°†åç½®ğ‘åˆå¹¶åˆ°å‚æ•°ğ‘¤ä¸­ï¼Œåˆå¹¶æ–¹æ³•æ˜¯åœ¨åŒ…å«æ‰€æœ‰å‚æ•°çš„çŸ©é˜µä¸­é™„åŠ ä¸€åˆ—ã€‚ æˆ‘ä»¬çš„é¢„æµ‹é—®é¢˜æ˜¯æœ€å°åŒ–â€–ğ‘¦âˆ’ğ‘‹ğ‘¤â€–2ã€‚ è¿™åœ¨æŸå¤±å¹³é¢ä¸Šåªæœ‰ä¸€ä¸ªä¸´ç•Œç‚¹ï¼Œè¿™ä¸ªä¸´ç•Œç‚¹å¯¹åº”äºæ•´ä¸ªåŒºåŸŸçš„æŸå¤±æå°ç‚¹ã€‚ å°†æŸå¤±å…³äºğ‘¤çš„å¯¼æ•°è®¾ä¸º0ï¼Œå¾—åˆ°è§£æè§£ï¼š</p><p>   ğ‘¤âˆ—&#x3D;(ğ‘‹âŠ¤ğ‘‹)âˆ’1ğ‘‹âŠ¤ğ‘¦.</p><p>åƒçº¿æ€§å›å½’è¿™æ ·çš„ç®€å•é—®é¢˜å­˜åœ¨è§£æè§£ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„é—®é¢˜éƒ½å­˜åœ¨è§£æè§£ã€‚ è§£æè§£å¯ä»¥è¿›è¡Œå¾ˆå¥½çš„æ•°å­¦åˆ†æï¼Œä½†è§£æè§£å¯¹é—®é¢˜çš„é™åˆ¶å¾ˆä¸¥æ ¼ï¼Œå¯¼è‡´å®ƒæ— æ³•å¹¿æ³›åº”ç”¨åœ¨æ·±åº¦å­¦ä¹ é‡Œã€‚</p><h4 id="éšæœºæ¢¯åº¦ä¸‹é™"><a href="#éšæœºæ¢¯åº¦ä¸‹é™" class="headerlink" title="éšæœºæ¢¯åº¦ä¸‹é™"></a>éšæœºæ¢¯åº¦ä¸‹é™</h4><p>å³ä½¿åœ¨æˆ‘ä»¬æ— æ³•å¾—åˆ°è§£æè§£çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥æœ‰æ•ˆåœ°è®­ç»ƒæ¨¡å‹ã€‚ åœ¨è®¸å¤šä»»åŠ¡ä¸Šï¼Œé‚£äº›éš¾ä»¥ä¼˜åŒ–çš„æ¨¡å‹æ•ˆæœè¦æ›´å¥½ã€‚ å› æ­¤ï¼Œå¼„æ¸…æ¥šå¦‚ä½•è®­ç»ƒè¿™äº›éš¾ä»¥ä¼˜åŒ–çš„æ¨¡å‹æ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>æœ¬ä¹¦ä¸­æˆ‘ä»¬ç”¨åˆ°ä¸€ç§åä¸º<em>æ¢¯åº¦ä¸‹é™</em>ï¼ˆgradient descentï¼‰çš„æ–¹æ³•ï¼Œ è¿™ç§æ–¹æ³•å‡ ä¹å¯ä»¥ä¼˜åŒ–æ‰€æœ‰æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚ å®ƒé€šè¿‡ä¸æ–­åœ°åœ¨æŸå¤±å‡½æ•°é€’å‡çš„æ–¹å‘ä¸Šæ›´æ–°å‚æ•°æ¥é™ä½è¯¯å·®ã€‚</p><p>æ¢¯åº¦ä¸‹é™æœ€ç®€å•çš„ç”¨æ³•æ˜¯è®¡ç®—æŸå¤±å‡½æ•°ï¼ˆæ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬çš„æŸå¤±å‡å€¼ï¼‰ å…³äºæ¨¡å‹å‚æ•°çš„å¯¼æ•°ï¼ˆåœ¨è¿™é‡Œä¹Ÿå¯ä»¥ç§°ä¸ºæ¢¯åº¦ï¼‰ã€‚ ä½†å®é™…ä¸­çš„æ‰§è¡Œå¯èƒ½ä¼šéå¸¸æ…¢ï¼šå› ä¸ºåœ¨æ¯ä¸€æ¬¡æ›´æ–°å‚æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»éå†æ•´ä¸ªæ•°æ®é›†ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨æ¯æ¬¡éœ€è¦è®¡ç®—æ›´æ–°çš„æ—¶å€™éšæœºæŠ½å–ä¸€å°æ‰¹æ ·æœ¬ï¼Œ è¿™ç§å˜ä½“å«åš<em>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™</em>ï¼ˆminibatch stochastic gradient descentï¼‰ã€‚</p><p>åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéšæœºæŠ½æ ·ä¸€ä¸ªå°æ‰¹é‡ğµï¼Œ å®ƒæ˜¯ç”±å›ºå®šæ•°é‡çš„è®­ç»ƒæ ·æœ¬ç»„æˆçš„ã€‚ ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—å°æ‰¹é‡çš„å¹³å‡æŸå¤±å…³äºæ¨¡å‹å‚æ•°çš„å¯¼æ•°ï¼ˆä¹Ÿå¯ä»¥ç§°ä¸ºæ¢¯åº¦ï¼‰ã€‚ æœ€åï¼Œæˆ‘ä»¬å°†æ¢¯åº¦ä¹˜ä»¥ä¸€ä¸ªé¢„å…ˆç¡®å®šçš„æ­£æ•°ğœ‚ï¼Œå¹¶ä»å½“å‰å‚æ•°çš„å€¼ä¸­å‡æ‰ã€‚</p><p>æˆ‘ä»¬ç”¨ä¸‹é¢çš„æ•°å­¦å…¬å¼æ¥è¡¨ç¤ºè¿™ä¸€æ›´æ–°è¿‡ç¨‹ï¼ˆğœ•è¡¨ç¤ºåå¯¼æ•°ï¼‰ï¼š</p><p><img src="/../img/Pytorch1/pytorch5/2.png" alt="2"></p><p>å…¬å¼ <a href="https://zh-v2.d2l.ai/chapter_linear-networks/linear-regression.html#equation-eq-linreg-batch-update">(3.1.10)</a>ä¸­çš„ğ‘¤å’Œğ‘¥éƒ½æ˜¯å‘é‡ã€‚ åœ¨è¿™é‡Œï¼Œæ›´ä¼˜é›…çš„å‘é‡è¡¨ç¤ºæ³•æ¯”ç³»æ•°è¡¨ç¤ºæ³•ï¼ˆå¦‚ğ‘¤1,ğ‘¤2,â€¦,ğ‘¤ğ‘‘ï¼‰æ›´å…·å¯è¯»æ€§ã€‚ |ğµ|è¡¨ç¤ºæ¯ä¸ªå°æ‰¹é‡ä¸­çš„æ ·æœ¬æ•°ï¼Œè¿™ä¹Ÿç§°ä¸º<em>æ‰¹é‡å¤§å°</em>ï¼ˆbatch sizeï¼‰ã€‚ ğœ‚è¡¨ç¤º<em>å­¦ä¹ ç‡</em>ï¼ˆlearning rateï¼‰ã€‚ æ‰¹é‡å¤§å°å’Œå­¦ä¹ ç‡çš„å€¼é€šå¸¸æ˜¯æ‰‹åŠ¨é¢„å…ˆæŒ‡å®šï¼Œè€Œä¸æ˜¯é€šè¿‡æ¨¡å‹è®­ç»ƒå¾—åˆ°çš„ã€‚ è¿™äº›å¯ä»¥è°ƒæ•´ä½†ä¸åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ›´æ–°çš„å‚æ•°ç§°ä¸º<em>è¶…å‚æ•°</em>ï¼ˆhyperparameterï¼‰ã€‚ <em>è°ƒå‚</em>ï¼ˆhyperparameter tuningï¼‰æ˜¯é€‰æ‹©è¶…å‚æ•°çš„è¿‡ç¨‹ã€‚ è¶…å‚æ•°é€šå¸¸æ˜¯æˆ‘ä»¬æ ¹æ®è®­ç»ƒè¿­ä»£ç»“æœæ¥è°ƒæ•´çš„ï¼Œ è€Œè®­ç»ƒè¿­ä»£ç»“æœæ˜¯åœ¨ç‹¬ç«‹çš„<em>éªŒè¯æ•°æ®é›†</em>ï¼ˆvalidation datasetï¼‰ä¸Šè¯„ä¼°å¾—åˆ°çš„ã€‚</p><p>åœ¨è®­ç»ƒäº†é¢„å…ˆç¡®å®šçš„è‹¥å¹²è¿­ä»£æ¬¡æ•°åï¼ˆæˆ–è€…ç›´åˆ°æ»¡è¶³æŸäº›å…¶ä»–åœæ­¢æ¡ä»¶åï¼‰ï¼Œ æˆ‘ä»¬è®°å½•ä¸‹æ¨¡å‹å‚æ•°çš„ä¼°è®¡å€¼ï¼Œè¡¨ç¤ºä¸ºğ‘¤^,ğ‘^ã€‚ ä½†æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬çš„å‡½æ•°ç¡®å®æ˜¯çº¿æ€§çš„ä¸”æ— å™ªå£°ï¼Œè¿™äº›ä¼°è®¡å€¼ä¹Ÿä¸ä¼šä½¿æŸå¤±å‡½æ•°çœŸæ­£åœ°è¾¾åˆ°æœ€å°å€¼ã€‚ å› ä¸ºç®—æ³•ä¼šä½¿å¾—æŸå¤±å‘æœ€å°å€¼ç¼“æ…¢æ”¶æ•›ï¼Œä½†å´ä¸èƒ½åœ¨æœ‰é™çš„æ­¥æ•°å†…éå¸¸ç²¾ç¡®åœ°è¾¾åˆ°æœ€å°å€¼ã€‚</p><p>çº¿æ€§å›å½’æ°å¥½æ˜¯ä¸€ä¸ªåœ¨æ•´ä¸ªåŸŸä¸­åªæœ‰ä¸€ä¸ªæœ€å°å€¼çš„å­¦ä¹ é—®é¢˜ã€‚ ä½†æ˜¯å¯¹åƒæ·±åº¦ç¥ç»ç½‘ç»œè¿™æ ·å¤æ‚çš„æ¨¡å‹æ¥è¯´ï¼ŒæŸå¤±å¹³é¢ä¸Šé€šå¸¸åŒ…å«å¤šä¸ªæœ€å°å€¼ã€‚ æ·±åº¦å­¦ä¹ å®è·µè€…å¾ˆå°‘ä¼šå»èŠ±è´¹å¤§åŠ›æ°”å¯»æ‰¾è¿™æ ·ä¸€ç»„å‚æ•°ï¼Œä½¿å¾—åœ¨<em>è®­ç»ƒé›†</em>ä¸Šçš„æŸå¤±è¾¾åˆ°æœ€å°ã€‚ äº‹å®ä¸Šï¼Œæ›´éš¾åšåˆ°çš„æ˜¯æ‰¾åˆ°ä¸€ç»„å‚æ•°ï¼Œè¿™ç»„å‚æ•°èƒ½å¤Ÿåœ¨æˆ‘ä»¬ä»æœªè§è¿‡çš„æ•°æ®ä¸Šå®ç°è¾ƒä½çš„æŸå¤±ï¼Œ è¿™ä¸€æŒ‘æˆ˜è¢«ç§°ä¸º<em>æ³›åŒ–</em>ï¼ˆgeneralizationï¼‰ã€‚</p><h4 id="ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹"><a href="#ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹" class="headerlink" title="ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹"></a>ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹</h4><p>ç»™å®šâ€œå·²å­¦ä¹ â€çš„çº¿æ€§å›å½’æ¨¡å‹ğ‘¤^âŠ¤ğ‘¥+ğ‘^ï¼Œ ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡æˆ¿å±‹é¢ç§¯ğ‘¥1å’Œæˆ¿é¾„ğ‘¥2æ¥ä¼°è®¡ä¸€ä¸ªï¼ˆæœªåŒ…å«åœ¨è®­ç»ƒæ•°æ®ä¸­çš„ï¼‰æ–°æˆ¿å±‹ä»·æ ¼ã€‚ ç»™å®šç‰¹å¾ä¼°è®¡ç›®æ ‡çš„è¿‡ç¨‹é€šå¸¸ç§°ä¸º<em>é¢„æµ‹</em>ï¼ˆpredictionï¼‰æˆ–<em>æ¨æ–­</em>ï¼ˆinferenceï¼‰ã€‚</p><h3 id="çŸ¢é‡åŒ–åŠ é€Ÿ"><a href="#çŸ¢é‡åŒ–åŠ é€Ÿ" class="headerlink" title="çŸ¢é‡åŒ–åŠ é€Ÿ"></a>çŸ¢é‡åŒ–åŠ é€Ÿ</h3><p>åœ¨è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸å¸Œæœ›èƒ½å¤ŸåŒæ—¶å¤„ç†æ•´ä¸ªå°æ‰¹é‡çš„æ ·æœ¬ã€‚ ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œéœ€è¦æˆ‘ä»¬å¯¹è®¡ç®—è¿›è¡ŒçŸ¢é‡åŒ–ï¼Œ ä»è€Œåˆ©ç”¨çº¿æ€§ä»£æ•°åº“ï¼Œè€Œä¸æ˜¯åœ¨Pythonä¸­ç¼–å†™å¼€é”€é«˜æ˜‚çš„forå¾ªç¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è¯´æ˜çŸ¢é‡åŒ–ä¸ºä»€ä¹ˆå¦‚æ­¤é‡è¦ï¼Œæˆ‘ä»¬è€ƒè™‘å¯¹å‘é‡ç›¸åŠ çš„ä¸¤ç§æ–¹æ³•ã€‚ æˆ‘ä»¬å®ä¾‹åŒ–ä¸¤ä¸ªå…¨ä¸º1çš„10000ç»´å‘é‡ã€‚ åœ¨ä¸€ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Pythonçš„forå¾ªç¯éå†å‘é‡ï¼› åœ¨å¦ä¸€ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†ä¾èµ–å¯¹<code>+</code>çš„è°ƒç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">10000</span></span><br><span class="line">a = torch.ones([n])</span><br><span class="line">b = torch.ones([n])</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬å°†é¢‘ç¹åœ°è¿›è¡Œè¿è¡Œæ—¶é—´çš„åŸºå‡†æµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè®¡æ—¶å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Timer</span>:  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®°å½•å¤šæ¬¡è¿è¡Œæ—¶é—´&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.times = []</span><br><span class="line">        self.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¯åŠ¨è®¡æ—¶å™¨&quot;&quot;&quot;</span></span><br><span class="line">        self.tik = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åœæ­¢è®¡æ—¶å™¨å¹¶å°†æ—¶é—´è®°å½•åœ¨åˆ—è¡¨ä¸­&quot;&quot;&quot;</span></span><br><span class="line">        self.times.append(time.time() - self.tik)</span><br><span class="line">        <span class="keyword">return</span> self.times[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">avg</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿”å›å¹³å‡æ—¶é—´&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times) / <span class="built_in">len</span>(self.times)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿”å›æ—¶é—´æ€»å’Œ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(self.times)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cumsum</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿”å›ç´¯è®¡æ—¶é—´&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> np.array(self.times).cumsum().tolist()</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¯¹å·¥ä½œè´Ÿè½½è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨forå¾ªç¯ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€ä½çš„åŠ æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">c = torch.zeros(n)</span><br><span class="line">timer = Timer()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    c[i] = a[i] + b[i]</span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.5</span>f&#125;</span> sec&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;0.16749 sec&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œæˆ‘ä»¬ä½¿ç”¨é‡è½½çš„<code>+</code>è¿ç®—ç¬¦æ¥è®¡ç®—æŒ‰å…ƒç´ çš„å’Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">timer.start()</span><br><span class="line">d = a + b</span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.5</span>f&#125;</span> sec&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;0.00042 sec&#x27;</span></span><br></pre></td></tr></table></figure><p>ç»“æœå¾ˆæ˜æ˜¾ï¼Œç¬¬äºŒç§æ–¹æ³•æ¯”ç¬¬ä¸€ç§æ–¹æ³•å¿«å¾—å¤šã€‚ çŸ¢é‡åŒ–ä»£ç é€šå¸¸ä¼šå¸¦æ¥æ•°é‡çº§çš„åŠ é€Ÿã€‚ å¦å¤–ï¼Œæˆ‘ä»¬å°†æ›´å¤šçš„æ•°å­¦è¿ç®—æ”¾åˆ°åº“ä¸­ï¼Œè€Œæ— é¡»è‡ªå·±ç¼–å†™é‚£ä¹ˆå¤šçš„è®¡ç®—ï¼Œä»è€Œå‡å°‘äº†å‡ºé”™çš„å¯èƒ½æ€§</p><h3 id="æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±"><a href="#æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±" class="headerlink" title="æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±"></a>æ­£æ€åˆ†å¸ƒä¸å¹³æ–¹æŸå¤±</h3><p>å®šä¹‰ä¸€ä¸ªPythonå‡½æ•°æ¥è®¡ç®—æ­£æ€åˆ†å¸ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">normal</span>(<span class="params">x, mu, sigma</span>):</span><br><span class="line">    p = <span class="number">1</span> / math.sqrt(<span class="number">2</span> * math.pi * sigma**<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> p * np.exp(-<span class="number">0.5</span> / sigma**<span class="number">2</span> * (x - mu)**<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>å¯è§†åŒ–æ­£æ€åˆ†å¸ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†æ¬¡ä½¿ç”¨numpyè¿›è¡Œå¯è§†åŒ–</span></span><br><span class="line">x = np.arange(-<span class="number">7</span>, <span class="number">7</span>, <span class="number">0.01</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡å€¼å’Œæ ‡å‡†å·®å¯¹</span></span><br><span class="line">params = [(<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">2</span>), (<span class="number">3</span>, <span class="number">1</span>)]</span><br><span class="line">d2l.plot(x, [normal(x, mu, sigma) <span class="keyword">for</span> mu, sigma <span class="keyword">in</span> params], xlabel=<span class="string">&#x27;x&#x27;</span>,</span><br><span class="line">         ylabel=<span class="string">&#x27;p(x)&#x27;</span>, figsize=(<span class="number">4.5</span>, <span class="number">2.5</span>),</span><br><span class="line">         legend=[<span class="string">f&#x27;mean <span class="subst">&#123;mu&#125;</span>, std <span class="subst">&#123;sigma&#125;</span>&#x27;</span> <span class="keyword">for</span> mu, sigma <span class="keyword">in</span> params])</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch5/3.png" alt="3"></p><h2 id="çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°"><a href="#çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°"></a>çº¿æ€§å›å½’çš„ä»é›¶å¼€å§‹å®ç°</h2><p>ä»é›¶å¼€å§‹å®ç°æ•´ä¸ªæ–¹æ³•ï¼Œ åŒ…æ‹¬æ•°æ®æµæ°´çº¿ã€æ¨¡å‹ã€æŸå¤±å‡½æ•°å’Œå°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ä¼˜åŒ–å™¨ã€‚ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br></pre></td></tr></table></figure><p>æ ¹æ®å¸¦æœ‰å™ªå£°çš„çº¿æ€§æ¨¡å‹æ„é€ ä¸€ä¸ªäººé€ æ•°æ®é›†ã€‚ æˆ‘ä»¬çš„ä»»åŠ¡æ˜¯ä½¿ç”¨è¿™ä¸ªæœ‰é™æ ·æœ¬çš„æ•°æ®é›†æ¥æ¢å¤è¿™ä¸ªæ¨¡å‹çš„å‚æ•°ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ä½ç»´æ•°æ®ï¼Œè¿™æ ·å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å…¶å¯è§†åŒ–ã€‚ åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªåŒ…å«1000ä¸ªæ ·æœ¬çš„æ•°æ®é›†ï¼Œ æ¯ä¸ªæ ·æœ¬åŒ…å«ä»æ ‡å‡†æ­£æ€åˆ†å¸ƒä¸­é‡‡æ ·çš„2ä¸ªç‰¹å¾ã€‚ æˆ‘ä»¬çš„åˆæˆæ•°æ®é›†æ˜¯ä¸€ä¸ªçŸ©é˜µğ‘‹âˆˆğ‘…1000Ã—2ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨çº¿æ€§æ¨¡å‹å‚æ•°<strong>ğ‘¤&#x3D;[2,âˆ’3.4]âŠ¤ã€ğ‘&#x3D;4.2 å’Œå™ªå£°é¡¹ğœ–</strong>ç”Ÿæˆæ•°æ®é›†åŠå…¶æ ‡ç­¾ï¼š</p><p>(3.2.1)ğ‘¦&#x3D;ğ‘‹ğ‘¤+ğ‘+ğœ–.</p><p>ğœ–å¯ä»¥è§†ä¸ºæ¨¡å‹é¢„æµ‹å’Œæ ‡ç­¾æ—¶çš„æ½œåœ¨è§‚æµ‹è¯¯å·®ã€‚ åœ¨è¿™é‡Œæˆ‘ä»¬è®¤ä¸ºæ ‡å‡†å‡è®¾æˆç«‹ï¼Œå³ğœ–æœä»å‡å€¼ä¸º0çš„æ­£æ€åˆ†å¸ƒã€‚ ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬å°†æ ‡å‡†å·®è®¾ä¸º0.01ã€‚ ä¸‹é¢çš„ä»£ç ç”Ÿæˆåˆæˆæ•°æ®é›†ã€‚</p><h3 id="ç”Ÿæˆæ•°æ®é›†"><a href="#ç”Ÿæˆæ•°æ®é›†" class="headerlink" title="ç”Ÿæˆæ•°æ®é›†"></a>ç”Ÿæˆæ•°æ®é›†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">synthetic_data</span>(<span class="params">w, b, num_examples</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç”Ÿæˆy=Xw+b+å™ªå£°&quot;&quot;&quot;</span></span><br><span class="line">    X = torch.normal(<span class="number">0</span>, <span class="number">1</span>, (num_examples, <span class="built_in">len</span>(w)))</span><br><span class="line">    y = torch.matmul(X, w) + b</span><br><span class="line">    y += torch.normal(<span class="number">0</span>, <span class="number">0.01</span>, y.shape)</span><br><span class="line">    <span class="keyword">return</span> X, y.reshape((-<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">true_w = torch.tensor([<span class="number">2</span>, -<span class="number">3.4</span>])</span><br><span class="line">true_b = <span class="number">4.2</span></span><br><span class="line">features, labels = synthetic_data(true_w, true_b, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œ<code>features</code>ä¸­çš„æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªäºŒç»´æ•°æ®æ ·æœ¬ï¼Œ <code>labels</code>ä¸­çš„æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ç»´æ ‡ç­¾å€¼ï¼ˆä¸€ä¸ªæ ‡é‡ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;features:&#x27;</span>, features[<span class="number">0</span>],<span class="string">&#x27;\nlabel:&#x27;</span>, labels[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">features: tensor([<span class="number">1.4632</span>, <span class="number">0.5511</span>])</span><br><span class="line">label: tensor([<span class="number">5.2498</span>])</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç”Ÿæˆç¬¬äºŒä¸ªç‰¹å¾<code>features[:, 1]</code>å’Œ<code>labels</code>çš„æ•£ç‚¹å›¾ï¼Œ å¯ä»¥ç›´è§‚è§‚å¯Ÿåˆ°ä¸¤è€…ä¹‹é—´çš„çº¿æ€§å…³ç³»ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d2l.set_figsize()</span><br><span class="line">d2l.plt.scatter(features[:, (<span class="number">1</span>)].detach().numpy(), labels.detach().numpy(), <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch5/4.png" alt="4"></p><h3 id="è¯»å–æ•°æ®é›†"><a href="#è¯»å–æ•°æ®é›†" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h3><p>å®šä¹‰ä¸€ä¸ª<code>data_iter</code>å‡½æ•°ï¼Œ è¯¥å‡½æ•°æ¥æ”¶æ‰¹é‡å¤§å°ã€ç‰¹å¾çŸ©é˜µå’Œæ ‡ç­¾å‘é‡ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆå¤§å°ä¸º<code>batch_size</code>çš„å°æ‰¹é‡ã€‚ æ¯ä¸ªå°æ‰¹é‡åŒ…å«ä¸€ç»„ç‰¹å¾å’Œæ ‡ç­¾ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">data_iter</span>(<span class="params">batch_size, features, labels</span>):</span><br><span class="line">    num_examples = <span class="built_in">len</span>(features)</span><br><span class="line">    indices = <span class="built_in">list</span>(<span class="built_in">range</span>(num_examples))</span><br><span class="line">    <span class="comment"># è¿™äº›æ ·æœ¬æ˜¯éšæœºè¯»å–çš„ï¼Œæ²¡æœ‰ç‰¹å®šçš„é¡ºåº</span></span><br><span class="line">    random.shuffle(indices)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, num_examples, batch_size):</span><br><span class="line">        batch_indices = torch.tensor(</span><br><span class="line">            indices[i: <span class="built_in">min</span>(i + batch_size, num_examples)])</span><br><span class="line">        <span class="keyword">yield</span> features[batch_indices], labels[batch_indices]</span><br></pre></td></tr></table></figure><p>æ„Ÿå—ä¸€ä¸‹å°æ‰¹é‡è¿ç®—ï¼šè¯»å–ç¬¬ä¸€ä¸ªå°æ‰¹é‡æ•°æ®æ ·æœ¬å¹¶æ‰“å°ã€‚ æ¯ä¸ªæ‰¹é‡çš„ç‰¹å¾ç»´åº¦æ˜¾ç¤ºæ‰¹é‡å¤§å°å’Œè¾“å…¥ç‰¹å¾æ•°ã€‚ åŒæ ·çš„ï¼Œæ‰¹é‡çš„æ ‡ç­¾å½¢çŠ¶ä¸<code>batch_size</code>ç›¸ç­‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter(batch_size, features, labels):</span><br><span class="line">    <span class="built_in">print</span>(X, <span class="string">&#x27;\n&#x27;</span>, y)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">0.3934</span>,  <span class="number">2.5705</span>],</span><br><span class="line">        [ <span class="number">0.5849</span>, -<span class="number">0.7124</span>],</span><br><span class="line">        [ <span class="number">0.1008</span>,  <span class="number">0.6947</span>],</span><br><span class="line">        [-<span class="number">0.4493</span>, -<span class="number">0.9037</span>],</span><br><span class="line">        [ <span class="number">2.3104</span>, -<span class="number">0.2798</span>],</span><br><span class="line">        [-<span class="number">0.0173</span>, -<span class="number">0.2552</span>],</span><br><span class="line">        [ <span class="number">0.1963</span>, -<span class="number">0.5445</span>],</span><br><span class="line">        [-<span class="number">1.0580</span>, -<span class="number">0.5180</span>],</span><br><span class="line">        [ <span class="number">0.8417</span>, -<span class="number">1.5547</span>],</span><br><span class="line">        [-<span class="number">0.6316</span>,  <span class="number">0.9732</span>]])</span><br><span class="line"> tensor([[-<span class="number">3.7623</span>],</span><br><span class="line">        [ <span class="number">7.7852</span>],</span><br><span class="line">        [ <span class="number">2.0443</span>],</span><br><span class="line">        [ <span class="number">6.3767</span>],</span><br><span class="line">        [ <span class="number">9.7776</span>],</span><br><span class="line">        [ <span class="number">5.0301</span>],</span><br><span class="line">        [ <span class="number">6.4541</span>],</span><br><span class="line">        [ <span class="number">3.8407</span>],</span><br><span class="line">        [<span class="number">11.1396</span>],</span><br><span class="line">        [-<span class="number">0.3836</span>]])</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h3><p>æˆ‘ä»¬é€šè¿‡ä»å‡å€¼ä¸º0ã€æ ‡å‡†å·®ä¸º0.01çš„æ­£æ€åˆ†å¸ƒä¸­é‡‡æ ·éšæœºæ•°æ¥åˆå§‹åŒ–æƒé‡ï¼Œ å¹¶å°†åç½®åˆå§‹åŒ–ä¸º0ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">w = torch.normal(<span class="number">0</span>, <span class="number">0.01</span>, size=(<span class="number">2</span>,<span class="number">1</span>), requires_grad=<span class="literal">True</span>)</span><br><span class="line">b = torch.zeros(<span class="number">1</span>, requires_grad=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>åœ¨åˆå§‹åŒ–å‚æ•°ä¹‹åï¼Œæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯æ›´æ–°è¿™äº›å‚æ•°ï¼Œç›´åˆ°è¿™äº›å‚æ•°è¶³å¤Ÿæ‹Ÿåˆæˆ‘ä»¬çš„æ•°æ®ã€‚ æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦è®¡ç®—æŸå¤±å‡½æ•°å…³äºæ¨¡å‹å‚æ•°çš„æ¢¯åº¦ã€‚ æœ‰äº†è¿™ä¸ªæ¢¯åº¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘å‡å°æŸå¤±çš„æ–¹å‘æ›´æ–°æ¯ä¸ªå‚æ•°ã€‚ å› ä¸ºæ‰‹åŠ¨è®¡ç®—æ¢¯åº¦å¾ˆæ¯ç‡¥è€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥æ²¡æœ‰äººä¼šæ‰‹åŠ¨è®¡ç®—æ¢¯åº¦ã€‚ æˆ‘ä»¬ä½¿ç”¨è‡ªåŠ¨å¾®åˆ†ç« èŠ‚ä¸­å¼•å…¥çš„è‡ªåŠ¨å¾®åˆ†æ¥è®¡ç®—æ¢¯åº¦ã€‚</p><h3 id="å®šä¹‰æ¨¡å‹"><a href="#å®šä¹‰æ¨¡å‹" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">linreg</span>(<span class="params">X, w, b</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;çº¿æ€§å›å½’æ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> torch.matmul(X, w) + b</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æŸå¤±å‡½æ•°"><a href="#å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">squared_loss</span>(<span class="params">y_hat, y</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;å‡æ–¹æŸå¤±&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (y_hat - y.reshape(y_hat.shape)) ** <span class="number">2</span> / <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰ä¼˜åŒ–ç®—æ³•"><a href="#å®šä¹‰ä¼˜åŒ–ç®—æ³•" class="headerlink" title="å®šä¹‰ä¼˜åŒ–ç®—æ³•"></a>å®šä¹‰ä¼˜åŒ–ç®—æ³•</h3><p>åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œä½¿ç”¨ä»æ•°æ®é›†ä¸­éšæœºæŠ½å–çš„ä¸€ä¸ªå°æ‰¹é‡ï¼Œç„¶åæ ¹æ®å‚æ•°è®¡ç®—æŸå¤±çš„æ¢¯åº¦ã€‚ æ¥ä¸‹æ¥ï¼Œæœç€å‡å°‘æŸå¤±çš„æ–¹å‘æ›´æ–°æˆ‘ä»¬çš„å‚æ•°ã€‚ ä¸‹é¢çš„å‡½æ•°å®ç°å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™æ›´æ–°ã€‚ è¯¥å‡½æ•°æ¥å—æ¨¡å‹å‚æ•°é›†åˆã€å­¦ä¹ é€Ÿç‡å’Œæ‰¹é‡å¤§å°ä½œä¸ºè¾“å…¥ã€‚æ¯ ä¸€æ­¥æ›´æ–°çš„å¤§å°ç”±å­¦ä¹ é€Ÿç‡<code>lr</code>å†³å®šã€‚ å› ä¸ºæˆ‘ä»¬è®¡ç®—çš„æŸå¤±æ˜¯ä¸€ä¸ªæ‰¹é‡æ ·æœ¬çš„æ€»å’Œï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨æ‰¹é‡å¤§å°ï¼ˆ<code>batch_size</code>ï¼‰ æ¥è§„èŒƒåŒ–æ­¥é•¿ï¼Œè¿™æ ·æ­¥é•¿å¤§å°å°±ä¸ä¼šå–å†³äºæˆ‘ä»¬å¯¹æ‰¹é‡å¤§å°çš„é€‰æ‹©ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sgd</span>(<span class="params">params, lr, batch_size</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> params:</span><br><span class="line">            param -= lr * param.grad / batch_size</span><br><span class="line">            param.grad.zero_()</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><p>åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬è¯»å–ä¸€å°æ‰¹é‡è®­ç»ƒæ ·æœ¬ï¼Œå¹¶é€šè¿‡æˆ‘ä»¬çš„æ¨¡å‹æ¥è·å¾—ä¸€ç»„é¢„æµ‹ã€‚ è®¡ç®—å®ŒæŸå¤±åï¼Œæˆ‘ä»¬å¼€å§‹åå‘ä¼ æ’­ï¼Œå­˜å‚¨æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦ã€‚ æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨ä¼˜åŒ–ç®—æ³•<code>sgd</code>æ¥æ›´æ–°æ¨¡å‹å‚æ•°ã€‚</p><p>æˆ‘ä»¬å°†æ‰§è¡Œä»¥ä¸‹å¾ªç¯ï¼š</p><p><img src="/../img/Pytorch1/pytorch5/5.png" alt="5"></p><p>åœ¨æ¯ä¸ª<em>è¿­ä»£å‘¨æœŸ</em>ï¼ˆepochï¼‰ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>data_iter</code>å‡½æ•°éå†æ•´ä¸ªæ•°æ®é›†ï¼Œ å¹¶å°†è®­ç»ƒæ•°æ®é›†ä¸­æ‰€æœ‰æ ·æœ¬éƒ½ä½¿ç”¨ä¸€æ¬¡ï¼ˆå‡è®¾æ ·æœ¬æ•°èƒ½å¤Ÿè¢«æ‰¹é‡å¤§å°æ•´é™¤ï¼‰ã€‚ è¿™é‡Œçš„è¿­ä»£å‘¨æœŸä¸ªæ•°<code>num_epochs</code>å’Œå­¦ä¹ ç‡<code>lr</code>éƒ½æ˜¯è¶…å‚æ•°ï¼Œåˆ†åˆ«è®¾ä¸º3å’Œ0.03ã€‚ è®¾ç½®è¶…å‚æ•°å¾ˆæ£˜æ‰‹ï¼Œéœ€è¦é€šè¿‡åå¤è¯•éªŒè¿›è¡Œè°ƒæ•´ã€‚ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lr = <span class="number">0.03</span></span><br><span class="line">num_epochs = <span class="number">3</span></span><br><span class="line">net = linreg</span><br><span class="line">loss = squared_loss</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter(batch_size, features, labels):</span><br><span class="line">        l = loss(net(X, w, b), y)  <span class="comment"># Xå’Œyçš„å°æ‰¹é‡æŸå¤±</span></span><br><span class="line">        <span class="comment"># å› ä¸ºlå½¢çŠ¶æ˜¯(batch_size,1)ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ ‡é‡ã€‚lä¸­çš„æ‰€æœ‰å…ƒç´ è¢«åŠ åˆ°ä¸€èµ·ï¼Œ</span></span><br><span class="line">        <span class="comment"># å¹¶ä»¥æ­¤è®¡ç®—å…³äº[w,b]çš„æ¢¯åº¦</span></span><br><span class="line">        l.<span class="built_in">sum</span>().backward()</span><br><span class="line">        sgd([w, b], lr, batch_size)  <span class="comment"># ä½¿ç”¨å‚æ•°çš„æ¢¯åº¦æ›´æ–°å‚æ•°</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        train_l = loss(net(features, w, b), labels)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;epoch <span class="subst">&#123;epoch + <span class="number">1</span>&#125;</span>, loss <span class="subst">&#123;<span class="built_in">float</span>(train_l.mean()):f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">epoch <span class="number">1</span>, loss <span class="number">0.042790</span></span><br><span class="line">epoch <span class="number">2</span>, loss <span class="number">0.000162</span></span><br><span class="line">epoch <span class="number">3</span>, loss <span class="number">0.000051</span></span><br></pre></td></tr></table></figure><p>è®¡ç®—è¯¯å·®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;wçš„ä¼°è®¡è¯¯å·®: <span class="subst">&#123;true_w - w.reshape(true_w.shape)&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;bçš„ä¼°è®¡è¯¯å·®: <span class="subst">&#123;true_b - b&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wçš„ä¼°è®¡è¯¯å·®: tensor([-<span class="number">1.3804e-04</span>,  <span class="number">5.7936e-05</span>], grad_fn=&lt;SubBackward0&gt;)</span><br><span class="line">bçš„ä¼°è®¡è¯¯å·®: tensor([<span class="number">0.0006</span>], grad_fn=&lt;RsubBackward1&gt;)</span><br></pre></td></tr></table></figure><h2 id="çº¿æ€§å›å½’çš„Pytorchå®ç°"><a href="#çº¿æ€§å›å½’çš„Pytorchå®ç°" class="headerlink" title="çº¿æ€§å›å½’çš„Pytorchå®ç°"></a>çº¿æ€§å›å½’çš„Pytorchå®ç°</h2><h3 id="ç”Ÿæˆæ•°æ®é›†-1"><a href="#ç”Ÿæˆæ•°æ®é›†-1" class="headerlink" title="ç”Ÿæˆæ•°æ®é›†"></a>ç”Ÿæˆæ•°æ®é›†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils <span class="keyword">import</span> data</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">true_w = torch.tensor([<span class="number">2</span>, -<span class="number">3.4</span>])</span><br><span class="line">true_b = <span class="number">4.2</span></span><br><span class="line">features, labels = d2l.synthetic_data(true_w, true_b, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h3 id="è¯»å–æ•°æ®é›†-1"><a href="#è¯»å–æ•°æ®é›†-1" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h3><p>è°ƒç”¨æ¡†æ¶ä¸­ç°æœ‰çš„APIæ¥è¯»å–æ•°æ®ã€‚ æˆ‘ä»¬å°†<code>features</code>å’Œ<code>labels</code>ä½œä¸ºAPIçš„å‚æ•°ä¼ é€’ï¼Œå¹¶é€šè¿‡æ•°æ®è¿­ä»£å™¨æŒ‡å®š<code>batch_size</code>ã€‚ æ­¤å¤–ï¼Œå¸ƒå°”å€¼<code>is_train</code>è¡¨ç¤ºæ˜¯å¦å¸Œæœ›æ•°æ®è¿­ä»£å™¨å¯¹è±¡åœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸå†…æ‰“ä¹±æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_array</span>(<span class="params">data_arrays, batch_size, is_train=<span class="literal">True</span></span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ„é€ ä¸€ä¸ªPyTorchæ•°æ®è¿­ä»£å™¨&quot;&quot;&quot;</span></span><br><span class="line">    dataset = data.TensorDataset(*data_arrays)</span><br><span class="line">    <span class="keyword">return</span> data.DataLoader(dataset, batch_size, shuffle=is_train)</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">10</span></span><br><span class="line">data_iter = load_array((features, labels), batch_size)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>data_iter</code>çš„æ–¹å¼ä¸æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨<code>data_iter</code>å‡½æ•°çš„æ–¹å¼ç›¸åŒã€‚ä¸ºäº†éªŒè¯æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œè®©æˆ‘ä»¬è¯»å–å¹¶æ‰“å°ç¬¬ä¸€ä¸ªå°æ‰¹é‡æ ·æœ¬ã€‚ ä¸ ä¹‹å‰ä¸åŒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>iter</code>æ„é€ Pythonè¿­ä»£å™¨ï¼Œå¹¶ä½¿ç”¨<code>next</code>ä»è¿­ä»£å™¨ä¸­è·å–ç¬¬ä¸€é¡¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(data_iter))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[tensor([[-<span class="number">1.3116</span>, -<span class="number">0.3062</span>],</span><br><span class="line">         [-<span class="number">1.5653</span>,  <span class="number">0.4830</span>],</span><br><span class="line">         [-<span class="number">0.8893</span>, -<span class="number">0.9466</span>],</span><br><span class="line">         [-<span class="number">1.2417</span>,  <span class="number">1.6891</span>],</span><br><span class="line">         [-<span class="number">0.7148</span>,  <span class="number">0.1376</span>],</span><br><span class="line">         [-<span class="number">0.2162</span>, -<span class="number">0.6122</span>],</span><br><span class="line">         [ <span class="number">2.4048</span>, -<span class="number">0.3211</span>],</span><br><span class="line">         [-<span class="number">0.1516</span>,  <span class="number">0.4997</span>],</span><br><span class="line">         [ <span class="number">1.5298</span>, -<span class="number">0.2291</span>],</span><br><span class="line">         [ <span class="number">1.3895</span>,  <span class="number">1.2602</span>]]),</span><br><span class="line"> tensor([[ <span class="number">2.6073</span>],</span><br><span class="line">         [-<span class="number">0.5787</span>],</span><br><span class="line">         [ <span class="number">5.6339</span>],</span><br><span class="line">         [-<span class="number">4.0211</span>],</span><br><span class="line">         [ <span class="number">2.3117</span>],</span><br><span class="line">         [ <span class="number">5.8492</span>],</span><br><span class="line">         [<span class="number">10.0926</span>],</span><br><span class="line">         [ <span class="number">2.1932</span>],</span><br><span class="line">         [ <span class="number">8.0441</span>],</span><br><span class="line">         [ <span class="number">2.6943</span>]])]</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æ¨¡å‹-1"><a href="#å®šä¹‰æ¨¡å‹-1" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><p>å½“æˆ‘ä»¬åœ¨ä¹‹å‰ä¸­å®ç°çº¿æ€§å›å½’æ—¶ï¼Œ æˆ‘ä»¬æ˜ç¡®å®šä¹‰äº†æ¨¡å‹å‚æ•°å˜é‡ï¼Œå¹¶ç¼–å†™äº†è®¡ç®—çš„ä»£ç ï¼Œè¿™æ ·é€šè¿‡åŸºæœ¬çš„çº¿æ€§ä»£æ•°è¿ç®—å¾—åˆ°è¾“å‡ºã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ¨¡å‹å˜å¾—æ›´åŠ å¤æ‚ï¼Œä¸”å½“æˆ‘ä»¬å‡ ä¹æ¯å¤©éƒ½éœ€è¦å®ç°æ¨¡å‹æ—¶ï¼Œè‡ªç„¶ä¼šæƒ³ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚ è¿™ç§æƒ…å†µç±»ä¼¼äºä¸ºè‡ªå·±çš„åšå®¢ä»é›¶å¼€å§‹ç¼–å†™ç½‘é¡µã€‚ åšä¸€ä¸¤æ¬¡æ˜¯æœ‰ç›Šçš„ï¼Œä½†å¦‚æœæ¯ä¸ªæ–°åšå®¢å°±éœ€è¦å·¥ç¨‹å¸ˆèŠ±ä¸€ä¸ªæœˆçš„æ—¶é—´é‡æ–°å¼€å§‹ç¼–å†™ç½‘é¡µï¼Œé‚£å¹¶ä¸é«˜æ•ˆã€‚</p><p>å¯¹äºæ ‡å‡†æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¡†æ¶çš„é¢„å®šä¹‰å¥½çš„å±‚ã€‚è¿™ä½¿æˆ‘ä»¬åªéœ€å…³æ³¨ä½¿ç”¨å“ªäº›å±‚æ¥æ„é€ æ¨¡å‹ï¼Œè€Œä¸å¿…å…³æ³¨å±‚çš„å®ç°ç»†èŠ‚ã€‚ æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¨¡å‹å˜é‡<code>net</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ª<code>Sequential</code>ç±»çš„å®ä¾‹ã€‚ <code>Sequential</code>ç±»å°†å¤šä¸ªå±‚ä¸²è”åœ¨ä¸€èµ·ã€‚ å½“ç»™å®šè¾“å…¥æ•°æ®æ—¶ï¼Œ<code>Sequential</code>å®ä¾‹å°†æ•°æ®ä¼ å…¥åˆ°ç¬¬ä¸€å±‚ï¼Œ ç„¶åå°†ç¬¬ä¸€å±‚çš„è¾“å‡ºä½œä¸ºç¬¬äºŒå±‚çš„è¾“å…¥ï¼Œä»¥æ­¤ç±»æ¨ã€‚ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„æ¨¡å‹åªåŒ…å«ä¸€ä¸ªå±‚ï¼Œå› æ­¤å®é™…ä¸Šä¸éœ€è¦<code>Sequential</code>ã€‚ ä½†æ˜¯ç”±äºä»¥åå‡ ä¹æ‰€æœ‰çš„æ¨¡å‹éƒ½æ˜¯å¤šå±‚çš„ï¼Œåœ¨è¿™é‡Œä½¿ç”¨<code>Sequential</code>ä¼šè®©ä½ ç†Ÿæ‚‰â€œæ ‡å‡†çš„æµæ°´çº¿â€ã€‚</p><p>å›é¡¾ä¹‹å‰ä¸­çš„å•å±‚ç½‘ç»œæ¶æ„ï¼Œ è¿™ä¸€å•å±‚è¢«ç§°ä¸º<em>å…¨è¿æ¥å±‚</em>ï¼ˆfully-connected layerï¼‰ï¼Œ å› ä¸ºå®ƒçš„æ¯ä¸€ä¸ªè¾“å…¥éƒ½é€šè¿‡çŸ©é˜µ-å‘é‡ä¹˜æ³•å¾—åˆ°å®ƒçš„æ¯ä¸ªè¾“å‡ºã€‚</p><p>åœ¨PyTorchä¸­ï¼Œå…¨è¿æ¥å±‚åœ¨<code>Linear</code>ç±»ä¸­å®šä¹‰ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªå‚æ•°ä¼ é€’åˆ°<code>nn.Linear</code>ä¸­ã€‚ ç¬¬ä¸€ä¸ªæŒ‡å®šè¾“å…¥ç‰¹å¾å½¢çŠ¶ï¼Œå³2ï¼Œç¬¬äºŒä¸ªæŒ‡å®šè¾“å‡ºç‰¹å¾å½¢çŠ¶ï¼Œè¾“å‡ºç‰¹å¾å½¢çŠ¶ä¸ºå•ä¸ªæ ‡é‡ï¼Œå› æ­¤ä¸º1ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nnæ˜¯ç¥ç»ç½‘ç»œçš„ç¼©å†™</span></span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">net = nn.Sequential(nn.Linear(<span class="number">2</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°-1"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°-1" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h3><p>åœ¨ä½¿ç”¨<code>net</code>ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–æ¨¡å‹å‚æ•°ã€‚ å¦‚åœ¨çº¿æ€§å›å½’æ¨¡å‹ä¸­çš„æƒé‡å’Œåç½®ã€‚ æ·±åº¦å­¦ä¹ æ¡†æ¶é€šå¸¸æœ‰é¢„å®šä¹‰çš„æ–¹æ³•æ¥åˆå§‹åŒ–å‚æ•°ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šæ¯ä¸ªæƒé‡å‚æ•°åº”è¯¥ä»å‡å€¼ä¸º0ã€æ ‡å‡†å·®ä¸º0.01çš„æ­£æ€åˆ†å¸ƒä¸­éšæœºé‡‡æ ·ï¼Œ åç½®å‚æ•°å°†åˆå§‹åŒ–ä¸ºé›¶ã€‚</p><p>æ­£å¦‚æˆ‘ä»¬åœ¨æ„é€ <code>nn.Linear</code>æ—¶æŒ‡å®šè¾“å…¥å’Œè¾“å‡ºå°ºå¯¸ä¸€æ ·ï¼Œ ç°åœ¨æˆ‘ä»¬èƒ½ç›´æ¥è®¿é—®å‚æ•°ä»¥è®¾å®šå®ƒä»¬çš„åˆå§‹å€¼ã€‚ æˆ‘ä»¬é€šè¿‡<code>net[0]</code>é€‰æ‹©ç½‘ç»œä¸­çš„ç¬¬ä¸€ä¸ªå›¾å±‚ï¼Œ ç„¶åä½¿ç”¨<code>weight.data</code>å’Œ<code>bias.data</code>æ–¹æ³•è®¿é—®å‚æ•°ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ›¿æ¢æ–¹æ³•<code>normal_</code>å’Œ<code>fill_</code>æ¥é‡å†™å‚æ•°å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net[<span class="number">0</span>].weight.data.normal_(<span class="number">0</span>, <span class="number">0.01</span>)</span><br><span class="line">net[<span class="number">0</span>].bias.data.fill_(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">0.</span>])</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æŸå¤±å‡½æ•°-1"><a href="#å®šä¹‰æŸå¤±å‡½æ•°-1" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h3><p>è®¡ç®—å‡æ–¹è¯¯å·®ä½¿ç”¨çš„æ˜¯<code>MSELoss</code>ç±»ï¼Œä¹Ÿç§°ä¸ºå¹³æ–¹ğ¿2èŒƒæ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè¿”å›æ‰€æœ‰æ ·æœ¬æŸå¤±çš„å¹³å‡å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = nn.MSELoss()</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰ä¼˜åŒ–ç®—æ³•-1"><a href="#å®šä¹‰ä¼˜åŒ–ç®—æ³•-1" class="headerlink" title="å®šä¹‰ä¼˜åŒ–ç®—æ³•"></a>å®šä¹‰ä¼˜åŒ–ç®—æ³•</h3><p>å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•æ˜¯ä¸€ç§ä¼˜åŒ–ç¥ç»ç½‘ç»œçš„æ ‡å‡†å·¥å…·ï¼Œ PyTorchåœ¨<code>optim</code>æ¨¡å—ä¸­å®ç°äº†è¯¥ç®—æ³•çš„è®¸å¤šå˜ç§ã€‚ å½“æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ª<code>SGD</code>å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬è¦æŒ‡å®šä¼˜åŒ–çš„å‚æ•° ï¼ˆå¯é€šè¿‡<code>net.parameters()</code>ä»æˆ‘ä»¬çš„æ¨¡å‹ä¸­è·å¾—ï¼‰ä»¥åŠä¼˜åŒ–ç®—æ³•æ‰€éœ€çš„è¶…å‚æ•°å­—å…¸ã€‚ å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™åªéœ€è¦è®¾ç½®<code>lr</code>å€¼ï¼Œè¿™é‡Œè®¾ç½®ä¸º0.03ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trainer = torch.optim.SGD(net.parameters(), lr=<span class="number">0.03</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ·±åº¦å­¦ä¹ æ¡†æ¶çš„é«˜çº§APIæ¥å®ç°æˆ‘ä»¬çš„æ¨¡å‹åªéœ€è¦ç›¸å¯¹è¾ƒå°‘çš„ä»£ç ã€‚ æˆ‘ä»¬ä¸å¿…å•ç‹¬åˆ†é…å‚æ•°ã€ä¸å¿…å®šä¹‰æˆ‘ä»¬çš„æŸå¤±å‡½æ•°ï¼Œä¹Ÿä¸å¿…æ‰‹åŠ¨å®ç°å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ã€‚ å½“æˆ‘ä»¬éœ€è¦æ›´å¤æ‚çš„æ¨¡å‹æ—¶ï¼Œé«˜çº§APIçš„ä¼˜åŠ¿å°†å¤§å¤§å¢åŠ ã€‚ å½“æˆ‘ä»¬æœ‰äº†æ‰€æœ‰çš„åŸºæœ¬ç»„ä»¶ï¼Œè®­ç»ƒè¿‡ç¨‹ä»£ç ä¸æˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°æ—¶æ‰€åšçš„éå¸¸ç›¸ä¼¼ã€‚</p><p>å›é¡¾ä¸€ä¸‹ï¼šåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸé‡Œï¼Œæˆ‘ä»¬å°†å®Œæ•´éå†ä¸€æ¬¡æ•°æ®é›†ï¼ˆ<code>train_data</code>ï¼‰ï¼Œ ä¸åœåœ°ä»ä¸­è·å–ä¸€ä¸ªå°æ‰¹é‡çš„è¾“å…¥å’Œç›¸åº”çš„æ ‡ç­¾ã€‚ å¯¹äºæ¯ä¸€ä¸ªå°æ‰¹é‡ï¼Œæˆ‘ä»¬ä¼šè¿›è¡Œä»¥ä¸‹æ­¥éª¤:</p><ul><li>é€šè¿‡è°ƒç”¨<code>net(X)</code>ç”Ÿæˆé¢„æµ‹å¹¶è®¡ç®—æŸå¤±<code>l</code>ï¼ˆå‰å‘ä¼ æ’­ï¼‰ã€‚</li><li>é€šè¿‡è¿›è¡Œåå‘ä¼ æ’­æ¥è®¡ç®—æ¢¯åº¦ã€‚</li><li>é€šè¿‡è°ƒç”¨ä¼˜åŒ–å™¨æ¥æ›´æ–°æ¨¡å‹å‚æ•°ã€‚</li></ul><p>ä¸ºäº†æ›´å¥½çš„è¡¡é‡è®­ç»ƒæ•ˆæœï¼Œæˆ‘ä»¬è®¡ç®—æ¯ä¸ªè¿­ä»£å‘¨æœŸåçš„æŸå¤±ï¼Œå¹¶æ‰“å°å®ƒæ¥ç›‘æ§è®­ç»ƒè¿‡ç¨‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num_epochs = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter:</span><br><span class="line">        l = loss(net(X) ,y)</span><br><span class="line">        trainer.zero_grad()</span><br><span class="line">        l.backward()</span><br><span class="line">        trainer.step()</span><br><span class="line">    l = loss(net(features), labels)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;epoch <span class="subst">&#123;epoch + <span class="number">1</span>&#125;</span>, loss <span class="subst">&#123;l:f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">epoch <span class="number">1</span>, loss <span class="number">0.000248</span></span><br><span class="line">epoch <span class="number">2</span>, loss <span class="number">0.000103</span></span><br><span class="line">epoch <span class="number">3</span>, loss <span class="number">0.000103</span></span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒç”Ÿæˆæ•°æ®é›†çš„çœŸå®å‚æ•°å’Œé€šè¿‡æœ‰é™æ•°æ®è®­ç»ƒè·å¾—çš„æ¨¡å‹å‚æ•°ã€‚ è¦è®¿é—®å‚æ•°ï¼Œæˆ‘ä»¬é¦–å…ˆä»<code>net</code>è®¿é—®æ‰€éœ€çš„å±‚ï¼Œç„¶åè¯»å–è¯¥å±‚çš„æƒé‡å’Œåç½®ã€‚ æ­£å¦‚åœ¨ä»é›¶å¼€å§‹å®ç°ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬ä¼°è®¡å¾—åˆ°çš„å‚æ•°ä¸ç”Ÿæˆæ•°æ®çš„çœŸå®å‚æ•°éå¸¸æ¥è¿‘ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w = net[<span class="number">0</span>].weight.data</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;wçš„ä¼°è®¡è¯¯å·®ï¼š&#x27;</span>, true_w - w.reshape(true_w.shape))</span><br><span class="line">b = net[<span class="number">0</span>].bias.data</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;bçš„ä¼°è®¡è¯¯å·®ï¼š&#x27;</span>, true_b - b)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wçš„ä¼°è®¡è¯¯å·®ï¼š tensor([-<span class="number">0.0010</span>, -<span class="number">0.0003</span>])</span><br><span class="line">bçš„ä¼°è®¡è¯¯å·®ï¼š tensor([-<span class="number">0.0003</span>])</span><br></pre></td></tr></table></figure><h2 id="softmaxå›å½’"><a href="#softmaxå›å½’" class="headerlink" title="softmaxå›å½’"></a>softmaxå›å½’</h2><p>softmaxå…¶å®æ˜¯ä¸ªåˆ†ç±»é—®é¢˜</p><p>å›å½’å¯ä»¥ç”¨äºé¢„æµ‹<em>å¤šå°‘</em>çš„é—®é¢˜ã€‚ æ¯”å¦‚é¢„æµ‹æˆ¿å±‹è¢«å”®å‡ºä»·æ ¼ï¼Œæˆ–è€…æ£’çƒé˜Ÿå¯èƒ½è·å¾—çš„èƒœåœºæ•°ï¼Œåˆæˆ–è€…æ‚£è€…ä½é™¢çš„å¤©æ•°ã€‚</p><h3 id="åˆ†ç±»é—®é¢˜"><a href="#åˆ†ç±»é—®é¢˜" class="headerlink" title="åˆ†ç±»é—®é¢˜"></a>åˆ†ç±»é—®é¢˜</h3><p>å›å½’ï¼šä¼°è®¡ä¸€ä¸ªè¿ç»­å€¼</p><p>åˆ†ç±»ï¼šé¢„æµ‹ä¸€ä¸ªç¦»æ•£ç±»åˆ«</p><p>ä»å›å½’åˆ°å¤šç±»åˆ†ç±»â€”-å‡æ–¹æŸå¤±</p><ul><li><p>å¯¹ç±»åˆ«è¿›è¡Œä¸€ä½æœ‰æ•ˆç¼–ç </p><p>y&#x3D;[y1,y2,â€¦,yn]^T</p></li><li><p>ä½¿ç”¨å‡æ–¹æŸå¤±è¿›è¡Œè®­ç»ƒ</p></li><li><p>æœ€å¤§å€¼ä¸ºé¢„æµ‹</p><p>y^&#x3D;argmax 0i</p></li></ul><h3 id="softmaxè¿ç®—"><a href="#softmaxè¿ç®—" class="headerlink" title="softmaxè¿ç®—"></a>softmaxè¿ç®—</h3><p>ç°åœ¨æˆ‘ä»¬å°†ä¼˜åŒ–å‚æ•°ä»¥æœ€å¤§åŒ–è§‚æµ‹æ•°æ®çš„æ¦‚ç‡ã€‚ ä¸ºäº†å¾—åˆ°é¢„æµ‹ç»“æœï¼Œæˆ‘ä»¬å°†è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå¦‚é€‰æ‹©å…·æœ‰æœ€å¤§æ¦‚ç‡çš„æ ‡ç­¾ã€‚</p><p>æˆ‘ä»¬å¸Œæœ›æ¨¡å‹çš„è¾“å‡ºğ‘¦^ğ‘—å¯ä»¥è§†ä¸ºå±äºç±»ğ‘—çš„æ¦‚ç‡ï¼Œ ç„¶åé€‰æ‹©å…·æœ‰æœ€å¤§è¾“å‡ºå€¼çš„ç±»åˆ«argmaxğ‘—ğ‘¦ğ‘—ä½œä¸ºæˆ‘ä»¬çš„é¢„æµ‹ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœğ‘¦^1ã€ğ‘¦^2å’Œğ‘¦^3åˆ†åˆ«ä¸º0.1ã€0.8å’Œ0.1ï¼Œ é‚£ä¹ˆæˆ‘ä»¬é¢„æµ‹çš„ç±»åˆ«æ˜¯2ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ä»£è¡¨â€œé¸¡â€ã€‚</p><p>ç„¶è€Œæˆ‘ä»¬èƒ½å¦å°†æœªè§„èŒƒåŒ–çš„é¢„æµ‹ğ‘œç›´æ¥è§†ä½œæˆ‘ä»¬æ„Ÿå…´è¶£çš„è¾“å‡ºå‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚ å› ä¸ºå°†çº¿æ€§å±‚çš„è¾“å‡ºç›´æ¥è§†ä¸ºæ¦‚ç‡æ—¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬æ²¡æœ‰é™åˆ¶è¿™äº›è¾“å‡ºæ•°å­—çš„æ€»å’Œä¸º1ã€‚ å¦ä¸€æ–¹é¢ï¼Œæ ¹æ®è¾“å…¥çš„ä¸åŒï¼Œå®ƒä»¬å¯ä»¥ä¸ºè´Ÿå€¼ã€‚ è¿™äº›è¿åäº† <a href="https://zh-v2.d2l.ai/chapter_preliminaries/probability.html#sec-prob">2.6èŠ‚</a>ä¸­æ‰€è¯´çš„æ¦‚ç‡åŸºæœ¬å…¬ç†ã€‚</p><p>è¦å°†è¾“å‡ºè§†ä¸ºæ¦‚ç‡ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯åœ¨ä»»ä½•æ•°æ®ä¸Šçš„è¾“å‡ºéƒ½æ˜¯éè´Ÿçš„ä¸”æ€»å’Œä¸º1ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè®­ç»ƒçš„ç›®æ ‡å‡½æ•°ï¼Œæ¥æ¿€åŠ±æ¨¡å‹ç²¾å‡†åœ°ä¼°è®¡æ¦‚ç‡ã€‚ ä¾‹å¦‚ï¼Œ åœ¨åˆ†ç±»å™¨è¾“å‡º0.5çš„æ‰€æœ‰æ ·æœ¬ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›æ ·æœ¬æ˜¯åˆšå¥½æœ‰ä¸€åŠå®é™…ä¸Šå±äºé¢„æµ‹çš„ç±»åˆ«ã€‚ è¿™ä¸ªå±æ€§å«åš<em>æ ¡å‡†</em>ï¼ˆcalibrationï¼‰</p><p><img src="/../img/Pytorch1/pytorch5/6.png" alt="6"></p><p>è¿™é‡Œï¼Œå¯¹äºæ‰€æœ‰çš„ğ‘—æ€»æœ‰0â‰¤ğ‘¦^ğ‘—â‰¤1ã€‚ å› æ­¤ï¼Œğ‘¦^å¯ä»¥è§†ä¸ºä¸€ä¸ªæ­£ç¡®çš„æ¦‚ç‡åˆ†å¸ƒã€‚ softmaxè¿ç®—ä¸ä¼šæ”¹å˜æœªè§„èŒƒåŒ–çš„é¢„æµ‹ğ‘œä¹‹é—´çš„å¤§å°æ¬¡åºï¼Œåªä¼šç¡®å®šåˆ†é…ç»™æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡ã€‚ å› æ­¤ï¼Œåœ¨é¢„æµ‹è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ç”¨ä¸‹å¼æ¥é€‰æ‹©æœ€æœ‰å¯èƒ½çš„ç±»åˆ«ã€‚</p><p><img src="/../img/Pytorch1/pytorch5/7.png" alt="7"></p><p>å°½ç®¡softmaxæ˜¯ä¸€ä¸ªéçº¿æ€§å‡½æ•°ï¼Œä½†softmaxå›å½’çš„è¾“å‡ºä»ç„¶ç”±è¾“å…¥ç‰¹å¾çš„ä»¿å°„å˜æ¢å†³å®šã€‚ å› æ­¤ï¼Œsoftmaxå›å½’æ˜¯ä¸€ä¸ª<em>çº¿æ€§æ¨¡å‹</em>ï¼ˆlinear modelï¼‰</p><h2 id="å›¾åƒåˆ†ç±»æ•°æ®é›†"><a href="#å›¾åƒåˆ†ç±»æ•°æ®é›†" class="headerlink" title="å›¾åƒåˆ†ç±»æ•°æ®é›†"></a>å›¾åƒåˆ†ç±»æ•°æ®é›†</h2><p>MNISTæ•°æ®é›†æ˜¯å›¾åƒåˆ†ç±»ä¸­å¹¿æ³›ä½¿ç”¨çš„æ•°æ®é›†ä¹‹ä¸€ï¼Œä½†ä½œä¸ºåŸºå‡†æ•°æ®é›†è¿‡äºç®€å•ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ç±»ä¼¼ä½†æ›´å¤æ‚çš„Fashion-MNISTæ•°æ®é›† ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> torch.utils <span class="keyword">import</span> data</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">d2l.use_svg_display()</span><br></pre></td></tr></table></figure><h3 id="è¯»å–æ•°æ®é›†-2"><a href="#è¯»å–æ•°æ®é›†-2" class="headerlink" title="è¯»å–æ•°æ®é›†"></a>è¯»å–æ•°æ®é›†</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¡†æ¶ä¸­çš„å†…ç½®å‡½æ•°å°†Fashion-MNISTæ•°æ®é›†ä¸‹è½½å¹¶è¯»å–åˆ°å†…å­˜ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡ToTensorå®ä¾‹å°†å›¾åƒæ•°æ®ä»PILç±»å‹å˜æ¢æˆ32ä½æµ®ç‚¹æ•°æ ¼å¼ï¼Œ</span></span><br><span class="line"><span class="comment"># å¹¶é™¤ä»¥255ä½¿å¾—æ‰€æœ‰åƒç´ çš„æ•°å€¼å‡åœ¨0ï½1ä¹‹é—´</span></span><br><span class="line">trans = transforms.ToTensor()</span><br><span class="line">mnist_train = torchvision.datasets.FashionMNIST(</span><br><span class="line">    root=<span class="string">&quot;../data&quot;</span>, train=<span class="literal">True</span>, transform=trans, download=<span class="literal">True</span>)</span><br><span class="line">mnist_test = torchvision.datasets.FashionMNIST(</span><br><span class="line">    root=<span class="string">&quot;../data&quot;</span>, train=<span class="literal">False</span>, transform=trans, download=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>Fashion-MNISTç”±10ä¸ªç±»åˆ«çš„å›¾åƒç»„æˆï¼Œ æ¯ä¸ªç±»åˆ«ç”±<em>è®­ç»ƒæ•°æ®é›†</em>ï¼ˆtrain datasetï¼‰ä¸­çš„6000å¼ å›¾åƒ å’Œ<em>æµ‹è¯•æ•°æ®é›†</em>ï¼ˆtest datasetï¼‰ä¸­çš„1000å¼ å›¾åƒç»„æˆã€‚ å› æ­¤ï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†åˆ†åˆ«åŒ…å«60000å’Œ10000å¼ å›¾åƒã€‚ æµ‹è¯•æ•°æ®é›†ä¸ä¼šç”¨äºè®­ç»ƒï¼Œåªç”¨äºè¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">len</span>(mnist_train), <span class="built_in">len</span>(mnist_test)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">60000</span>, <span class="number">10000</span>)</span><br></pre></td></tr></table></figure><p>Fashion-MNISTä¸­åŒ…å«çš„10ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«ä¸ºt-shirtï¼ˆTæ¤ï¼‰ã€trouserï¼ˆè£¤å­ï¼‰ã€pulloverï¼ˆå¥—è¡«ï¼‰ã€dressï¼ˆè¿è¡£è£™ï¼‰ã€coatï¼ˆå¤–å¥—ï¼‰ã€sandalï¼ˆå‡‰é‹ï¼‰ã€shirtï¼ˆè¡¬è¡«ï¼‰ã€sneakerï¼ˆè¿åŠ¨é‹ï¼‰ã€bagï¼ˆåŒ…ï¼‰å’Œankle bootï¼ˆçŸ­é´ï¼‰ã€‚ ä»¥ä¸‹å‡½æ•°ç”¨äºåœ¨æ•°å­—æ ‡ç­¾ç´¢å¼•åŠå…¶æ–‡æœ¬åç§°ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_fashion_mnist_labels</span>(<span class="params">labels</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è¿”å›Fashion-MNISTæ•°æ®é›†çš„æ–‡æœ¬æ ‡ç­¾&quot;&quot;&quot;</span></span><br><span class="line">    text_labels = [<span class="string">&#x27;t-shirt&#x27;</span>, <span class="string">&#x27;trouser&#x27;</span>, <span class="string">&#x27;pullover&#x27;</span>, <span class="string">&#x27;dress&#x27;</span>, <span class="string">&#x27;coat&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;sandal&#x27;</span>, <span class="string">&#x27;shirt&#x27;</span>, <span class="string">&#x27;sneaker&#x27;</span>, <span class="string">&#x27;bag&#x27;</span>, <span class="string">&#x27;ankle boot&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> [text_labels[<span class="built_in">int</span>(i)] <span class="keyword">for</span> i <span class="keyword">in</span> labels]</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥å¯è§†åŒ–è¿™äº›æ ·æœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show_images</span>(<span class="params">imgs, num_rows, num_cols, titles=<span class="literal">None</span>, scale=<span class="number">1.5</span></span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç»˜åˆ¶å›¾åƒåˆ—è¡¨&quot;&quot;&quot;</span></span><br><span class="line">    figsize = (num_cols * scale, num_rows * scale)</span><br><span class="line">    _, axes = d2l.plt.subplots(num_rows, num_cols, figsize=figsize)</span><br><span class="line">    axes = axes.flatten()</span><br><span class="line">    <span class="keyword">for</span> i, (ax, img) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(axes, imgs)):</span><br><span class="line">        <span class="keyword">if</span> torch.is_tensor(img):</span><br><span class="line">            <span class="comment"># å›¾ç‰‡å¼ é‡</span></span><br><span class="line">            ax.imshow(img.numpy())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># PILå›¾ç‰‡</span></span><br><span class="line">            ax.imshow(img)</span><br><span class="line">        ax.axes.get_xaxis().set_visible(<span class="literal">False</span>)</span><br><span class="line">        ax.axes.get_yaxis().set_visible(<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">if</span> titles:</span><br><span class="line">            ax.set_title(titles[i])</span><br><span class="line">    <span class="keyword">return</span> axes</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯è®­ç»ƒæ•°æ®é›†ä¸­å‰å‡ ä¸ªæ ·æœ¬çš„å›¾åƒåŠå…¶ç›¸åº”çš„æ ‡ç­¾ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X, y = <span class="built_in">next</span>(<span class="built_in">iter</span>(data.DataLoader(mnist_train, batch_size=<span class="number">18</span>)))</span><br><span class="line">show_images(X.reshape(<span class="number">18</span>, <span class="number">28</span>, <span class="number">28</span>), <span class="number">2</span>, <span class="number">9</span>, titles=get_fashion_mnist_labels(y));</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch5/8.png" alt="8"></p><h3 id="è¯»å–å°æ‰¹é‡"><a href="#è¯»å–å°æ‰¹é‡" class="headerlink" title="è¯»å–å°æ‰¹é‡"></a>è¯»å–å°æ‰¹é‡</h3><p>ä¸ºäº†ä½¿æˆ‘ä»¬åœ¨è¯»å–è®­ç»ƒé›†å’Œæµ‹è¯•é›†æ—¶æ›´å®¹æ˜“ï¼Œæˆ‘ä»¬ä½¿ç”¨å†…ç½®çš„æ•°æ®è¿­ä»£å™¨ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹åˆ›å»ºã€‚ å›é¡¾ä¸€ä¸‹ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ•°æ®åŠ è½½å™¨æ¯æ¬¡éƒ½ä¼šè¯»å–ä¸€å°æ‰¹é‡æ•°æ®ï¼Œå¤§å°ä¸º<code>batch_size</code>ã€‚ é€šè¿‡å†…ç½®æ•°æ®è¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥éšæœºæ‰“ä¹±äº†æ‰€æœ‰æ ·æœ¬ï¼Œä»è€Œæ— åè§åœ°è¯»å–å°æ‰¹é‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">batch_size = <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_dataloader_workers</span>():  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨4ä¸ªè¿›ç¨‹æ¥è¯»å–æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line">train_iter = data.DataLoader(mnist_train, batch_size, shuffle=<span class="literal">True</span>,</span><br><span class="line">                             num_workers=get_dataloader_workers())</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¯»å–è®­ç»ƒæ•°æ®æ‰€éœ€çš„æ—¶é—´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">timer = d2l.Timer()</span><br><span class="line"><span class="keyword">for</span> X, y <span class="keyword">in</span> train_iter:</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="string">f&#x27;<span class="subst">&#123;timer.stop():<span class="number">.2</span>f&#125;</span> sec&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;3.37 sec&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="æ•´åˆæ‰€æœ‰ç»„ä»¶"><a href="#æ•´åˆæ‰€æœ‰ç»„ä»¶" class="headerlink" title="æ•´åˆæ‰€æœ‰ç»„ä»¶"></a>æ•´åˆæ‰€æœ‰ç»„ä»¶</h3><p>å®šä¹‰<code>load_data_fashion_mnist</code>å‡½æ•°ï¼Œç”¨äºè·å–å’Œè¯»å–Fashion-MNISTæ•°æ®é›†ã€‚ è¿™ä¸ªå‡½æ•°è¿”å›è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æ•°æ®è¿­ä»£å™¨ã€‚ æ­¤å¤–ï¼Œè¿™ä¸ªå‡½æ•°è¿˜æ¥å—ä¸€ä¸ªå¯é€‰å‚æ•°<code>resize</code>ï¼Œç”¨æ¥å°†å›¾åƒå¤§å°è°ƒæ•´ä¸ºå¦ä¸€ç§å½¢çŠ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_data_fashion_mnist</span>(<span class="params">batch_size, resize=<span class="literal">None</span></span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸‹è½½Fashion-MNISTæ•°æ®é›†ï¼Œç„¶åå°†å…¶åŠ è½½åˆ°å†…å­˜ä¸­&quot;&quot;&quot;</span></span><br><span class="line">    trans = [transforms.ToTensor()]</span><br><span class="line">    <span class="keyword">if</span> resize:</span><br><span class="line">        trans.insert(<span class="number">0</span>, transforms.Resize(resize))</span><br><span class="line">    trans = transforms.Compose(trans)</span><br><span class="line">    mnist_train = torchvision.datasets.FashionMNIST(</span><br><span class="line">        root=<span class="string">&quot;../data&quot;</span>, train=<span class="literal">True</span>, transform=trans, download=<span class="literal">True</span>)</span><br><span class="line">    mnist_test = torchvision.datasets.FashionMNIST(</span><br><span class="line">        root=<span class="string">&quot;../data&quot;</span>, train=<span class="literal">False</span>, transform=trans, download=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> (data.DataLoader(mnist_train, batch_size, shuffle=<span class="literal">True</span>,</span><br><span class="line">                            num_workers=get_dataloader_workers()),</span><br><span class="line">            data.DataLoader(mnist_test, batch_size, shuffle=<span class="literal">False</span>,</span><br><span class="line">                            num_workers=get_dataloader_workers()))</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®š<code>resize</code>å‚æ•°æ¥æµ‹è¯•<code>load_data_fashion_mnist</code>å‡½æ•°çš„å›¾åƒå¤§å°è°ƒæ•´åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">train_iter, test_iter = load_data_fashion_mnist(<span class="number">32</span>, resize=<span class="number">64</span>)</span><br><span class="line"><span class="keyword">for</span> X, y <span class="keyword">in</span> train_iter:</span><br><span class="line">    <span class="built_in">print</span>(X.shape, X.dtype, y.shape, y.dtype)</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.Size([<span class="number">32</span>, <span class="number">1</span>, <span class="number">64</span>, <span class="number">64</span>]) torch.float32 torch.Size([<span class="number">32</span>]) torch.int64</span><br></pre></td></tr></table></figure><h2 id="softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°"><a href="#softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°" class="headerlink" title="softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°"></a>softmaxå›å½’çš„ä»é›¶å¼€å§‹å®ç°</h2><p>ä½¿ç”¨åˆšåˆšåœ¨ä¹‹å‰ä¸­å¼•å…¥çš„Fashion-MNISTæ•°æ®é›†ï¼Œ å¹¶è®¾ç½®æ•°æ®è¿­ä»£å™¨çš„æ‰¹é‡å¤§å°ä¸º256ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> display</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°-2"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°-2" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h3><p>å’Œä¹‹å‰çº¿æ€§å›å½’çš„ä¾‹å­ä¸€æ ·ï¼Œè¿™é‡Œçš„æ¯ä¸ªæ ·æœ¬éƒ½å°†ç”¨å›ºå®šé•¿åº¦çš„å‘é‡è¡¨ç¤ºã€‚ åŸå§‹æ•°æ®é›†ä¸­çš„æ¯ä¸ªæ ·æœ¬éƒ½æ˜¯28Ã—28çš„å›¾åƒã€‚ æœ¬èŠ‚å°†å±•å¹³æ¯ä¸ªå›¾åƒï¼ŒæŠŠå®ƒä»¬çœ‹ä½œé•¿åº¦ä¸º784çš„å‘é‡ã€‚ åœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºèƒ½å¤Ÿåˆ©ç”¨å›¾åƒç©ºé—´ç»“æ„çš„ç‰¹å¾ï¼Œ ä½†ç°åœ¨æˆ‘ä»¬æš‚æ—¶åªæŠŠæ¯ä¸ªåƒç´ ä½ç½®çœ‹ä½œä¸€ä¸ªç‰¹å¾ã€‚</p><p>å›æƒ³ä¸€ä¸‹ï¼Œåœ¨softmaxå›å½’ä¸­ï¼Œæˆ‘ä»¬çš„è¾“å‡ºä¸ç±»åˆ«ä¸€æ ·å¤šã€‚ å› ä¸ºæˆ‘ä»¬çš„æ•°æ®é›†æœ‰10ä¸ªç±»åˆ«ï¼Œæ‰€ä»¥ç½‘ç»œè¾“å‡ºç»´åº¦ä¸º10ã€‚ å› æ­¤ï¼Œæƒé‡å°†æ„æˆä¸€ä¸ª784Ã—10çš„çŸ©é˜µï¼Œ åç½®å°†æ„æˆä¸€ä¸ª1Ã—10çš„è¡Œå‘é‡ã€‚ ä¸çº¿æ€§å›å½’ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ­£æ€åˆ†å¸ƒåˆå§‹åŒ–æˆ‘ä»¬çš„æƒé‡<code>W</code>ï¼Œåç½®åˆå§‹åŒ–ä¸º0ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">num_inputs = <span class="number">784</span></span><br><span class="line">num_outputs = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">W = torch.normal(<span class="number">0</span>, <span class="number">0.01</span>, size=(num_inputs, num_outputs), requires_grad=<span class="literal">True</span>)</span><br><span class="line">b = torch.zeros(num_outputs, requires_grad=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰softmaxæ“ä½œ"><a href="#å®šä¹‰softmaxæ“ä½œ" class="headerlink" title="å®šä¹‰softmaxæ“ä½œ"></a>å®šä¹‰softmaxæ“ä½œ</h3><p>åœ¨å®ç°softmaxå›å½’æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬ç®€è¦å›é¡¾ä¸€ä¸‹<code>sum</code>è¿ç®—ç¬¦å¦‚ä½•æ²¿ç€å¼ é‡ä¸­çš„ç‰¹å®šç»´åº¦å·¥ä½œã€‚ å¦‚ <a href="https://zh-v2.d2l.ai/chapter_preliminaries/linear-algebra.html#subseq-lin-alg-reduction">2.3.6èŠ‚</a>å’Œ <a href="https://zh-v2.d2l.ai/chapter_preliminaries/linear-algebra.html#subseq-lin-alg-non-reduction">2.3.6.1èŠ‚</a>æ‰€è¿°ï¼Œ ç»™å®šä¸€ä¸ªçŸ©é˜µ<code>X</code>ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å…ƒç´ æ±‚å’Œï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚ ä¹Ÿå¯ä»¥åªæ±‚åŒä¸€ä¸ªè½´ä¸Šçš„å…ƒç´ ï¼Œå³åŒä¸€åˆ—ï¼ˆè½´0ï¼‰æˆ–åŒä¸€è¡Œï¼ˆè½´1ï¼‰ã€‚ å¦‚æœ<code>X</code>æ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º<code>(2, 3)</code>çš„å¼ é‡ï¼Œæˆ‘ä»¬å¯¹åˆ—è¿›è¡Œæ±‚å’Œï¼Œ åˆ™ç»“æœå°†æ˜¯ä¸€ä¸ªå…·æœ‰å½¢çŠ¶<code>(3,)</code>çš„å‘é‡ã€‚ å½“è°ƒç”¨<code>sum</code>è¿ç®—ç¬¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¿æŒåœ¨åŸå§‹å¼ é‡çš„è½´æ•°ï¼Œè€Œä¸æŠ˜å æ±‚å’Œçš„ç»´åº¦ã€‚ è¿™å°†äº§ç”Ÿä¸€ä¸ªå…·æœ‰å½¢çŠ¶<code>(1, 3)</code>çš„äºŒç»´å¼ é‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = torch.tensor([[<span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>], [<span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">6.0</span>]])</span><br><span class="line">X.<span class="built_in">sum</span>(<span class="number">0</span>, keepdim=<span class="literal">True</span>), X.<span class="built_in">sum</span>(<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(tensor([[<span class="number">5.</span>, <span class="number">7.</span>, <span class="number">9.</span>]]),</span><br><span class="line"> tensor([[ <span class="number">6.</span>],</span><br><span class="line">         [<span class="number">15.</span>]]))</span><br></pre></td></tr></table></figure><p>å›æƒ³ä¸€ä¸‹ï¼Œå®ç°softmaxç”±ä¸‰ä¸ªæ­¥éª¤ç»„æˆï¼š</p><ol><li>å¯¹æ¯ä¸ªé¡¹æ±‚å¹‚ï¼ˆä½¿ç”¨<code>exp</code>ï¼‰ï¼›</li><li>å¯¹æ¯ä¸€è¡Œæ±‚å’Œï¼ˆå°æ‰¹é‡ä¸­æ¯ä¸ªæ ·æœ¬æ˜¯ä¸€è¡Œï¼‰ï¼Œå¾—åˆ°æ¯ä¸ªæ ·æœ¬çš„è§„èŒƒåŒ–å¸¸æ•°ï¼›</li><li>å°†æ¯ä¸€è¡Œé™¤ä»¥å…¶è§„èŒƒåŒ–å¸¸æ•°ï¼Œç¡®ä¿ç»“æœçš„å’Œä¸º1ã€‚</li></ol><p>å›é¡¾ä¸€ä¸‹è¿™ä¸ªè¡¨è¾¾å¼</p><p><img src="/../img/Pytorch1/pytorch5/6.png" alt="6"></p><p>åˆ†æ¯æˆ–è§„èŒƒåŒ–å¸¸æ•°ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸º<em>é…åˆ†å‡½æ•°</em>ï¼ˆå…¶å¯¹æ•°ç§°ä¸ºå¯¹æ•°-é…åˆ†å‡½æ•°ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">softmax</span>(<span class="params">X</span>):</span><br><span class="line">    X_exp = torch.exp(X)</span><br><span class="line">    partition = X_exp.<span class="built_in">sum</span>(<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> X_exp / partition  <span class="comment"># è¿™é‡Œåº”ç”¨äº†å¹¿æ’­æœºåˆ¶</span></span><br></pre></td></tr></table></figure><p>æ­£å¦‚ä¸Šè¿°ä»£ç ï¼Œå¯¹äºä»»ä½•éšæœºè¾“å…¥ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå…ƒç´ å˜æˆä¸€ä¸ªéè´Ÿæ•°ã€‚ æ­¤å¤–ï¼Œä¾æ®æ¦‚ç‡åŸç†ï¼Œæ¯è¡Œæ€»å’Œä¸º1ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X = torch.normal(<span class="number">0</span>, <span class="number">1</span>, (<span class="number">2</span>, <span class="number">5</span>))</span><br><span class="line">X_prob = softmax(X)</span><br><span class="line">X_prob, X_prob.<span class="built_in">sum</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(tensor([[<span class="number">0.1686</span>, <span class="number">0.4055</span>, <span class="number">0.0849</span>, <span class="number">0.1064</span>, <span class="number">0.2347</span>],</span><br><span class="line">         [<span class="number">0.0217</span>, <span class="number">0.2652</span>, <span class="number">0.6354</span>, <span class="number">0.0457</span>, <span class="number">0.0321</span>]]),</span><br><span class="line"> tensor([<span class="number">1.0000</span>, <span class="number">1.0000</span>]))</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æ¨¡å‹-2"><a href="#å®šä¹‰æ¨¡å‹-2" class="headerlink" title="å®šä¹‰æ¨¡å‹"></a>å®šä¹‰æ¨¡å‹</h3><p>å®šä¹‰softmaxæ“ä½œåï¼Œæˆ‘ä»¬å¯ä»¥å®ç°softmaxå›å½’æ¨¡å‹ã€‚ ä¸‹é¢çš„ä»£ç å®šä¹‰äº†è¾“å…¥å¦‚ä½•é€šè¿‡ç½‘ç»œæ˜ å°„åˆ°è¾“å‡ºã€‚ æ³¨æ„ï¼Œå°†æ•°æ®ä¼ é€’åˆ°æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>reshape</code>å‡½æ•°å°†æ¯å¼ åŸå§‹å›¾åƒå±•å¹³ä¸ºå‘é‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">net</span>(<span class="params">X</span>):</span><br><span class="line">    <span class="keyword">return</span> softmax(torch.matmul(X.reshape((-<span class="number">1</span>, W.shape[<span class="number">0</span>])), W) + b)</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æŸå¤±å‡½æ•°-2"><a href="#å®šä¹‰æŸå¤±å‡½æ•°-2" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h3><p>ä¸‹æ¥ï¼Œæˆ‘ä»¬å®ç°ä¹‹å‰å¼•å…¥çš„äº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚ è¿™å¯èƒ½æ˜¯æ·±åº¦å­¦ä¹ ä¸­æœ€å¸¸è§çš„æŸå¤±å‡½æ•°ï¼Œå› ä¸ºç›®å‰åˆ†ç±»é—®é¢˜çš„æ•°é‡è¿œè¿œè¶…è¿‡å›å½’é—®é¢˜çš„æ•°é‡ã€‚</p><p>å›é¡¾ä¸€ä¸‹ï¼Œäº¤å‰ç†µé‡‡ç”¨çœŸå®æ ‡ç­¾çš„é¢„æµ‹æ¦‚ç‡çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ã€‚ è¿™é‡Œæˆ‘ä»¬ä¸ä½¿ç”¨Pythonçš„forå¾ªç¯è¿­ä»£é¢„æµ‹ï¼ˆè¿™å¾€å¾€æ˜¯ä½æ•ˆçš„ï¼‰ï¼Œ è€Œæ˜¯é€šè¿‡ä¸€ä¸ªè¿ç®—ç¬¦é€‰æ‹©æ‰€æœ‰å…ƒç´ ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°æ®æ ·æœ¬<code>y_hat</code>ï¼Œå…¶ä¸­åŒ…å«2ä¸ªæ ·æœ¬åœ¨3ä¸ªç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ï¼Œ ä»¥åŠå®ƒä»¬å¯¹åº”çš„æ ‡ç­¾<code>y</code>ã€‚ æœ‰äº†<code>y</code>ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ç¬¬ä¸€ä¸ªæ ·æœ¬ä¸­ï¼Œç¬¬ä¸€ç±»æ˜¯æ­£ç¡®çš„é¢„æµ‹ï¼› è€Œåœ¨ç¬¬äºŒä¸ªæ ·æœ¬ä¸­ï¼Œç¬¬ä¸‰ç±»æ˜¯æ­£ç¡®çš„é¢„æµ‹ã€‚ ç„¶åä½¿ç”¨<code>y</code>ä½œä¸º<code>y_hat</code>ä¸­æ¦‚ç‡çš„ç´¢å¼•ï¼Œ æˆ‘ä»¬é€‰æ‹©ç¬¬ä¸€ä¸ªæ ·æœ¬ä¸­ç¬¬ä¸€ä¸ªç±»çš„æ¦‚ç‡å’Œç¬¬äºŒä¸ªæ ·æœ¬ä¸­ç¬¬ä¸‰ä¸ªç±»çš„æ¦‚ç‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y = torch.tensor([<span class="number">0</span>, <span class="number">2</span>])</span><br><span class="line">y_hat = torch.tensor([[<span class="number">0.1</span>, <span class="number">0.3</span>, <span class="number">0.6</span>], [<span class="number">0.3</span>, <span class="number">0.2</span>, <span class="number">0.5</span>]])</span><br><span class="line">y_hat[[<span class="number">0</span>, <span class="number">1</span>], y]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">0.1000</span>, <span class="number">0.5000</span>])</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬åªéœ€ä¸€è¡Œä»£ç å°±å¯ä»¥å®ç°äº¤å‰ç†µæŸå¤±å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cross_entropy</span>(<span class="params">y_hat, y</span>):</span><br><span class="line">    <span class="keyword">return</span> - torch.log(y_hat[<span class="built_in">range</span>(<span class="built_in">len</span>(y_hat)), y])</span><br><span class="line"></span><br><span class="line">cross_entropy(y_hat, y)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">2.3026</span>, <span class="number">0.6931</span>])</span><br></pre></td></tr></table></figure><h3 id="åˆ†ç±»ç²¾åº¦"><a href="#åˆ†ç±»ç²¾åº¦" class="headerlink" title="åˆ†ç±»ç²¾åº¦"></a>åˆ†ç±»ç²¾åº¦</h3><p>ç»™å®šé¢„æµ‹æ¦‚ç‡åˆ†å¸ƒ<code>y_hat</code>ï¼Œå½“æˆ‘ä»¬å¿…é¡»è¾“å‡ºç¡¬é¢„æµ‹ï¼ˆhard predictionï¼‰æ—¶ï¼Œ æˆ‘ä»¬é€šå¸¸é€‰æ‹©é¢„æµ‹æ¦‚ç‡æœ€é«˜çš„ç±»ã€‚ è®¸å¤šåº”ç”¨éƒ½è¦æ±‚æˆ‘ä»¬åšå‡ºé€‰æ‹©ã€‚å¦‚Gmailå¿…é¡»å°†ç”µå­é‚®ä»¶åˆ†ç±»ä¸ºâ€œPrimaryï¼ˆä¸»è¦é‚®ä»¶ï¼‰â€ã€ â€œSocialï¼ˆç¤¾äº¤é‚®ä»¶ï¼‰â€â€œUpdatesï¼ˆæ›´æ–°é‚®ä»¶ï¼‰â€æˆ–â€œForumsï¼ˆè®ºå›é‚®ä»¶ï¼‰â€ã€‚ Gmailåšåˆ†ç±»æ—¶å¯èƒ½åœ¨å†…éƒ¨ä¼°è®¡æ¦‚ç‡ï¼Œä½†æœ€ç»ˆå®ƒå¿…é¡»åœ¨ç±»ä¸­é€‰æ‹©ä¸€ä¸ªã€‚</p><p>å½“é¢„æµ‹ä¸æ ‡ç­¾åˆ†ç±»<code>y</code>ä¸€è‡´æ—¶ï¼Œå³æ˜¯æ­£ç¡®çš„ã€‚ åˆ†ç±»ç²¾åº¦å³æ­£ç¡®é¢„æµ‹æ•°é‡ä¸æ€»é¢„æµ‹æ•°é‡ä¹‹æ¯”ã€‚ è™½ç„¶ç›´æ¥ä¼˜åŒ–ç²¾åº¦å¯èƒ½å¾ˆå›°éš¾ï¼ˆå› ä¸ºç²¾åº¦çš„è®¡ç®—ä¸å¯å¯¼ï¼‰ï¼Œ ä½†ç²¾åº¦é€šå¸¸æ˜¯æˆ‘ä»¬æœ€å…³å¿ƒçš„æ€§èƒ½è¡¡é‡æ ‡å‡†ï¼Œæˆ‘ä»¬åœ¨è®­ç»ƒåˆ†ç±»å™¨æ—¶å‡ ä¹æ€»ä¼šå…³æ³¨å®ƒã€‚</p><p>ä¸ºäº†è®¡ç®—ç²¾åº¦ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚ é¦–å…ˆï¼Œå¦‚æœ<code>y_hat</code>æ˜¯çŸ©é˜µï¼Œé‚£ä¹ˆå‡å®šç¬¬äºŒä¸ªç»´åº¦å­˜å‚¨æ¯ä¸ªç±»çš„é¢„æµ‹åˆ†æ•°ã€‚ æˆ‘ä»¬ä½¿ç”¨<code>argmax</code>è·å¾—æ¯è¡Œä¸­æœ€å¤§å…ƒç´ çš„ç´¢å¼•æ¥è·å¾—é¢„æµ‹ç±»åˆ«ã€‚ ç„¶åæˆ‘ä»¬å°†é¢„æµ‹ç±»åˆ«ä¸çœŸå®<code>y</code>å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚ ç”±äºç­‰å¼è¿ç®—ç¬¦â€œ<code>==</code>â€å¯¹æ•°æ®ç±»å‹å¾ˆæ•æ„Ÿï¼Œ å› æ­¤æˆ‘ä»¬å°†<code>y_hat</code>çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºä¸<code>y</code>çš„æ•°æ®ç±»å‹ä¸€è‡´ã€‚ ç»“æœæ˜¯ä¸€ä¸ªåŒ…å«0ï¼ˆé”™ï¼‰å’Œ1ï¼ˆå¯¹ï¼‰çš„å¼ é‡ã€‚ æœ€åï¼Œæˆ‘ä»¬æ±‚å’Œä¼šå¾—åˆ°æ­£ç¡®é¢„æµ‹çš„æ•°é‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">accuracy</span>(<span class="params">y_hat, y</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—é¢„æµ‹æ­£ç¡®çš„æ•°é‡&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(y_hat.shape) &gt; <span class="number">1</span> <span class="keyword">and</span> y_hat.shape[<span class="number">1</span>] &gt; <span class="number">1</span>:</span><br><span class="line">        y_hat = y_hat.argmax(axis=<span class="number">1</span>)</span><br><span class="line">    cmp = y_hat.<span class="built_in">type</span>(y.dtype) == y</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">float</span>(cmp.<span class="built_in">type</span>(y.dtype).<span class="built_in">sum</span>())</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„å˜é‡<code>y_hat</code>å’Œ<code>y</code>åˆ†åˆ«ä½œä¸ºé¢„æµ‹çš„æ¦‚ç‡åˆ†å¸ƒå’Œæ ‡ç­¾ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€ä¸ªæ ·æœ¬çš„é¢„æµ‹ç±»åˆ«æ˜¯2ï¼ˆè¯¥è¡Œçš„æœ€å¤§å…ƒç´ ä¸º0.6ï¼Œç´¢å¼•ä¸º2ï¼‰ï¼Œè¿™ä¸å®é™…æ ‡ç­¾0ä¸ä¸€è‡´ã€‚ ç¬¬äºŒä¸ªæ ·æœ¬çš„é¢„æµ‹ç±»åˆ«æ˜¯2ï¼ˆè¯¥è¡Œçš„æœ€å¤§å…ƒç´ ä¸º0.5ï¼Œç´¢å¼•ä¸º2ï¼‰ï¼Œè¿™ä¸å®é™…æ ‡ç­¾2ä¸€è‡´ã€‚ å› æ­¤ï¼Œè¿™ä¸¤ä¸ªæ ·æœ¬çš„åˆ†ç±»ç²¾åº¦ç‡ä¸º0.5ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accuracy(y_hat, y) / <span class="built_in">len</span>(y)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.5</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œå¯¹äºä»»æ„æ•°æ®è¿­ä»£å™¨<code>data_iter</code>å¯è®¿é—®çš„æ•°æ®é›†ï¼Œ æˆ‘ä»¬å¯ä»¥è¯„ä¼°åœ¨ä»»æ„æ¨¡å‹<code>net</code>çš„ç²¾åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">evaluate_accuracy</span>(<span class="params">net, data_iter</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¡ç®—åœ¨æŒ‡å®šæ•°æ®é›†ä¸Šæ¨¡å‹çš„ç²¾åº¦&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(net, torch.nn.Module):</span><br><span class="line">        net.<span class="built_in">eval</span>()  <span class="comment"># å°†æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class="line">    metric = Accumulator(<span class="number">2</span>)  <span class="comment"># æ­£ç¡®é¢„æµ‹æ•°ã€é¢„æµ‹æ€»æ•°</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> X, y <span class="keyword">in</span> data_iter:</span><br><span class="line">            metric.add(accuracy(net(X), y), y.numel())</span><br><span class="line">    <span class="keyword">return</span> metric[<span class="number">0</span>] / metric[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰ä¸€ä¸ªå®ç”¨ç¨‹åºç±»<code>Accumulator</code>ï¼Œç”¨äºå¯¹å¤šä¸ªå˜é‡è¿›è¡Œç´¯åŠ ã€‚ åœ¨ä¸Šé¢çš„<code>evaluate_accuracy</code>å‡½æ•°ä¸­ï¼Œ æˆ‘ä»¬åœ¨<code>Accumulator</code>å®ä¾‹ä¸­åˆ›å»ºäº†2ä¸ªå˜é‡ï¼Œ åˆ†åˆ«ç”¨äºå­˜å‚¨æ­£ç¡®é¢„æµ‹çš„æ•°é‡å’Œé¢„æµ‹çš„æ€»æ•°é‡ã€‚ å½“æˆ‘ä»¬éå†æ•°æ®é›†æ—¶ï¼Œä¸¤è€…éƒ½å°†éšç€æ—¶é—´çš„æ¨ç§»è€Œç´¯åŠ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Accumulator</span>:  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;åœ¨nä¸ªå˜é‡ä¸Šç´¯åŠ &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n</span>):</span><br><span class="line">        self.data = [<span class="number">0.0</span>] * n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, *args</span>):</span><br><span class="line">        self.data = [a + <span class="built_in">float</span>(b) <span class="keyword">for</span> a, b <span class="keyword">in</span> <span class="built_in">zip</span>(self.data, args)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        self.data = [<span class="number">0.0</span>] * <span class="built_in">len</span>(self.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):</span><br><span class="line">        <span class="keyword">return</span> self.data[idx]</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬ä½¿ç”¨éšæœºæƒé‡åˆå§‹åŒ–<code>net</code>æ¨¡å‹ï¼Œ å› æ­¤è¯¥æ¨¡å‹çš„ç²¾åº¦åº”æ¥è¿‘äºéšæœºçŒœæµ‹ã€‚ ä¾‹å¦‚åœ¨æœ‰10ä¸ªç±»åˆ«æƒ…å†µä¸‹çš„ç²¾åº¦ä¸º0.1ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evaluate_accuracy(net, test_iter)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.0625</span></span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒ-1"><a href="#è®­ç»ƒ-1" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡æ„è®­ç»ƒè¿‡ç¨‹çš„å®ç°ä»¥ä½¿å…¶å¯é‡å¤ä½¿ç”¨ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è®­ç»ƒä¸€ä¸ªè¿­ä»£å‘¨æœŸã€‚ è¯·æ³¨æ„ï¼Œ<code>updater</code>æ˜¯æ›´æ–°æ¨¡å‹å‚æ•°çš„å¸¸ç”¨å‡½æ•°ï¼Œå®ƒæ¥å—æ‰¹é‡å¤§å°ä½œä¸ºå‚æ•°ã€‚ å®ƒå¯ä»¥æ˜¯<code>d2l.sgd</code>å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¡†æ¶çš„å†…ç½®ä¼˜åŒ–å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train_epoch_ch3</span>(<span class="params">net, train_iter, loss, updater</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®­ç»ƒæ¨¡å‹ä¸€ä¸ªè¿­ä»£å‘¨æœŸï¼ˆå®šä¹‰è§ç¬¬3ç« ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># å°†æ¨¡å‹è®¾ç½®ä¸ºè®­ç»ƒæ¨¡å¼</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(net, torch.nn.Module):</span><br><span class="line">        net.train()</span><br><span class="line">    <span class="comment"># è®­ç»ƒæŸå¤±æ€»å’Œã€è®­ç»ƒå‡†ç¡®åº¦æ€»å’Œã€æ ·æœ¬æ•°</span></span><br><span class="line">    metric = Accumulator(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> train_iter:</span><br><span class="line">        <span class="comment"># è®¡ç®—æ¢¯åº¦å¹¶æ›´æ–°å‚æ•°</span></span><br><span class="line">        y_hat = net(X)</span><br><span class="line">        l = loss(y_hat, y)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(updater, torch.optim.Optimizer):</span><br><span class="line">            <span class="comment"># ä½¿ç”¨PyTorchå†…ç½®çš„ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°</span></span><br><span class="line">            updater.zero_grad()</span><br><span class="line">            l.mean().backward()</span><br><span class="line">            updater.step()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># ä½¿ç”¨å®šåˆ¶çš„ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•°</span></span><br><span class="line">            l.<span class="built_in">sum</span>().backward()</span><br><span class="line">            updater(X.shape[<span class="number">0</span>])</span><br><span class="line">        metric.add(<span class="built_in">float</span>(l.<span class="built_in">sum</span>()), accuracy(y_hat, y), y.numel())</span><br><span class="line">    <span class="comment"># è¿”å›è®­ç»ƒæŸå¤±å’Œè®­ç»ƒç²¾åº¦</span></span><br><span class="line">    <span class="keyword">return</span> metric[<span class="number">0</span>] / metric[<span class="number">2</span>], metric[<span class="number">1</span>] / metric[<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>åœ¨å±•ç¤ºè®­ç»ƒå‡½æ•°çš„å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåœ¨åŠ¨ç”»ä¸­ç»˜åˆ¶æ•°æ®çš„å®ç”¨ç¨‹åºç±»<code>Animator</code>ï¼Œ å®ƒèƒ½å¤Ÿç®€åŒ–æœ¬ä¹¦å…¶ä½™éƒ¨åˆ†çš„ä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animator</span>:  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;åœ¨åŠ¨ç”»ä¸­ç»˜åˆ¶æ•°æ®&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, xlabel=<span class="literal">None</span>, ylabel=<span class="literal">None</span>, legend=<span class="literal">None</span>, xlim=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">                 ylim=<span class="literal">None</span>, xscale=<span class="string">&#x27;linear&#x27;</span>, yscale=<span class="string">&#x27;linear&#x27;</span>,</span></span><br><span class="line"><span class="params">                 fmts=(<span class="params"><span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;m--&#x27;</span>, <span class="string">&#x27;g-.&#x27;</span>, <span class="string">&#x27;r:&#x27;</span></span>), nrows=<span class="number">1</span>, ncols=<span class="number">1</span>,</span></span><br><span class="line"><span class="params">                 figsize=(<span class="params"><span class="number">3.5</span>, <span class="number">2.5</span></span>)</span>):</span><br><span class="line">        <span class="comment"># å¢é‡åœ°ç»˜åˆ¶å¤šæ¡çº¿</span></span><br><span class="line">        <span class="keyword">if</span> legend <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            legend = []</span><br><span class="line">        d2l.use_svg_display()</span><br><span class="line">        self.fig, self.axes = d2l.plt.subplots(nrows, ncols, figsize=figsize)</span><br><span class="line">        <span class="keyword">if</span> nrows * ncols == <span class="number">1</span>:</span><br><span class="line">            self.axes = [self.axes, ]</span><br><span class="line">        <span class="comment"># ä½¿ç”¨lambdaå‡½æ•°æ•è·å‚æ•°</span></span><br><span class="line">        self.config_axes = <span class="keyword">lambda</span>: d2l.set_axes(</span><br><span class="line">            self.axes[<span class="number">0</span>], xlabel, ylabel, xlim, ylim, xscale, yscale, legend)</span><br><span class="line">        self.X, self.Y, self.fmts = <span class="literal">None</span>, <span class="literal">None</span>, fmts</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="comment"># å‘å›¾è¡¨ä¸­æ·»åŠ å¤šä¸ªæ•°æ®ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(y, <span class="string">&quot;__len__&quot;</span>):</span><br><span class="line">            y = [y]</span><br><span class="line">        n = <span class="built_in">len</span>(y)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(x, <span class="string">&quot;__len__&quot;</span>):</span><br><span class="line">            x = [x] * n</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.X:</span><br><span class="line">            self.X = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.Y:</span><br><span class="line">            self.Y = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">        <span class="keyword">for</span> i, (a, b) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(x, y)):</span><br><span class="line">            <span class="keyword">if</span> a <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> b <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                self.X[i].append(a)</span><br><span class="line">                self.Y[i].append(b)</span><br><span class="line">        self.axes[<span class="number">0</span>].cla()</span><br><span class="line">        <span class="keyword">for</span> x, y, fmt <span class="keyword">in</span> <span class="built_in">zip</span>(self.X, self.Y, self.fmts):</span><br><span class="line">            self.axes[<span class="number">0</span>].plot(x, y, fmt)</span><br><span class="line">        self.config_axes()</span><br><span class="line">        display.display(self.fig)</span><br><span class="line">        display.clear_output(wait=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°ä¸€ä¸ªè®­ç»ƒå‡½æ•°ï¼Œ å®ƒä¼šåœ¨<code>train_iter</code>è®¿é—®åˆ°çš„è®­ç»ƒæ•°æ®é›†ä¸Šè®­ç»ƒä¸€ä¸ªæ¨¡å‹<code>net</code>ã€‚ è¯¥è®­ç»ƒå‡½æ•°å°†ä¼šè¿è¡Œå¤šä¸ªè¿­ä»£å‘¨æœŸï¼ˆç”±<code>num_epochs</code>æŒ‡å®šï¼‰ã€‚ åœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸç»“æŸæ—¶ï¼Œåˆ©ç”¨<code>test_iter</code>è®¿é—®åˆ°çš„æµ‹è¯•æ•°æ®é›†å¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°ã€‚ æˆ‘ä»¬å°†åˆ©ç”¨<code>Animator</code>ç±»æ¥å¯è§†åŒ–è®­ç»ƒè¿›åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">train_ch3</span>(<span class="params">net, train_iter, test_iter, loss, num_epochs, updater</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®­ç»ƒæ¨¡å‹ï¼ˆå®šä¹‰è§ç¬¬3ç« ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    animator = Animator(xlabel=<span class="string">&#x27;epoch&#x27;</span>, xlim=[<span class="number">1</span>, num_epochs], ylim=[<span class="number">0.3</span>, <span class="number">0.9</span>],</span><br><span class="line">                        legend=[<span class="string">&#x27;train loss&#x27;</span>, <span class="string">&#x27;train acc&#x27;</span>, <span class="string">&#x27;test acc&#x27;</span>])</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">        train_metrics = train_epoch_ch3(net, train_iter, loss, updater)</span><br><span class="line">        test_acc = evaluate_accuracy(net, test_iter)</span><br><span class="line">        animator.add(epoch + <span class="number">1</span>, train_metrics + (test_acc,))</span><br><span class="line">    train_loss, train_acc = train_metrics</span><br><span class="line">    <span class="keyword">assert</span> train_loss &lt; <span class="number">0.5</span>, train_loss</span><br><span class="line">    <span class="keyword">assert</span> train_acc &lt;= <span class="number">1</span> <span class="keyword">and</span> train_acc &gt; <span class="number">0.7</span>, train_acc</span><br><span class="line">    <span class="keyword">assert</span> test_acc &lt;= <span class="number">1</span> <span class="keyword">and</span> test_acc &gt; <span class="number">0.7</span>, test_acc</span><br></pre></td></tr></table></figure><p>ä½œä¸ºä¸€ä¸ªä»é›¶å¼€å§‹çš„å®ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„ å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™æ¥ä¼˜åŒ–æ¨¡å‹çš„æŸå¤±å‡½æ•°ï¼Œè®¾ç½®å­¦ä¹ ç‡ä¸º0.1ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lr = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">updater</span>(<span class="params">batch_size</span>):</span><br><span class="line">    <span class="keyword">return</span> d2l.sgd([W, b], lr, batch_size)</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬è®­ç»ƒæ¨¡å‹10ä¸ªè¿­ä»£å‘¨æœŸã€‚ è¯·æ³¨æ„ï¼Œè¿­ä»£å‘¨æœŸï¼ˆ<code>num_epochs</code>ï¼‰å’Œå­¦ä¹ ç‡ï¼ˆ<code>lr</code>ï¼‰éƒ½æ˜¯å¯è°ƒèŠ‚çš„è¶…å‚æ•°ã€‚ é€šè¿‡æ›´æ”¹å®ƒä»¬çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æé«˜æ¨¡å‹çš„åˆ†ç±»ç²¾åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_epochs = <span class="number">10</span></span><br><span class="line">train_ch3(net, train_iter, test_iter, cross_entropy, num_epochs, updater)</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch5/9.png" alt="9"></p><h3 id="é¢„æµ‹"><a href="#é¢„æµ‹" class="headerlink" title="é¢„æµ‹"></a>é¢„æµ‹</h3><p>ç°åœ¨è®­ç»ƒå·²ç»å®Œæˆï¼Œæˆ‘ä»¬çš„æ¨¡å‹å·²ç»å‡†å¤‡å¥½å¯¹å›¾åƒè¿›è¡Œåˆ†ç±»é¢„æµ‹ã€‚ ç»™å®šä¸€ç³»åˆ—å›¾åƒï¼Œæˆ‘ä»¬å°†æ¯”è¾ƒå®ƒä»¬çš„å®é™…æ ‡ç­¾ï¼ˆæ–‡æœ¬è¾“å‡ºçš„ç¬¬ä¸€è¡Œï¼‰å’Œæ¨¡å‹é¢„æµ‹ï¼ˆæ–‡æœ¬è¾“å‡ºçš„ç¬¬äºŒè¡Œï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">predict_ch3</span>(<span class="params">net, test_iter, n=<span class="number">6</span></span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;é¢„æµ‹æ ‡ç­¾ï¼ˆå®šä¹‰è§ç¬¬3ç« ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> X, y <span class="keyword">in</span> test_iter:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    trues = d2l.get_fashion_mnist_labels(y)</span><br><span class="line">    preds = d2l.get_fashion_mnist_labels(net(X).argmax(axis=<span class="number">1</span>))</span><br><span class="line">    titles = [true +<span class="string">&#x27;\n&#x27;</span> + pred <span class="keyword">for</span> true, pred <span class="keyword">in</span> <span class="built_in">zip</span>(trues, preds)]</span><br><span class="line">    d2l.show_images(</span><br><span class="line">        X[<span class="number">0</span>:n].reshape((n, <span class="number">28</span>, <span class="number">28</span>)), <span class="number">1</span>, n, titles=titles[<span class="number">0</span>:n])</span><br><span class="line"></span><br><span class="line">predict_ch3(net, test_iter)</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch5/10.png" alt="10"></p><h2 id="softmaxçš„Pytorchå®ç°"><a href="#softmaxçš„Pytorchå®ç°" class="headerlink" title="softmaxçš„Pytorchå®ç°"></a>softmaxçš„Pytorchå®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mxnet <span class="keyword">import</span> gluon, init, npx</span><br><span class="line"><span class="keyword">from</span> mxnet.gluon <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> mxnet <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line">npx.set_np()</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">256</span></span><br><span class="line">train_iter, test_iter = d2l.load_data_fashion_mnist(batch_size)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[07:03:<span class="number">36</span>] ../src/storage/storage.cc:<span class="number">196</span>: Using Pooled (Naive) StorageManager <span class="keyword">for</span> CPU</span><br></pre></td></tr></table></figure><h3 id="åˆå§‹åŒ–æ¨¡å‹å‚æ•°-3"><a href="#åˆå§‹åŒ–æ¨¡å‹å‚æ•°-3" class="headerlink" title="åˆå§‹åŒ–æ¨¡å‹å‚æ•°"></a>åˆå§‹åŒ–æ¨¡å‹å‚æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net = nn.Sequential()</span><br><span class="line">net.add(nn.Dense(<span class="number">10</span>))</span><br><span class="line">net.initialize(init.Normal(sigma=<span class="number">0.01</span>))</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰æŸå¤±å‡½æ•°-3"><a href="#å®šä¹‰æŸå¤±å‡½æ•°-3" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss = gluon.loss.SoftmaxCrossEntropyLoss()</span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–ç®—æ³•"><a href="#ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ä¼˜åŒ–ç®—æ³•"></a>ä¼˜åŒ–ç®—æ³•</h3><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å­¦ä¹ ç‡ä¸º0.1çš„å°æ‰¹é‡éšæœºæ¢¯åº¦ä¸‹é™ä½œä¸ºä¼˜åŒ–ç®—æ³•ã€‚ è¿™ä¸æˆ‘ä»¬åœ¨çº¿æ€§å›å½’ä¾‹å­ä¸­çš„ç›¸åŒï¼Œè¿™è¯´æ˜äº†ä¼˜åŒ–å™¨çš„æ™®é€‚æ€§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trainer = gluon.Trainer(net.collect_params(), <span class="string">&#x27;sgd&#x27;</span>, &#123;<span class="string">&#x27;learning_rate&#x27;</span>: <span class="number">0.1</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="è®­ç»ƒ-2"><a href="#è®­ç»ƒ-2" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num_epochs = <span class="number">10</span></span><br><span class="line">d2l.train_ch3(net, train_iter, test_iter, loss, num_epochs, trainer)</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch5/11.png" alt="11"></p><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-æ¥è‡ªææ²å¤§ç¥çš„å­¦ä¹ ç¬”è®°</p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch4æ–‡æ¡£æŸ¥é˜…</title>
      <link href="/2024/06/12/Pytorch4%E6%96%87%E6%A1%A3%E6%9F%A5%E9%98%85/"/>
      <url>/2024/06/12/Pytorch4%E6%96%87%E6%A1%A3%E6%9F%A5%E9%98%85/</url>
      
        <content type="html"><![CDATA[<h1 id="Pytorch-learning-notes4-â€“æ–‡æ¡£æŸ¥é˜…"><a href="#Pytorch-learning-notes4-â€“æ–‡æ¡£æŸ¥é˜…" class="headerlink" title="Pytorch learning notes4 â€“æ–‡æ¡£æŸ¥é˜…"></a>Pytorch learning notes4 â€“æ–‡æ¡£æŸ¥é˜…</h1><p>â€”â€”â€“æä¾›äº†ä¸€äº›æŸ¥çœ‹PyTorch APIçš„æŒ‡å¯¼ã€‚</p><h2 id="æŸ¥æ‰¾æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œç±»"><a href="#æŸ¥æ‰¾æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œç±»" class="headerlink" title="æŸ¥æ‰¾æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œç±»"></a>æŸ¥æ‰¾æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œç±»</h2><p>ä¸ºäº†çŸ¥é“æ¨¡å—ä¸­å¯ä»¥è°ƒç”¨å“ªäº›å‡½æ•°å’Œç±»ï¼Œå¯ä»¥è°ƒç”¨<code>dir</code>å‡½æ•°ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢éšæœºæ•°ç”Ÿæˆæ¨¡å—ä¸­çš„æ‰€æœ‰å±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(torch.distributions))</span><br></pre></td></tr></table></figure><p>é€šå¸¸å¯ä»¥å¿½ç•¥ä»¥â€œ<code>__</code>â€ï¼ˆåŒä¸‹åˆ’çº¿ï¼‰å¼€å§‹å’Œç»“æŸçš„å‡½æ•°ï¼Œå®ƒä»¬æ˜¯Pythonä¸­çš„ç‰¹æ®Šå¯¹è±¡ï¼Œ æˆ–ä»¥å•ä¸ªâ€œ<code>_</code>â€ï¼ˆå•ä¸‹åˆ’çº¿ï¼‰å¼€å§‹çš„å‡½æ•°ï¼Œå®ƒä»¬é€šå¸¸æ˜¯å†…éƒ¨å‡½æ•°ã€‚ æ ¹æ®å‰©ä½™çš„å‡½æ•°åæˆ–å±æ€§åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šçŒœæµ‹è¿™ä¸ªæ¨¡å—æä¾›äº†å„ç§ç”Ÿæˆéšæœºæ•°çš„æ–¹æ³•ï¼Œ åŒ…æ‹¬ä»å‡åŒ€åˆ†å¸ƒï¼ˆ<code>uniform</code>ï¼‰ã€æ­£æ€åˆ†å¸ƒï¼ˆ<code>normal</code>ï¼‰å’Œå¤šé¡¹åˆ†å¸ƒï¼ˆ<code>multinomial</code>ï¼‰ä¸­é‡‡æ ·ã€‚</p><h2 id="æŸ¥æ‰¾ç‰¹å®šå‡½æ•°å’Œç±»çš„ç”¨æ³•"><a href="#æŸ¥æ‰¾ç‰¹å®šå‡½æ•°å’Œç±»çš„ç”¨æ³•" class="headerlink" title="æŸ¥æ‰¾ç‰¹å®šå‡½æ•°å’Œç±»çš„ç”¨æ³•"></a>æŸ¥æ‰¾ç‰¹å®šå‡½æ•°å’Œç±»çš„ç”¨æ³•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">help</span>(torch.ones)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Help on built-<span class="keyword">in</span> function ones <span class="keyword">in</span> module torch:</span><br><span class="line"></span><br><span class="line">ones(...)</span><br><span class="line">    ones(*size, *, out=<span class="literal">None</span>, dtype=<span class="literal">None</span>, layout=torch.strided, device=<span class="literal">None</span>, requires_grad=<span class="literal">False</span>) -&gt; Tensor</span><br><span class="line"></span><br><span class="line">    Returns a tensor filled <span class="keyword">with</span> the scalar value <span class="number">1</span>, <span class="keyword">with</span> the shape defined</span><br><span class="line">    by the variable argument size.</span><br><span class="line"></span><br><span class="line">    Args:</span><br><span class="line">        size (<span class="built_in">int</span>...): a sequence of integers defining the shape of the output tensor.</span><br><span class="line">            Can be a variable number of arguments <span class="keyword">or</span> a collection like a <span class="built_in">list</span> <span class="keyword">or</span> <span class="built_in">tuple</span>.</span><br><span class="line"></span><br><span class="line">    Keyword arguments:</span><br><span class="line">        out (Tensor, optional): the output tensor.</span><br><span class="line">        dtype (torch.dtype, optional): the desired data <span class="built_in">type</span> of returned tensor.</span><br><span class="line">            Default: <span class="keyword">if</span> <span class="literal">None</span>, uses a <span class="keyword">global</span> default (see torch.set_default_tensor_type()).</span><br><span class="line">        layout (torch.layout, optional): the desired layout of returned Tensor.</span><br><span class="line">            Default: torch.strided.</span><br><span class="line">        device (torch.device, optional): the desired device of returned tensor.</span><br><span class="line">            Default: <span class="keyword">if</span> <span class="literal">None</span>, uses the current device <span class="keyword">for</span> the default tensor <span class="built_in">type</span></span><br><span class="line">            (see torch.set_default_tensor_type()). device will be the CPU</span><br><span class="line">            <span class="keyword">for</span> CPU tensor types <span class="keyword">and</span> the current CUDA device <span class="keyword">for</span> CUDA tensor types.</span><br><span class="line">        requires_grad (<span class="built_in">bool</span>, optional): If autograd should record operations on the</span><br><span class="line">            returned tensor. Default: <span class="literal">False</span>.</span><br><span class="line"></span><br><span class="line">    Example::</span><br><span class="line"></span><br><span class="line">        &gt;&gt;&gt; torch.ones(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        tensor([[ <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>],</span><br><span class="line">                [ <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>]])</span><br><span class="line"></span><br><span class="line">        &gt;&gt;&gt; torch.ones(<span class="number">5</span>)</span><br><span class="line">        tensor([ <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>,  <span class="number">1.</span>])</span><br></pre></td></tr></table></figure><p>ä»æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>ones</code>å‡½æ•°åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šå½¢çŠ¶çš„æ–°å¼ é‡ï¼Œå¹¶å°†æ‰€æœ‰å…ƒç´ å€¼è®¾ç½®ä¸º1ã€‚ ä¸‹é¢æ¥è¿è¡Œä¸€ä¸ªå¿«é€Ÿæµ‹è¯•æ¥ç¡®è®¤è¿™ä¸€è§£é‡Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.ones(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>])</span><br></pre></td></tr></table></figure><p>åœ¨Jupyterè®°äº‹æœ¬ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>?</code>æŒ‡ä»¤åœ¨å¦ä¸€ä¸ªæµè§ˆå™¨çª—å£ä¸­æ˜¾ç¤ºæ–‡æ¡£ã€‚ ä¾‹å¦‚ï¼Œ<code>list?</code>æŒ‡ä»¤å°†åˆ›å»ºä¸<code>help(list)</code>æŒ‡ä»¤å‡ ä¹ç›¸åŒçš„å†…å®¹ï¼Œå¹¶åœ¨æ–°çš„æµè§ˆå™¨çª—å£ä¸­æ˜¾ç¤ºå®ƒã€‚ æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªé—®å·ï¼Œå¦‚<code>list??</code>ï¼Œå°†æ˜¾ç¤ºå®ç°è¯¥å‡½æ•°çš„Pythonä»£ç ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch3è‡ªåŠ¨å¾®åˆ†</title>
      <link href="/2024/06/11/Pytorch3%E8%87%AA%E5%8A%A8%E5%BE%AE%E5%88%86/"/>
      <url>/2024/06/11/Pytorch3%E8%87%AA%E5%8A%A8%E5%BE%AE%E5%88%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Pytorch-learning-notes3-â€“è‡ªåŠ¨å¾®åˆ†"><a href="#Pytorch-learning-notes3-â€“è‡ªåŠ¨å¾®åˆ†" class="headerlink" title="Pytorch learning notes3 â€“è‡ªåŠ¨å¾®åˆ†"></a>Pytorch learning notes3 â€“è‡ªåŠ¨å¾®åˆ†</h1><p>æ±‚å¯¼æ˜¯å‡ ä¹æ‰€æœ‰æ·±åº¦å­¦ä¹ ä¼˜åŒ–ç®—æ³•çš„å…³é”®æ­¥éª¤ã€‚ è™½ç„¶æ±‚å¯¼çš„è®¡ç®—å¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€äº›åŸºæœ¬çš„å¾®ç§¯åˆ†ã€‚ ä½†å¯¹äºå¤æ‚çš„æ¨¡å‹ï¼Œæ‰‹å·¥è¿›è¡Œæ›´æ–°æ˜¯ä¸€ä»¶å¾ˆç—›è‹¦çš„äº‹æƒ…ï¼ˆè€Œä¸”ç»å¸¸å®¹æ˜“å‡ºé”™ï¼‰ã€‚</p><p>æ·±åº¦å­¦ä¹ æ¡†æ¶é€šè¿‡è‡ªåŠ¨è®¡ç®—å¯¼æ•°ï¼Œå³<em>è‡ªåŠ¨å¾®åˆ†</em>ï¼ˆautomatic differentiationï¼‰æ¥åŠ å¿«æ±‚å¯¼ã€‚ å®é™…ä¸­ï¼Œæ ¹æ®è®¾è®¡å¥½çš„æ¨¡å‹ï¼Œç³»ç»Ÿä¼šæ„å»ºä¸€ä¸ª<em>è®¡ç®—å›¾</em>ï¼ˆcomputational graphï¼‰ï¼Œ æ¥è·Ÿè¸ªè®¡ç®—æ˜¯å“ªäº›æ•°æ®é€šè¿‡å“ªäº›æ“ä½œç»„åˆèµ·æ¥äº§ç”Ÿè¾“å‡ºã€‚ è‡ªåŠ¨å¾®åˆ†ä½¿ç³»ç»Ÿèƒ½å¤Ÿéšååå‘ä¼ æ’­æ¢¯åº¦ã€‚ è¿™é‡Œï¼Œ<em>åå‘ä¼ æ’­</em>ï¼ˆbackpropagateï¼‰æ„å‘³ç€è·Ÿè¸ªæ•´ä¸ªè®¡ç®—å›¾ï¼Œå¡«å……å…³äºæ¯ä¸ªå‚æ•°çš„åå¯¼æ•°ã€‚</p><h2 id="A-simple-example"><a href="#A-simple-example" class="headerlink" title="A simple example"></a>A simple example</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">x = torch.arange(<span class="number">4.0</span>)</span><br><span class="line">x</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>])</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬è®¡ç®—ğ‘¦å…³äºğ‘¥çš„æ¢¯åº¦ä¹‹å‰ï¼Œéœ€è¦ä¸€ä¸ªåœ°æ–¹æ¥å­˜å‚¨æ¢¯åº¦ã€‚ é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨æ¯æ¬¡å¯¹ä¸€ä¸ªå‚æ•°æ±‚å¯¼æ—¶éƒ½åˆ†é…æ–°çš„å†…å­˜ã€‚ å› ä¸ºæˆ‘ä»¬ç»å¸¸ä¼šæˆåƒä¸Šä¸‡æ¬¡åœ°æ›´æ–°ç›¸åŒçš„å‚æ•°ï¼Œæ¯æ¬¡éƒ½åˆ†é…æ–°çš„å†…å­˜å¯èƒ½å¾ˆå¿«å°±ä¼šå°†å†…å­˜è€—å°½ã€‚ æ³¨æ„ï¼Œä¸€ä¸ªæ ‡é‡å‡½æ•°å…³äºå‘é‡ğ‘¥çš„æ¢¯åº¦æ˜¯å‘é‡ï¼Œå¹¶ä¸”ä¸ğ‘¥å…·æœ‰ç›¸åŒçš„å½¢çŠ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x.requires_grad_(<span class="literal">True</span>)  <span class="comment"># ç­‰ä»·äºx=torch.arange(4.0,requires_grad=True)</span></span><br><span class="line">x.grad  <span class="comment"># é»˜è®¤å€¼æ˜¯None</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨è®¡ç®—ğ‘¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y = <span class="number">2</span> * torch.dot(x, x)</span><br><span class="line">y</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([ <span class="number">0.</span>,  <span class="number">4.</span>,  <span class="number">8.</span>, <span class="number">12.</span>])</span><br></pre></td></tr></table></figure><p>å‡½æ•°ğ‘¦&#x3D;2ğ‘¥âŠ¤ğ‘¥å…³äºğ‘¥çš„æ¢¯åº¦åº”ä¸º4ğ‘¥ã€‚ è®©æˆ‘ä»¬å¿«é€ŸéªŒè¯è¿™ä¸ªæ¢¯åº¦æ˜¯å¦è®¡ç®—æ­£ç¡®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.grad == <span class="number">4</span> * x</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>])</span><br></pre></td></tr></table></figure><p>ç°åœ¨è®¡ç®—<code>x</code>çš„å¦ä¸€ä¸ªå‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒPyTorchä¼šç´¯ç§¯æ¢¯åº¦ï¼Œæˆ‘ä»¬éœ€è¦æ¸…é™¤ä¹‹å‰çš„å€¼</span></span><br><span class="line">x.grad.zero_()</span><br><span class="line">y = x.<span class="built_in">sum</span>()</span><br><span class="line">y.backward()</span><br><span class="line">x.grad</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>])</span><br></pre></td></tr></table></figure><h2 id="éæ ‡é‡å˜é‡çš„åå‘ä¼ æ’­"><a href="#éæ ‡é‡å˜é‡çš„åå‘ä¼ æ’­" class="headerlink" title="éæ ‡é‡å˜é‡çš„åå‘ä¼ æ’­"></a>éæ ‡é‡å˜é‡çš„åå‘ä¼ æ’­</h2><p>å½“<code>y</code>ä¸æ˜¯æ ‡é‡æ—¶ï¼Œå‘é‡<code>y</code>å…³äºå‘é‡<code>x</code>çš„å¯¼æ•°çš„æœ€è‡ªç„¶è§£é‡Šæ˜¯ä¸€ä¸ªçŸ©é˜µã€‚ å¯¹äºé«˜é˜¶å’Œé«˜ç»´çš„<code>y</code>å’Œ<code>x</code>ï¼Œæ±‚å¯¼çš„ç»“æœå¯ä»¥æ˜¯ä¸€ä¸ªé«˜é˜¶å¼ é‡ã€‚</p><p>ç„¶è€Œï¼Œè™½ç„¶è¿™äº›æ›´å¥‡ç‰¹çš„å¯¹è±¡ç¡®å®å‡ºç°åœ¨é«˜çº§æœºå™¨å­¦ä¹ ä¸­ï¼ˆåŒ…æ‹¬æ·±åº¦å­¦ä¹ ä¸­ï¼‰ï¼Œ ä½†å½“è°ƒç”¨å‘é‡çš„åå‘è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè¯•å›¾è®¡ç®—ä¸€æ‰¹è®­ç»ƒæ ·æœ¬ä¸­æ¯ä¸ªç»„æˆéƒ¨åˆ†çš„æŸå¤±å‡½æ•°çš„å¯¼æ•°ã€‚ è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç›®çš„ä¸æ˜¯è®¡ç®—å¾®åˆ†çŸ©é˜µï¼Œè€Œæ˜¯å•ç‹¬è®¡ç®—æ‰¹é‡ä¸­æ¯ä¸ªæ ·æœ¬çš„åå¯¼æ•°ä¹‹å’Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹éæ ‡é‡è°ƒç”¨backwardéœ€è¦ä¼ å…¥ä¸€ä¸ªgradientå‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šå¾®åˆ†å‡½æ•°å…³äºselfçš„æ¢¯åº¦ã€‚</span></span><br><span class="line"><span class="comment"># æœ¬ä¾‹åªæƒ³æ±‚åå¯¼æ•°çš„å’Œï¼Œæ‰€ä»¥ä¼ é€’ä¸€ä¸ª1çš„æ¢¯åº¦æ˜¯åˆé€‚çš„</span></span><br><span class="line">x.grad.zero_()</span><br><span class="line">y = x * x</span><br><span class="line"><span class="comment"># ç­‰ä»·äºy.backward(torch.ones(len(x)))</span></span><br><span class="line">y.<span class="built_in">sum</span>().backward()</span><br><span class="line">x.grad</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="number">0.</span>, <span class="number">2.</span>, <span class="number">4.</span>, <span class="number">6.</span>])</span><br></pre></td></tr></table></figure><h2 id="åˆ†ç¦»è®¡ç®—"><a href="#åˆ†ç¦»è®¡ç®—" class="headerlink" title="åˆ†ç¦»è®¡ç®—"></a>åˆ†ç¦»è®¡ç®—</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x.grad.zero_()</span><br><span class="line">y = x * x</span><br><span class="line">u = y.detach()</span><br><span class="line">z = u * x</span><br><span class="line"></span><br><span class="line">z.<span class="built_in">sum</span>().backward()</span><br><span class="line">x.grad == u</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>])</span><br></pre></td></tr></table></figure><p>ç”±äºè®°å½•äº†<code>y</code>çš„è®¡ç®—ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥éšååœ¨<code>y</code>ä¸Šè°ƒç”¨åå‘ä¼ æ’­ï¼Œ å¾—åˆ°<code>y=x*x</code>å…³äºçš„<code>x</code>çš„å¯¼æ•°ï¼Œå³<code>2*x</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x.grad.zero_()</span><br><span class="line">y.<span class="built_in">sum</span>().backward()</span><br><span class="line">x.grad == <span class="number">2</span> * x</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor([<span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>, <span class="literal">True</span>])</span><br></pre></td></tr></table></figure><h2 id="Pythonæ§åˆ¶æµçš„æ¢¯åº¦è®¡ç®—"><a href="#Pythonæ§åˆ¶æµçš„æ¢¯åº¦è®¡ç®—" class="headerlink" title="Pythonæ§åˆ¶æµçš„æ¢¯åº¦è®¡ç®—"></a>Pythonæ§åˆ¶æµçš„æ¢¯åº¦è®¡ç®—</h2><p>ä½¿ç”¨è‡ªåŠ¨å¾®åˆ†çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼š å³ä½¿æ„å»ºå‡½æ•°çš„è®¡ç®—å›¾éœ€è¦é€šè¿‡Pythonæ§åˆ¶æµï¼ˆä¾‹å¦‚ï¼Œæ¡ä»¶ã€å¾ªç¯æˆ–ä»»æ„å‡½æ•°è°ƒç”¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è®¡ç®—å¾—åˆ°çš„å˜é‡çš„æ¢¯åº¦ã€‚ åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œ<code>while</code>å¾ªç¯çš„è¿­ä»£æ¬¡æ•°å’Œ<code>if</code>è¯­å¥çš„ç»“æœéƒ½å–å†³äºè¾“å…¥<code>a</code>çš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">a</span>):</span><br><span class="line">    b = a * <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> b.norm() &lt; <span class="number">1000</span>:</span><br><span class="line">        b = b * <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> b.<span class="built_in">sum</span>() &gt; <span class="number">0</span>:</span><br><span class="line">        c = b</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c = <span class="number">100</span> * b</span><br><span class="line">    <span class="keyword">return</span> c</span><br></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬è®¡ç®—æ¢¯åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = torch.randn(size=(), requires_grad=<span class="literal">True</span>)</span><br><span class="line">d = f(a)</span><br><span class="line">d.backward()</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ†æä¸Šé¢å®šä¹‰çš„<code>f</code>å‡½æ•°ã€‚ è¯·æ³¨æ„ï¼Œå®ƒåœ¨å…¶è¾“å…¥<code>a</code>ä¸­æ˜¯åˆ†æ®µçº¿æ€§çš„ã€‚ æ¢è¨€ä¹‹ï¼Œå¯¹äºä»»ä½•<code>a</code>ï¼Œå­˜åœ¨æŸä¸ªå¸¸é‡æ ‡é‡<code>k</code>ï¼Œä½¿å¾—<code>f(a)=k*a</code>ï¼Œå…¶ä¸­<code>k</code>çš„å€¼å–å†³äºè¾“å…¥<code>a</code>ï¼Œå› æ­¤å¯ä»¥ç”¨<code>d/a</code>éªŒè¯æ¢¯åº¦æ˜¯å¦æ­£ç¡®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.grad == d / a</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor(<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><hr><p>â€”â€”æ‘˜è‡³ææ²å¤§ç¥æ•™å­¦æ–‡æ¡£</p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch2å¾®ç§¯åˆ†å®ç°</title>
      <link href="/2024/06/11/Pytorch2%E5%BE%AE%E7%A7%AF%E5%88%86%E5%AE%9E%E7%8E%B0/"/>
      <url>/2024/06/11/Pytorch2%E5%BE%AE%E7%A7%AF%E5%88%86%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="Pytorch-learning-notes2-â€“å¾®ç§¯åˆ†å®ç°"><a href="#Pytorch-learning-notes2-â€“å¾®ç§¯åˆ†å®ç°" class="headerlink" title="Pytorch learning notes2 â€“å¾®ç§¯åˆ†å®ç°"></a>Pytorch learning notes2 â€“å¾®ç§¯åˆ†å®ç°</h1><p>ä¸ºäº†æ›´å¥½åœ°åœ¨pythonä¸­å®ç°å¯¼æ•°ï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ªå®éªŒã€‚ å®šä¹‰ğ‘¢&#x3D;ğ‘“(ğ‘¥)&#x3D;3ğ‘¥2âˆ’4ğ‘¥å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline           <span class="comment"># Jupyterä¸­ä½¿ç”¨çš„é­”æ³•å‘½ä»¤ï¼ˆMagic Commandï¼‰ã€‚åœ¨å•å…ƒæ ¼å†…ç›´æ¥æ˜¾ç¤º Matplotlib ç”Ÿæˆçš„å›¾å½¢</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span> * x ** <span class="number">2</span> - <span class="number">4</span> * x</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¤ğ‘¥&#x3D;1å¹¶è®©â„æ¥è¿‘0ï¼Œ[ğ‘“(ğ‘¥+â„)âˆ’ğ‘“(ğ‘¥)]&#x2F;â„çš„æ•°å€¼ç»“æœæ¥è¿‘2ã€‚ è™½ç„¶è¿™ä¸ªå®éªŒä¸æ˜¯ä¸€ä¸ªæ•°å­¦è¯æ˜ï¼Œä½†ç¨åä¼šçœ‹åˆ°ï¼Œå½“ğ‘¥&#x3D;1æ—¶ï¼Œå¯¼æ•°ğ‘¢â€²æ˜¯2ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">numerical_lim</span>(<span class="params">f, x, h</span>):</span><br><span class="line">    <span class="keyword">return</span> (f(x + h) - f(x)) / h</span><br><span class="line"></span><br><span class="line">h = <span class="number">0.1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;h=<span class="subst">&#123;h:<span class="number">.5</span>f&#125;</span>, numerical limit=<span class="subst">&#123;numerical_lim(f, <span class="number">1</span>, h):<span class="number">.5</span>f&#125;</span>&#x27;</span>)</span><br><span class="line">    h *= <span class="number">0.1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h=<span class="number">0.10000</span>, numerical limit=<span class="number">2.30000</span></span><br><span class="line">h=<span class="number">0.01000</span>, numerical limit=<span class="number">2.03000</span></span><br><span class="line">h=<span class="number">0.00100</span>, numerical limit=<span class="number">2.00300</span></span><br><span class="line">h=<span class="number">0.00010</span>, numerical limit=<span class="number">2.00030</span></span><br><span class="line">h=<span class="number">0.00001</span>, numerical limit=<span class="number">2.00003</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†å¯¹å¯¼æ•°çš„è¿™ç§è§£é‡Šè¿›è¡Œå¯è§†åŒ–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code>**matplotlib**</code>ï¼Œ ä¸€ä¸ªPythonä¸­æµè¡Œçš„ç»˜å›¾åº“ã€‚ è¦é…ç½®<code>matplotlib</code>ç”Ÿæˆå›¾å½¢çš„å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å‡ ä¸ªå‡½æ•°ã€‚ åœ¨ä¸‹é¢ï¼Œ<code>use_svg_display</code>å‡½æ•°æŒ‡å®š<code>matplotlib</code>è½¯ä»¶åŒ…è¾“å‡ºsvgå›¾è¡¨ä»¥è·å¾—æ›´æ¸…æ™°çš„å›¾åƒã€‚</p><p>æ³¨é‡Š<code>#@save</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è®°ï¼Œä¼šå°†å¯¹åº”çš„å‡½æ•°ã€ç±»æˆ–è¯­å¥ä¿å­˜åœ¨<code>d2l</code>åŒ…ä¸­ã€‚ å› æ­¤ï¼Œä»¥åæ— é¡»é‡æ–°å®šä¹‰å°±å¯ä»¥ç›´æ¥è°ƒç”¨å®ƒä»¬ï¼ˆä¾‹å¦‚ï¼Œ<code>d2l.use_svg_display()</code>ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">use_svg_display</span>():  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä½¿ç”¨svgæ ¼å¼åœ¨Jupyterä¸­æ˜¾ç¤ºç»˜å›¾&quot;&quot;&quot;</span></span><br><span class="line">    backend_inline.set_matplotlib_formats(<span class="string">&#x27;svg&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å®šä¹‰<code>set_figsize</code>å‡½æ•°æ¥è®¾ç½®å›¾è¡¨å¤§å°ã€‚ æ³¨æ„ï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>d2l.plt</code>ï¼Œå› ä¸ºå¯¼å…¥è¯­å¥ <code>from matplotlib import pyplot as plt</code>å·²æ ‡è®°ä¸ºä¿å­˜åˆ°<code>d2l</code>åŒ…ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">set_figsize</span>(<span class="params">figsize=(<span class="params"><span class="number">3.5</span>, <span class="number">2.5</span></span>)</span>):  <span class="comment">#@save</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¾ç½®matplotlibçš„å›¾è¡¨å¤§å°&quot;&quot;&quot;</span></span><br><span class="line">    use_svg_display()</span><br><span class="line">    d2l.plt.rcParams[<span class="string">&#x27;figure.figsize&#x27;</span>] = figsize</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„<code>set_axes</code>å‡½æ•°ç”¨äºè®¾ç½®ç”±<code>matplotlib</code>ç”Ÿæˆå›¾è¡¨çš„è½´çš„å±æ€§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_axes</span>(<span class="params">axes, xlabel, ylabel, xlim, ylim, xscale, yscale, legend</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è®¾ç½®matplotlibçš„è½´&quot;&quot;&quot;</span></span><br><span class="line">    axes.set_xlabel(xlabel)</span><br><span class="line">    axes.set_ylabel(ylabel)</span><br><span class="line">    axes.set_xscale(xscale)</span><br><span class="line">    axes.set_yscale(yscale)</span><br><span class="line">    axes.set_xlim(xlim)</span><br><span class="line">    axes.set_ylim(ylim)</span><br><span class="line">    <span class="keyword">if</span> legend:</span><br><span class="line">        axes.legend(legend)</span><br><span class="line">    axes.grid()</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸‰ä¸ªç”¨äºå›¾å½¢é…ç½®çš„å‡½æ•°ï¼Œå®šä¹‰ä¸€ä¸ª<code>plot</code>å‡½æ•°æ¥ç®€æ´åœ°ç»˜åˆ¶å¤šæ¡æ›²çº¿ï¼Œ å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨æ•´ä¸ªä¹¦ä¸­å¯è§†åŒ–è®¸å¤šæ›²çº¿ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#@save</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot</span>(<span class="params">X, Y=<span class="literal">None</span>, xlabel=<span class="literal">None</span>, ylabel=<span class="literal">None</span>, legend=<span class="literal">None</span>, xlim=<span class="literal">None</span>,</span></span><br><span class="line"><span class="params">         ylim=<span class="literal">None</span>, xscale=<span class="string">&#x27;linear&#x27;</span>, yscale=<span class="string">&#x27;linear&#x27;</span>,</span></span><br><span class="line"><span class="params">         fmts=(<span class="params"><span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;m--&#x27;</span>, <span class="string">&#x27;g-.&#x27;</span>, <span class="string">&#x27;r:&#x27;</span></span>), figsize=(<span class="params"><span class="number">3.5</span>, <span class="number">2.5</span></span>), axes=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ç»˜åˆ¶æ•°æ®ç‚¹&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> legend <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        legend = []</span><br><span class="line"></span><br><span class="line">    set_figsize(figsize)</span><br><span class="line">    axes = axes <span class="keyword">if</span> axes <span class="keyword">else</span> d2l.plt.gca()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœXæœ‰ä¸€ä¸ªè½´ï¼Œè¾“å‡ºTrue</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_one_axis</span>(<span class="params">X</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">hasattr</span>(X, <span class="string">&quot;ndim&quot;</span>) <span class="keyword">and</span> X.ndim == <span class="number">1</span> <span class="keyword">or</span> <span class="built_in">isinstance</span>(X, <span class="built_in">list</span>)</span><br><span class="line">                <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(X[<span class="number">0</span>], <span class="string">&quot;__len__&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> has_one_axis(X):</span><br><span class="line">        X = [X]</span><br><span class="line">    <span class="keyword">if</span> Y <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        X, Y = [[]] * <span class="built_in">len</span>(X), X</span><br><span class="line">    <span class="keyword">elif</span> has_one_axis(Y):</span><br><span class="line">        Y = [Y]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(X) != <span class="built_in">len</span>(Y):</span><br><span class="line">        X = X * <span class="built_in">len</span>(Y)</span><br><span class="line">    axes.cla()</span><br><span class="line">    <span class="keyword">for</span> x, y, fmt <span class="keyword">in</span> <span class="built_in">zip</span>(X, Y, fmts):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x):</span><br><span class="line">            axes.plot(x, y, fmt)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            axes.plot(y, fmt)</span><br><span class="line">    set_axes(axes, xlabel, ylabel, xlim, ylim, xscale, yscale, legend)</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç»˜åˆ¶å‡½æ•°ğ‘¢&#x3D;ğ‘“(ğ‘¥)åŠå…¶åœ¨ğ‘¥&#x3D;1å¤„çš„åˆ‡çº¿ğ‘¦&#x3D;2ğ‘¥âˆ’3ï¼Œ å…¶ä¸­ç³»æ•°2æ˜¯åˆ‡çº¿çš„æ–œç‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = np.arange(<span class="number">0</span>, <span class="number">3</span>, <span class="number">0.1</span>)</span><br><span class="line">plot(x, [f(x), <span class="number">2</span> * x - <span class="number">3</span>], <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;f(x)&#x27;</span>, legend=[<span class="string">&#x27;f(x)&#x27;</span>, <span class="string">&#x27;Tangent line (x=1)&#x27;</span>])</span><br></pre></td></tr></table></figure><p><img src="/../img/Pytorch1/pytorch2/1.png" alt="1"></p><h2 id="æ¢¯åº¦"><a href="#æ¢¯åº¦" class="headerlink" title="æ¢¯åº¦"></a>æ¢¯åº¦</h2><p>æˆ‘ä»¬å¯ä»¥è¿ç»“ä¸€ä¸ªå¤šå…ƒå‡½æ•°å¯¹å…¶æ‰€æœ‰å˜é‡çš„åå¯¼æ•°ï¼Œä»¥å¾—åˆ°è¯¥å‡½æ•°çš„<em>æ¢¯åº¦</em>ï¼ˆgradientï¼‰å‘é‡ã€‚ å…·ä½“è€Œè¨€ï¼Œè®¾å‡½æ•°ğ‘“:ğ‘…ğ‘›â†’ğ‘…çš„è¾“å…¥æ˜¯ ä¸€ä¸ªğ‘›ç»´å‘é‡ğ‘¥&#x3D;[ğ‘¥1,ğ‘¥2,â€¦,ğ‘¥ğ‘›]âŠ¤ï¼Œå¹¶ä¸”è¾“å‡ºæ˜¯ä¸€ä¸ªæ ‡é‡ã€‚ å‡½æ•°ğ‘“(ğ‘¥)ç›¸å¯¹äºğ‘¥çš„æ¢¯åº¦æ˜¯ä¸€ä¸ªåŒ…å«ğ‘›ä¸ªåå¯¼æ•°çš„å‘é‡:</p><p><img src="/../img/Pytorch1/pytorch2/2.png" alt="2"></p><p><img src="/../img/Pytorch1/pytorch2/3.png" alt="3"></p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++å®¹å™¨å¸¸ç”¨æ–¹æ³•æ±‡æ€»</title>
      <link href="/2024/06/11/C-%E5%AE%B9%E5%99%A8%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/"/>
      <url>/2024/06/11/C-%E5%AE%B9%E5%99%A8%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E6%B1%87%E6%80%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="C-å®¹å™¨å¸¸ç”¨æ–¹æ³•æ±‡æ€»â€”â€”é™†ç† é¹"><a href="#C-å®¹å™¨å¸¸ç”¨æ–¹æ³•æ±‡æ€»â€”â€”é™†ç† é¹" class="headerlink" title="C++å®¹å™¨å¸¸ç”¨æ–¹æ³•æ±‡æ€»â€”â€”é™†ç† é¹"></a>C++å®¹å™¨å¸¸ç”¨æ–¹æ³•æ±‡æ€»â€”â€”é™†ç† é¹</h1><h2 id="ä¸€-Vector"><a href="#ä¸€-Vector" class="headerlink" title="ä¸€. Vector"></a>ä¸€. Vector</h2><h3 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1. å®šä¹‰"></a>1. å®šä¹‰</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç©ºvector</span></span><br><span class="line">vevtor&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line"><span class="comment">//æŒ‡å®šå…ƒç´ ä¸ªæ•°,ä¸”å€¼å‡ä¸ºt</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vec</span><span class="params">(<span class="type">int</span> sive, <span class="type">int</span> t)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="2-å¢"><a href="#2-å¢" class="headerlink" title="2. å¢"></a>2. å¢</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‘å‘é‡å°¾éƒ¨å¢åŠ ä¸€ä¸ªå…ƒç´ x</span></span><br><span class="line">vec.<span class="built_in">push_back</span>(<span class="type">const</span> T&amp; x);</span><br><span class="line"><span class="comment">//å‘é‡ä¸­è¿­ä»£å™¨æŒ‡å‘å…ƒç´ å‰å¢åŠ ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">vec.<span class="built_in">insert</span>(inerator it,<span class="type">const</span> T&amp; x);</span><br></pre></td></tr></table></figure><p>è¿­ä»£å™¨ä½¿ç”¨example:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; vv=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(vector&lt;<span class="type">int</span>&gt;::iterator it=vv.<span class="built_in">begin</span>();it!=vv.<span class="built_in">end</span>();it++)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;*it&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;endl;</span><br></pre></td></tr></table></figure><h3 id="3-åˆ "><a href="#3-åˆ " class="headerlink" title="3. åˆ "></a>3. åˆ </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ é™¤å‘é‡å°¾éƒ¨æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">vec.<span class="built_in">pop_back</span>();</span><br><span class="line"><span class="comment">//æ¸…ç©ºå‘é‡ä¸­çš„æ‰€æœ‰å…ƒç´ </span></span><br><span class="line">vec.<span class="built_in">clear</span>();</span><br><span class="line"><span class="comment">//åˆ é™¤å‘é‡ä¸­è¿­ä»£å™¨æŒ‡å‘å…ƒç´ </span></span><br><span class="line">vec.<span class="built_in">erase</span>(iterator it);</span><br><span class="line"><span class="built_in">vecerase</span>(iterator first,iterator last);</span><br></pre></td></tr></table></figure><h3 id="4-å±æ€§"><a href="#4-å±æ€§" class="headerlink" title="4. å±æ€§"></a>4. å±æ€§</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vec.<span class="built_in">empty</span>();</span><br><span class="line">vec.<span class="built_in">size</span>();</span><br><span class="line">vec.<span class="built_in">capacity</span>();     <span class="comment">//è¿”å›å½“å‰å‘é‡æ‰€èƒ½å®¹çº³çš„æœ€å¤§å…ƒç´ å€¼</span></span><br></pre></td></tr></table></figure><h2 id="äºŒ-Unordered-map"><a href="#äºŒ-Unordered-map" class="headerlink" title="äºŒ. Unordered_map"></a>äºŒ. Unordered_map</h2><h3 id="1-æ„é€ "><a href="#1-æ„é€ " class="headerlink" title="1. æ„é€ "></a>1. æ„é€ </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;<span class="type">int</span>,<span class="type">int</span>&gt; cac;</span><br></pre></td></tr></table></figure><h3 id="2-å¢-1"><a href="#2-å¢-1" class="headerlink" title="2. å¢"></a>2. å¢</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 3. åˆ </span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line">cac.clear();</span><br></pre></td></tr></table></figure><h3 id="4-å±æ€§-1"><a href="#4-å±æ€§-1" class="headerlink" title="4. å±æ€§"></a>4. å±æ€§</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŸ¥æ‰¾key,æŸ¥åˆ°ååº”å¯¹åº”è¿­ä»£å™¨,è‹¥æ— åˆ™è¿”å›æœ«å°¾è¿­ä»£å™¨</span></span><br><span class="line">cac.<span class="built_in">find</span>(key);</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">cac.<span class="built_in">empty</span>();</span><br><span class="line"><span class="comment">//è¿”å›å½“å‰é”®å€¼å¯¹æ•°é‡</span></span><br><span class="line">cac.<span class="built_in">size</span>();</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-Stack"><a href="#ä¸‰-Stack" class="headerlink" title="ä¸‰. Stack"></a>ä¸‰. Stack</h2><h3 id="1-æ„é€ -1"><a href="#1-æ„é€ -1" class="headerlink" title="1. æ„é€ "></a>1. æ„é€ </h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stack&lt;<span class="type">int</span>&gt; cac;</span><br></pre></td></tr></table></figure><h3 id="2-å¢-2"><a href="#2-å¢-2" class="headerlink" title="2. å¢"></a>2. å¢</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cac.<span class="built_in">push</span>();</span><br></pre></td></tr></table></figure><h3 id="3-åˆ -1"><a href="#3-åˆ -1" class="headerlink" title="3. åˆ "></a>3. åˆ </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cac.<span class="built_in">pop</span>();</span><br></pre></td></tr></table></figure><h3 id="4-æŸ¥"><a href="#4-æŸ¥" class="headerlink" title="4. æŸ¥"></a>4. æŸ¥</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cac.<span class="built_in">top</span>();</span><br></pre></td></tr></table></figure><h3 id="5-å±æ€§"><a href="#5-å±æ€§" class="headerlink" title="5. å±æ€§"></a>5. å±æ€§</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cac.<span class="built_in">empty</span>();</span><br><span class="line">cac.<span class="built_in">size</span>();</span><br></pre></td></tr></table></figure><h2 id="å››-Queue"><a href="#å››-Queue" class="headerlink" title="å››. Queue"></a>å››. Queue</h2><h3 id="1-æ±‡æ€»"><a href="#1-æ±‡æ€»" class="headerlink" title="1. æ±‡æ€»"></a>1. æ±‡æ€»</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">queue&lt;<span class="type">int</span>&gt; cac;</span><br><span class="line"><span class="comment">// è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ å¼•ç”¨</span></span><br><span class="line">cac.<span class="built_in">front</span>()</span><br><span class="line"><span class="comment">// è¿”å›æœ€åä¸€ä¸ªå…ƒç´ å¼•ç”¨</span></span><br><span class="line">cac.<span class="built_in">back</span>()</span><br><span class="line"><span class="comment">// æ·»åŠ å…ƒç´ åˆ°é˜Ÿåˆ—å°¾éƒ¨</span></span><br><span class="line">cac.<span class="built_in">push</span>();</span><br><span class="line"><span class="comment">// åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">cac.<span class="built_in">pop</span>();</span><br><span class="line"><span class="comment">// è¿”å›å½“å‰å…ƒç´ æ•°é‡</span></span><br><span class="line">cac.<span class="built_in">size</span>();</span><br><span class="line"><span class="comment">// æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">cac.<span class="built_in">empty</span>()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Pytorch1çº¿æ€§ä»£æ•°å®ç°</title>
      <link href="/2024/06/11/Pytorch1%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%AE%9E%E7%8E%B0/"/>
      <url>/2024/06/11/Pytorch1%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="Pytorch-learning-notes1-â€“çº¿æ€§ä»£æ•°å®ç°"><a href="#Pytorch-learning-notes1-â€“çº¿æ€§ä»£æ•°å®ç°" class="headerlink" title="Pytorch learning notes1 â€“çº¿æ€§ä»£æ•°å®ç°"></a>Pytorch learning notes1 â€“çº¿æ€§ä»£æ•°å®ç°</h1><h2 id="çŸ©é˜µ"><a href="#çŸ©é˜µ" class="headerlink" title="çŸ©é˜µ"></a>çŸ©é˜µ</h2><p>æ­£å¦‚å‘é‡å°†æ ‡é‡ä»é›¶é˜¶æ¨å¹¿åˆ°ä¸€é˜¶ï¼ŒçŸ©é˜µå°†å‘é‡ä»ä¸€é˜¶æ¨å¹¿åˆ°äºŒé˜¶ã€‚ çŸ©é˜µï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ç²—ä½“ã€å¤§å†™å­—æ¯æ¥è¡¨ç¤º ï¼ˆä¾‹å¦‚ï¼Œğ‘‹ã€ğ‘Œå’Œğ‘ï¼‰ï¼Œ åœ¨ä»£ç ä¸­è¡¨ç¤ºä¸ºå…·æœ‰ä¸¤ä¸ªè½´çš„å¼ é‡ã€‚</p><p>æ•°å­¦è¡¨ç¤ºæ³•ä½¿ç”¨ğ´âˆˆğ‘…ğ‘šÃ—ğ‘› æ¥è¡¨ç¤ºçŸ©é˜µğ´ï¼Œå…¶ç”±ğ‘šè¡Œå’Œğ‘›åˆ—çš„å®å€¼æ ‡é‡ç»„æˆã€‚ æˆ‘ä»¬å¯ä»¥å°†ä»»æ„çŸ©é˜µğ´âˆˆğ‘…ğ‘šÃ—ğ‘›è§†ä¸ºä¸€ä¸ªè¡¨æ ¼ï¼Œ å…¶ä¸­æ¯ä¸ªå…ƒç´ ğ‘ğ‘–ğ‘—å±äºç¬¬ğ‘–è¡Œç¬¬ğ‘—åˆ—ï¼š</p><h3 id="åˆ›å»ºçŸ©é˜µ"><a href="#åˆ›å»ºçŸ©é˜µ" class="headerlink" title="åˆ›å»ºçŸ©é˜µ"></a>åˆ›å»ºçŸ©é˜µ</h3><p>å½“è°ƒç”¨å‡½æ•°æ¥å®ä¾‹åŒ–å¼ é‡æ—¶ï¼Œ æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šä¸¤ä¸ªåˆ†é‡ğ‘šå’Œğ‘›æ¥åˆ›å»ºä¸€ä¸ªå½¢çŠ¶ä¸ºğ‘šÃ—ğ‘›çš„çŸ©é˜µã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A = torch.arange(<span class="number">20</span>).reshape(<span class="number">5</span>, <span class="number">4</span>)</span><br><span class="line">A</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</span><br><span class="line">        [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">        [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>],</span><br><span class="line">        [<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>]])</span><br></pre></td></tr></table></figure><h3 id="çŸ©å½¢è½¬ç½®"><a href="#çŸ©å½¢è½¬ç½®" class="headerlink" title="çŸ©å½¢è½¬ç½®"></a>çŸ©å½¢è½¬ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.T</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">0</span>,  <span class="number">4</span>,  <span class="number">8</span>, <span class="number">12</span>, <span class="number">16</span>],</span><br><span class="line">        [ <span class="number">1</span>,  <span class="number">5</span>,  <span class="number">9</span>, <span class="number">13</span>, <span class="number">17</span>],</span><br><span class="line">        [ <span class="number">2</span>,  <span class="number">6</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">18</span>],</span><br><span class="line">        [ <span class="number">3</span>,  <span class="number">7</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">19</span>]])</span><br></pre></td></tr></table></figure><h2 id="å¼ é‡"><a href="#å¼ é‡" class="headerlink" title="å¼ é‡"></a>å¼ é‡</h2><p>å°±åƒå‘é‡æ˜¯æ ‡é‡çš„æ¨å¹¿ï¼ŒçŸ©é˜µæ˜¯å‘é‡çš„æ¨å¹¿ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºå…·æœ‰æ›´å¤šè½´çš„æ•°æ®ç»“æ„ã€‚ å¼ é‡ï¼ˆæœ¬å°èŠ‚ä¸­çš„â€œå¼ é‡â€æŒ‡ä»£æ•°å¯¹è±¡ï¼‰æ˜¯æè¿°å…·æœ‰ä»»æ„æ•°é‡è½´çš„ğ‘›ç»´æ•°ç»„çš„é€šç”¨æ–¹æ³•ã€‚ ä¾‹å¦‚ï¼Œå‘é‡æ˜¯ä¸€é˜¶å¼ é‡ï¼ŒçŸ©é˜µæ˜¯äºŒé˜¶å¼ é‡ã€‚ å¼ é‡ç”¨ç‰¹æ®Šå­—ä½“çš„å¤§å†™å­—æ¯è¡¨ç¤ºï¼ˆä¾‹å¦‚ï¼Œğ‘‹ã€ğ‘Œå’Œğ‘ï¼‰ï¼Œ å®ƒä»¬çš„ç´¢å¼•æœºåˆ¶ï¼ˆä¾‹å¦‚ğ‘¥ğ‘–ğ‘—ğ‘˜å’Œ[ğ‘‹]1,2ğ‘–âˆ’1,3ï¼‰ä¸çŸ©é˜µç±»ä¼¼ã€‚</p><p>å½“æˆ‘ä»¬å¼€å§‹å¤„ç†å›¾åƒæ—¶ï¼Œå¼ é‡å°†å˜å¾—æ›´åŠ é‡è¦ï¼Œå›¾åƒä»¥ğ‘›ç»´æ•°ç»„å½¢å¼å‡ºç°ï¼Œ å…¶ä¸­3ä¸ªè½´å¯¹åº”äºé«˜åº¦ã€å®½åº¦ï¼Œä»¥åŠä¸€ä¸ª<em>é€šé“</em>ï¼ˆchannelï¼‰è½´ï¼Œ ç”¨äºè¡¨ç¤ºé¢œè‰²é€šé“ï¼ˆçº¢è‰²ã€ç»¿è‰²å’Œè“è‰²ï¼‰ã€‚ ç°åœ¨å…ˆå°†é«˜é˜¶å¼ é‡æš‚æ”¾ä¸€è¾¹ï¼Œè€Œæ˜¯ä¸“æ³¨å­¦ä¹ å…¶åŸºç¡€çŸ¥è¯†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X = torch.arange(<span class="number">24</span>).reshape(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">X</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tensor([[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>],</span><br><span class="line">         [ <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">         [ <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]],</span><br><span class="line"></span><br><span class="line">        [[<span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>],</span><br><span class="line">         [<span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>],</span><br><span class="line">         [<span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>]]])</span><br></pre></td></tr></table></figure><h2 id="å¼ é‡ç®—æ³•çš„åŸºæœ¬æ€§è´¨"><a href="#å¼ é‡ç®—æ³•çš„åŸºæœ¬æ€§è´¨" class="headerlink" title="å¼ é‡ç®—æ³•çš„åŸºæœ¬æ€§è´¨"></a>å¼ é‡ç®—æ³•çš„åŸºæœ¬æ€§è´¨</h2><p> æ ‡é‡ã€å‘é‡ã€çŸ©é˜µå’Œä»»æ„æ•°é‡è½´çš„å¼ é‡ï¼ˆæœ¬å°èŠ‚ä¸­çš„â€œå¼ é‡â€æŒ‡ä»£æ•°å¯¹è±¡ï¼‰æœ‰ä¸€äº›å®ç”¨çš„å±æ€§ã€‚ ä¾‹å¦‚ï¼Œä»æŒ‰å…ƒç´ æ“ä½œçš„å®šä¹‰ä¸­å¯ä»¥æ³¨æ„åˆ°ï¼Œä»»ä½•æŒ‰å…ƒç´ çš„ä¸€å…ƒè¿ç®—éƒ½ä¸ä¼šæ”¹å˜å…¶æ“ä½œæ•°çš„å½¢çŠ¶ã€‚ åŒæ ·ï¼Œç»™å®šå…·æœ‰ç›¸åŒå½¢çŠ¶çš„ä»»æ„ä¸¤ä¸ªå¼ é‡ï¼Œä»»ä½•æŒ‰å…ƒç´ äºŒå…ƒè¿ç®—çš„ç»“æœéƒ½å°†æ˜¯ç›¸åŒå½¢çŠ¶çš„å¼ é‡ã€‚ ä¾‹å¦‚ï¼Œå°†ä¸¤ä¸ªç›¸åŒå½¢çŠ¶çš„çŸ©é˜µç›¸åŠ ï¼Œä¼šåœ¨è¿™ä¸¤ä¸ªçŸ©é˜µä¸Šæ‰§è¡Œå…ƒç´ åŠ æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A = torch.arange(<span class="number">20</span>, dtype=torch.float32).reshape(<span class="number">5</span>, <span class="number">4</span>)</span><br><span class="line">B = A.clone()  <span class="comment"># é€šè¿‡åˆ†é…æ–°å†…å­˜ï¼Œå°†Açš„ä¸€ä¸ªå‰¯æœ¬åˆ†é…ç»™B</span></span><br><span class="line">A, A + B</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(tensor([[ <span class="number">0.</span>,  <span class="number">1.</span>,  <span class="number">2.</span>,  <span class="number">3.</span>],</span><br><span class="line">         [ <span class="number">4.</span>,  <span class="number">5.</span>,  <span class="number">6.</span>,  <span class="number">7.</span>],</span><br><span class="line">         [ <span class="number">8.</span>,  <span class="number">9.</span>, <span class="number">10.</span>, <span class="number">11.</span>],</span><br><span class="line">         [<span class="number">12.</span>, <span class="number">13.</span>, <span class="number">14.</span>, <span class="number">15.</span>],</span><br><span class="line">         [<span class="number">16.</span>, <span class="number">17.</span>, <span class="number">18.</span>, <span class="number">19.</span>]]),</span><br><span class="line"> tensor([[ <span class="number">0.</span>,  <span class="number">2.</span>,  <span class="number">4.</span>,  <span class="number">6.</span>],</span><br><span class="line">         [ <span class="number">8.</span>, <span class="number">10.</span>, <span class="number">12.</span>, <span class="number">14.</span>],</span><br><span class="line">         [<span class="number">16.</span>, <span class="number">18.</span>, <span class="number">20.</span>, <span class="number">22.</span>],</span><br><span class="line">         [<span class="number">24.</span>, <span class="number">26.</span>, <span class="number">28.</span>, <span class="number">30.</span>],</span><br><span class="line">         [<span class="number">32.</span>, <span class="number">34.</span>, <span class="number">36.</span>, <span class="number">38.</span>]]))</span><br></pre></td></tr></table></figure><p>å…·ä½“è€Œè¨€ï¼Œä¸¤ä¸ªçŸ©é˜µçš„æŒ‰å…ƒç´ ä¹˜æ³•ç§°ä¸º<em>Hadamard(å“ˆè¾¾ç )ç§¯</em>ï¼ˆHadamard productï¼‰ï¼ˆæ•°å­¦ç¬¦å·âŠ™ï¼‰ã€‚ å¯¹äºçŸ©é˜µğµâˆˆğ‘…ğ‘šÃ—ğ‘›ï¼Œ å…¶ä¸­ç¬¬ğ‘–è¡Œå’Œç¬¬ğ‘—åˆ—çš„å…ƒç´ æ˜¯ğ‘ğ‘–ğ‘—ã€‚ çŸ©é˜µğ´å’Œğµçš„Hadamardç§¯ä¸ºï¼š</p><p><img src="/../img/Pytorch1/1.jpg" alt="1"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A * B</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tensor([[  <span class="number">0.</span>,   <span class="number">1.</span>,   <span class="number">4.</span>,   <span class="number">9.</span>],</span><br><span class="line">        [ <span class="number">16.</span>,  <span class="number">25.</span>,  <span class="number">36.</span>,  <span class="number">49.</span>],</span><br><span class="line">        [ <span class="number">64.</span>,  <span class="number">81.</span>, <span class="number">100.</span>, <span class="number">121.</span>],</span><br><span class="line">        [<span class="number">144.</span>, <span class="number">169.</span>, <span class="number">196.</span>, <span class="number">225.</span>],</span><br><span class="line">        [<span class="number">256.</span>, <span class="number">289.</span>, <span class="number">324.</span>, <span class="number">361.</span>]])</span><br></pre></td></tr></table></figure><p>å°†å¼ é‡ä¹˜ä»¥æˆ–åŠ ä¸Šä¸€ä¸ªæ ‡é‡ä¸ä¼šæ”¹å˜å¼ é‡çš„å½¢çŠ¶ï¼Œå…¶ä¸­å¼ é‡çš„æ¯ä¸ªå…ƒç´ éƒ½å°†ä¸æ ‡é‡ç›¸åŠ æˆ–ç›¸ä¹˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">2</span></span><br><span class="line">X = torch.arange(<span class="number">24</span>).reshape(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">a + X, (a * X).shape</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(tensor([[[ <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>],</span><br><span class="line">          [ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>],</span><br><span class="line">          [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]],</span><br><span class="line"></span><br><span class="line">         [[<span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>],</span><br><span class="line">          [<span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>],</span><br><span class="line">          [<span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>]]]),</span><br><span class="line"> torch.Size([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))</span><br></pre></td></tr></table></figure><h2 id="é™ç»´"><a href="#é™ç»´" class="headerlink" title="é™ç»´"></a>é™ç»´</h2><p>æˆ‘ä»¬å¯ä»¥å¯¹ä»»æ„å¼ é‡è¿›è¡Œçš„ä¸€ä¸ªæœ‰ç”¨çš„æ“ä½œæ˜¯è®¡ç®—å…¶å…ƒç´ çš„å’Œã€‚ æ•°å­¦è¡¨ç¤ºæ³•ä½¿ç”¨âˆ‘ç¬¦å·è¡¨ç¤ºæ±‚å’Œã€‚ ä¸ºäº†è¡¨ç¤ºé•¿åº¦ä¸ºğ‘‘çš„å‘é‡ä¸­å…ƒç´ çš„æ€»å’Œï¼Œå¯ä»¥è®°ä¸ºâˆ‘ğ‘–&#x3D;1ğ‘‘ğ‘¥ğ‘–ã€‚ åœ¨ä»£ç ä¸­å¯ä»¥è°ƒç”¨è®¡ç®—æ±‚å’Œçš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = torch.arange(<span class="number">4</span>, dtype=torch.float32)</span><br><span class="line">x, x.<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor([<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>]), tensor(<span class="number">6.</span>))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥è¡¨ç¤ºä»»æ„å½¢çŠ¶å¼ é‡çš„å…ƒç´ å’Œã€‚ ä¾‹å¦‚ï¼ŒçŸ©é˜µğ´ä¸­å…ƒç´ çš„å’Œå¯ä»¥è®°ä¸ºâˆ‘ğ‘–&#x3D;1ğ‘šâˆ‘ğ‘—&#x3D;1ğ‘›ğ‘ğ‘–ğ‘—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.shape, A.<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(torch.Size([<span class="number">5</span>, <span class="number">4</span>]), tensor(<span class="number">190.</span>))</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ±‚å’Œå‡½æ•°ä¼šæ²¿æ‰€æœ‰çš„è½´é™ä½å¼ é‡çš„ç»´åº¦ï¼Œä½¿å®ƒå˜ä¸ºä¸€ä¸ªæ ‡é‡ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šå¼ é‡æ²¿å“ªä¸€ä¸ªè½´æ¥é€šè¿‡æ±‚å’Œé™ä½ç»´åº¦ã€‚ ä»¥çŸ©é˜µä¸ºä¾‹ï¼Œä¸ºäº†é€šè¿‡æ±‚å’Œæ‰€æœ‰è¡Œçš„å…ƒç´ æ¥é™ç»´ï¼ˆè½´0ï¼‰ï¼Œå¯ä»¥åœ¨è°ƒç”¨å‡½æ•°æ—¶æŒ‡å®š<code>axis=0</code>ã€‚ ç”±äºè¾“å…¥çŸ©é˜µæ²¿0è½´é™ç»´ä»¥ç”Ÿæˆè¾“å‡ºå‘é‡ï¼Œå› æ­¤è¾“å…¥è½´0çš„ç»´æ•°åœ¨è¾“å‡ºå½¢çŠ¶ä¸­æ¶ˆå¤±ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A_sum_axis0 = A.<span class="built_in">sum</span>(axis=<span class="number">0</span>)          <span class="comment">#è¡Œï¼Œæ±‚å®Œååªå‰©ä¸‹ä¸€è¡Œ</span></span><br><span class="line">A_sum_axis0, A_sum_axis0.shape</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor([<span class="number">40.</span>, <span class="number">45.</span>, <span class="number">50.</span>, <span class="number">55.</span>]), torch.Size([<span class="number">4</span>]))</span><br></pre></td></tr></table></figure><p>æŒ‡å®š<code>axis=1</code>å°†é€šè¿‡æ±‡æ€»æ‰€æœ‰åˆ—çš„å…ƒç´ é™ç»´ï¼ˆè½´1ï¼‰ã€‚å› æ­¤ï¼Œè¾“å…¥è½´1çš„ç»´æ•°åœ¨è¾“å‡ºå½¢çŠ¶ä¸­æ¶ˆå¤±ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A_sum_axis1 = A.<span class="built_in">sum</span>(axis=<span class="number">1</span>)         <span class="comment">#åˆ—ï¼Œæ±‚å®Œååªå‰©ä¸‹ä¸€åˆ—</span></span><br><span class="line">A_sum_axis1, A_sum_axis1.shape</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor([ <span class="number">6.</span>, <span class="number">22.</span>, <span class="number">38.</span>, <span class="number">54.</span>, <span class="number">70.</span>]), torch.Size([<span class="number">5</span>]))</span><br></pre></td></tr></table></figure><p>æ²¿ç€è¡Œå’Œåˆ—å¯¹çŸ©é˜µæ±‚å’Œï¼Œç­‰ä»·äºå¯¹çŸ©é˜µçš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.<span class="built_in">sum</span>(axis=[<span class="number">0</span>, <span class="number">1</span>])  <span class="comment"># ç»“æœå’ŒA.sum()ç›¸åŒ</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªä¸æ±‚å’Œç›¸å…³çš„é‡æ˜¯<em>å¹³å‡å€¼</em>ï¼ˆmeanæˆ–averageï¼‰ã€‚ æˆ‘ä»¬é€šè¿‡å°†æ€»å’Œé™¤ä»¥å…ƒç´ æ€»æ•°æ¥è®¡ç®—å¹³å‡å€¼ã€‚ åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å‡½æ•°æ¥è®¡ç®—ä»»æ„å½¢çŠ¶å¼ é‡çš„å¹³å‡å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.mean(), A.<span class="built_in">sum</span>() / A.numel()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor(<span class="number">9.5000</span>), tensor(<span class="number">9.5000</span>))</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œè®¡ç®—å¹³å‡å€¼çš„å‡½æ•°ä¹Ÿå¯ä»¥æ²¿æŒ‡å®šè½´é™ä½å¼ é‡çš„ç»´åº¦ã€‚</p><h3 id="éé™ç»´æ±‚å’Œ"><a href="#éé™ç»´æ±‚å’Œ" class="headerlink" title="éé™ç»´æ±‚å’Œ"></a>éé™ç»´æ±‚å’Œ</h3><p>æœ‰æ—¶åœ¨è°ƒç”¨å‡½æ•°æ¥è®¡ç®—æ€»å’Œæˆ–å‡å€¼æ—¶ä¿æŒè½´æ•°ä¸å˜ä¼šå¾ˆæœ‰ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sum_A = A.<span class="built_in">sum</span>(axis=<span class="number">1</span>, keepdims=<span class="literal">True</span>)</span><br><span class="line">sum_A</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">6.</span>],</span><br><span class="line">        [<span class="number">22.</span>],</span><br><span class="line">        [<span class="number">38.</span>],</span><br><span class="line">        [<span class="number">54.</span>],</span><br><span class="line">        [<span class="number">70.</span>]])</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æƒ³æ²¿æŸä¸ªè½´è®¡ç®—<code>A</code>å…ƒç´ çš„ç´¯ç§¯æ€»å’Œï¼Œ æ¯”å¦‚<code>axis=0</code>ï¼ˆæŒ‰è¡Œè®¡ç®—ï¼‰ï¼Œå¯ä»¥è°ƒç”¨<code>cumsum</code>å‡½æ•°ã€‚ æ­¤å‡½æ•°ä¸ä¼šæ²¿ä»»ä½•è½´é™ä½è¾“å…¥å¼ é‡çš„ç»´åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.cumsum(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">0.</span>,  <span class="number">1.</span>,  <span class="number">2.</span>,  <span class="number">3.</span>],</span><br><span class="line">        [ <span class="number">4.</span>,  <span class="number">6.</span>,  <span class="number">8.</span>, <span class="number">10.</span>],</span><br><span class="line">        [<span class="number">12.</span>, <span class="number">15.</span>, <span class="number">18.</span>, <span class="number">21.</span>],</span><br><span class="line">        [<span class="number">24.</span>, <span class="number">28.</span>, <span class="number">32.</span>, <span class="number">36.</span>],</span><br><span class="line">        [<span class="number">40.</span>, <span class="number">45.</span>, <span class="number">50.</span>, <span class="number">55.</span>]])</span><br></pre></td></tr></table></figure><h2 id="ç‚¹ç§¯ï¼ˆDot-Productï¼‰"><a href="#ç‚¹ç§¯ï¼ˆDot-Productï¼‰" class="headerlink" title="ç‚¹ç§¯ï¼ˆDot Productï¼‰"></a>ç‚¹ç§¯ï¼ˆDot Productï¼‰</h2><p>æˆ‘ä»¬å·²ç»å­¦ä¹ äº†æŒ‰å…ƒç´ æ“ä½œã€æ±‚å’ŒåŠå¹³å‡å€¼ã€‚ å¦ä¸€ä¸ªæœ€åŸºæœ¬çš„æ“ä½œä¹‹ä¸€æ˜¯ç‚¹ç§¯ã€‚ ç»™å®šä¸¤ä¸ªå‘é‡ğ‘¥,ğ‘¦âˆˆğ‘…ğ‘‘ï¼Œ å®ƒä»¬çš„<em>ç‚¹ç§¯</em>ï¼ˆdot productï¼‰ğ‘¥âŠ¤ğ‘¦ ï¼ˆæˆ–âŸ¨ğ‘¥,ğ‘¦âŸ©ï¼‰ æ˜¯ç›¸åŒä½ç½®çš„æŒ‰å…ƒç´ ä¹˜ç§¯çš„å’Œï¼šğ‘¥âŠ¤ğ‘¦&#x3D;âˆ‘ğ‘–&#x3D;1ğ‘‘ğ‘¥ğ‘–ğ‘¦ğ‘–ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y = torch.ones(<span class="number">4</span>, dtype = torch.float32)</span><br><span class="line">x, y, torch.dot(x, y)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(tensor([<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>]), tensor([<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>]), tensor(<span class="number">6.</span>))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ‰§è¡ŒæŒ‰å…ƒç´ ä¹˜æ³•ï¼Œç„¶åè¿›è¡Œæ±‚å’Œæ¥è¡¨ç¤ºä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.<span class="built_in">sum</span>(x * y)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor(<span class="number">6.</span>)</span><br></pre></td></tr></table></figure><p>ç‚¹ç§¯åœ¨å¾ˆå¤šåœºåˆéƒ½å¾ˆæœ‰ç”¨ã€‚ ä¾‹å¦‚ï¼Œç»™å®šä¸€ç»„ç”±å‘é‡ğ‘¥âˆˆğ‘…ğ‘‘è¡¨ç¤ºçš„å€¼ï¼Œ å’Œä¸€ç»„ç”±ğ‘¤âˆˆğ‘…ğ‘‘è¡¨ç¤ºçš„æƒé‡ã€‚ ğ‘¥ä¸­çš„å€¼æ ¹æ®æƒé‡ğ‘¤çš„åŠ æƒå’Œï¼Œ å¯ä»¥è¡¨ç¤ºä¸ºç‚¹ç§¯ğ‘¥âŠ¤ğ‘¤ã€‚ å½“æƒé‡ä¸ºéè´Ÿæ•°ä¸”å’Œä¸º1ï¼ˆå³(âˆ‘ğ‘–&#x3D;1ğ‘‘ğ‘¤ğ‘–&#x3D;1)ï¼‰æ—¶ï¼Œ ç‚¹ç§¯è¡¨ç¤º<em>åŠ æƒå¹³å‡</em>ï¼ˆweighted averageï¼‰ã€‚ å°†ä¸¤ä¸ªå‘é‡è§„èŒƒåŒ–å¾—åˆ°å•ä½é•¿åº¦åï¼Œç‚¹ç§¯è¡¨ç¤ºå®ƒä»¬å¤¹è§’çš„ä½™å¼¦</p><h2 id="çŸ©é˜µ-å‘é‡ç§¯"><a href="#çŸ©é˜µ-å‘é‡ç§¯" class="headerlink" title="çŸ©é˜µ-å‘é‡ç§¯"></a>çŸ©é˜µ-å‘é‡ç§¯</h2><p>å›é¡¾çŸ©é˜µğ´âˆˆğ‘…ğ‘šÃ—ğ‘›å’Œå‘é‡ğ‘¥âˆˆğ‘…ğ‘›ã€‚ è®©æˆ‘ä»¬å°†çŸ©é˜µğ´ç”¨å®ƒçš„è¡Œå‘é‡è¡¨ç¤ºï¼š</p><p><img src="/../img/Pytorch1/2.jpg" alt="2"></p><p>æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªçŸ©é˜µğ´âˆˆğ‘…ğ‘šÃ—ğ‘›ä¹˜æ³•çœ‹ä½œä¸€ä¸ªä»ğ‘…ğ‘›åˆ°ğ‘…ğ‘šå‘é‡çš„è½¬æ¢ã€‚ è¿™äº›è½¬æ¢æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œä¾‹å¦‚å¯ä»¥ç”¨æ–¹é˜µçš„ä¹˜æ³•æ¥è¡¨ç¤ºæ—‹è½¬ã€‚ åç»­ç« èŠ‚å°†è®²åˆ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨çŸ©é˜µ-å‘é‡ç§¯æ¥æè¿°åœ¨ç»™å®šå‰ä¸€å±‚çš„å€¼æ—¶ï¼Œ æ±‚è§£ç¥ç»ç½‘ç»œæ¯ä¸€å±‚æ‰€éœ€çš„å¤æ‚è®¡ç®—ã€‚</p><p>åœ¨ä»£ç ä¸­ä½¿ç”¨å¼ é‡è¡¨ç¤ºçŸ©é˜µ-å‘é‡ç§¯ï¼Œæˆ‘ä»¬ä½¿ç”¨**<code>mv</code>å‡½æ•°<strong>ã€‚ å½“æˆ‘ä»¬ä¸ºçŸ©é˜µ<code>A</code>å’Œå‘é‡<code>x</code>è°ƒç”¨<code>torch.mv(A, x)</code>æ—¶ï¼Œä¼šæ‰§è¡ŒçŸ©é˜µ-å‘é‡ç§¯ã€‚ æ³¨æ„ï¼Œ</strong><code>A</code>çš„åˆ—ç»´æ•°ï¼ˆæ²¿è½´1çš„é•¿åº¦ï¼‰å¿…é¡»ä¸<code>x</code>çš„ç»´æ•°ï¼ˆå…¶é•¿åº¦ï¼‰ç›¸åŒ**ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A.shape, x.shape, torch.mv(A, x)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(torch.Size([<span class="number">5</span>, <span class="number">4</span>]), torch.Size([<span class="number">4</span>]), tensor([ <span class="number">14.</span>,  <span class="number">38.</span>,  <span class="number">62.</span>,  <span class="number">86.</span>, <span class="number">110.</span>]))</span><br></pre></td></tr></table></figure><p>å›¾ç‰‡è§£é‡Šï¼š</p><p><img src="/../img/Pytorch1/3.jpg" alt="3"></p><h2 id="çŸ©é˜µ-çŸ©é˜µä¹˜æ³•"><a href="#çŸ©é˜µ-çŸ©é˜µä¹˜æ³•" class="headerlink" title="çŸ©é˜µ-çŸ©é˜µä¹˜æ³•"></a>çŸ©é˜µ-çŸ©é˜µä¹˜æ³•</h2><p>å‡è®¾æœ‰ä¸¤ä¸ªçŸ©é˜µğ´âˆˆğ‘…ğ‘›Ã—ğ‘˜å’Œğµâˆˆğ‘…ğ‘˜Ã—ğ‘š</p><p>æˆ‘ä»¬å¯ä»¥å°†çŸ©é˜µ-çŸ©é˜µä¹˜æ³•ABçœ‹ä½œç®€å•åœ°æ‰§è¡Œğ‘šæ¬¡çŸ©é˜µ-å‘é‡ç§¯ï¼Œå¹¶å°†ç»“æœæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªğ‘›Ã—ğ‘šçŸ©é˜µã€‚ åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨<code>A</code>å’Œ<code>B</code>ä¸Šæ‰§è¡ŒçŸ©é˜µä¹˜æ³•ã€‚ è¿™é‡Œçš„<code>A</code>æ˜¯ä¸€ä¸ª5è¡Œ4åˆ—çš„çŸ©é˜µï¼Œ<code>B</code>æ˜¯ä¸€ä¸ª4è¡Œ3åˆ—çš„çŸ©é˜µã€‚ ä¸¤è€…ç›¸ä¹˜åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª5è¡Œ3åˆ—çš„çŸ©é˜µã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">B = torch.ones(<span class="number">4</span>, <span class="number">3</span>)</span><br><span class="line">torch.mm(A, B)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tensor([[ <span class="number">6.</span>,  <span class="number">6.</span>,  <span class="number">6.</span>],</span><br><span class="line">        [<span class="number">22.</span>, <span class="number">22.</span>, <span class="number">22.</span>],</span><br><span class="line">        [<span class="number">38.</span>, <span class="number">38.</span>, <span class="number">38.</span>],</span><br><span class="line">        [<span class="number">54.</span>, <span class="number">54.</span>, <span class="number">54.</span>],</span><br><span class="line">        [<span class="number">70.</span>, <span class="number">70.</span>, <span class="number">70.</span>]])</span><br></pre></td></tr></table></figure><p>çŸ©é˜µ-çŸ©é˜µä¹˜æ³•å¯ä»¥ç®€å•åœ°ç§°ä¸º<strong>çŸ©é˜µä¹˜æ³•</strong>ï¼Œä¸åº”ä¸â€œHadamardç§¯â€æ··æ·†</p><h2 id="èŒƒæ•°"><a href="#èŒƒæ•°" class="headerlink" title="èŒƒæ•°"></a>èŒƒæ•°</h2><p>æ€§ä»£æ•°ä¸­æœ€æœ‰ç”¨çš„ä¸€äº›è¿ç®—ç¬¦æ˜¯<em>èŒƒæ•°</em>ï¼ˆnormï¼‰ã€‚ éæ­£å¼åœ°è¯´ï¼Œå‘é‡çš„<em>èŒƒæ•°</em>æ˜¯è¡¨ç¤ºä¸€ä¸ªå‘é‡æœ‰å¤šå¤§ã€‚ è¿™é‡Œè€ƒè™‘çš„<em>å¤§å°</em>ï¼ˆsizeï¼‰æ¦‚å¿µä¸æ¶‰åŠç»´åº¦ï¼Œè€Œæ˜¯åˆ†é‡çš„å¤§å°ã€‚</p><p>åœ¨çº¿æ€§ä»£æ•°ä¸­ï¼Œå‘é‡èŒƒæ•°æ˜¯å°†å‘é‡æ˜ å°„åˆ°æ ‡é‡çš„å‡½æ•°ğ‘“ã€‚ ç»™å®šä»»æ„å‘é‡ğ‘¥ï¼Œå‘é‡èŒƒæ•°è¦æ»¡è¶³ä¸€äº›å±æ€§ã€‚ ç¬¬ä¸€ä¸ªæ€§è´¨æ˜¯ï¼šå¦‚æœæˆ‘ä»¬æŒ‰å¸¸æ•°å› å­ğ›¼ç¼©æ”¾å‘é‡çš„æ‰€æœ‰å…ƒç´ ï¼Œ å…¶èŒƒæ•°ä¹Ÿä¼šæŒ‰ç›¸åŒå¸¸æ•°å› å­çš„<em>ç»å¯¹å€¼</em>ç¼©æ”¾ï¼š</p><p>â€‹                                                                                                      ğ‘“(ğ›¼ğ‘¥)&#x3D;|ğ›¼|ğ‘“(ğ‘¥).</p><p>ç¬¬äºŒä¸ªæ€§è´¨æ˜¯ç†Ÿæ‚‰çš„ä¸‰è§’ä¸ç­‰å¼:</p><p>â€‹                                                                                                    ğ‘“(ğ‘¥+ğ‘¦)â‰¤ğ‘“(ğ‘¥)+ğ‘“(ğ‘¦).</p><p>ç¬¬ä¸‰ä¸ªæ€§è´¨ç®€å•åœ°è¯´èŒƒæ•°å¿…é¡»æ˜¯éè´Ÿçš„:</p><p>â€‹                                                                                                             ğ‘“(ğ‘¥)â‰¥0.</p><p>è¿™æ˜¯æœ‰é“ç†çš„ã€‚å› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»»ä½•ä¸œè¥¿çš„æœ€å°çš„<em>å¤§å°</em>æ˜¯0ã€‚ æœ€åä¸€ä¸ªæ€§è´¨è¦æ±‚èŒƒæ•°æœ€å°ä¸º0ï¼Œå½“ä¸”ä»…å½“å‘é‡å…¨ç”±0ç»„æˆã€‚</p><p>â€‹                                                                                            âˆ€ğ‘–,[ğ‘¥]ğ‘–&#x3D;0â‡”ğ‘“(ğ‘¥)&#x3D;0.</p><p>èŒƒæ•°å¬èµ·æ¥å¾ˆåƒè·ç¦»çš„åº¦é‡ã€‚ æ¬§å‡ é‡Œå¾—è·ç¦»å’Œæ¯•è¾¾å“¥æ‹‰æ–¯å®šç†ä¸­çš„éè´Ÿæ€§æ¦‚å¿µå’Œä¸‰è§’ä¸ç­‰å¼å¯èƒ½ä¼šç»™å‡ºä¸€äº›å¯å‘ã€‚ äº‹å®ä¸Šï¼Œæ¬§å‡ é‡Œå¾—è·ç¦»æ˜¯ä¸€ä¸ªğ¿2èŒƒæ•°ï¼š å‡è®¾ğ‘›ç»´å‘é‡ğ‘¥ä¸­çš„å…ƒç´ æ˜¯ğ‘¥1,â€¦,ğ‘¥ğ‘›ï¼Œå…¶ğ¿2<em>èŒƒæ•°</em>æ˜¯å‘é‡å…ƒç´ å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ï¼š   </p><p><img src="/../img/Pytorch1/4.png" alt="4">                                                                     </p><p>å…¶ä¸­ï¼Œåœ¨ğ¿2èŒƒæ•°ä¸­å¸¸å¸¸çœç•¥ä¸‹æ ‡2ï¼Œä¹Ÿå°±æ˜¯è¯´â€–ğ‘¥â€–ç­‰åŒäºâ€–ğ‘¥â€–2ã€‚ åœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¡ç®—å‘é‡çš„ğ¿2èŒƒæ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u = torch.tensor([<span class="number">3.0</span>, -<span class="number">4.0</span>])</span><br><span class="line">torch.norm(u)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor(<span class="number">5.</span>)</span><br></pre></td></tr></table></figure><p>æ·±åº¦å­¦ä¹ ä¸­æ›´ç»å¸¸åœ°ä½¿ç”¨ğ¿2èŒƒæ•°çš„å¹³æ–¹ï¼Œä¹Ÿä¼šç»å¸¸é‡åˆ°ğ¿1èŒƒæ•°ï¼Œå®ƒè¡¨ç¤ºä¸ºå‘é‡å…ƒç´ çš„ç»å¯¹å€¼ä¹‹å’Œï¼š</p><p><img src="/../img/Pytorch1/5.png" alt="5"></p><p>ä¸ğ¿2èŒƒæ•°ç›¸æ¯”ï¼Œğ¿1èŒƒæ•°å—å¼‚å¸¸å€¼çš„å½±å“è¾ƒå°ã€‚ ä¸ºäº†è®¡ç®—ğ¿1èŒƒæ•°ï¼Œæˆ‘ä»¬å°†ç»å¯¹å€¼å‡½æ•°å’ŒæŒ‰å…ƒç´ æ±‚å’Œç»„åˆèµ·æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.<span class="built_in">abs</span>(u).<span class="built_in">sum</span>()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor(<span class="number">7.</span>)</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼äºå‘é‡çš„ğ¿2èŒƒæ•°ï¼ŒçŸ©é˜µğ‘‹âˆˆğ‘…ğ‘šÃ—ğ‘›çš„<em>FrobeniusèŒƒæ•°</em>ï¼ˆFrobenius normï¼‰æ˜¯çŸ©é˜µå…ƒç´ å¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ï¼š</p><p><img src="/../img/Pytorch1/6.png" alt="6"></p><p>FrobeniusèŒƒæ•°æ»¡è¶³å‘é‡èŒƒæ•°çš„æ‰€æœ‰æ€§è´¨ï¼Œå®ƒå°±åƒæ˜¯çŸ©é˜µå½¢å‘é‡çš„ğ¿2èŒƒæ•°ã€‚ è°ƒç”¨ä»¥ä¸‹å‡½æ•°å°†è®¡ç®—çŸ©é˜µçš„FrobeniusèŒƒæ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.norm(torch.ones((<span class="number">4</span>, <span class="number">9</span>)))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensor(<span class="number">6.</span>)</span><br></pre></td></tr></table></figure><hr><p>â€‹                                                                                                                                                                                  â€”â€”æ–‡ç« ç”±æ²ç¥çš„æ•™å­¦æ–‡æ¡£æ”¹ç¼–</p>]]></content>
      
      
      
        <tags>
            
            <tag> machine-learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå…¥é—¨</title>
      <link href="/2024/06/10/Docker/"/>
      <url>/2024/06/10/Docker/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="1-åŸºæœ¬æ“ä½œ"><a href="#1-åŸºæœ¬æ“ä½œ" class="headerlink" title="1.åŸºæœ¬æ“ä½œ"></a>1.åŸºæœ¬æ“ä½œ</h2><p>ç™»å½•docker hub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker login   </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>docker tag</code> å‘½ä»¤ç»™æœ¬åœ°é•œåƒæ‰“æ ‡ç­¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag demo-docker:1.0 lypsdocker/teacherspringboot1:1.0</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>demo-docker:1.0</code> æ˜¯ä½ æœ¬åœ°é•œåƒçš„åå­—å’Œæ ‡ç­¾ï¼Œ<code>lypsdocker/teacherspringboot1:1.0</code> æ˜¯ä½ æƒ³è¦æ¨é€åˆ° Docker Hub çš„ç”¨æˆ·åã€ä»“åº“åå’Œæ ‡ç­¾ã€‚</p><p>ä½¿ç”¨ <code>docker push</code> å‘½ä»¤æ¨é€é•œåƒåˆ° Docker Hub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push lypsdocker/teacherspringboot1:1.0</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><p>åœæ­¢å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop demo-docker</span><br></pre></td></tr></table></figure><p>è¿™å°†åœæ­¢åä¸º<code>demo-docker</code>çš„å®¹å™¨.</p><p>å¯åŠ¨å®¹å™¨ï¼ˆå¦‚æœä¹‹å‰å·²ç»åœæ­¢ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start demo-docker</span><br></pre></td></tr></table></figure><p>åˆ é™¤å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> demo-docker</span><br></pre></td></tr></table></figure><p>è¿›å…¥å®¹å™¨å†…éƒ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it demo-docker /bin/bash</span><br></pre></td></tr></table></figure><h2 id="2-åˆ›å»ºé•œåƒå’Œå®¹å™¨å¹¶ä¸Šä¼ åˆ°Docker-hub"><a href="#2-åˆ›å»ºé•œåƒå’Œå®¹å™¨å¹¶ä¸Šä¼ åˆ°Docker-hub" class="headerlink" title="2.åˆ›å»ºé•œåƒå’Œå®¹å™¨å¹¶ä¸Šä¼ åˆ°Docker hub"></a>2.åˆ›å»ºé•œåƒå’Œå®¹å™¨å¹¶ä¸Šä¼ åˆ°Docker hub</h2><h2 id="3-ä»Docker-bub-ä¸Šæ‹‰å–é•œåƒå¹¶åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ"><a href="#3-ä»Docker-bub-ä¸Šæ‹‰å–é•œåƒå¹¶åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ" class="headerlink" title="3.ä»Docker bub ä¸Šæ‹‰å–é•œåƒå¹¶åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ"></a>3.ä»Docker bub ä¸Šæ‹‰å–é•œåƒå¹¶åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</h2><p>æ‹‰å–é•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull lypsdocker/teacherspringboot1:1.0</span><br></pre></td></tr></table></figure><p>ä½ çš„Docker Hubç”¨æˆ·åæ˜¯<code>lypsdocker</code>ï¼Œå¹¶ä¸”ä½ è¦æ‹‰å–çš„é•œåƒåç§°æ˜¯<code>demo-docker</code>ï¼Œæ ‡ç­¾æ˜¯<code>1.0</code></p><p>è¿è¡Œdockerå®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name my-springboot-app -p 9090:9090 lypsdocker/teacherspringboot1:1.0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name my-container-name my-app</span><br></pre></td></tr></table></figure><ul><li><p><code>-d</code>ï¼šåœ¨â€œåˆ†ç¦»â€æ¨¡å¼ä¸‹è¿è¡Œå®¹å™¨ï¼Œè¿™æ„å‘³ç€å®¹å™¨å°†åœ¨åå°è¿è¡Œï¼Œå¹¶è¿”å›å®¹å™¨IDã€‚</p></li><li><p><code>--name my-container-name</code>ï¼šç»™å®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œè¿™æ ·ä½ å¯ä»¥æ›´å®¹æ˜“åœ°å¼•ç”¨å®ƒã€‚</p></li><li><p><code>-p</code> æˆ– <code>--publish</code>ï¼šå°†å®¹å™¨çš„ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ã€‚ä¾‹å¦‚ï¼Œ<code>-p 8080:80</code> ä¼šå°†å®¹å™¨å†…çš„80ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„8080ç«¯å£ã€‚</p></li><li><p><code>-v</code> æˆ– <code>--volume</code>ï¼šæŒ‚è½½å®¿ä¸»æœºçš„ç›®å½•æˆ–æ–‡ä»¶åˆ°å®¹å™¨å†…ã€‚ä¾‹å¦‚ï¼Œ<code>-v /host/path:/container/path</code> ä¼šå°†å®¿ä¸»æœºçš„<code>/host/path</code>ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„<code>/container/path</code>ç›®å½•ã€‚</p></li><li><p><code>--env</code> æˆ– <code>-e</code>ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼Œ<code>-e &quot;VAR_NAME=value&quot;</code> ä¼šåœ¨å®¹å™¨å†…è®¾ç½®ä¸€ä¸ªåä¸º<code>VAR_NAME</code>çš„ç¯å¢ƒå˜é‡ï¼Œå…¶å€¼ä¸º<code>value</code>ã€‚</p></li><li><p><code>--network</code>ï¼šæŒ‡å®šå®¹å™¨ä½¿ç”¨çš„ç½‘ç»œã€‚</p></li><li><p><code>--restart</code>ï¼šè®¾ç½®å®¹å™¨çš„é‡å¯ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œ<code>--restart=always</code> ä¼šä½¿å®¹å™¨åœ¨é€€å‡ºæ—¶æ€»æ˜¯é‡æ–°å¯åŠ¨ã€‚</p></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/06/08/hello-world/"/>
      <url>/2024/06/08/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
